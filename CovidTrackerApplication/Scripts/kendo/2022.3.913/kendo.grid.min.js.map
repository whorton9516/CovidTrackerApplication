{"version":3,"file":"kendo.grid.min.js","sources":["kendo.grid.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.grid',[\n        \"kendo.data\",\n        \"kendo.columnsorter\",\n        \"kendo.editable\",\n        \"kendo.window\",\n        \"kendo.filtermenu\",\n        \"kendo.filtercell\",\n        \"kendo.columnmenu\",\n        \"kendo.groupable\",\n        \"kendo.pager\",\n        \"kendo.selectable\",\n        \"kendo.sortable\",\n        \"kendo.reorderable\",\n        \"kendo.resizable\",\n        \"kendo.ooxml\",\n        \"kendo.excel\",\n        \"kendo.pane\",\n        \"kendo.progressbar\",\n        \"kendo.pdf\",\n        \"kendo.dialog\",\n        \"kendo.pane\",\n        \"kendo.switch\",\n        \"kendo.html.button\",\n        \"kendo.textbox\",\n        \"kendo.form\"\n    ], f);\n})(function() {\n\nvar __meta__ = {\n    id: \"grid\",\n    name: \"Grid\",\n    category: \"web\",\n    description: \"The Grid widget displays tabular data and offers rich support for interacting with data,including paging, sorting, grouping, and selection.\",\n    depends: [ \"data\", \"columnsorter\", \"sortable\", \"html.button\" ],\n    features: [ {\n        id: \"grid-editing\",\n        name: \"Editing\",\n        description: \"Support for record editing\",\n        depends: [ \"editable\", \"window\", \"textbox\", \"form\" ]\n    }, {\n        id: \"grid-filtering\",\n        name: \"Filtering\",\n        description: \"Support for record filtering\",\n        depends: [ \"filtermenu\" ]\n    }, {\n        id: \"grid-columnmenu\",\n        name: \"Column menu\",\n        description: \"Support for header column menu\",\n        depends: [ \"columnmenu\" ]\n    }, {\n        id: \"grid-grouping\",\n        name: \"Grouping\",\n        description: \"Support for grid grouping\",\n        depends: [ \"groupable\" ]\n    }, {\n        id: \"grid-filtercell\",\n        name: \"Row filter\",\n        description: \"Support for grid header filtering\",\n        depends: [ \"filtercell\" ]\n    }, {\n        id: \"grid-paging\",\n        name: \"Paging\",\n        description: \"Support for grid paging\",\n        depends: [ \"pager\" ]\n    }, {\n        id: \"grid-selection\",\n        name: \"Selection\",\n        description: \"Support for row selection\",\n        depends: [ \"selectable\" ]\n    }, {\n        id: \"grid-column-reorder\",\n        name: \"Column reordering\",\n        description: \"Support for column reordering\",\n        depends: [ \"reorderable\" ]\n    }, {\n        id: \"grid-column-resize\",\n        name: \"Column resizing\",\n        description: \"Support for column resizing\",\n        depends: [ \"resizable\" ]\n    }, {\n        id: \"grid-mobile\",\n        name: \"Grid adaptive rendering\",\n        description: \"Support for adaptive rendering\",\n        depends: [ \"dialog\", \"pane\", \"switch\" ]\n    }, {\n        id: \"grid-excel-export\",\n        name: \"Excel export\",\n        description: \"Export grid data as Excel spreadsheet\",\n        depends: [ \"excel\" ]\n    }, {\n        id: \"grid-pdf-export\",\n        name: \"PDF export\",\n        description: \"Export grid data as PDF\",\n        depends: [ \"pdf\", \"drawing\", \"progressbar\" ]\n    } ]\n};\n\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        DataSource = kendo.data.DataSource,\n        ObservableObject = kendo.data.ObservableObject,\n        tbodySupportsInnerHtml = kendo.support.tbodyInnerHtml,\n        activeElement = kendo._activeElement,\n        Widget = ui.Widget,\n        outerWidth = kendo._outerWidth,\n        outerHeight = kendo._outerHeight,\n        keys = kendo.keys,\n\n        isPlainObject = $.isPlainObject,\n        extend = $.extend,\n        map = $.map,\n        grep = $.grep,\n        isArray = Array.isArray,\n        inArray = $.inArray,\n        push = Array.prototype.push,\n        isFunction = kendo.isFunction,\n        isEmptyObject = $.isEmptyObject,\n        contains = $.contains,\n        math = Math,\n\n        DOT = \".\",\n        PROGRESS = \"progress\",\n        ERROR = \"error\",\n        HIERARCHY_CELL_CLASS = \"k-hierarchy-cell\",\n        DATA_CELL = \":not(.k-group-cell):not([\" + kendo.attr(\"virtual\") + \"]):not(.k-hierarchy-cell:not(:has(.k-icon.k-i-collapse,.k-icon.k-i-expand))):visible\",\n        SELECTION_CELL_SELECTOR = \"tbody>tr:not(.k-grouping-row):not(.k-detail-row):not(.k-group-footer) > td:not(.k-group-cell):not(.k-hierarchy-cell)\",\n        NAVROW = \"tr:not(.k-footer-template):visible\",\n        NAVCELL = \":not(.k-group-cell):not(.k-detail-cell):not(.k-hierarchy-cell):visible\",\n        ITEMROW = \"tr:not(.k-grouping-row):not(.k-detail-row):not(.k-footer-template):not(.k-group-footer):visible\",\n        COLGROUP = \"col:not(.k-group-col, .k-hierarchy-col)\",\n        HEADERCELLS = \"th.k-header:not(.k-group-cell):not(.k-hierarchy-cell)\",\n        WRAPPER = \".k-grid.k-widget\",\n        NS = \".kendoGrid\",\n        CONTENTRLOCKEDCONTAINER = \"k-grid-content-locked\",\n        GROUPCELLCLASS = \"k-group-cell\",\n\n        EDIT = \"edit\",\n        BEFOREEDIT = \"beforeEdit\",\n        SAVE = \"save\",\n        REMOVE = \"remove\",\n        DETAILINIT = \"detailInit\",\n        FILTERMENUINIT = \"filterMenuInit\",\n        COLUMNMENUINIT = \"columnMenuInit\",\n        FILTERMENUOPEN = \"filterMenuOpen\",\n        COLUMNMENUOPEN = \"columnMenuOpen\",\n        CELLCLOSE = \"cellClose\",\n        CHANGE = \"change\",\n        COLUMNHIDE = \"columnHide\",\n        COLUMNSHOW = \"columnShow\",\n        SAVECHANGES = \"saveChanges\",\n        DATABOUND = \"dataBound\",\n        DETAILEXPAND = \"detailExpand\",\n        DETAILCOLLAPSE = \"detailCollapse\",\n        ITEM_CHANGE = \"itemchange\",\n        PAGE = \"page\",\n        PAGING = \"paging\",\n        SCROLL = \"scroll\",\n        SYNC = \"sync\",\n        LOAD_START = \"loadStart\",\n        LOAD_END = \"loadEnd\",\n\n        FOCUSED = \"k-focus\",\n        FOCUSABLE = \":kendoFocusable\",\n        SELECTED = \"k-selected\",\n        CHECKBOX = \"k-checkbox\",\n        CHECKBOXINPUT = \"input[data-role='checkbox'].\" + CHECKBOX,\n        NORECORDSCLASS = \"k-grid-norecords\",\n        LINK_CLASS = \"k-link\",\n        ICON_CLASS = \"k-icon\",\n        ORDER_CLASS = \"k-sort-order\",\n        SORTED_CLASS = \"k-sorted\",\n        HEADER_COLUMN_MENU_CLASS = \"k-header-column-menu\",\n        FILTER_MENU_CLASS = \"k-grid-filter\",\n        STICKY_CELL_CLASS = \"k-grid-content-sticky\",\n        STICKY_HEADER_CLASS = \"k-grid-header-sticky\",\n        STICKY_FOOTER_CLASS = \"k-grid-footer-sticky\",\n        STICKY_HEADER_NO_BORDER_CLASS = \"k-grid-no-left-border\",\n        RESIZE = \"resize\",\n        COLUMNRESIZE = \"columnResize\",\n        COLUMNREORDER = \"columnReorder\",\n        COLUMNLOCK = \"columnLock\",\n        COLUMNUNLOCK = \"columnUnlock\",\n        COLUMNSTICK = \"columnStick\",\n        COLUMNUNSTICK = \"columnUnstick\",\n        ROWREORDER = \"rowReorder\",\n        NAVIGATE = \"navigate\",\n        CLICK = \"click\",\n        MOUSEDOWN = \"mousedown\",\n        HEIGHT = \"height\",\n        TABINDEX = \"tabIndex\",\n        FUNCTION = \"function\",\n        STRING = \"string\",\n        BOTTOM = \"bottom\",\n        CONTAINER_FOR = \"container-for\",\n        FIELD = \"field\",\n        INPUT = \"input\",\n        INCELL = \"incell\",\n        INLINE = \"inline\",\n        UNIQUE_ID = \"uid\",\n        MINCOLSPANVALUE = 1,\n        COLSPAN = \"colSpan\",\n        OVERFLOW = \"overflow\",\n        HIDDEN = \"hidden\",\n        SORT = \"sort\",\n        GROUP_SORT = \"group-sort\",\n        DELETECONFIRM = \"Are you sure you want to delete this record?\",\n        NORECORDS = \"No records available.\",\n        CONFIRMDELETE = \"Delete\",\n        CANCELDELETE = \"Cancel\",\n        COLLAPSE = \"Collapse\",\n        EXPAND = \"Expand\",\n        ARIALABEL = \"aria-label\",\n        formatRegExp = /(\\}|\\#)/ig,\n        templateHashRegExp = /#/ig,\n        whitespaceRegExp = \"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",\n        leftRegExp = new RegExp(\"(\\\\s*left\\\\s*:\\\\s*\\\\d*px;?)*\", \"ig\"),\n        rightRegExp = new RegExp(\"(\\\\s*right\\\\s*:\\\\s*\\\\d*px;?)*\", \"ig\"),\n        nonDataCellsRegExp = new RegExp(\"(^|\" + whitespaceRegExp + \")\" + \"(k-group-cell|k-hierarchy-cell)\" + \"(\" + whitespaceRegExp + \"|$)\"),\n        filterRowRegExp = new RegExp(\"(^|\" + whitespaceRegExp + \")\" + \"(k-filter-row)\" + \"(\" + whitespaceRegExp + \"|$)\"),\n        COMMANDBUTTONTMPL = '<button type=\"button\" class=\"#=className#\" #=attr#>#=text#</button>',\n        SELECTCOLUMNTMPL = '<input tabindex=\"-1\" class=\"k-select-checkbox ' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select row\" aria-checked=\"false\" type=\"checkbox\">',\n        SELECTCOLUMNHEADERTMPL = '<input tabindex=\"-1\" class=\"k-select-checkbox ' + CHECKBOX + ' k-checkbox-md k-rounded-md\" data-role=\"checkbox\" aria-label=\"Select all rows\" aria-checked=\"false\" type=\"checkbox\">',\n        DRAGHANDLECOLUMNTMPL = '<span class=\"k-icon k-i-reorder\"></span>',\n        SORTHEADERTMPL = '<span class=\"k-cell-inner\"><span class=\"k-link\"><span class=\"k-column-title\">#=text#</span></span></span>',\n        isRtl = false,\n        browser = kendo.support.browser;\n\n    var isIE11 = browser.msie && browser.version === 11;\n    var isMac = /Mac OS/.test(navigator.userAgent);\n    var classNames = {\n        content: \"k-content\",\n        widget: \"k-widget\",\n        scrollContainer: \"k-scroll-container\",\n        headerCellInner: \"k-cell-inner\"\n    };\n    var GroupsPager;\n\n    if (ui.Pager) {\n        GroupsPager = ui.Pager.extend({\n            init: function(element, options) {\n                ui.Pager.fn.init.call(this, element, extend(true, {}, options));\n                this.dataSource.options.useRanges = true;\n                this.dataSource._omitPrefetch = true;\n            },\n            options: {\n                name: \"GroupsPager\"\n            },\n\n            totalPages: function() {\n                var that = this;\n\n                return Math.ceil((that._collapsedTotal() || 0) / (that.pageSize() || 1));\n            },\n            _collapsedTotal: function() {\n                var dataSource = this.dataSource;\n                return dataSource ? (dataSource.groupsTotal(true) || 0) : 0;\n            }\n        });\n    }\n\n    var VirtualScrollable = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            Widget.fn.init.call(that, element, options);\n            that._refreshHandler = that.refresh.bind(that);\n            that.setDataSource(options.dataSource);\n            that.wrap();\n        },\n\n        setDataSource: function(dataSource) {\n            var that = this;\n            if (that.dataSource) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler);\n            }\n            that.dataSource = dataSource;\n            that.dataSource.bind(CHANGE, that._refreshHandler);\n            that.dataSource.options.useRanges = true;\n            that.dataSource.options.virtual = true;\n        },\n\n        options: {\n            name: \"VirtualScrollable\",\n            itemHeight: $.noop,\n            prefetch: true,\n            maxScrollHeight: 250000\n        },\n\n        events: [\n            PAGING,\n            PAGE,\n            SCROLL,\n            LOAD_START,\n            LOAD_END\n        ],\n\n        destroy: function() {\n            var that = this;\n\n            Widget.fn.destroy.call(that);\n\n            that.dataSource.unbind(CHANGE, that._refreshHandler);\n            that.wrapper.add(that.verticalScrollbar).off(NS);\n\n            clearTimeout(that._timeout);\n            if (that._scrollingTimeout) {\n                clearTimeout(that._scrollingTimeout);\n            }\n\n            if (that.drag) {\n                that.drag.destroy();\n                that.drag = null;\n            }\n            that.wrapper = that.element = that.verticalScrollbar = null;\n            that._refreshHandler = null;\n        },\n\n        wrap: function() {\n            var that = this,\n                // workaround for IE issue where scroll is not raised if container is same width as the scrollbar\n                scrollbar = kendo.support.scrollbar() + 1,\n                element = that.element,\n                wrapper;\n\n            element.css( {\n                width: \"auto\",\n                overflow: \"hidden\"\n            }).css((isRtl ? \"padding-left\" : \"padding-right\"), scrollbar);\n            that.content = element.children().first();\n            wrapper = that.wrapper = that.content.wrap('<div class=\"k-virtual-scrollable-wrap\"/>')\n                                .parent()\n                                .on(\"DOMMouseScroll\" + NS + \" mousewheel\" + NS, that._wheelScroll.bind(that));\n            that._wrapper();\n\n            if (kendo.support.kineticScrollNeeded || kendo.support.touch) {\n                that.wrapper.css(\"touch-action\", \"none\");\n                that.drag = new kendo.UserEvents(that.wrapper, {\n                    global: true,\n                    allowSelection: true,\n                    start: function(e) {\n                        e.sender.capture();\n                    },\n                    move: function(e) {\n                        that.verticalScrollbar.scrollTop(that.verticalScrollbar.scrollTop() - e.y.delta);\n                        kendo.scrollLeft(wrapper, kendo.scrollLeft(wrapper) - e.x.delta);\n                        e.preventDefault();\n                    }\n                });\n            }\n\n            that.verticalScrollbar = $('<div class=\"k-scrollbar k-scrollbar-vertical\" />')\n                                        .css({\n                                            width: scrollbar\n                                        }).appendTo(element)\n                                        .on(\"scroll\" + NS, that._scroll.bind(that));\n        },\n\n        _wrapper: function() {\n            var that = this;\n\n            if (isIE11) {\n                //scrolling the virtual scrollbar to the bottom and then\n                //scrolling the horizontal content scrollbar does not fire the \"scroll\" event\n                //seems like a problem in IE 11 only (after version 11.0.9600.18860)\n                //https://github.com/telerik/kendo-ui-core/issues/3779\n                that.wrapper.css({\n                    \"overflow-y\": SCROLL\n                });\n\n                //hide the wrapper behind the virtual scrollbar\n                that.element.css((isRtl ? \"padding-left\" : \"padding-right\"), 0);\n            }\n        },\n\n        _wheelScroll: function(e) {\n            if (e.ctrlKey) {\n                return;\n            }\n\n            var scrollbar = this.verticalScrollbar,\n                scrollTop = scrollbar.scrollTop(),\n                delta = kendo.wheelDeltaY(e);\n\n            if (delta && !(delta > 0 && scrollTop === 0) && !(delta < 0 && scrollTop + scrollbar[0].clientHeight == scrollbar[0].scrollHeight)) {\n                e.preventDefault();\n                this.verticalScrollbar.scrollTop(scrollTop + (-delta));\n            }\n        },\n\n        _scroll: function(e) {\n            var that = this,\n                delayLoading = !that.options.prefetch,\n                scrollTop = e.currentTarget.scrollTop,\n                dataSource = that.dataSource,\n                rowHeight = that.itemHeight,\n                skip = dataSource.skip() || 0,\n                start = that._rangeStart || skip,\n                height = that.element.innerHeight(),\n                isScrollingUp = !!(that._scrollbarTop && that._scrollbarTop > scrollTop),\n                firstItemIndex = math.max(math.floor(scrollTop / rowHeight), 0),\n                lastItemOffset = isScrollingUp ? math.ceil(height / rowHeight) : math.floor(height / rowHeight),\n                lastItemIndex = math.max(firstItemIndex + lastItemOffset, 0);\n\n            if (that._preventScroll) {\n                that._preventScroll = false;\n                return;\n            }\n            that._prevScrollTop = that._scrollTop;\n            that._scrollTop = scrollTop - (start * rowHeight);\n            that._scrollbarTop = scrollTop;\n\n            that._scrolling = delayLoading;\n\n            if (!that._fetch(firstItemIndex, lastItemIndex, isScrollingUp)) {\n                that.wrapper[0].scrollTop = that._scrollTop;\n            }\n\n            that.trigger(SCROLL);\n\n            if (delayLoading) {\n                if (that._scrollingTimeout) {\n                    clearTimeout(that._scrollingTimeout);\n                }\n\n                that._scrollingTimeout = setTimeout(function() {\n                    that._scrolling = false;\n                    that._page(that._rangeStart, that.dataSource.take());\n                }, 100);\n            }\n        },\n\n        scrollToTop: function() {\n            this._scrollTo(0);\n        },\n\n        scrollToBottom: function() {\n            var scrollbar = this.verticalScrollbar;\n            this._scrollTo(scrollbar[0].scrollHeight - scrollbar.height());\n        },\n\n        _scrollWrapperToTop: function() {\n            this.wrapper.scrollTop(0);\n        },\n\n        _scrollWrapperToBottom: function() {\n            this.wrapper.scrollTop(this.wrapper[0].scrollHeight);\n        },\n\n        _scrollWrapperOnColumnResize: function() {\n            var that = this;\n            var wrapper = this.wrapper;\n            var initialScrollTop = wrapper.scrollTop();\n\n            if (wrapper[0].scrollWidth > wrapper[0].clientWidth) {\n                if ((!that._wrapperScrolled && initialScrollTop) || that._isScrolledToBottom()) {\n                    wrapper.scrollTop(initialScrollTop + kendo.support.scrollbar());\n                    that._scrollTop = wrapper.scrollTop();\n                    that._wrapperScrolled = true;\n                }\n            } else if (that._wrapperScrolled) {\n                if (!that._isWrapperScrolledToBottom()) {\n                    wrapper.scrollTop(initialScrollTop - kendo.support.scrollbar());\n                    that._scrollTop = wrapper.scrollTop();\n                }\n\n                that._wrapperScrolled = false;\n            }\n        },\n\n        _scrollTo: function(scrollTop) {\n            var that = this;\n            var scrollbar = that.verticalScrollbar;\n\n            if (scrollbar.scrollTop() !== scrollTop) {\n                that._preventScroll = true;\n            }\n\n            that.wrapper.scrollTop(scrollTop);\n            that._scrollTop = that.wrapper.scrollTop();\n\n            scrollbar.scrollTop(scrollTop);\n            that._scrollbarTop = scrollbar.scrollTop();\n        },\n\n        _isScrolledToTop: function() {\n            return this.verticalScrollbar.scrollTop() === 0;\n        },\n\n        _isScrolledToBottom: function() {\n            var scrollbar = this.verticalScrollbar;\n            var scrollTop = scrollbar.scrollTop();\n\n            return (scrollTop > 0 && scrollTop >= parseInt(scrollbar[0].scrollHeight - scrollbar.height(), 10));\n        },\n\n        _isWrapperScrolledToBottom: function() {\n            var wrapper = this.wrapper;\n\n            return (wrapper.scrollTop() >= parseInt(wrapper[0].scrollHeight - wrapper.height(), 10));\n        },\n\n        itemIndex: function(rowIndex) {\n            var rangeStart = this._rangeStart || this.dataSource.skip() || 0;\n\n            return rangeStart + rowIndex;\n        },\n\n        position: function(index) {\n            var rangeStart = this._rangeStart || this.dataSource.skip() || 0;\n            var pageSize = this.dataSource.pageSize();\n            var result;\n\n            if (index > rangeStart) {\n                result = index - rangeStart;\n            } else {\n                result = rangeStart - index - 1;\n            }\n\n            return result > pageSize ? pageSize : result;\n        },\n\n        scrollIntoView: function(row) {\n            var container = this.wrapper[0];\n            var containerHeight = container.clientHeight;\n            var containerScroll = !this._isScrolledToBottom() ? (this._scrollTop || container.scrollTop) : container.scrollTop;\n            var elementOffset = row[0].offsetTop;\n            var elementHeight = row[0].offsetHeight;\n\n            if (containerScroll > elementOffset) {\n                this.verticalScrollbar[0].scrollTop -= containerHeight / 2;\n            } else if (elementOffset + elementHeight >= containerScroll + containerHeight) {\n                this.verticalScrollbar[0].scrollTop += containerHeight / 2;\n            }\n        },\n\n        _fetch: function(firstItemIndex, lastItemIndex, scrollingUp) {\n            var that = this,\n                dataSource = that.dataSource,\n                itemHeight = that.itemHeight,\n                take = dataSource.take(),\n                rangeStart = that._rangeStart || dataSource.skip() || 0,\n                currentSkip = math.floor(firstItemIndex / take) * take,\n                fetching = false,\n                prefetchAt = 0.33;\n            var scrollbar = that.verticalScrollbar;\n            var webkitCorrection = browser.webkit ? 1 : 0;\n            var total = dataSource._isGroupPaged() ? dataSource.groupsTotal(true) : dataSource.total();\n\n            if (firstItemIndex < rangeStart) {\n\n                fetching = true;\n                rangeStart = math.max(0, lastItemIndex - take);\n                that._scrollTop = scrollbar.scrollTop() - (rangeStart * itemHeight);\n                that._page(rangeStart, take);\n\n            } else if (lastItemIndex >= rangeStart + take && !scrollingUp) {\n\n                fetching = true;\n                rangeStart = math.min(firstItemIndex, total - take);\n\n                //ensure the scrollbar can be scrolled to bottom with mouse drag\n                if (scrollbar.scrollTop() >= scrollbar[0].scrollHeight - scrollbar[0].offsetHeight - webkitCorrection) {\n                    that._scrollTop = that.wrapper[0].scrollHeight - that.wrapper[0].offsetHeight;\n                } else if (that.dataSource._isGroupPaged() && firstItemIndex >= total - take) {\n                    that._scrollTop = that.wrapper[0].scrollHeight - that.wrapper[0].offsetHeight - (that._scrollTop - that._prevScrollTop);\n                } else {\n                    that._scrollTop = itemHeight;\n                }\n\n                that._page(rangeStart, take);\n\n            } else if (!that._fetching && that.options.prefetch) {\n\n                if (firstItemIndex < (currentSkip + take) - take * prefetchAt && firstItemIndex > take) {\n                    dataSource.prefetch(currentSkip - take, take, $.noop);\n                }\n                if (lastItemIndex > currentSkip + take * prefetchAt) {\n                    dataSource.prefetch(currentSkip + take, take, $.noop);\n                }\n\n            }\n            return fetching;\n        },\n\n        fetching: function() {\n            return this._fetching;\n        },\n\n        _page: function(skip, take, callback) {\n            var that = this,\n                delayLoading = !that.options.prefetch,\n                dataSource = that.dataSource,\n                isGroupPaged = dataSource._isGroupPaged();\n            callback = isFunction(callback) ? callback : $.noop;\n\n            if (that.trigger(PAGING, { skip: skip, take: take })) {\n                return;\n            }\n\n            clearTimeout(that._timeout);\n            that._fetching = true;\n            that._rangeStart = skip;\n\n            if ((isGroupPaged && dataSource._groupRangeExists(skip, skip + take)) || (!isGroupPaged && dataSource.inRange(skip, take))) {\n                that.trigger(LOAD_START);\n\n                dataSource.range(skip, take, function() {\n                    that.trigger(LOAD_END);\n                    callback();\n                    that.trigger(PAGE);\n                }, \"page\");\n            } else {\n                if (!delayLoading) {\n                    that.trigger(LOAD_START);\n                }\n\n                that._timeout = setTimeout(function() {\n                    if (!that._scrolling) {\n\n                        if (delayLoading) {\n                            that.trigger(LOAD_START);\n                        }\n\n                        dataSource.range(skip, take, function() {\n                            that.trigger(LOAD_END);\n                            callback();\n                            that.trigger(PAGE);\n                        });\n                    }\n                }, 100);\n            }\n        },\n\n        repaintScrollbar: function(shouldScrollWrapper) {\n            var that = this,\n                html = \"\",\n                maxHeight = that.options.maxScrollHeight,\n                dataSource = that.dataSource,\n                scrollbar = !kendo.support.kineticScrollNeeded ? kendo.support.scrollbar() : 0,\n                wrapperElement = that.wrapper[0],\n                totalHeight,\n                idx,\n                itemHeight;\n            var wasScrolledToBottom = that._isScrolledToBottom();\n\n            itemHeight = that.itemHeight = that.options.itemHeight() || 0;\n\n            var addScrollBarHeight = (wrapperElement.scrollWidth > wrapperElement.offsetWidth) ? scrollbar : 0;\n\n            totalHeight = (dataSource._isGroupPaged() ? dataSource.groupsTotal(true) : dataSource.total()) * itemHeight + addScrollBarHeight;\n\n            for (idx = 0; idx < math.floor(totalHeight / maxHeight); idx++) {\n                html += '<div style=\"width:1px;height:' + maxHeight + 'px\"></div>';\n            }\n\n            if (totalHeight % maxHeight) {\n                html += '<div style=\"width:1px;height:' + (totalHeight % maxHeight) + 'px\"></div>';\n            }\n\n            that.verticalScrollbar.html(html);\n\n            if (wasScrolledToBottom && !that._isScrolledToBottom() && !that.dataSource._isGroupPaged()) {\n                that.scrollToBottom();\n            }\n\n            if (typeof(that._scrollTop) !== \"undefined\" && !!shouldScrollWrapper) {\n                wrapperElement.scrollTop = that._scrollTop;\n                that._scrollWrapperOnColumnResize();\n            }\n        },\n\n        refresh: function(e) {\n            var that = this,\n                dataSource = that.dataSource,\n                rangeStart = that._rangeStart;\n            var action = (e || {}).action;\n            var shouldScrollWrapper = that._isScrolledToBottom() || !action || (action !== ITEM_CHANGE && action !== REMOVE && action !== SYNC);\n\n            that.trigger(LOAD_END);\n            clearTimeout(that._timeout);\n\n            that.repaintScrollbar(shouldScrollWrapper);\n\n            if (that.drag) {\n                that.drag.cancel();\n            }\n\n            if (typeof(rangeStart) !== \"undefined\" && !that._fetching) { // we are rebound from outside local range should be reset\n                if (!action || (action !== SYNC && action !== ITEM_CHANGE && action !== \"expandGroup\")) {\n                    that._rangeStart = dataSource.skip();\n                }\n\n                if (dataSource.page() === 1 && (!action || (action !== SYNC && action !== ITEM_CHANGE && action !== \"expandGroup\" && action !== \"collapseGroup\"))) {\n                    // reset the scrollbar position if datasource is filtered\n                    that.verticalScrollbar[0].scrollTop = 0;\n                }\n            }\n\n            that._fetching = false;\n        }\n    });\n\n    function attrEquals(attrName, attrValue) {\n        return \"[\" + kendo.attr(attrName) + \"=\" + attrValue + \"]\";\n    }\n\n    function groupCells(count) {\n        return new Array(count + 1).join('<td class=\"k-group-cell\">&nbsp;</td>');\n    }\n\n    function stringifyAttributes(attributes) {\n        var attr,\n            result = \" \";\n\n        if (attributes) {\n            if (typeof attributes === STRING) {\n                return attributes;\n            }\n\n            for (attr in attributes) {\n                if (attributes[attr] !== '') {\n                    result += attr + '=\"' + attributes[attr] + '\"';\n                }\n            }\n        }\n        return result;\n    }\n\n    var defaultCommands = {\n        create: {\n            text: \"Add new record\",\n            className: \"k-grid-add\",\n            iconClass: \"k-icon k-i-plus\"\n        },\n        cancel: {\n            text: \"Cancel changes\",\n            className: \"k-grid-cancel-changes\",\n            iconClass: \"k-icon k-i-cancel\"\n        },\n        save: {\n            text: \"Save changes\",\n            className: \"k-grid-save-changes\",\n            iconClass: \"k-icon k-i-check\"\n        },\n        destroy: {\n            text: \"Delete\",\n            className: \"k-grid-delete\",\n            iconClass: \"k-icon k-i-close\"\n        },\n        edit: {\n            text: \"Edit\",\n            className: \"k-grid-edit\",\n            iconClass: \"k-icon k-i-edit\"\n        },\n        update: {\n            text: \"Update\",\n            className: \"k-grid-update\",\n            iconClass: \"k-icon k-i-check\",\n            themeColor: \"primary\"\n        },\n        canceledit: {\n            text: \"Cancel\",\n            className: \"k-grid-cancel\",\n            iconClass: \"k-icon k-i-cancel\"\n        },\n        excel: {\n            text: \"Export to Excel\",\n            className: \"k-grid-excel\",\n            iconClass: \"k-icon k-i-file-excel\"\n        },\n        pdf: {\n            text: \"Export to PDF\",\n            className: \"k-grid-pdf\",\n            iconClass: \"k-icon k-i-file-pdf\"\n        },\n        search: {\n            text: \"Search...\",\n            className: \"k-grid-search\"\n        }\n    };\n\n    function cursor(context, value) {\n        $('th, th .k-grid-filter, th .k-link', context)\n            .add(document.body)\n            .css('cursor', value);\n    }\n\n    function reorder(selector, source, dest, before, count) {\n        var sourceIndex = source;\n        source = $();\n        count = count || 1;\n        for (var idx = 0; idx < count; idx++) {\n            source = source.add(selector.eq(sourceIndex + idx));\n        }\n\n        if (typeof dest == \"number\") {\n            source[before ? \"insertBefore\" : \"insertAfter\"](selector.eq(dest));\n        } else {\n            source.appendTo(dest);\n        }\n    }\n\n    function elements(lockedContent, content, filter) {\n        return $(lockedContent).add(content).find(filter);\n    }\n\n    function attachCustomCommandEvent(context, container, commands) {\n        var idx,\n            length,\n            command,\n            commandName;\n\n        commands = !isArray(commands) ? [commands] : commands;\n\n        for (idx = 0, length = commands.length; idx < length; idx++) {\n            command = commands[idx];\n\n            if (isPlainObject(command) && command.click) {\n                commandName = command.name || command.text;\n                container.on(CLICK + NS, \".k-grid-\" + (commandName || \"\").replace(/\\s/g, \"\"), { commandName: commandName }, command.click.bind(context));\n            }\n        }\n    }\n\n    function normalizeColumns(columns, encoded, hide, locked, parentIds) {\n        return map(columns, function(column) {\n            column = typeof column === STRING ? { field: column } : column;\n\n            var hidden;\n            column.parentIds = parentIds;\n\n            if (!isVisible(column) || hide) {\n                column.attributes = addHiddenStyle(column.attributes);\n                column.footerAttributes = addHiddenStyle(column.footerAttributes);\n                column.headerAttributes = addHiddenStyle(column.headerAttributes);\n                hidden = true;\n            }\n\n            var uid = kendo.guid();\n            if (locked && !column.locked) {\n                column.locked = locked;\n            }\n\n            column.headerAttributes = extend({ headers: parentIds }, column.headerAttributes);\n            if (!column.headerAttributes.id) {\n                column.headerAttributes = extend({ id: uid }, column.headerAttributes);\n                column.uid = uid;\n            } else {\n                column.uid = uid = column.headerAttributes.id;\n            }\n\n            if (column.columns) {\n                column.columns = normalizeColumns(column.columns, encoded, hidden, column.locked, parentIds ? (parentIds + \" \" + uid) : uid);\n            }\n            return extend({ encoded: encoded, hidden: hidden, locked: locked }, column);\n        });\n    }\n\n    function columnParent(column, columns) {\n        var parents = [];\n        columnParents(column, columns, parents);\n        return parents[parents.length - 1];\n    }\n\n    function columnParents(column, columns, parents) {\n        parents = parents || [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (column === columns[idx]) {\n                return true;\n            } else if (columns[idx].columns) {\n                var inserted = parents.length;\n                parents.push(columns[idx]);\n                if (!columnParents(column, columns[idx].columns, parents)) {\n                    parents.splice(inserted, parents.length - inserted);\n                } else {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n\n    function setColumnVisibility(column, visible) {\n        setVisibility(column, visible, visible);\n    }\n\n    function setVisibility(column, visible, show) {\n        var method = show ? removeHiddenStyle : addHiddenStyle;\n        column.hidden = !visible;\n        column.attributes = method(column.attributes);\n        column.footerAttributes = method(column.footerAttributes);\n        column.headerAttributes = method(column.headerAttributes);\n    }\n\n\n    function setColumnMediaVisibility(column, visible) {\n        setColumnMatchesMedia(column);\n        var hideByMedia = column._hideByMedia;\n        setVisibility(column, visible, hideByMedia ? column.matchesMedia : visible);\n    }\n\n    function setColumnMatchesMedia(column) {\n        column.matchesMedia = columnMatchesMedia(column);\n    }\n\n    function columnMatchesMedia(column) {\n        return column && (isUndefined(column.media) || (!isUndefined(column.media) && kendo.matchesMedia(column.media)));\n    }\n\n    function isCellVisible() {\n        return this.style.display !== \"none\";\n    }\n\n    function isElementVisible(element) {\n        return $(element)[0].style.display !== \"none\";\n    }\n\n    function isVisible(column) {\n        return visibleColumns([column]).length > 0;\n    }\n\n    function visibleColumns(columns) {\n        return grep(columns, function(column) {\n            var result = !column.hidden && column.matchesMedia !== false;\n\n            if (result && column.columns) {\n                result = visibleColumns(column.columns).length > 0;\n            }\n            return result;\n        });\n    }\n\n    function columnsWithMedia(columns) {\n        var result = [];\n        var column;\n\n        for (var i = 0; i < columns.length; i++) {\n            column = columns[i];\n\n            if (!isUndefined(column.media)) {\n                if (!isUndefined(column.minScreenWidth)) {\n                    throw new Error(\"Using 'media' and 'minScreenWidth' options at the same time is not supported.\");\n                }\n\n                result.push(column);\n            }\n\n            if (column.columns) {\n                result = result.concat(columnsWithMedia(column.columns));\n            }\n        }\n\n        return result;\n    }\n\n    function isUndefined(value) {\n        return typeof value === \"undefined\";\n    }\n\n    function toJQuery(elements) {\n        return $(elements).map(function() { return this.toArray(); });\n    }\n\n    function updateCellRowSpan(cell, columns, sourceLockedColumnsCount) {\n        var lockedColumnDepth = depth(lockedColumns(columns));\n        var nonLockedColumnDepth = depth(nonLockedColumns(columns));\n\n        var rowSpan = cell.rowSpan;\n        if (sourceLockedColumnsCount) {\n            if (lockedColumnDepth > nonLockedColumnDepth) {\n                cell.rowSpan = (rowSpan - (lockedColumnDepth - nonLockedColumnDepth)) || 1;\n            } else {\n                cell.rowSpan = rowSpan + (nonLockedColumnDepth - lockedColumnDepth);\n            }\n        } else {\n            if (lockedColumnDepth > nonLockedColumnDepth) {\n                cell.rowSpan = rowSpan + (lockedColumnDepth - nonLockedColumnDepth);\n            } else {\n                cell.rowSpan = (rowSpan - (nonLockedColumnDepth - lockedColumnDepth)) || 1;\n            }\n        }\n    }\n\n    function findColumnByField(columns, field) {\n        for (var i = 0; i < columns.length; i++) {\n            if (columns[i].field == field) {\n                return columns[i];\n            }\n        }\n    }\n\n    function moveCellsBetweenContainers(sources, target, leafs, columns, container, destination, groups, action) {\n        var sourcesDepth = depth(sources);\n        var targetDepth = depth([target]);\n\n        if (sourcesDepth > targetDepth) {\n            var groupCells = new Array(groups + 1).join('<th class=\"k-group-cell k-header\" scope=\"col\">&nbsp;</th>');\n            var rows = destination.children(\":not(.k-filter-row)\");\n            $(new Array((sourcesDepth - targetDepth) + 1).join(\"<tr>\" + groupCells + \"</tr>\")).insertAfter(rows.last());\n        }\n\n        addRowSpanValue(destination, sourcesDepth - targetDepth);\n\n        moveCells(leafs, columns, container, destination, action);\n    }\n\n    function updateCellIndex(thead, columns, offset) {\n        offset = offset || 0;\n\n        var position;\n        var cell;\n        var allColumns = columns;\n        columns = leafColumns(columns);\n\n        var cells = {};\n        var rows = thead.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        for (var idx = 0, length = columns.length; idx < length; idx++) {\n            position = columnPosition(columns[idx], allColumns);\n\n            if (!cells[position.row]) {\n                cells[position.row] = rows.eq(position.row)\n                    .find(\".k-header\")\n                    .filter(filter);\n            }\n\n            cell = cells[position.row].eq(position.cell);\n            cell.attr(kendo.attr(\"index\"), offset + idx);\n        }\n\n\n        return columns.length;\n    }\n\n    function depth(columns) {\n        var result = 1;\n        var max = 0;\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (columns[idx].columns) {\n                var temp = depth(columns[idx].columns);\n                if (temp > max) {\n                    max = temp;\n                }\n            }\n        }\n        return result + max;\n    }\n\n    function moveCells(leafs, columns, container, destination, action) {\n        var sourcePosition = columnVisiblePosition(leafs[0], columns);\n\n        var ths = container.find(\">tr:not(.k-filter-row)\").eq(sourcePosition.row).children(\"th.k-header\");\n\n        var t = $();\n        var sourceIndex = sourcePosition.cell;\n        var idx;\n\n        for (idx = 0; idx < leafs.length; idx++) {\n            t = t.add(ths.eq(sourceIndex + idx));\n        }\n\n        destination.find(\">tr:not(.k-filter-row)\").eq(sourcePosition.row)[action](t);\n\n        var children = [];\n        for (idx = 0; idx < leafs.length; idx++) {\n            if (leafs[idx].columns) {\n                children = children.concat(leafs[idx].columns);\n            }\n        }\n\n        if (children.length) {\n            moveCells(children, columns, container, destination, action);\n        }\n    }\n\n    function columnPosition(column, columns, row, cellCounts) {\n        var result;\n        var idx;\n\n        row = row || 0;\n        cellCounts = cellCounts || {};\n        cellCounts[row] = cellCounts[row] || 0;\n\n        for (idx = 0; idx < columns.length; idx++) {\n           if (columns[idx] == column) {\n                result = { cell: cellCounts[row], row: row };\n                break;\n           } else if (columns[idx].columns) {\n               result = columnPosition(column, columns[idx].columns, row + 1, cellCounts);\n               if (result) {\n                    break;\n               }\n           }\n\n           cellCounts[row]++;\n        }\n        return result;\n    }\n    function findParentColumnWithChildren(columns, index, source, rtl) {\n        var target;\n        var locked = !!source.locked;\n        var targetLocked;\n\n        do {\n            target = columns[index];\n            index += rtl ? 1 : -1;\n            targetLocked = !!target.locked;\n        } while (target && index > -1 && index < columns.length && target != source && !target.columns && targetLocked === locked);\n\n        return target;\n    }\n\n    function findReorderTarget(columns, target, source, before, masterColumns) {\n        if (target.columns) {\n            target = target.columns;\n            return target[before ? 0 : target.length - 1];\n        } else {\n            var parent = columnParent(target, columns);\n            var parentColumns;\n\n            if (parent) {\n                parentColumns = parent.columns;\n            } else {\n                parentColumns = columns;\n            }\n\n            var index = inArray(target, parentColumns);\n            if (index === 0 && before) {\n                index++;\n            } else if ((index == parentColumns.length - 1 && !before) || (!source.locked && !target.columns && !before)) {\n                index--;\n            } else if (index > 0 || (index === 0 && !before)) {\n                index++;\n            }\n\n            var sourceIndex = inArray(source, parentColumns);\n            target = findParentColumnWithChildren(parentColumns, index, source, sourceIndex > index);\n            var targetIndex = inArray(target, masterColumns);\n            if (target.columns && (!targetIndex || targetIndex === parentColumns.length - 1)) {\n                return null;\n            }\n\n            if (target && target != source && target.columns) {\n                return findReorderTarget(columns, target, source, before, masterColumns);\n            }\n        }\n        return null;\n    }\n\n    function columnVisiblePosition(column, columns, row, cellCounts) {\n        var result;\n        var idx;\n\n        row = row || 0;\n        cellCounts = cellCounts || {};\n        cellCounts[row] = cellCounts[row] || 0;\n\n        for (idx = 0; idx < columns.length; idx++) {\n           if (columns[idx] == column) {\n                result = { cell: cellCounts[row], row: row };\n                break;\n           } else if (columns[idx].columns) {\n               result = columnVisiblePosition(column, columns[idx].columns, row + 1, cellCounts);\n               if (result) {\n                    break;\n               }\n           }\n\n           if (!columns[idx].hidden) {\n               cellCounts[row]++;\n           }\n        }\n        return result;\n    }\n\n    function flatColumnsInDomOrder(columns) {\n        var result = flatColumns(lockedColumns(columns));\n        return result.concat(flatColumns(nonLockedColumns(columns)));\n    }\n\n    function targetParentContainerIndex(flatColumns, columns, sourceIndex, targetIndex) {\n        var column = flatColumns[sourceIndex];\n        var target = flatColumns[targetIndex];\n\n        var parent = columnParent(column, columns);\n        columns = parent ? parent.columns : columns;\n\n        return inArray(target, columns);\n    }\n\n    function flatColumns(columns) {\n        var result = [];\n        var children = [];\n        for (var idx = 0; idx < columns.length; idx++) {\n            result.push(columns[idx]);\n            if (columns[idx].columns) {\n                children = children.concat(columns[idx].columns);\n            }\n\n        }\n        if (children.length) {\n            result = result.concat(flatColumns(children));\n        }\n        return result;\n    }\n\n    function hiddenLeafColumnsCount(columns) {\n        var counter = 0;\n        var column;\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            column = columns[idx];\n\n            if (column.columns) {\n                counter += hiddenLeafColumnsCount(column.columns);\n            } else if (column.hidden) {\n                counter++;\n            }\n        }\n        return counter;\n    }\n\n    function sumWidths(cols) {\n        var width = 0;\n\n        for (var idx = 0, length = cols.length; idx < length; idx++) {\n            if (!cols[idx].hidden) {\n                width += parseInt(cols[idx].width, 10);\n            }\n        }\n\n        return width;\n    }\n\n    function columnsWidth(cols) {\n        var colWidth, width = 0;\n\n        for (var idx = 0, length = cols.length; idx < length; idx++) {\n            colWidth = cols[idx].style.width;\n            if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                width += parseInt(colWidth, 10);\n            }\n        }\n\n        return width;\n    }\n\n    function removeRowSpanValue(container, count) {\n        var cells = container.find(\"tr:not(.k-filter-row) th:not(.k-group-cell,.k-hierarchy-cell)\");\n\n        var rowSpan;\n        for (var idx = 0; idx < cells.length; idx++) {\n            rowSpan = cells[idx].rowSpan;\n            if (rowSpan > 1) {\n                cells[idx].rowSpan = (rowSpan - count) || 1;\n            }\n        }\n    }\n\n    function addRowSpanValue(container, count) {\n        var cells = container.find(\"tr:not(.k-filter-row) th:not(.k-group-cell,.k-hierarchy-cell)\");\n\n        for (var idx = 0; idx < cells.length; idx++) {\n            cells[idx].rowSpan += count;\n        }\n    }\n\n    function removeEmptyRows(container) {\n        var rows = container.find(\"tr:not(.k-filter-row)\");\n\n        var emptyRowsCount = rows.filter(function() {\n            return !$(this).children().length;\n        }).remove().length;\n\n        var cells = rows.find(\"th:not(.k-group-cell,.k-hierarchy-cell)\");\n\n        for (var idx = 0; idx < cells.length; idx++) {\n            if (cells[idx].rowSpan > 1) {\n                cells[idx].rowSpan -= emptyRowsCount;\n            }\n        }\n        return rows.length - emptyRowsCount;\n    }\n\n    function mapColumnToCellRows(columns, cells, rows, rowIndex, offset) {\n        var idx, row, length, children = [];\n\n        for (idx = 0, length = columns.length; idx < length; idx++) {\n            row = rows[rowIndex] || [];\n            row.push(cells.eq(offset + idx));\n            rows[rowIndex] = row;\n\n            if (columns[idx].columns) {\n                children = children.concat(columns[idx].columns);\n            }\n        }\n\n        if (children.length) {\n            mapColumnToCellRows(children, cells, rows, rowIndex + 1, offset + columns.length);\n        }\n    }\n\n    function setLeftAndRightStyles(element, left, right) {\n        element.css({\n            \"left\": left,\n            \"right\": right\n        });\n    }\n\n    function createColumnAttribute(column, attribute, property) {\n        column[attribute] = column[attribute] || {};\n        column[attribute][property] = column[attribute][property] || \"\";\n    }\n\n    function addColumnAttribute(column, attribute, property, value) {\n        createColumnAttribute(column, attribute, property);\n\n        if (column[attribute][property] !== \"\") {\n            column[attribute][property] += \" \" + value;\n        } else {\n            column[attribute][property] = value;\n        }\n    }\n\n    function removeColumnAttribute(column, attribute, property, value) {\n        createColumnAttribute(column, attribute, property);\n\n        column[attribute][property] = column[attribute][property].replace(value, \"\");\n    }\n\n    function lockedColumns(columns) {\n        return grep(columns, function(column) {\n            return column.locked;\n        });\n    }\n\n    function nonLockedColumns(columns) {\n        return grep(columns, function(column) {\n            return !column.locked;\n        });\n    }\n\n    function stickyColumns(columns) {\n        return grep(columns, function(column) {\n            return column.sticky && !column.locked;\n        });\n    }\n\n    function visibleStickyColumns(columns) {\n        return grep(columns, function(column) {\n            return column.sticky && !column.locked && isVisible(column);\n        });\n    }\n\n    function visibleNonLockedColumns(columns) {\n        return grep(columns, function(column) {\n            return !column.locked && isVisible(column);\n        });\n    }\n\n    function visibleLockedColumns(columns) {\n        return grep(columns, function(column) {\n            return column.locked && isVisible(column);\n        });\n    }\n\n    function visibleLeafColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (columns[idx].hidden) {\n                continue;\n            }\n\n            if (columns[idx].columns) {\n                result = result.concat(visibleLeafColumns(columns[idx].columns));\n            } else {\n                result.push(columns[idx]);\n            }\n        }\n\n        return result;\n    }\n\n    function visibleLeafExportColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (columns[idx].hidden) {\n                continue;\n            }\n\n            if (columns[idx].columns) {\n                result = result.concat(visibleLeafColumns(columns[idx].columns));\n            } else {\n                result.push({\n                    field: columns[idx].field,\n                    width: columns[idx].width,\n                    values: columns[idx].values\n                });\n            }\n        }\n\n        return result;\n    }\n\n    function childColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (columns[idx].columns) {\n                result = result.concat(columns[idx].columns);\n            }\n        }\n\n        return result;\n    }\n\n    function visibleChildColumns(columns) {\n        var result = childColumns(columns);\n\n        result = result.filter(function(e) {\n            return !e.hidden;\n        });\n\n        return result;\n    }\n\n    function leafColumns(columns) {\n        var result = [];\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (!columns[idx].columns) {\n                result.push(columns[idx]);\n                continue;\n            }\n            result = result.concat(leafColumns(columns[idx].columns));\n        }\n\n        return result;\n    }\n\n    function getColumnsFields(columns) {\n        var result = [];\n        columns = leafColumns(columns);\n\n        for (var idx = 0; idx < columns.length; idx++) {\n            if (typeof columns[idx] === \"string\") {\n                result.push(columns[idx]);\n            } else if (columns[idx].field) {\n                result.push(columns[idx].field);\n            }\n        }\n        return result;\n    }\n\n    function editField(column) {\n        return {\n            field: column.field,\n            title: column.title,\n            format: column.format,\n            editor: column.editor,\n            values: column.values,\n            editorOptions: extend(true, { format: column.format }, column.editorOptions),\n            label: column.title || column.field || \"\"\n        };\n    }\n\n    function leafDataCells(container) {\n        var rows = container.find(\">tr:not(.k-filter-row)\");\n\n        var filter = function() {\n            var el = $(this);\n            return !el.hasClass(\"k-group-cell\") && !el.hasClass(\"k-hierarchy-cell\");\n        };\n\n        var cells = $();\n        if (rows.length > 1) {\n            cells = rows.find(\"th\")\n                .filter(filter)\n                .filter(function() { return this.rowSpan > 1; });\n        }\n\n        cells = cells.add(rows.last().find(\"th\").filter(filter));\n\n        var indexAttr = kendo.attr(\"index\");\n        cells.sort(function(a, b) {\n            a = $(a);\n            b = $(b);\n\n            var indexA = a.attr(indexAttr);\n            var indexB = b.attr(indexAttr);\n\n            if (indexA === undefined) {\n                indexA = $(a).index();\n            }\n            if (indexB === undefined) {\n                indexB = $(b).index();\n            }\n\n            indexA = parseInt(indexA, 10);\n            indexB = parseInt(indexB, 10);\n            return indexA > indexB ? 1 : (indexA < indexB ? -1 : 0);\n        });\n\n        return cells;\n    }\n\n    function parentColumnsCells(cell) {\n        var container = cell.closest(\"table\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr:not(.k-filter-row)\");\n        var level = headerRows.index(row);\n        if (level > 0) {\n            var parent = headerRows.eq(level - 1);\n            var parentCellsWithChildren = parent.find(\"th:not(.k-group-cell,.k-hierarchy-cell)\").filter(function() {\n                return !$(this).attr(\"rowspan\");\n            });\n\n            var offset = 0;\n            var index = row.find(\"th:not(.k-group-cell,.k-hierarchy-cell)\").index(cell);\n\n            var prevCells = cell.prevAll(\":not(.k-group-cell,.k-hierarchy-cell)\").filter(function() {\n                return this.colSpan > 1;\n            });\n\n            for (var idx = 0; idx < prevCells.length; idx++) {\n                offset += prevCells[idx].colSpan || 1;\n            }\n\n            index += Math.max(offset - 1, 0);\n\n            offset = 0;\n            for (idx = 0; idx < parentCellsWithChildren.length; idx++) {\n                var parentCell = parentCellsWithChildren.eq(idx);\n                if (parentCell.attr(\"data-colspan\")) {\n                    offset += parentCell[0].getAttribute(\"data-colspan\");\n                } else {\n                    offset += 1;\n                }\n                if (index >= idx && index < offset) {\n                    result = parentColumnsCells(parentCell).add(result);\n                    break;\n                }\n            }\n        }\n        return result;\n    }\n\n    function childColumnsCells(cell) {\n        var container = cell.closest(\"thead\");\n        var result = $().add(cell);\n\n        var row = cell.closest(\"tr\");\n        var headerRows = container.find(\"tr:not(.k-filter-row)\");\n        var level = headerRows.index(row) + cell[0].rowSpan;\n        var colSpanAttr = kendo.attr(\"colspan\");\n\n        if (level <= headerRows.length - 1) {\n            var child = row.next();\n            var prevCells = cell.prevAll(\":not(.k-group-cell,.k-hierarchy-cell)\");\n\n            var idx;\n\n            prevCells = prevCells.filter(function() {\n                return !this.rowSpan || this.rowSpan === 1;\n            });\n\n            var offset = 0;\n\n            for (idx = 0; idx < prevCells.length; idx++) {\n                offset += parseInt(prevCells.eq(idx).attr(colSpanAttr), 10) || 1;\n            }\n\n            var cells = child.find(\"th:not(.k-group-cell,.k-hierarchy-cell)\");\n            var colSpan = parseInt(cell.attr(colSpanAttr), 10) || 1;\n\n            idx = 0;\n\n            while (idx < colSpan) {\n                child = cells.eq(idx + offset);\n                result = result.add(childColumnsCells(child));\n                var value = parseInt(child.attr(colSpanAttr), 10);\n                if (value > 1) {\n                    colSpan -= value - 1;\n                }\n                idx++;\n            }\n        }\n\n        return result;\n    }\n\n    function appendContent(tbody, table, html, empty) {\n        var placeholder,\n            tmp = tbody;\n\n        // necessary for AngularJS to cleanup its guts.\n        if (empty) {\n            tbody.empty();\n        }\n\n        if (tbodySupportsInnerHtml) {\n            tbody[0].innerHTML = html;\n        } else {\n            placeholder = document.createElement(\"div\");\n            placeholder.innerHTML = \"<table><tbody>\" + html + \"</tbody></table>\";\n            tbody = placeholder.firstChild.firstChild;\n            table[0].replaceChild(tbody, tmp[0]);\n            tbody = $(tbody);\n        }\n        return tbody;\n    }\n\n    function addHiddenStyle(attr) {\n        attr = attr || {};\n        var style = attr.style;\n\n        if (!style) {\n            style = \"display:none\";\n        } else {\n            style = style.replace(/display:[^;]*/i, \"display:none\");\n            if (!style.match(/display:/i)) {\n                style = style.replace(/(.*)?/i, \"display:none;$1\");\n            }\n        }\n\n        return extend({}, attr, { style: style });\n    }\n\n    function hasHiddenStyle(attr) {\n        attr = attr || {};\n        var style = attr.style || \"\";\n\n        return style.indexOf(\"display:none\") !== -1;\n    }\n\n    function removeHiddenStyle(attr) {\n        attr = attr || {};\n        var style = attr.style;\n\n        if (style) {\n            attr.style = style.replace(/(display\\s*:\\s*none\\s*;?)*/ig, \"\");\n        }\n\n        return attr;\n    }\n\n    function normalizeCols(table, visibleColumns, hasDetails, groups) {\n        var colgroup = table.find(\">colgroup\"),\n            width,\n            cols = map(visibleColumns, function(column) {\n                    width = column.width;\n                    if (width && parseInt(width, 10) !== 0) {\n                        return kendo.format('<col style=\"width:{0}\"/>', typeof width === STRING ? width : width + \"px\");\n                    }\n\n                    return \"<col />\";\n                });\n\n        if (hasDetails || colgroup.find(\".k-hierarchy-col\").length) {\n            cols.splice(0, 0, '<col class=\"k-hierarchy-col\" />');\n        }\n\n        if (colgroup.length) {\n            colgroup.remove();\n        }\n\n        colgroup = $(new Array(groups + 1).join('<col class=\"k-group-col\">') + cols.join(\"\"));\n        if (!colgroup.is(\"colgroup\")) {\n            colgroup = $(\"<colgroup/>\").append(colgroup);\n        }\n\n        table.prepend(colgroup);\n    }\n\n    function normalizeHeaderCells(container, columns) {\n        var lastIndex = 0;\n        var idx , len;\n        var th = container.find(\"th:not(.k-group-cell)\");\n\n        for (idx = 0, len = columns.length; idx < len; idx ++) {\n            if (columns[idx].locked) {\n                th.eq(idx).insertBefore(th.eq(lastIndex));\n                th = container.find(\"th:not(.k-group-cell)\");\n                lastIndex ++;\n            }\n        }\n    }\n\n    function convertToObject(array) {\n        var result = {},\n            item,\n            idx,\n            length;\n\n        for (idx = 0, length = array.length; idx < length; idx++) {\n            item = array[idx];\n            result[item.value] = item.text;\n        }\n\n        return result;\n    }\n\n    function formatGroupValue(value, format, columnValues, encoded) {\n        var isForeignKey = columnValues && columnValues.length && isPlainObject(columnValues[0]) && \"value\" in columnValues[0],\n            groupValue = isForeignKey ? convertToObject(columnValues)[value] : value;\n\n        groupValue = groupValue != null ? groupValue : \"\";\n\n        return format ? kendo.format(format, groupValue) : (encoded === false ? groupValue : kendo.htmlEncode(groupValue));\n    }\n\n    function setCellVisibility(cells, index, visible) {\n        var pad = 0,\n            state,\n            cell = cells[pad];\n\n        while (cell) {\n            state = visible ? true : cell.style.display !== \"none\";\n\n            if (state && !nonDataCellsRegExp.test(cell.className) && --index < 0) {\n                cell.style.display = visible ? \"\" : \"none\";\n                break;\n            }\n\n            cell = cells[++pad];\n        }\n    }\n\n    function hideColumnCells(rows, columnIndex) {\n        var idx = 0,\n            length = rows.length,\n            cell, row;\n\n        for ( ; idx < length; idx += 1) {\n            row = rows.eq(idx);\n            if (row.is(\".k-grouping-row,.k-detail-row\")) {\n                cell = row.children(\":not(.k-group-cell):first,.k-detail-cell\").last();\n                cell.attr(\"colspan\", parseInt(cell.attr(\"colspan\"), 10) - 1);\n            } else {\n                if (row.hasClass(\"k-grid-edit-row\") && (cell = row.children(\".k-edit-container\")[0])) {\n                    cell = $(cell);\n                    cell.attr(\"colspan\", parseInt(cell.attr(\"colspan\"), 10) - 1);\n                    cell.find(\"col\").eq(columnIndex).remove();\n                    row = cell.find(\"tr\").first();\n                }\n\n                setCellVisibility(row[0].cells, columnIndex, false);\n            }\n        }\n    }\n\n    function groupRows(data) {\n        var result = [];\n        var item;\n\n        for (var idx = 0; idx < data.length; idx++) {\n            item = data[idx];\n            if (!(\"field\" in item && \"value\" in item && \"items\" in item)) {\n                break;\n            }\n\n            result.push(item);\n\n            if (item.hasSubgroups) {\n                result = result.concat(groupRows(item.items));\n            }\n        }\n\n        return result;\n    }\n\n    function groupFooters(data) {\n        var result = [];\n        var item;\n\n        for (var idx = 0; idx < data.length; idx++) {\n            item = data[idx];\n            if (!(\"field\" in item && \"value\" in item && \"items\" in item)) {\n                break;\n            }\n\n            if (item.hasSubgroups) {\n                result = result.concat(groupFooters(item.items));\n            }\n\n            result.push(item.aggregates);\n        }\n\n        return result;\n    }\n\n    function showColumnCells(rows, columnIndex) {\n        var idx = 0,\n            length = rows.length,\n            cell, row, columns;\n\n        for ( ; idx < length; idx += 1) {\n            row = rows.eq(idx);\n            if (row.is(\".k-grouping-row,.k-detail-row\")) {\n                cell = row.children(\":not(.k-group-cell):first,.k-detail-cell\").last();\n                cell.attr(\"colspan\", parseInt(cell.attr(\"colspan\"), 10) + 1);\n            } else {\n                if (row.hasClass(\"k-grid-edit-row\") && (cell = row.children(\".k-edit-container\")[0])) {\n                    cell = $(cell);\n                    cell.attr(\"colspan\", parseInt(cell.attr(\"colspan\"), 10) + 1);\n                    normalizeCols(cell.find(\">form>table\"), visibleColumns(columns), false, 0);\n                    row = cell.find(\"tr\").first();\n                }\n\n                setCellVisibility(row[0].cells, columnIndex, true);\n            }\n        }\n    }\n\n    function updateColspan(toAdd, toRemove, num) {\n        num = num || 1;\n\n        var item, idx, length;\n        for (idx = 0, length = toAdd.length; idx < length; idx++) {\n            item = toAdd.eq(idx).children().last();\n            item.attr(\"colspan\", parseInt(item.attr(\"colspan\"), 10) + num);\n\n            item = toRemove.eq(idx).children().last();\n            item.attr(\"colspan\", parseInt(item.attr(\"colspan\"), 10) - num);\n        }\n    }\n\n    function tableWidth(table) {\n        var idx, length, width = 0;\n        var cols = table.find(\">colgroup>col\");\n\n        for (idx = 0, length = cols.length; idx < length; idx += 1) {\n            width += parseInt(cols[idx].style.width, 10);\n        }\n\n        return width;\n    }\n\n    var Grid = kendo.ui.DataBoundWidget.extend({\n        init: function(element, options, events) {\n            var that = this;\n\n            options = isArray(options) ? { dataSource: options } : options;\n\n            Widget.fn.init.call(that, element, options);\n\n            if (events) {\n                that._events = events;\n            }\n\n            isRtl = kendo.support.isRtl(element);\n\n            that._element();\n\n            that._ariaId();\n\n            that._columns($.extend(true, [], that.options.columns));\n\n            if (that._foreignKeyPromises) {\n                $.when.apply(null, that._foreignKeyPromises)\n                    .then(function() {\n                        that._foreignKeyPromises = null;\n                        that._continueInit();\n                    });\n            } else {\n                that._continueInit();\n            }\n        },\n\n        _continueInit: function() {\n            var that = this;\n\n            that._dataSource();\n\n            that._stickyColumns();\n\n            that._tbody();\n\n            that._thead();\n\n            that._groupable();\n\n            that._toolbar();\n\n            that._pageable();\n\n            that._setContentHeight();\n\n            that._templates();\n\n            that._navigatable();\n\n            that._selectable();\n\n            that._clipboard();\n\n            that._details();\n\n            that._editable();\n\n            that._attachCustomCommandsEvent();\n\n            that._adaptiveColumns();\n\n            that._minScreenSupport();\n\n            if (that.options.autoBind) {\n                that.dataSource.fetch();\n            } else {\n                that._group = that._groups() > 0;\n                that._footer();\n            }\n\n            if (that.lockedContent) {\n                that.wrapper.addClass(\"k-grid-lockedcolumns\");\n                that._resizeHandler = function() {\n                    that.resize();\n                };\n                $(window).on(\"resize\" + NS, that._resizeHandler);\n            }\n\n            kendo.notify(that);\n        },\n\n        events: [\n           CHANGE,\n           \"dataBinding\",\n           \"cancel\",\n           DATABOUND,\n           DETAILEXPAND,\n           DETAILCOLLAPSE,\n           DETAILINIT,\n           FILTERMENUINIT,\n           FILTERMENUOPEN,\n           COLUMNMENUINIT,\n           COLUMNMENUOPEN,\n           EDIT,\n           BEFOREEDIT,\n           SAVE,\n           REMOVE,\n           SAVECHANGES,\n           CELLCLOSE,\n           COLUMNRESIZE,\n           COLUMNREORDER,\n           COLUMNSHOW,\n           COLUMNHIDE,\n           COLUMNLOCK,\n           COLUMNUNLOCK,\n           COLUMNSTICK,\n           COLUMNUNSTICK,\n           ROWREORDER,\n           NAVIGATE,\n           \"page\",\n           \"sort\",\n           \"filter\",\n           \"group\",\n           \"groupExpand\",\n           \"groupCollapse\",\n           \"kendoKeydown\"\n        ],\n\n        setDataSource: function(dataSource) {\n            var that = this;\n            var scrollable = that.options.scrollable;\n            var scrollableContent;\n\n            that.options.dataSource = dataSource;\n\n            that._dataSource();\n\n            that._pageable();\n\n            that._thead();\n\n            if (scrollable) {\n                if (scrollable.virtual) {\n                    scrollableContent = that.content.find(\">.k-virtual-scrollable-wrap\");\n                    kendo.scrollLeft(scrollableContent, leftMostPosition(scrollableContent, isRtl));\n                } else {\n                    scrollableContent = that.tbody;\n                    kendo.scrollLeft(that.content, leftMostPosition(scrollableContent, isRtl));\n                }\n            }\n\n            if (that.options.groupable) {\n                that._groupable();\n            }\n\n            if (that.virtualScrollable) {\n                that.virtualScrollable.setDataSource(that.options.dataSource);\n            }\n\n            if (that.options.navigatable) {\n                that._navigatable();\n            }\n\n            if (that.options.selectable) {\n                that._selectable();\n            }\n\n            if (that.options.autoBind) {\n                that.dataSource.fetch();\n            } else {\n                that._footer();\n            }\n        },\n\n        options: {\n            name: \"Grid\",\n            columns: [],\n            toolbar: null,\n            autoBind: true,\n            filterable: false,\n            scrollable: true,\n            sortable: false,\n            selectable: false,\n            allowCopy: false,\n            navigatable: false,\n            pageable: false,\n            persistSelection: false,\n            editable: false,\n            encodeTitles: false,\n            groupable: false,\n            rowTemplate: \"\",\n            altRowTemplate: \"\",\n            search: false,\n            noRecords: false,\n            dataSource: {},\n            height: null,\n            resizable: false,\n            reorderable: false,\n            columnMenu: false,\n            detailTemplate: null,\n            columnResizeHandleWidth: 3,\n            mobile: \"\",\n            loaderType: \"loadingPanel\",\n            messages: {\n                editable: {\n                    cancelDelete: CANCELDELETE,\n                    confirmation: DELETECONFIRM,\n                    confirmDelete: CONFIRMDELETE\n                },\n                commands: {\n                    create: defaultCommands.create.text,\n                    cancel: defaultCommands.cancel.text,\n                    save: defaultCommands.save.text,\n                    destroy: defaultCommands.destroy.text,\n                    edit: defaultCommands.edit.text,\n                    update: defaultCommands.update.text,\n                    canceledit: defaultCommands.canceledit.text,\n                    excel: defaultCommands.excel.text,\n                    pdf: defaultCommands.pdf.text,\n                    search: defaultCommands.search.text\n                },\n                noRecords: NORECORDS,\n                expandCollapseColumnHeader: \"\",\n                groupHeader: \"Press ctrl + space to group\",\n                ungroupHeader: \"Press ctrl + space to ungroup\",\n                itemsSelected: \"items selected\",\n                dragHandleLabel: \"Drag row\",\n                toolbarLabel: \"grid toolbar\",\n                groupingHeaderLabel: \"grid grouping header\",\n                filterCellTitle: \"filter cell\"\n            },\n            width: null\n        },\n\n        destroy: function() {\n            var that = this,\n                element;\n\n            that._angularItems(\"cleanup\");\n            that._destroyColumnAttachments();\n\n            Widget.fn.destroy.call(that);\n\n            if (this._navigatableTables) {\n                this._navigatableTables.off(NS);\n                this._navigatableTables = null;\n                this._headertables = null;\n            }\n\n            if (that._resizeHandler) {\n                $(window).off(\"resize\" + NS, that._resizeHandler);\n            }\n\n            if (that.pager && that.pager.element) {\n                that.pager.destroy();\n            }\n\n            if (that.timer) {\n                clearTimeout(that.timer);\n            }\n\n            if (that._progressTimeOut) {\n                clearTimeout(that._progressTimeOut);\n            }\n\n            if (that._collapseGroupsTimeOut) {\n                clearTimeout(that._collapseGroupsTimeOut);\n            }\n\n            if (that._endlessFetchTimeOut) {\n                clearTimeout(that._endlessFetchTimeOut);\n            }\n\n            that.pager = null;\n\n            that._destroyGroupable();\n\n            if (that.options.reorderable === true || (that.options.reorderable && that.options.reorderable.columns)) {\n                that.wrapper.data(\"kendoReorderable\").destroy();\n            }\n\n            if (that._hasReorderableRows()) {\n                that.tbody.data(\"kendoReorderable\").destroy();\n            }\n\n            if (that.selectable && that.selectable.element) {\n                that.selectable.destroy();\n\n                that.clearArea();\n                that._selectedIds = null;\n\n                if (that.copyHandler) {\n                    that.wrapper.off(\"keydown\", that.copyHandler);\n                    that.unbind(that.copyHandler);\n                }\n                if (that.updateClipBoardState) {\n                    that.unbind(that.updateClipBoardState);\n                    that.updateClipBoardState = null;\n                }\n                if (that.clearAreaHandler) {\n                    that.wrapper.off(\"keyup\", that.clearAreaHandler);\n                }\n            }\n\n            that.selectable = null;\n\n            if (that.resizable) {\n                that.resizable.destroy();\n\n                if (that._resizeUserEvents) {\n                    if (that._resizeHandleDocumentClickHandler) {\n                        $(document).off(\"click\", that._resizeHandleDocumentClickHandler);\n                    }\n                    that._resizeUserEvents.destroy();\n                    that._resizeUserEvents = null;\n                }\n                that.resizable = null;\n            }\n\n            that._destroyVirtualScrollable();\n\n            if (that.editableUserEvents) {\n                that.editableUserEvents.destroy();\n                that.editableUserEvents = null;\n            }\n\n            if (that._lockedContentUserEvents) {\n                that._lockedContentUserEvents.destroy();\n                that._lockedContentUserEvents = null;\n            }\n\n            that._destroyEditable();\n\n            if (that.dataSource) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler)\n                           .unbind(PROGRESS, that._progressHandler)\n                           .unbind(ERROR, that._errorHandler)\n                           .unbind(SORT, that._clearSortClasses);\n\n                that._refreshHandler = that._progressHandler = that._errorHandler = that._sortHandler = null;\n            }\n\n            element = that.element\n                .add(that.wrapper)\n                .add(that.table)\n                .add(that.thead)\n                .add(that.wrapper.find(\">.k-grid-toolbar\"));\n\n            if (that.content) {\n                element = element\n                        .add(that.content)\n                        .add(that.content.find(\">.k-virtual-scrollable-wrap\"));\n            }\n\n            if (that.lockedHeader) {\n                that._removeLockedContainers();\n            }\n\n            if (that.pane) {\n                that.pane.destroy();\n            }\n\n            if (that._isMobile) {\n                that.wrapper.off(\"transitionend\" + NS);\n                that.wrapper.off(\"contextmenu\" + NS);\n            }\n\n            if (that.minScreenResizeHandler) {\n                $(window).off(\"resize\", that.minScreenResizeHandler);\n            }\n\n            that._detachColumnMediaResizeHandler();\n\n            if (that._draggableInstance && that._draggableInstance.element) {\n                that._draggableInstance.destroy();\n            }\n\n            that._draggableInstance = null;\n\n            if (that._draggableRowsInstance && that._draggableRowsInstance.element) {\n                that._draggableRowsInstance.destroy();\n            }\n\n            that._draggableRowsInstance = null;\n\n            element.off(NS);\n\n            kendo.destroy(that.wrapper);\n\n            that.rowTemplate =\n            that.altRowTemplate =\n            that.lockedRowTemplate =\n            that.lockedAltRowTemplate =\n            that.detailTemplate =\n            that.footerTemplate =\n            that.groupFooterTemplate =\n            that.lockedGroupFooterTemplate =\n            that.noRecordsTemplate = null;\n\n            that.scrollables =\n            that.thead =\n            that.tbody =\n            that.element =\n            that.table =\n            that.content =\n            that.footer =\n            that.wrapper =\n            that.lockedTable =\n            that.lockedContent =\n            that.lockedHeader =\n            that.lockedFooter =\n            that._groupableClickHandler =\n            that._groupRows =\n            that._setContentWidthHandler = null;\n        },\n\n        getOptions: function() {\n            var options = this.options;\n            options.dataSource = null;\n\n            var result = extend(true, {}, this.options);\n            result.columns = kendo.deepExtend([], this.columns);\n\n            var dataSource = this.dataSource;\n\n            var initialData = dataSource.options.data && dataSource._data;\n            dataSource.options.data = null;\n\n            result.dataSource = $.extend(true, {}, dataSource.options);\n\n            dataSource.options.data = initialData;\n\n            result.dataSource.data = initialData;\n            result.dataSource.page = dataSource.page();\n            result.dataSource.filter = $.extend(true, {}, dataSource.filter());\n            result.dataSource.pageSize = dataSource.pageSize();\n            result.dataSource.sort = dataSource.sort();\n            result.dataSource.group = dataSource.group();\n            result.dataSource.aggregate = dataSource.aggregate();\n\n            if (result.dataSource.transport) {\n                result.dataSource.transport.dataSource = null;\n            }\n\n            if (result.pageable && result.pageable.pageSize) {\n                result.pageable.pageSize = dataSource.pageSize();\n            }\n\n            result.$angular = undefined;\n\n            return result;\n        },\n\n        setOptions: function(options) {\n            var currentOptions = this.getOptions();\n            kendo.deepExtend(currentOptions, options);\n            if (!options.dataSource) {\n                currentOptions.dataSource = this.dataSource;\n            } else {\n              if (options.dataSource.filter) {\n                  currentOptions.dataSource.filter = options.dataSource.filter;\n              }\n            }\n            var wrapper = this.wrapper;\n            var events = this._events;\n            var element = this.element;\n\n            this.destroy();\n            this.options = null;\n            if (this._isMobile) {\n                var mobileWrapper = wrapper.closest(kendo.roleSelector(\"pane\")).parent();\n                mobileWrapper.after(wrapper);\n                mobileWrapper.remove();\n                wrapper.removeClass(\"k-grid-mobile\");\n            }\n            if (wrapper[0] !== element[0]) {\n                wrapper.before(element);\n                wrapper.remove();\n            }\n            element.empty();\n\n            this.init(element, currentOptions, events);\n            this._setEvents(currentOptions);\n        },\n\n        items: function() {\n            if (this.lockedContent) {\n                return this._items(this.tbody).add(this._items(this.lockedTable.children(\"tbody\")));\n            } else {\n                return this._items(this.tbody);\n            }\n        },\n\n        _items: function(container, includeGroupRows) {\n            return container.children().filter(function() {\n                var tr = $(this);\n                return (includeGroupRows ? !tr.hasClass(\"k-detail-row\") : !tr.hasClass(\"k-grouping-row\")) && !tr.hasClass(\"k-detail-row\") && !tr.hasClass(\"k-group-footer\");\n            });\n        },\n\n        dataItems: function() {\n            var dataItems = kendo.ui.DataBoundWidget.fn.dataItems.call(this);\n            if (this.lockedContent) {\n                var n = dataItems.length, tmp = new Array(2 * n);\n                for (var i = n; --i >= 0;) {\n                    tmp[i] = tmp[i + n] = dataItems[i];\n                }\n                dataItems = tmp;\n            }\n\n            return dataItems;\n        },\n\n        _destroyColumnAttachments: function() {\n            var that = this;\n\n            that.resizeHandle = null;\n\n            if (!that.thead) {\n                return;\n            }\n\n            this.angular(\"cleanup\", function() {\n                return { elements: that.thead.get() };\n            });\n\n            that.thead.add(that.lockedHeader).find(\"th\").each(function() {\n                var th = $(this),\n                    filterMenu = th.data(\"kendoFilterMenu\"),\n                    sortable = th.data(\"kendoColumnSorter\"),\n                    columnMenu = th.data(\"kendoColumnMenu\");\n\n                if (filterMenu) {\n                    filterMenu.destroy();\n                }\n\n                if (sortable) {\n                    sortable.destroy();\n                }\n\n                if (columnMenu) {\n                    columnMenu.destroy();\n                }\n            });\n        },\n\n        _attachCustomCommandsEvent: function() {\n            var that = this,\n                columns = leafColumns(that.columns || []),\n                command,\n                idx,\n                length;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                command = columns[idx].command;\n\n                if (command) {\n                    attachCustomCommandEvent(that, that.wrapper, command);\n                }\n            }\n        },\n\n        _aria: function() {\n            var wrapper = this.wrapper,\n                gridRole = this._hasDetails() ? \"treegrid\" : \"grid\",\n                table = this.table,\n                toolbar = wrapper.find(\".k-grid-toolbar\"),\n                groupingHeader = wrapper.find(\".k-grouping-header\"),\n                gridId = table.attr(\"id\"),\n                tableTabindex = table.attr(\"tabindex\"),\n                tbodyId, headerGroupId, footerGroupId, tableOwned,\n                numberOfFixedRows = this.thead.find(\"tr\").length + this.wrapper.find(\".k-grid-footer-wrap table tr\").length,\n                trailingColumns = this._trailingColumns(),\n                virtual = this.virtualScroll,\n                pageable = this.options.pageable,\n                rowsCount;\n\n            table.attr({\n                role: gridRole,\n                tabindex: tableTabindex >= 0 ? tableTabindex : 0\n            });\n\n            table.find(\"tbody, thead, tfoot\").attr(\"role\", \"rowgroup\");\n            table.find(\"tr\").attr(\"role\", \"row\");\n            table.find(\"th\").attr(\"role\", \"columnheader\");\n            table.find(\"td\").attr(\"role\", \"gridcell\");\n\n            if ((pageable && this.dataSource.totalPages() > 1) || (virtual && virtual.rows)) {\n                if (this.dataSource.group().length > 0) {\n                    rowsCount = -1;\n                } else if (this._hasDetails()) {\n                    rowsCount = numberOfFixedRows + (this.dataSource.total() * 2);\n                } else {\n                    rowsCount = numberOfFixedRows + this.dataSource.total();\n                }\n\n                table.attr(\"aria-rowcount\", rowsCount);\n            } else if (this._hasDetails()) {\n                if (this.dataSource.group().length > 0) {\n                    rowsCount = -1;\n                } else {\n                    rowsCount = numberOfFixedRows + (this.dataSource.total() * 2);\n                }\n\n                table.attr(\"aria-rowcount\", rowsCount);\n            }\n\n            if (rowsCount && rowsCount > 0) {\n                this._ariaRowIndex();\n            }\n\n            if ((virtual && virtual.columns) ||\n                (!table.attr(\"aria-colcount\") &&\n                    (table.find(\"td:hidden\").length > 0 ||\n                    wrapper.find(\".k-grid-content-locked td:hidden\").length > 0))) {\n                        table.attr(\"aria-colcount\", trailingColumns + leafColumns(this.columns).length);\n                        this._ariaColumnIndex();\n            }\n\n            if (!gridId) {\n                gridId = kendo.guid();\n                table.attr(\"id\", gridId);\n            }\n\n            if (this.pager) {\n                this.pager.element.attr(\"aria-controls\", gridId);\n            }\n\n            toolbar.attr({\n                role: \"toolbar\",\n                \"aria-label\": this.options.messages.toolbarLabel,\n                \"aria-controls\": gridId\n            });\n\n            groupingHeader.attr({\n                role: \"toolbar\",\n                \"aria-label\": this.options.messages.groupingHeaderLabel,\n                \"aria-controls\": gridId\n            });\n\n            headerGroupId = this._ariaHeaderFooter(\"header\", \"thead\", \"th, td\", \"columnheader\");\n            footerGroupId = this._ariaHeaderFooter(\"footer\", \"tfoot\", \"td\", \"gridcell\");\n\n            if (wrapper.find(\".k-grid-content-locked\").length > 0) {\n                this._ariaLockedContent();\n            }\n\n            if (!!headerGroupId || !!footerGroupId) {\n                tbodyId = this.tbody.attr(\"id\") || kendo.guid();\n                tableOwned = [headerGroupId, tbodyId, footerGroupId].join(\" \");\n\n                this.tbody.attr(\"id\", tbodyId);\n                table.attr(\"aria-owns\", tableOwned);\n            }\n        },\n\n        _ariaColumnIndex: function() {\n            var trailingColumns = this._trailingColumns(),\n                dataVirtual = this.tbody.find(\">tr\").last().find(\"> td[data-virtual]\"),\n                headerRows = this.thead.find(\">tr\").not(\".k-filter-row\"),\n                lockedHeaderRows = this.wrapper.find(\".k-grid-header-locked thead > tr\").not(\".k-filter-row\"),\n                firstIndex = Number.MAX_VALUE,\n                lastIndex = 0,\n                lockedLastIndex = 0,\n                previousVirtual = 0,\n                nextVirtual = 0,\n                previousIndex, i, cells, dataIndex, cellsIndex,\n                eachHeaderCell = function(j, cell) {\n                    var current = cell.getAttribute(\"data-index\"),\n                        currentIndex = Number(current),\n                        lockedParent = $(cell).closest(\".k-grid-header-locked\");\n\n                    if (lockedParent.length === 0 && currentIndex < firstIndex) {\n                        firstIndex = currentIndex;\n                    }\n\n                    if (lockedParent.length > 0 && lockedLastIndex < currentIndex) {\n                        lockedLastIndex = currentIndex;\n                    }\n\n                    if (lockedParent.length === 0 && lastIndex < currentIndex) {\n                        lastIndex = currentIndex;\n                    }\n\n                    if (current !== null) {\n                        cell.setAttribute(\"aria-colindex\", Number(currentIndex) + 1);\n                        previousIndex = Number(currentIndex) + 1 + cell.getAttribute(\"colspan\");\n                    } else {\n                        cell.setAttribute(\"aria-colindex\", previousIndex + 1);\n                        previousIndex = previousIndex + cell.getAttribute(\"colspan\");\n                    }\n                };\n\n            if (dataVirtual.length === 2) {\n                previousVirtual = Number(dataVirtual[0].getAttribute(\"colspan\"));\n                nextVirtual = Number(dataVirtual[1].getAttribute(\"colspan\"));\n            } else if (dataVirtual.length === 1 && dataVirtual.prev().length === 0) {\n                previousVirtual = Number(dataVirtual[0].getAttribute(\"colspan\"));\n            } else if (dataVirtual.length === 1 && dataVirtual.prev().length === 1) {\n                nextVirtual = Number(dataVirtual[0].getAttribute(\"colspan\"));\n            }\n\n            for (i = 0; i < lockedHeaderRows.length; i++) {\n                previousIndex = 0;\n                lockedHeaderRows.eq(i).find(\"th\").each(eachHeaderCell);\n            }\n\n            for (i = 0; i < headerRows.length; i++) {\n                previousIndex = 0;\n                headerRows.eq(i).find(\"th\").each(eachHeaderCell);\n            }\n\n            for (i = 0; i <= lockedLastIndex; i++) {\n                dataIndex = i + trailingColumns;\n                cells = this.wrapper.find(\".k-grid-content-locked tbody > tr > td:nth-child(\" + (i + 1) + \")\");\n                cells.attr(\"aria-colindex\", dataIndex + 1);\n            }\n\n            for (i = previousVirtual; i <= lastIndex - firstIndex - nextVirtual; i++) {\n                if (previousVirtual === 0 ) {\n                    cellsIndex = i + 1;\n                } else {\n                    cellsIndex = i - previousVirtual + 2;\n                }\n\n                dataIndex = firstIndex + i + trailingColumns;\n\n                cells = this.tbody.find(\"> tr > td:nth-child(\" + cellsIndex + \")\");\n                cells.attr(\"aria-colindex\", dataIndex + 1);\n            }\n        },\n\n        _ariaHeaderFooter: function(type, group, el, role) {\n            var that = this,\n                wrapper = that.wrapper,\n                table = wrapper.find(\".k-grid-\" + type + \" .k-grid-\" + type + \"-wrap table\"),\n                lockedTable = wrapper.find(\".k-grid-\" + type + \" .k-grid-\" + type + \"-locked table\"),\n                groupId = \"\",\n                rowGroup;\n\n            if (table.length > 0) {\n                rowGroup = table.find(group + \", tbody\");\n                groupId = rowGroup.attr(\"id\") || kendo.guid();\n\n                table.attr(\"role\", \"none\");\n                table.find(\"tr\").attr(\"role\", \"row\");\n                table.find(el).attr(\"role\", role);\n                rowGroup.attr({\n                    role: \"rowgroup\",\n                    id: groupId\n                });\n            }\n\n            if (lockedTable.length > 0) {\n                that._ariaLocked(type, group, el, role);\n            }\n\n            lockedTable.find(\"td\").attr(\"role\", \"gridcell\");\n            table.find(\"td\").attr(\"role\", \"gridcell\");\n\n            return groupId;\n        },\n\n        _ariaId: function() {\n            var id = this.element.attr(\"id\") || \"aria\";\n\n            if (id) {\n                this._cellId = id + \"_active_cell\";\n            }\n        },\n\n        _ariaLocked: function(type, group, el, role) {\n            var that = this,\n                wrapper = that.wrapper,\n                table = wrapper.find(\".k-grid-\" + type + \" .k-grid-\" + type + \"-wrap table\"),\n                lockedTable = wrapper.find(\".k-grid-\" + type + \" .k-grid-\" + type + \"-locked table\"),\n                rows = table.find(\"tr\"),\n                lockedRows = lockedTable.find(\"tr\");\n\n            lockedTable.attr(\"role\", \"none\");\n            lockedTable.find(group + \", tbody\").attr(\"role\", \"none\");\n            lockedRows.attr(\"role\", \"none\");\n\n            lockedTable.find(el).attr(\"role\", role);\n\n            rows.each(function(i, row) {\n                var ownedCells = [];\n\n                ownedCells = that._cellsIds(lockedRows.eq(i).find(el), \"locked_\" + type, i);\n                ownedCells = ownedCells.concat(that._cellsIds($(row).find(el), type, i));\n\n                row.setAttribute(\"aria-owns\", ownedCells.join(\" \"));\n            });\n        },\n\n        _ariaLockedContent: function() {\n            var that = this,\n                table = that.table,\n                tableRows = table.find(\"tr\"),\n                lockedTable = that.wrapper.find(\".k-grid-content-locked table\"),\n                lockedRows = lockedTable.find(\"tr\");\n\n            lockedTable.attr(\"role\", \"none\");\n            lockedTable.find(\"tbody\").attr(\"role\", \"none\");\n            lockedRows.attr(\"role\", \"none\");\n            lockedTable.find(\"td\").attr(\"role\", \"gridcell\");\n\n            tableRows.each(function(i, row) {\n                var ownedCells = [];\n\n                ownedCells = that._cellsIds(lockedRows.eq(i).find(\"td\"), \"locked_datacell\", i);\n                ownedCells = ownedCells.concat(that._cellsIds($(row).find(\"td\"), \"datacell\", i));\n\n                row.setAttribute(\"aria-owns\", ownedCells.join(\" \"));\n            });\n        },\n\n        _ariaAddHiddenColIndex: function() {\n            var virtualScroll = this.virtualScroll || {},\n                columns = this.columns,\n                table = this.table,\n                leafColsCount = leafColumns(columns).length;\n\n            if (!virtualScroll.columns && !table.attr(\"aria-colcount\")) {\n                this._ariaColumnIndex();\n\n                table.attr(\"aria-colcount\", leafColsCount);\n            }\n        },\n\n        _ariaRemoveHiddenColIndex: function() {\n            var virtualScroll = this.virtualScroll || {},\n                columns = this.columns,\n                leafColsCount = leafColumns(columns).length;\n\n            if (!virtualScroll.columns && (leafColsCount === visibleLeafColumns(this.columns).length)) {\n                this.wrapper.find(\"td, th\").removeAttr(\"aria-colindex\");\n\n                this.table.removeAttr(\"aria-colcount\");\n            }\n        },\n\n        _ariaRowIndex: function() {\n            var headerRows = this.thead.find(\">tr\"),\n                numberOfHeaderRows = headerRows.length,\n                bodyRows = this.tbody.find(\">tr\"),\n                footerRows = this.wrapper.find(\".k-grid-footer-wrap tfoot > tr\"),\n                totalNumberOfItems = this.dataSource.total(),\n                previousItems = this.dataSource.skip() || 0,\n                currentIndex = 1,\n                previousMaster = false,\n                i, currentRow;\n\n            if (this._hasDetails()) {\n                totalNumberOfItems = totalNumberOfItems * 2;\n                previousItems = previousItems * 2;\n            }\n\n            for (i = 0; i < numberOfHeaderRows; i++) {\n                headerRows.eq(i).attr(\"aria-rowindex\", currentIndex + i);\n            }\n\n            currentIndex = numberOfHeaderRows + previousItems;\n\n            for (i = 0; i < bodyRows.length; i++) {\n                currentRow = bodyRows.eq(i);\n\n                if (this._hasDetails() && currentRow.hasClass(\"k-master-row\")) {\n                    if (previousMaster) {\n                        currentIndex = currentIndex + 2;\n                    } else {\n                        currentIndex = currentIndex + 1;\n                    }\n\n                    previousMaster = true;\n                } else {\n                    currentIndex = currentIndex + 1;\n                    previousMaster = false;\n                }\n\n                currentRow.attr(\"aria-rowindex\", currentIndex);\n            }\n\n            currentIndex = numberOfHeaderRows + totalNumberOfItems + 1;\n\n            for (i = 0; i < footerRows.length; i++) {\n                footerRows.eq(i).attr(\"aria-rowindex\", currentIndex + i);\n            }\n        },\n\n        _cellsIds: function(elements, prefix, i) {\n            var ownedCells = [];\n\n            elements.each(function(j, cell) {\n                var id = cell.getAttribute(\"id\") || prefix + \"_\" + i + \"_\" + j;\n\n                cell.setAttribute(\"id\", id);\n\n                ownedCells.push(id);\n            });\n\n            return ownedCells;\n        },\n\n        _trailingColumns: function() {\n            return this.dataSource.group().length + (this._hasDetails() ? 1 : 0);\n        },\n\n        _element: function() {\n            var that = this,\n                table = that.element;\n\n            if (!table.is(\"table\")) {\n                if (that.options.scrollable) {\n                    table = that.element.find(\"> .k-grid-content > table\");\n                } else {\n                    table = that.element.children(\"table\");\n                }\n\n                if (!table.length) {\n                    table = $(\"<table />\").appendTo(that.element);\n                }\n            }\n\n            that.table = table;\n\n            that._wrapper();\n        },\n\n        _createResizeHandle: function(container, th) {\n            var that = this;\n            var indicatorWidth = that.options.columnResizeHandleWidth;\n            var scrollable = that.options.scrollable;\n            var resizeHandle = that.resizeHandle;\n            var halfResizeHandle = (indicatorWidth * 3) / 2;\n            var rtlCorrection = 0;\n            var headerWrap;\n            var ieCorrection;\n            var webkitCorrection;\n            var firefoxCorrection;\n            var leftMargin;\n            var invisibleSpace;\n            var leftBorderWidth;\n            var scrollLeft;\n            var left;\n            var top;\n\n            if (resizeHandle && that.lockedContent && resizeHandle.data(\"th\")[0] !== th[0]) {\n                resizeHandle.off(NS).remove();\n                resizeHandle = null;\n            }\n\n            if (!resizeHandle) {\n                resizeHandle = that.resizeHandle = $('<div class=\"k-resize-handle\"><div class=\"k-resize-handle-inner\"></div></div>');\n                container.append(resizeHandle);\n            }\n\n            scrollLeft = kendo.scrollLeft(container);\n\n            if (isRtl && (browser.mozilla || (browser.webkit && browser.version >= 85))) {\n                scrollLeft = scrollLeft * -1;\n            }\n\n            leftBorderWidth = parseFloat(container.css(\"borderLeftWidth\"));\n\n            left = th.offset().left + scrollLeft - parseFloat(th.css(\"marginLeft\")) - (container.offset().left + leftBorderWidth);\n\n            if (!isRtl) {\n                left += th[0].offsetWidth;\n           } else {\n                if (scrollable) {\n                    rtlCorrection = (left <= scrollLeft ? halfResizeHandle : 0);// when shown on first column headers are misaligned due to the width of the resize handler\n                    headerWrap = th.closest(\".k-grid-header-wrap, .k-grid-header-locked\");\n                    invisibleSpace = headerWrap[0].scrollWidth - headerWrap[0].offsetWidth; // the difference between the entire width and the visible area\n                    leftMargin = parseFloat(headerWrap.css(\"marginLeft\"));\n                    ieCorrection = browser.msie ? 2 * kendo.scrollLeft(headerWrap) + leftBorderWidth - leftMargin - rtlCorrection : 0;\n                    webkitCorrection = -rtlCorrection;\n                    firefoxCorrection = browser.mozilla ? leftBorderWidth - leftMargin - rtlCorrection : 0;\n\n                    left -= webkitCorrection + firefoxCorrection + ieCorrection;\n                }\n            }\n\n            top = th.offset().top - parseFloat(th.css(\"marginTop\")) - (container.offset().top + parseFloat(container.css(\"borderTopWidth\")));\n\n            resizeHandle.css({\n                top: top, //scrollable ? 0 : heightAboveHeader(that.wrapper),\n                left: left - halfResizeHandle,\n                height: outerHeight(th),\n                width: indicatorWidth * 3 - rtlCorrection\n            })\n            .data(\"th\", th)\n            .show();\n\n            resizeHandle.off(\"dblclick\" + NS).on(\"dblclick\" + NS, function() {\n                that._autoFitLeafColumn(parseInt(th.attr(kendo.attr(\"index\")), 10));\n            });\n        },\n\n        _positionColumnResizeHandle: function() {\n            var that = this,\n                lockedHead = that.lockedHeader ? that.lockedHeader.find(\"thead\").first() : $();\n\n            that.thead.add(lockedHead).on(\"mousemove\" + NS, \"tr:not(.k-filter-row) > th\", function(e) {\n                var button = typeof e.buttons !== \"undefined\" ? e.buttons : (e.which || e.button);\n\n                var th = $(this);\n                if (th.hasClass(\"k-group-cell\") || th.hasClass(\"k-hierarchy-cell\")) {\n                    return;\n                }\n\n                if (typeof button !== \"undefined\" && button !== 0) {\n                    //do not create a new resize handle if a mouse button is still pressed\n                    //this happens during resizing or before UserEvents trigger \"start\"\n                    return;\n                }\n\n                if (th[0].hasAttribute(kendo.attr(COLSPAN))) {\n                    // resizing multi-column headers is not supported\n                    return;\n                }\n\n                that._createResizeHandle(th.closest(\"div\"), th);\n            });\n        },\n\n        _resizeHandleDocumentClick: function(e) {\n            if ($(e.target).closest(\".k-column-active\").length) {\n                return;\n            }\n\n            $(document).off(e);\n\n            this._resetResizeHandleHeader();\n            this._hideResizeHandle();\n        },\n\n        _resetResizeHandleHeader: function() {\n            var th;\n\n            if (!this.resizeHandle) {\n                return;\n            }\n\n            th = $(this.resizeHandle).data(\"th\");\n\n            if (th) {\n                th.find(DOT + LINK_CLASS).find(DOT + ICON_CLASS).show();\n                th.find(DOT + ORDER_CLASS).show();\n                th.find(DOT + HEADER_COLUMN_MENU_CLASS).show();\n                th.find(DOT + FILTER_MENU_CLASS).show();\n            }\n        },\n\n        _hideResizeHandle: function() {\n            if (this.resizeHandle) {\n                this.resizeHandle.data(\"th\")\n                    .removeClass(\"k-column-active\");\n\n                if (this.lockedContent && !this._isMobile) {\n                    this.resizeHandle.off(NS).remove();\n                    this.resizeHandle = null;\n                } else {\n                    this.resizeHandle.hide();\n                }\n            }\n        },\n\n        _positionColumnResizeHandleTouch: function() {\n            var that = this,\n                lockedHead = that.lockedHeader ? that.lockedHeader.find(\"thead\").first() : $();\n\n            that._resizeUserEvents = new kendo.UserEvents(lockedHead.add(that.thead), {\n                filter: \"th:not(.k-group-cell):not(.k-hierarchy-cell)\",\n                threshold: 10,\n                minHold: 500,\n                hold: function(e) {\n                    var th = $(e.target);\n\n                    e.preventDefault();\n\n                    if (that.resizeHandle) {\n                        that.resizeHandle.data(\"th\")\n                            .removeClass(\"k-column-active\");\n                        that._resetResizeHandleHeader();\n                    }\n\n                    th.addClass(\"k-column-active\");\n\n                    th.find(DOT + LINK_CLASS).find(DOT + ICON_CLASS).hide();\n                    th.find(DOT + ORDER_CLASS).hide();\n                    th.find(DOT + HEADER_COLUMN_MENU_CLASS).hide();\n                    th.find(DOT + FILTER_MENU_CLASS).hide();\n\n                    that._createResizeHandle(th.closest(\"div\"), th);\n\n                    if (!that._resizeHandleDocumentClickHandler) {\n                        that._resizeHandleDocumentClickHandler = that._resizeHandleDocumentClick.bind(that);\n                    }\n\n                    $(document).on(\"click\", that._resizeHandleDocumentClickHandler);\n                }\n            });\n        },\n\n        resizeColumn: function(column, columnWidth) {\n            var that = this;\n            var isLocked = !!column.locked;\n            var isHidden = !!column.hidden;\n            var options = this.options;\n            var scrollbar = !kendo.support.mobileOS ? kendo.support.scrollbar() : 0;\n            var index = isLocked ? inArray(column, visibleLockedColumns(visibleLeafColumns(that.columns))) : inArray(column, visibleNonLockedColumns(visibleLeafColumns(that.columns)));\n            var contentTable = isLocked ? that.lockedTable : that.table;\n            var footer = that.footer || $();\n            var header = isLocked ? that.lockedHeader.find(\"table\") : that.thead.closest(\"table\");\n            var columnMinWidth = column.minResizableWidth || 10;\n            var gridWidth = isLocked ? outerWidth(contentTable.find(\"tbody\")) : outerWidth(that.tbody); // IE returns 0 if grid is empty and scrolling is enabled\n            var col;\n\n            if (isHidden) {\n                column.width = columnWidth > columnMinWidth ? columnWidth : columnMinWidth;\n                return;\n            }\n\n            if (that.footer && that.lockedContent) {\n                footer = isLocked ? that.footer.children(\".k-grid-footer-locked\") : that.footer.children(\".k-grid-footer-wrap\");\n            }\n\n            if (options.scrollable) {\n\n                col = header.find(\"col:not(.k-group-col,.k-hierarchy-col)\").eq(index)\n                    .add(contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index))\n                    .add(footer.find(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index));\n            } else {\n                col = contentTable.find(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index);\n            }\n\n            if (options.scrollable) {\n                var constrain = false;\n                var totalWidth = that.wrapper.width() - scrollbar;\n                var width = columnWidth = columnWidth > columnMinWidth ? columnWidth : columnMinWidth;\n\n                if (isLocked && gridWidth - columnWidth + width > totalWidth) {\n                    width = columnWidth + (totalWidth - gridWidth - scrollbar * 2);\n                    if (width < 0) {\n                        width = columnWidth;\n                    }\n                    constrain = true;\n                }\n\n                if (width > 10 && width >= columnMinWidth) {\n                    col.css('width', width);\n\n                    if (gridWidth) {\n                        if (constrain) {\n                            width = totalWidth - scrollbar * 2;\n                        } else {\n                            width = gridWidth + (columnWidth - column.width);\n                        }\n\n                        contentTable\n                            .add(header)\n                            .add(footer)\n                            .css('width', width);\n\n                        if (!isLocked) {\n                            that._footerWidth = width;\n                        }\n                    }\n                }\n\n            that._scrollVirtualWrapperOnColumnResize();\n            } else if (columnWidth > 10 && columnWidth >= columnMinWidth) {\n                col.css('width', columnWidth);\n            }\n\n            column.width = columnWidth;\n\n            that._applyLockedContainersWidth();\n            that._syncLockedContentHeight();\n            that._syncLockedHeaderHeight();\n            that._updateStickyColumns();\n        },\n\n        _resizable: function() {\n            var that = this,\n                options = that.options,\n                container,\n                columnStart,\n                columnWidth,\n                columnMinWidth,\n                gridWidth,\n                isMobile = this._isMobile,\n                scrollbar = !kendo.support.mobileOS ? kendo.support.scrollbar() : 0,\n                isLocked,\n                col, th;\n\n            if (options.resizable) {\n                container = options.scrollable ? that.wrapper.find(\".k-grid-header-wrap\").first() : that.wrapper;\n\n                if (isMobile) {\n                    that._positionColumnResizeHandleTouch(container);\n                } else {\n                    that._positionColumnResizeHandle(container);\n                }\n\n                if (that.resizable) {\n                    that.resizable.destroy();\n                }\n\n                that.resizable = new ui.Resizable(container.add(that.lockedHeader), {\n                    handle: (!!options.scrollable ? \"\" : \">\") + \".k-resize-handle\",\n                    hint: function(handle) {\n                        return $('<div class=\"k-grid-resize-indicator\" />').css({\n                            height: outerHeight(handle.data(\"th\")) + that.tbody.attr(\"clientHeight\")\n                        });\n                    },\n                    start: function(e) {\n                        th = $(e.currentTarget).data(\"th\");\n\n                        if (isMobile) {\n                            that._hideResizeHandle();\n                        }\n\n                        var header = th.closest(\"table\"),\n                            index = $.inArray(th[0], leafDataCells(th.closest(\"thead\")).filter(\":visible\"));\n\n                        isLocked = header.parent().hasClass(\"k-grid-header-locked\");\n\n                        var contentTable = isLocked ? that.lockedTable : that.table,\n                            footer = that.footer || $();\n\n                        if (that.footer && that.lockedContent) {\n                            footer = isLocked ? that.footer.children(\".k-grid-footer-locked\") : that.footer.children(\".k-grid-footer-wrap\");\n                        }\n\n                        cursor(that.wrapper, 'col-resize');\n\n                        if (options.scrollable) {\n                            col = header.find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index)\n                                .add(contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index))\n                                .add(footer.find(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index));\n                        } else {\n                            col = contentTable.children(\"colgroup\").find(\"col:not(.k-group-col):not(.k-hierarchy-col)\").eq(index);\n                        }\n\n                        var columns = $.map(that.columns, function(a) {\n                            return !a.hidden && ((isLocked && a.locked) || ((!isLocked && !a.locked))) ? a : null;\n                        });\n\n                        columnStart = e.x.location;\n                        columnWidth = outerWidth(th);\n                        columnMinWidth = leafColumns(columns)[index].minResizableWidth || 10;\n                        gridWidth = isLocked ? outerWidth(contentTable.children(\"tbody\")) : outerWidth(that.tbody); // IE returns 0 if grid is empty and scrolling is enabled\n\n                        // fix broken UI in Chrome38+\n                        if (browser.webkit) {\n                            that.wrapper.addClass(\"k-grid-column-resizing\");\n                        }\n                    },\n                    resize: function(e) {\n                        var rtlMultiplier = isRtl ? -1 : 1,\n                            currentWidth = columnWidth + (e.x.location * rtlMultiplier) - (columnStart * rtlMultiplier);\n\n                        if (options.scrollable) {\n                            var footer;\n                            if (isLocked && that.lockedFooter) {\n                                footer = that.lockedFooter.children(\"table\");\n                            } else if (that.footer) {\n                                footer = that.footer.find(\">.k-grid-footer-wrap>table\");\n                            }\n                            if (!footer || !footer[0]) {\n                                footer = $();\n                            }\n                            var header = th.closest(\"table\");\n                            var contentTable = isLocked ? that.lockedTable : that.table;\n                            var constrain = false;\n                            var totalWidth = that.wrapper.width() - scrollbar;\n                            var width = currentWidth;\n\n                            if (isLocked && gridWidth - columnWidth + width > totalWidth) {\n                                width = columnWidth + (totalWidth - gridWidth - scrollbar * 2);\n                                if (width < 0) {\n                                    width = currentWidth;\n                                }\n                                constrain = true;\n                            }\n\n                            if (width > 10 && width >= columnMinWidth) {\n                                col.css('width', width);\n\n                                if (gridWidth) {\n                                    if (constrain) {\n                                        width = totalWidth - scrollbar * 2;\n                                    } else {\n                                        width = gridWidth + (e.x.location * rtlMultiplier) - (columnStart * rtlMultiplier);\n                                    }\n\n                                    contentTable\n                                        .add(header)\n                                        .add(footer)\n                                        .css('width', width);\n\n                                    if (!isLocked) {\n                                        that._footerWidth = width;\n                                    }\n                                }\n                            }\n\n                            that._scrollVirtualWrapperOnColumnResize();\n                        } else if (currentWidth > 10 && currentWidth >= columnMinWidth) {\n                            col.css('width', currentWidth);\n                        }\n                    },\n                    resizeend: function() {\n                        var newWidth = outerWidth(th),\n                            column,\n                            header;\n\n                        cursor(that.wrapper, \"\");\n\n                        if (browser.webkit) {\n                            that.wrapper.removeClass(\"k-grid-column-resizing\");\n                        }\n\n                        if (columnWidth != newWidth) {\n                            header = that.lockedHeader ? that.lockedHeader.find(\"thead\").first().find(\"tr\").first().add(that.thead.find(\"tr\").first()) : th.parent();\n\n                            var index = th.attr(kendo.attr(\"index\"));\n                            if (!index) {\n                                index = header.find(\"th:not(.k-group-cell):not(.k-hierarchy-cell)\").index(th);\n                            }\n                            column = leafColumns(that.columns)[index];\n\n                            column.width = newWidth;\n\n                            that.trigger(COLUMNRESIZE, {\n                                column: column,\n                                oldWidth: columnWidth,\n                                newWidth: newWidth\n                            });\n\n                            that._applyLockedContainersWidth();\n                            that._syncLockedContentHeight();\n                            that._syncLockedHeaderHeight();\n                            that._updateStickyColumns();\n                        }\n\n                        that._resetResizeHandleHeader();\n                        that._hideResizeHandle();\n                        th = null;\n                    }\n                });\n\n            }\n        },\n\n        _draggable: function() {\n            var that = this,\n                reorderable = that.options.reorderable;\n\n            if (reorderable === true || (reorderable && reorderable.columns)) {\n\n                if (that._draggableInstance) {\n                    that._draggableInstance.destroy();\n                }\n\n                var header = that.wrapper.children(\".k-grid-header\");\n\n                that._draggableInstance = that.wrapper.kendoDraggable({\n                    group: kendo.guid(),\n                    autoScroll: true,\n                    filter: that.content ? \".k-grid-header:first \" + HEADERCELLS : \"table:first>.k-grid-header \" + HEADERCELLS,\n                    dragstart: function() {\n                        header.children(\".k-grid-header-wrap\").off(\"scroll\" + NS + \"scrolling\").on(\"scroll\" + NS + \"scrolling\", function(e) {\n                            if (that.virtualScrollable) {\n                                kendo.scrollLeft(that.content.find(\">.k-virtual-scrollable-wrap\"), this.scrollLeft);\n                            } else {\n                                kendo.scrollLeft(that.scrollables.not(e.currentTarget), this.scrollLeft);\n                            }\n                        });\n                    },\n                    dragend: function() {\n                        that._resetResizeHandleHeader();\n                        header.children(\".k-grid-header-wrap\").off(\"scroll\" + NS + \"scrolling\");\n                    },\n                    drag: function() {\n                        that._hideResizeHandle();\n                    },\n                    hint: function(target) {\n                        var title = target.attr(kendo.attr(\"title\"));\n                        if (title) {\n                            title = kendo.htmlEncode(title);\n                        }\n                        return $('<div class=\"k-reorder-clue k-drag-clue\" />')\n                            .html(title || target.attr(kendo.attr(\"field\")) || target.text())\n                            .prepend('<span class=\"k-icon k-drag-status k-i-cancel\"></span>');\n                    }\n                }).data(\"kendoDraggable\");\n            }\n        },\n\n        _reorderable: function() {\n            var that = this,\n                reorderable = that.options.reorderable;\n\n            if (reorderable === true || (reorderable && reorderable.columns)) {\n                if (that.wrapper.data(\"kendoReorderable\")) {\n                    that.wrapper.data(\"kendoReorderable\").destroy();\n                }\n\n                that.wrapper.kendoReorderable({\n                    draggable: that._draggableInstance,\n                    dropFilter: HEADERCELLS,\n                    dragOverContainers: function(sourceIndex, targetIndex) {\n                        var columns = flatColumnsInDomOrder(that.columns);\n                        return columns[sourceIndex].lockable !== false && targetParentContainerIndex(columns, that.columns, sourceIndex, targetIndex) > -1;\n                    },\n                    inSameContainer: function(e) {\n                        return $(e.source).parent()[0] === $(e.target).parent()[0] && targetParentContainerIndex(flatColumnsInDomOrder(that.columns), that.columns, e.sourceIndex, e.targetIndex) > -1;\n                    },\n                    change: function(e) {\n                        var columns = flatColumnsInDomOrder(that.columns);\n                        var column = columns[e.oldIndex];\n                        var newIndex = targetParentContainerIndex(columns, that.columns, e.oldIndex, e.newIndex);\n\n                        that.trigger(COLUMNREORDER, {\n                            newIndex: newIndex,\n                            oldIndex: inArray(column, columns),\n                            column: column\n                        });\n\n                        that.reorderColumn(newIndex, column, e.position === \"before\");\n                    }\n                });\n            }\n        },\n\n        _reorderHeader: function(sources, target, before, container) {\n            var that = this;\n            var sourcePosition = columnPosition(sources[0], that.columns);\n            var destPosition = columnPosition(target, that.columns);\n            var action;\n            var ths;\n\n            var leafs = [];\n            for (var idx = 0; idx < sources.length; idx++) {\n                if (sources[idx].columns) {\n                    leafs = leafs.concat(sources[idx].columns);\n                }\n            }\n            if (container) {\n                ths = elements(container, container, \"tr:eq(\" + sourcePosition.row + \")>th.k-header:not(.k-group-cell,.k-hierarchy-cell)\");\n            } else {\n                ths = elements(that.lockedHeader, that.thead, \"tr:eq(\" + sourcePosition.row + \")>th.k-header:not(.k-group-cell,.k-hierarchy-cell)\");\n            }\n\n            var sourceLockedColumns = lockedColumns(sources).length;\n            var targetLockedColumns = lockedColumns([target]).length;\n\n            if (leafs.length) {\n                if (sourceLockedColumns > 0 && targetLockedColumns === 0) {\n                    action = \"prepend\";\n                    moveCellsBetweenContainers(sources, target, leafs, that.columns, that.lockedHeader.find(\"thead\"), that.thead, this._groups(), action);\n                } else if (sourceLockedColumns === 0 && targetLockedColumns > 0) {\n                    action = destPosition.cell === 0 && sources[0].columns && !target.columns && !that._group ? \"prepend\" : \"append\";\n                    moveCellsBetweenContainers(sources, target, leafs, nonLockedColumns(that.columns), that.thead, that.lockedHeader.find(\"thead\"), this._groups(), action);\n                }\n\n                if (target.columns || sourcePosition.cell - destPosition.cell > 1 || destPosition.cell - sourcePosition.cell > 1) {\n                    target = findReorderTarget(that.columns, target, sources[0], before, that.columns);\n                    if (target) {\n                        if (sourceLockedColumns > 0 && targetLockedColumns === 0) {\n                            that._reorderHeader(leafs, target, before, that.thead);\n                        } else if (sourceLockedColumns === 0 && targetLockedColumns > 0) {\n                            that._reorderHeader(leafs, target, before, that.lockedHead);\n                        } else {\n                            that._reorderHeader(leafs, target, before);\n                        }\n                    }\n                }\n            } else if (sourceLockedColumns !== targetLockedColumns) { // move between containers\n                updateCellRowSpan(ths[sourcePosition.cell], that.columns, sourceLockedColumns);\n            }\n\n            reorder(ths, sourcePosition.cell, destPosition.cell, before, sources.length);\n        },\n\n        _reorderContent: function(sources, destination, before) {\n            var that = this;\n            var lockedRows = $();\n            var source = sources[0];\n            var visibleSources = visibleColumns(sources);\n            var sourceIndex = inArray(source, leafColumns(that.columns));\n            var destIndex = inArray(destination, leafColumns(that.columns));\n\n            var colSourceIndex = inArray(visibleSources[0], visibleLeafColumns(that.columns));\n            var colDest = inArray(destination, visibleLeafColumns(that.columns));\n            var lockedCount = lockedColumns(that.columns).length;\n            var isLocked = !!destination.locked;\n            var footer = that.footer || that.wrapper.find(\".k-grid-footer\");\n\n            var headerCol, footerCol, beforeVisibleColumn;\n            headerCol = footerCol = colDest;\n\n            if (destination.hidden) {\n                var columnsArray = isLocked ? lockedColumns(that.columns) : nonLockedColumns(that.columns);\n\n                if (visibleColumns(columnsArray).length > 0) {\n                    headerCol = footerCol = colDest = this._findClosestVisibleColumnIndex(columnsArray, destIndex);\n                    beforeVisibleColumn = visibleColumns(columnsArray.slice(destIndex)).length > 0;\n                }\n                else {\n                    if (isLocked) {\n                        colDest = that.lockedTable.find(\"colgroup\");\n                        headerCol = that.lockedHeader.find(\"colgroup\");\n                        footerCol = $(that.lockedFooter).find(\">table>colgroup\");\n                    } else {\n                        colDest = that.tbody.prev();\n                        headerCol = that.thead.prev();\n                        footerCol = footer.find(\".k-grid-footer-wrap\").find(\">table>colgroup\");\n                    }\n                }\n            }\n\n            if (that._hasFilterRow()) {\n                reorder(that.wrapper.find(\".k-filter-row td:not(.k-group-cell,.k-hierarchy-cell)\"), sourceIndex, destIndex, before, sources.length);\n            }\n\n            if (colSourceIndex >= 0) {\n                reorder(elements(that.lockedHeader, that.thead.prev(), COLGROUP), colSourceIndex, headerCol, beforeVisibleColumn ? beforeVisibleColumn : before, visibleSources.length);\n            }\n\n            if (that.options.scrollable) {\n                if (colSourceIndex >= 0 && !that._hasVirtualColumns()) {\n                    reorder(elements(that.lockedTable, that.tbody.prev(), COLGROUP), colSourceIndex, colDest, beforeVisibleColumn ? beforeVisibleColumn : before, visibleSources.length);\n                }\n            }\n\n            if (footer && footer.length) {\n                if (colSourceIndex >= 0) {\n                    reorder(elements(that.lockedFooter, footer.find(\".k-grid-footer-wrap\"), \">table>colgroup>col:not(.k-group-col,.k-hierarchy-col)\"), colSourceIndex, footerCol, beforeVisibleColumn ? beforeVisibleColumn : before, visibleSources.length);\n                }\n                reorder(footer.find(\".k-footer-template>td:not(.k-group-cell,.k-hierarchy-cell)\"), sourceIndex, destIndex, before, sources.length);\n            }\n\n            var rows = that.tbody.children(\":not(.k-grouping-row,.k-detail-row)\");\n            if (that.lockedTable) {\n                if (lockedCount > destIndex) {\n                    if (lockedCount <= sourceIndex) {\n                        updateColspan(\n                            that.lockedTable.find(\">tbody>tr.k-grouping-row\"),\n                            that.table.find(\">tbody>tr.k-grouping-row\"),\n                            sources.length\n                        );\n                    }\n                } else if (lockedCount > sourceIndex) {\n                    updateColspan(\n                        that.table.find(\">tbody>tr.k-grouping-row\"),\n                        that.lockedTable.find(\">tbody>tr.k-grouping-row\"),\n                        sources.length\n                    );\n                }\n\n                lockedRows = that.lockedTable.find(\">tbody>tr:not(.k-grouping-row,.k-detail-row)\");\n            }\n\n            for (var idx = 0, length = rows.length; idx < length; idx += 1) {\n                reorder(elements(lockedRows[idx], rows[idx], \">td:not(.k-group-cell,.k-hierarchy-cell)\"), sourceIndex, destIndex, before, sources.length);\n            }\n        },\n\n        _findClosestVisibleColumnIndex: function(columns, columnIndex) {\n            var columnsArray = visibleColumns(columns.slice(columnIndex)).length > 0 ? columns.slice(columnIndex) : columns.slice(0, columnIndex + 1).reverse(),\n                closestVisibleColumn = visibleColumns(columnsArray)[0];\n\n            return inArray(closestVisibleColumn, visibleColumns(this.columns));\n        },\n\n        _autoFitLeafColumn: function(leafIndex) {\n            this.autoFitColumn(leafColumns(this.columns)[leafIndex]);\n        },\n\n        _hasReorderableRows: function() {\n            return this._hasDragHandleColumn || (this.options.reorderable && this.options.reorderable.rows);\n        },\n\n        _draggableRows: function() {\n            var that = this,\n                selectable = that._checkBoxSelection ||\n                            (that.options.selectable && !kendo.ui.Selectable.parseOptions(that.options.selectable).cell);\n\n            if (that._draggableRowsInstance) {\n                that._draggableRowsInstance.destroy();\n            }\n\n            that._draggableRowsInstance = that.tbody.kendoDraggable({\n                group: \"row-draggable\",\n                autoScroll: true,\n                filter: (selectable ? \" > .k-selected\" : \" > \" + ITEMROW) + (that._hasDragHandleColumn ? \" > .k-drag-cell\" : \"\"),\n                hint: function(target) {\n                    var hint = $('<div class=\"k-reorder-clue k-drag-clue\"><span class=\"k-icon k-drag-status k-i-cancel\"></span></div>');\n\n                    if (selectable && that.select().length > 1) {\n                        hint.append(\"<span>\" + that.select().length + \" \" + that.options.messages.itemsSelected + \"</span>\");\n                    } else {\n                        var clone = target.closest(ITEMROW).clone();\n                        clone.find(\"td.k-command-cell\").remove();\n                        clone.find(\"td\").each(function(index, elm) {\n                            hint.append(\"<span>\" + elm.innerText + \"&nbsp;</span>\");\n                        });\n                    }\n\n                    return hint;\n                }\n            }).data(\"kendoDraggable\");\n        },\n\n        _reorderableRows: function() {\n            var that = this,\n                selectable = that._checkBoxSelection ||\n                            (that.options.selectable && !kendo.ui.Selectable.parseOptions(that.options.selectable).cell);\n\n            if (that.tbody.data(\"kendoReorderable\")) {\n                that.tbody.data(\"kendoReorderable\").destroy();\n            }\n\n            that.tbody.kendoReorderable({\n                smartPosition: false,\n                draggable: that._draggableRowsInstance,\n                dragOverContainers: function(sourceIndex, targetIndex) {\n                    var result = true,\n                        target = $(ITEMROW, that.content).eq(targetIndex);\n\n                    if (selectable) {\n                        result = !target.is(\".k-selected\");\n                    }\n\n                    return result;\n                },\n                inSameContainer: function(e) {\n                    if (selectable) {\n                        return !$(e.target).is(\".k-selected\");\n                    }\n\n                    return true;\n                },\n                dropFilter: \"> \" + ITEMROW,\n                allowIcon: \"k-i-insert-middle\",\n                orientation: \"vertical\",\n                reorderDropCue: $('<div class=\"k-drop-hint k-drop-hint-h\"><div class=\"k-drop-hint-start\"></div><div class=\"k-drop-hint-line\"></div></div>'),\n                positionDropCue: function(reorderDropCue, dropTarget) {\n                    var firstCellLeft = kendo.getOffset(dropTarget.children(DATA_CELL).eq(0)).left;\n                    reorderDropCue.css({\n                        transform: \"translate(0,-50%)\",\n                        left: firstCellLeft\n                    });\n                },\n                externalDraggable: function(e) {\n                    var draggable = e.draggable;\n\n                    if (draggable) {\n                        return draggable;\n                    }\n                },\n                change: function(e) {\n                    that._triggerRowRorder(e);\n                }\n            });\n        },\n\n        _triggerRowRorder: function(e) {\n            var that = this,\n                args = {\n                    newIndex: e.position === \"after\" ? e.newIndex + 1 : e.newIndex,\n                    oldIndex: e.oldIndex\n                },\n                row = e.element,\n                selectable = that._checkBoxSelection ||\n                (that.options.selectable && !kendo.ui.Selectable.parseOptions(that.options.selectable).cell);\n\n            if (selectable && that.select().length > 1) {\n                args = extend(args, {\n                    rows: that.select()\n                });\n            } else {\n                args = extend(args, {\n                    row: row\n                });\n            }\n\n            if (!that.trigger(ROWREORDER, args)) {\n                that.reorderRows(selectable ? that.select() : row, args.newIndex);\n            }\n        },\n\n        reorderRows: function(rows, index) {\n            var that = this,\n                dataSource = that.dataSource,\n                rowsLength = that.tbody.children(ITEMROW).length,\n                targetItem = that.dataItem(that.tbody.children(ITEMROW).eq(index)),\n                items = rows.toArray().map(function(row) {\n                    return that.dataItem(row);\n                });\n\n            if (!targetItem) {\n                // If index is after last row dataItem wouldn't exist\n                targetItem = that.dataItem(that.tbody.children(ITEMROW).eq(rowsLength - 1));\n                index = dataSource.indexOf(targetItem) + 1;\n            } else {\n                index = dataSource.indexOf(targetItem);\n            }\n\n            if (index >= 0) {\n                that._rowDropping = true;\n                dataSource.pushMove(index, items);\n                that._rowDropping = false;\n            }\n        },\n\n        autoFitColumns: function(columns) {\n            var that = this;\n\n            columns = columns || that.columns;\n\n            for (var i = 0; i < columns.length; i++) {\n                var column = columns[i];\n\n                if (column.columns) {\n                    that.autoFitColumns(column.columns);\n                } else {\n                    that.autoFitColumn(column);\n                }\n            }\n        },\n\n        autoFitColumn: function(column) {\n            var that = this,\n                options = that.options,\n                columns = that.columns,\n                index,\n                th,\n                headerTable,\n                leafCols,\n                isLocked,\n                visibleLocked = that.lockedHeader ? leafDataCells(that.lockedHeader.find(\">table>thead\")).filter(isCellVisible).length : 0,\n                col,\n                minWidth,\n                contentDiv, scrollLeft,\n                notGroupOrHierarchyCol = \"col:not(.k-group-col):not(.k-hierarchy-col)\",\n                notGroupOrHierarchyVisibleCell = \"td:visible:not(.k-group-cell):not(.k-hierarchy-cell)\",\n                menu,\n                thWidth;\n\n            //  retrieve the column object, depending on the method argument\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(flatColumns(columns), function(item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(flatColumns(columns), function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || !isVisible(column)) {\n                return;\n            }\n\n            leafCols = leafColumns(columns);\n            minWidth = column.minResizableWidth;\n            index = inArray(column, leafCols);\n            isLocked = column.locked;\n\n            if (isLocked) {\n                headerTable = that.lockedHeader.children(\"table\");\n            } else {\n                headerTable = that.thead.parent();\n            }\n\n            th = headerTable.find(\"[data-index='\" + index + \"']\");\n            menu = th.find('a.k-header-column-menu, a.k-grid-filter');\n\n            var contentTable = isLocked ? that.lockedTable : that.table,\n                footer = that.footer || $();\n\n            if (that.footer && that.lockedContent) {\n                footer = isLocked ? that.footer.children(\".k-grid-footer-locked\") : that.footer.children(\".k-grid-footer-wrap\");\n            }\n\n            var footerTable = footer.find(\"table\").first();\n\n            if (that.lockedHeader && !isLocked) {\n                index -= visibleLocked;\n            }\n\n            // adjust column index, depending on previous hidden columns\n            for (var j = 0; j < leafCols.length; j++) {\n                if (leafCols[j] === column) {\n                    break;\n                } else {\n                    if (leafCols[j].hidden) {\n                        index--;\n                    }\n                }\n            }\n\n            // get col elements\n            if (options.scrollable) {\n                col = headerTable.find(notGroupOrHierarchyCol).eq(index)\n                    .add(contentTable.children(\"colgroup\").find(notGroupOrHierarchyCol).eq(index))\n                    .add(footerTable.find(\"colgroup\").find(notGroupOrHierarchyCol).eq(index));\n\n                if (!isLocked) {\n                    contentDiv = contentTable.parent();\n                    scrollLeft = kendo.scrollLeft(contentDiv);\n                }\n            } else {\n                col = contentTable.children(\"colgroup\").find(notGroupOrHierarchyCol).eq(index);\n            }\n\n            var tables = headerTable.add(contentTable).add(footerTable);\n\n            if (browser.safari) {\n                th.css(\"white-space\", \"initial\");\n            }\n\n            var oldColumnWidth = outerWidth(th);\n\n            // reset the table and autofitted column widths\n            // if scrolling is disabled, we need some additional repainting of the table\n            col.width(\"\");\n            tables.css(\"table-layout\", \"fixed\");\n            col.width(\"auto\");\n            tables.addClass(\"k-autofitting\");\n            tables.css(\"table-layout\", \"\");\n\n            thWidth = menu.length ? outerWidth(menu) + outerWidth(th) : outerWidth(th);\n\n            // +1 is required by IE, regardless of the border widths, otherwise unexpected wrapping may occur with hyphenated text\n            var newColumnWidth = Math.ceil(Math.max(\n                thWidth,\n                outerWidth(contentTable.find(\"tr:not(.k-grouping-row)\").eq(0).children(notGroupOrHierarchyVisibleCell).eq(index)),\n                outerWidth(footerTable.find(\"tr\").eq(0).children(notGroupOrHierarchyVisibleCell).eq(index))\n            )) + 1;\n\n            if (minWidth && minWidth > newColumnWidth) {\n                newColumnWidth = minWidth;\n            }\n\n            col.width(newColumnWidth);\n            column.width = newColumnWidth;\n\n            if (browser.safari) {\n                th.css(\"white-space\", \"\");\n            }\n\n            // if all visible columns have widths, the table needs a pixel width as well\n            if (options.scrollable) {\n                var cols = headerTable.find(\"col\"),\n                    colWidth,\n                    totalWidth = 0;\n                for (var idx = 0, length = cols.length; idx < length; idx += 1) {\n                    colWidth = cols[idx].style.width;\n                    if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                        totalWidth += parseInt(colWidth, 10);\n                    } else if (cols.eq(idx).hasClass(\"k-group-col\")) {\n                        totalWidth += parseInt(cols.eq(idx).width(), 10);\n                    } else {\n                        totalWidth = 0;\n                        break;\n                    }\n                }\n\n                if (totalWidth) {\n                    tables.each(function() {\n                        this.style.width = totalWidth + \"px\";\n                    });\n                }\n            }\n\n            tables.removeClass(\"k-autofitting\");\n\n            if (scrollLeft) {\n                kendo.scrollLeft(contentDiv, scrollLeft);\n            }\n\n            that.trigger(COLUMNRESIZE, {\n                column: column,\n                oldWidth: oldColumnWidth,\n                newWidth: newColumnWidth\n            });\n\n            that._applyLockedContainersWidth();\n            that._syncLockedContentHeight();\n            that._syncLockedHeaderHeight();\n            that._updateStickyColumns();\n        },\n\n        reorderColumn: function(destIndex, column, before) {\n            var that = this,\n                parent = columnParent(column, that.columns),\n                columns = parent ? parent.columns : that.columns,\n                sourceIndex = inArray(column, columns),\n                destColumn = columns[destIndex],\n                virtualScroll = that.virtualScroll || {},\n                lockChanged,\n                isLocked = !!destColumn.locked,\n                lockedCount = lockedColumns(that.columns).length,\n                groupHeaderColumnTemplateColumns = grep(leafColumns(that.columns), function(column) { return column.groupHeaderColumnTemplate; });\n\n            if (sourceIndex === destIndex) {\n                return;\n            }\n\n            if (!column.locked && isLocked && nonLockedColumns(that.columns).length == 1) {\n                return;\n            }\n\n            if (column.locked && !isLocked && lockedCount == 1) {\n                return;\n            }\n\n            that._hideResizeHandle();\n\n            if (before === undefined) {\n                before = destIndex < sourceIndex;\n            }\n\n            var sourceColumns = [column];\n\n            that._reorderHeader(sourceColumns, destColumn, before);\n\n            if (that.lockedHeader) {\n                removeEmptyRows(that.thead);\n                removeEmptyRows(that.lockedHeader);\n            }\n\n            if (destColumn.columns) {\n                destColumn = leafColumns(destColumn.columns);\n                destColumn = destColumn[before ? 0 : destColumn.length - 1];\n            }\n\n            if (column.columns) {\n                sourceColumns = leafColumns(column.columns);\n            }\n\n            that._reorderContent(sourceColumns, destColumn, before);\n\n            lockChanged = !!column.locked;\n            lockChanged = lockChanged != isLocked;\n            column.locked = isLocked;\n\n            columns.splice(before ? destIndex : destIndex + 1, 0, column);\n            columns.splice(sourceIndex < destIndex ? sourceIndex : sourceIndex + 1, 1);\n\n            that._updateLockedCols();\n            that._updateCols();\n            that._templates();\n\n            that._updateColumnCellIndex();\n            that._updateColumnSorters();\n\n            if (groupHeaderColumnTemplateColumns.length > 0) {\n                that._renderGroupRows();\n            }\n            that._updateTablesWidth();\n            that._applyLockedContainersWidth();\n            that._syncLockedHeaderHeight();\n            that._syncLockedContentHeight();\n            that._updateFirstColumnClass();\n            that._updateStickyColumns();\n\n            if (virtualScroll.columns) {\n                that.refresh();\n            }\n\n            if (!lockChanged) {\n                return;\n            }\n\n            if (isLocked) {\n                that.trigger(COLUMNLOCK, {\n                    column: column\n                });\n            } else {\n                that.trigger(COLUMNUNLOCK, {\n                    column: column\n                });\n            }\n        },\n\n        _updateColumnCellIndex: function() {\n            var header;\n            var offset = 0;\n\n            if (this.lockedHeader) {\n                header = this.lockedHeader.find(\"thead\");\n                offset = updateCellIndex(header, lockedColumns(this.columns));\n            }\n            updateCellIndex(this.thead, nonLockedColumns(this.columns), offset);\n        },\n\n        lockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.locked || column.hidden) {\n                return;\n            }\n\n            if (column.sticky) {\n                this.unstickColumn(columns.indexOf(column));\n            }\n\n            var index = lockedColumns(columns).length - 1;\n            this.reorderColumn(index, column, false);\n        },\n\n        unlockColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || !column.locked || column.hidden) {\n                return;\n            }\n\n            var index = lockedColumns(columns).length;\n            this.reorderColumn(index, column, true);\n        },\n\n        stickColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || column.sticky || column.hidden) {\n                return;\n            }\n\n            if (column.locked) {\n                this.unlockColumn(columns.indexOf(column));\n\n                if (column.locked) {\n                    return;\n                }\n            }\n\n            column.sticky = true;\n            this._updateStickyColumns();\n        },\n\n        unstickColumn: function(column) {\n            var columns = this.columns;\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else {\n                column = grep(columns, function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || !column.sticky || column.locked || column.hidden) {\n                return;\n            }\n\n            this._removeStickyAttributes([column]);\n            this._removeStickyStyles(stickyColumns(columns));\n\n            column.sticky = false;\n            this._updateStickyColumns();\n\n            if (this._anyStickyColumns() === 0) {\n                this._templates();\n                if (this._hasFilterRow()) {\n                    this._updateStickyFilterCells();\n                }\n            }\n        },\n\n        cellIndex: function(td) {\n            var lockedColumnOffset = 0;\n\n            if (this.lockedTable && !$.contains(this.lockedTable[0], td[0])) {\n                lockedColumnOffset = leafColumns(lockedColumns(this.columns)).length;\n            }\n\n            return $(td).parent().children('td:not(.k-group-cell,.k-hierarchy-cell)').index(td) + lockedColumnOffset;\n        },\n\n        _modelForContainer: function(container) {\n            container = $(container);\n\n            if (!container.is(\"tr\") && this._editMode() !== \"popup\") {\n                container = container.closest(\"tr\");\n            }\n\n            var id = container.attr(kendo.attr(\"uid\")) || container.find(\".k-popup-edit-form\").attr(kendo.attr(\"uid\"));\n\n            return this.dataSource.getByUid(id);\n        },\n\n        _calculateColumnIndex: function(cell) {\n            var cellIndex = this.cellIndex(cell);\n            var virtualOffset = 0;\n\n            if (this._hasVirtualColumns()) {\n                virtualOffset = parseInt($(cell).closest(\"tr\").find(\"td\").first().attr(\"colspan\"), 10);\n                virtualOffset = (virtualOffset > 1 ? virtualOffset - 1 : 0);\n            }\n\n            return cellIndex + virtualOffset;\n        },\n\n        _editable: function() {\n            var that = this,\n                editable = that.options.editable,\n                handler = function() {\n                    var target = activeElement(),\n                        cell = that._editContainer;\n\n                    if (cell && cell[0] && !$.contains(cell[0], target) && cell[0] !== target && !$(target).closest(\".k-animation-container\").length) {\n                        if (that.editable.end()) {\n                            that.closeCell();\n                        } else {\n                            that._scrollVirtualWrapper();\n                        }\n                    }\n                };\n\n            if (editable) {\n                this.wrapper.addClass(\"k-editable\");\n\n                var mode = that._editMode();\n                if (mode === \"incell\") {\n                    that.table.add(that.lockedTable)\n                        .on(\"mousedown\" + NS, NAVROW + \">\" + NAVCELL, function(e) {\n                            var target = $(e.target);\n                            if (that._editMode() === \"incell\" && target.hasClass(\"k-checkbox\") && target.prev().attr(kendo.attr(\"bind\"))) {\n                                e.preventDefault();\n                            }\n                        });\n\n                    if (editable.update !== false) {\n                        if (isMac) {\n                            that.wrapper\n                                .on(CLICK + NS, \".k-edit-cell > input[type='checkbox']\", function(e) {\n                                    // checking /unchecking a checkbox does not change the document.activeElement to be the checkbox\n                                    // this is necessary for the \"focusout\" event to be fired\n                                    $(e.target).trigger(\"focus\");\n                                })\n                                .on(CLICK + NS, \".k-edit-cell\", function(e) {\n                                    if (!$(e.target).is(\"input\")) {\n                                        $(e.currentTarget).find(\"input[type='checkbox']\").trigger(\"focus\");\n                                    }\n                                })\n                                .on(MOUSEDOWN + NS, \"tr:not(.k-grouping-row) > td\", function(e) {\n                                    var editContainer = that._editContainer;\n\n                                    if (editContainer && editContainer[0] && ($.contains(editContainer[0], e.target) || editContainer[0] === e.target)) {\n                                        that._mousedownOnEditCell = true;\n                                    } else {\n                                        that._mousedownOnEditCell = false;\n                                    }\n                                });\n                        }\n\n                        that.editableUserEvents = new kendo.UserEvents(that.wrapper, {\n                            filter: \"tr:not(.k-grouping-row) > td\",\n                            allowSelection: true,\n                            tap: function(e) {\n                                var td = $(e.target),\n                                isLockedCell = that.lockedTable && td.closest(\"table\")[0] === that.lockedTable[0];\n\n                                that._mousedownOnEditCell = false;\n\n                                if (td.hasClass(\"k-hierarchy-cell\") ||\n                                    td.hasClass(\"k-detail-cell\") ||\n                                    td.hasClass(\"k-group-cell\") ||\n                                    td.hasClass(\"k-edit-cell\") ||\n                                    td.has(\".k-grid-delete\").length ||\n                                    (td.closest(\"tbody\")[0] !== that.tbody[0] && !isLockedCell) ||\n                                    $(e.target).is(\":input\")) {\n                                    return;\n                                }\n\n                                if (that.editable) {\n                                    if (that.editable.end()) {\n                                        $(activeElement()).trigger(\"blur\");\n                                        that.closeCell();\n                                        that.editCell(td);\n                                    } else {\n                                        that._scrollVirtualWrapper();\n                                    }\n                                } else {\n                                    that.editCell(td);\n                                }\n                            }\n                        });\n\n                        that.wrapper.on(\"focusin\" + NS, function() {\n                            // fix focus issue in IE\n                            if (!$.contains(this, activeElement())) {\n                                clearTimeout(that.timer);\n                                that.timer = null;\n                            }\n                        })\n                        .on(\"focusout\" + NS, function(e) {\n                            var shouldCloseCell = true;\n\n                            if ((isMac && that._mousedownOnEditCell) || that._virtualColScroll) {\n                                shouldCloseCell = false;\n                            }\n\n                            that._mousedownOnEditCell = false;\n\n                            if (shouldCloseCell) {\n                                that.timer = setTimeout(function() {\n                                    handler(e);\n                                }, 1);\n                            }\n                        });\n                    }\n                } else {\n                    if (editable.update !== false) {\n                        that.wrapper.on(CLICK + NS, \"tbody>tr:not(.k-detail-row,.k-grouping-row):visible .k-grid-edit\", function(e) {\n                            var element = $(this);\n                            if (!that._belongsToGrid(element)) {\n                                return;\n                            }\n                            e.preventDefault();\n                            that.editRow(element.closest(\"tr\"));\n                        });\n\n                        if (that._isVirtualInlineEditable()) {\n                            that.wrapper.on(\"focusout\" + NS, \"tr:not(.k-grouping-row) > td\", function() {\n                                if (that.editable && !that.editable.end()) {\n                                    that._scrollVirtualWrapper();\n                                }\n                            });\n                        }\n                    }\n                }\n\n                if (editable.destroy !== false) {\n                    that.wrapper.on(CLICK + NS, \"tbody>tr:not(.k-detail-row,.k-grouping-row):visible .k-grid-delete\", function(e) {\n                        var element = $(this);\n                        if (!that._belongsToGrid(element)) {\n                            return;\n                        }\n                        e.preventDefault();\n                        e.stopPropagation();\n                        that.removeRow(element.closest(\"tr\"));\n                    });\n                } else {\n                    //Required for the MVC server wrapper delete button\n                    that.wrapper.on(CLICK + NS, \"tbody>tr:not(.k-detail-row,.k-grouping-row):visible .k-grid-delete\", function(e) {\n                        if (!that._belongsToGrid($(this))) {\n                            return;\n                        }\n                        e.stopPropagation();\n\n                        if (!that._confirmation()) {\n                            e.preventDefault();\n                        }\n                    });\n                }\n            }\n        },\n\n        editCell: function(cell) {\n            cell = $(cell);\n\n            var that = this,\n            column = leafColumns(that.columns)[that._calculateColumnIndex(cell)],\n                model = that._modelForContainer(cell);\n\n            that.closeCell();\n\n            if (model && isColumnEditable(column, model) && !column.command) {\n                if (that.trigger(BEFOREEDIT, { model: model })) {\n                    return;\n                }\n\n                that._attachModelChange(model);\n\n                that._editContainer = cell;\n\n                if (that._shouldClearEditableState) {\n                    that._clearEditableState();\n                }\n                that.editable = cell.addClass(\"k-edit-cell\")\n                    .kendoEditable({\n                        fields: editField(column),\n                        model: model,\n                        target: that,\n                        change: function(e) {\n                            if (that.trigger(SAVE, { values: e.values, container: cell, model: model } )) {\n                                e.preventDefault();\n                            }\n                        },\n                        skipFocus: (that._isVirtualIncellEditable() || that._hasVirtualColumns()) && that._editableState ? true : false\n\n                    }).data(\"kendoEditable\");\n\n                var tr = cell.parent().addClass(\"k-grid-edit-row\");\n\n                if (that.lockedContent) {\n                    adjustRowHeight(tr[0], that._relatedRow(tr).addClass(\"k-grid-edit-row\")[0]);\n                    that._syncLockedScroll();\n                }\n\n                that.trigger(EDIT, { container: cell, model: model });\n            }\n        },\n\n        _adjustLockedHorizontalScrollBar: function() {\n            var table = this.table,\n                content = table.parent();\n\n            var scrollbar = table[0].offsetWidth > content[0].clientWidth ? kendo.support.scrollbar() : 0;\n            this.lockedContent.height(content[0].offsetHeight - scrollbar);\n        },\n\n        _syncLockedScroll: function() {\n            this.lockedContent[0].scrollTop = this.content[0].scrollTop;\n            if (this.virtualScrollable) {\n                this.lockedContent[0].scrollTop = this.wrapper.find(\".k-virtual-scrollable-wrap\")[0].scrollTop;\n            }\n        },\n\n        _syncLockedContentHeight: function() {\n            if (this.lockedTable) {\n                if (!this.touchScroller) {\n                    this._adjustLockedHorizontalScrollBar();\n                }\n                this._adjustRowsHeight(this.table, this.lockedTable);\n            }\n        },\n\n        _syncLockedHeaderHeight: function() {\n            if (this.lockedHeader) {\n                var lockedTable = this.lockedHeader.children(\"table\");\n                var table = this.thead.parent();\n\n                this._adjustRowsHeight(lockedTable, table);\n\n                syncTableHeight(lockedTable, table);\n            }\n        },\n\n        _syncLockedFooterHeight: function() {\n            if (this.lockedFooter && this.footer && this.footer.length) {\n                this._adjustRowsHeight(this.lockedFooter.children(\"table\"), this.footer.find(\".k-grid-footer-wrap > table\"));\n            }\n        },\n\n        _destroyEditable: function() {\n            var that = this;\n\n            var destroy = function() {\n                if (that.editable) {\n\n                    var container = that.editView ? that.editView.element : that._editContainer;\n                    var window = that._editContainer.data(\"kendoWindow\");\n\n                    if (container) {\n                        container.off(CLICK + NS, \".k-grid-cancel\", that._editCancelClickHandler);\n                        container.off(CLICK + NS, \".k-grid-update\", that._editUpdateClickHandler);\n                    }\n\n                    that._detachModelChange();\n                    that.editable.destroy();\n                    that.editable = null;\n                    if (window) {\n                        window.destroy();\n                    }\n                    that._editContainer = null;\n                    that._destroyEditView();\n                    that._editableIsClosing = null;\n                }\n            };\n\n            if (that.editable) {\n                if (that._editMode() === \"popup\" && !that._isMobile) {\n                    if (that._editableIsClosing) {\n                        that._editContainer.data(\"kendoWindow\").bind(\"deactivate\", destroy);\n                    }\n                    else {\n                        that._editableIsClosing = true;\n                        that._editContainer.data(\"kendoWindow\").bind(\"deactivate\", destroy).close();\n                    }\n                } else {\n                    destroy();\n                }\n            }\n            if (that._confirmDialog) {\n                that._confirmDialog.close();\n                that._confirmDialog.destroy();\n                that._confirmDialog = null;\n            }\n        },\n\n        _destroyEditView: function() {\n            if (this.editView) {\n                this.editView.purge();\n                this.editView = null;\n                this.pane.navigate(\"\");\n            }\n        },\n\n        _attachModelChange: function(model) {\n            var that = this;\n\n            that._modelChangeHandler = function(e) {\n                that._modelChange({ field: e.field, model: this });\n            };\n\n            model.bind(\"change\", that._modelChangeHandler);\n        },\n\n        _detachModelChange: function() {\n            var that = this,\n                container = that._editContainer,\n                model = that._modelForContainer(container);\n\n            if (model) {\n                model.unbind(CHANGE, that._modelChangeHandler);\n            }\n        },\n\n        closeCell: function(isCancel) {\n            var that = this,\n                cell = that._editContainer,\n                column,\n                tr,\n                model;\n\n            if (!cell) {\n                return;\n            }\n\n            model = that._modelForContainer(cell);\n\n            if (isCancel && that.trigger(\"cancel\", { container: cell, model: model })) {\n                return;\n            }\n\n            that.trigger(CELLCLOSE, { type: isCancel ? \"cancel\" : \"save\", model: model, container: cell });\n\n            cell.removeClass(\"k-edit-cell\");\n            column = leafColumns(that.columns)[that._calculateColumnIndex(cell)];\n\n            tr = cell.parent().removeClass(\"k-grid-edit-row\");\n\n            if (that.lockedContent) {\n                that._relatedRow(tr).removeClass(\"k-grid-edit-row\");\n            }\n\n            that._destroyEditable(); // editable should be destroyed before content of the container is changed\n\n            that._displayCell(cell, column, model);\n\n            if (that._shouldClearEditableState) {\n                that._clearEditableState();\n            }\n\n            that.trigger(\"itemChange\", { item: tr, data: model, ns: ui });\n\n            if (that.lockedContent) {\n                adjustRowHeight(tr.css(\"height\", \"\")[0], that._relatedRow(tr).css(\"height\", \"\")[0]);\n            }\n        },\n\n        _displayCell: function(cell, column, dataItem) {\n            var that = this,\n                state = { storage: {}, count: 0 },\n                settings = extend({}, kendo.Template, that.options.templateSettings),\n                tmpl = kendo.template(that._cellTmpl(column, state), settings);\n\n            if (state.count > 0) {\n                tmpl = tmpl.bind(state.storage);\n            }\n\n            cell.empty().html(tmpl(dataItem));\n\n            that.angular(\"compile\", function() {\n                return {\n                    elements: cell,\n                    data: [ { dataItem: dataItem } ]\n                };\n            });\n        },\n\n        removeRow: function(row) {\n            if (!this._confirmation(row)) {\n                return;\n            }\n\n            this._removeRow(row);\n        },\n\n        _removeRow: function(row) {\n            var that = this,\n                model,\n                modelId,\n                key,\n                schema,\n                mode = that._editMode();\n\n            if (mode !== \"incell\") {\n                that.cancelRow();\n            }\n\n            row = $(row);\n\n            if (that.lockedContent) {\n                row = row.add(that._relatedRow(row));\n            }\n\n            row = row.hide();\n            if (that.dataSource._isGroupPaged()) {\n                that._removeGroupIfEmpty(row);\n            }\n\n            model = that._modelForContainer(row);\n\n            if (model && !that.trigger(REMOVE, { row: row, model: model })) {\n                schema = that.dataSource.options.schema;\n                if (that._selectedIds && schema && schema.model) {\n                    modelId = isFunction(that.dataSource.options.schema.model) ? that.dataSource.options.schema.model.fn.idField : that.dataSource.options.schema.model.id;\n                    key = model[modelId];\n                    delete that._selectedIds[key];\n                }\n\n                that.dataSource.remove(model);\n\n                if (mode === \"inline\" || mode === \"popup\") {\n                    that.dataSource.sync();\n                }\n            } else if (mode === \"incell\") {\n                that._destroyEditable();\n            }\n        },\n\n        _editMode: function() {\n            var mode = \"incell\",\n                editable = this.options.editable;\n\n            if (editable !== true) {\n                if (typeof editable == \"string\") {\n                    mode = editable;\n                } else {\n                    mode = editable.mode || mode;\n                }\n            }\n\n            return mode;\n        },\n\n        editRow: function(row) {\n            var model;\n            var that = this;\n\n            if (row instanceof ObservableObject) {\n                model = row;\n            } else {\n                row = $(row);\n                model = that._modelForContainer(row);\n            }\n\n            var mode = that._editMode();\n            var container;\n\n            that.cancelRow();\n\n            if (model) {\n                row = that.tbody.children(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\");\n                that._attachModelChange(model);\n\n                if (mode === \"popup\") {\n                    that._createPopupEditor(model);\n                } else if (mode === \"inline\") {\n                    that._createInlineEditor(row, model);\n                } else if (mode === \"incell\") {\n                    $(row).children(DATA_CELL).each(function() {\n                        var cell = $(this);\n                        var column = leafColumns(that.columns)[that._calculateColumnIndex(cell)];\n\n                        model = that._modelForContainer(cell);\n\n                        if (model && (!model.editable || model.editable(column.field)) && column.field && !column.selectable) {\n                            that.editCell(cell);\n                            return false;\n                        }\n                    });\n                }\n\n\n                container = that.editView ? that.editView.element : that._editContainer;\n\n                if (container) {\n                    if (!this._editCancelClickHandler) {\n                        this._editCancelClickHandler = this._editCancelClick.bind(this);\n                    }\n\n                    container.on(CLICK + NS, \".k-grid-cancel\", this._editCancelClickHandler);\n\n                    if (!this._editUpdateClickHandler) {\n                        this._editUpdateClickHandler = this._editUpdateClick.bind(this);\n                    }\n\n                    container.on(CLICK + NS, \".k-grid-update\", this._editUpdateClickHandler);\n                }\n            }\n        },\n\n        _editUpdateClick: function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n\n            this.saveRow();\n        },\n\n        _editCancelClick: function(e) {\n            var that = this;\n            var navigatable = that.options.navigatable;\n            var model = that.editable.options.model;\n            var container = that.editView ? that.editView.element : that._editContainer;\n\n            e.preventDefault();\n            e.stopPropagation();\n\n            if (that.trigger(\"cancel\", { container: container, model: model })) {\n                return;\n            }\n\n            var currentIndex = that.items().index($(that.current()).parent());\n\n            that.cancelRow();\n\n            if (navigatable) {\n                that._setCurrent(that.items().eq(currentIndex).children().filter(NAVCELL).first());\n                focusTable(that.table, true);\n            }\n        },\n\n        _editFields: function(columns, model) {\n            var fields = [];\n            var column;\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                column = columns[idx];\n                if (column.selectable || column.command) {\n                    continue;\n                }\n                if (isColumnEditable(column, model)) {\n                    fields.push(editField(column));\n                }\n            }\n            return fields;\n        },\n\n        _createPopupEditor: function(model) {\n            var that = this;\n            var html = '<div ' + kendo.attr(\"uid\") + '=\"' + model.uid + '\" class=\"k-popup-edit-form\"><' + (that._isMobile ? 'ul class=\"k-edit-form-container k-listgroup k-listgroup-flush\">' : 'div class=\"k-edit-form-container\">');\n            var column;\n            var command;\n            var idx;\n            var length;\n            var tmpl;\n            var updateText;\n            var cancelText;\n            var updateIconClass;\n            var cancelIconClass;\n            var tempCommand;\n            var columns = leafColumns(that.columns);\n            var attr;\n            var editMenuGuid = kendo.guid();\n            var editable = that.options.editable;\n            var template = editable.template;\n            var options = isPlainObject(editable) ? editable.window : {};\n            var settings = extend({}, kendo.Template, that.options.templateSettings);\n            var state;\n            var container;\n            var buttonsHTML;\n\n            if (that.trigger(BEFOREEDIT, { model: model })) {\n                return;\n            }\n\n            options = options || {};\n\n            if (template) {\n                if (typeof template === STRING) {\n                    template = kendo.unescape(template);\n                }\n\n                html += (kendo.template(template, settings))(model);\n\n                for (idx = 0, length = columns.length; idx < length; idx++) {\n                    column = columns[idx];\n                    if (column.command) {\n                        tempCommand = getCommand(column.command, \"edit\");\n                        if (tempCommand) {\n                            command = tempCommand;\n                        }\n                    }\n                }\n            } else {\n                for (idx = 0, length = columns.length; idx < length; idx++) {\n                    column = columns[idx];\n                    if (column.selectable) {\n                        continue;\n                    }\n                    if (!column.command) {\n                        if (that._isMobile) {\n                            html += '<li class=\"k-item k-listgroup-item\">';\n\n                            if (isColumnEditable(column, model)) {\n                                html += '<label class=\"k-label k-listgroup-form-row\">';\n                                html += '<span class=\"k-item-title k-listgroup-form-field-label\">' + (column.title && (that.options.encodeTitles ? htmlEncode(column.title, true) : column.title) || column.field || \"\") + '</span>';\n                                html += '<div class=\"k-listgroup-form-field-wrapper\" id=\"' + column.field + '_' + editMenuGuid + '\" ' + kendo.attr(\"container-for\") + '=\"' + column.field + '\"></div>';\n                                html += '</label>';\n                            } else {\n                                state = { storage: {}, count: 0 };\n\n                                tmpl = kendo.template(that._cellTmpl(column, state), settings);\n\n                                if (state.count > 0) {\n                                    tmpl = tmpl.bind(state.storage);\n                                }\n\n                                html += '<label class=\"k-label k-listgroup-form-row k-no-click\">';\n                                html += '<span class=\"k-item-title k-listgroup-form-field-label\">' + (column.title && (that.options.encodeTitles ? htmlEncode(column.title, true) : column.title) || column.field || \"\") + '</span>';\n                                html += '<span class=\"k-no-editor k-listgroup-form-field-wrapper\">' + tmpl(model) + '</span>';\n                                html += '</label>';\n                            }\n\n                            html += \"</li>\";\n                        }\n                    } else if (column.command) {\n                        tempCommand = getCommand(column.command, \"edit\");\n                        if (tempCommand) {\n                            command = tempCommand;\n                        }\n                    }\n                }\n            }\n\n            if (command) {\n                if (isPlainObject(command)) {\n                    if (isPlainObject(command.text)) {\n                        updateText = command.text.update;\n                        cancelText = command.text.cancel;\n                    }\n                    if (isPlainObject(command.iconClass)) {\n                        updateIconClass = command.iconClass.update;\n                        cancelIconClass = command.iconClass.cancel;\n                    }\n\n                   if (command.attr) {\n                       attr = command.attr;\n                   }\n                }\n            }\n\n            if (!that._isMobile) {\n                buttonsHTML = '<div class=\"k-edit-buttons k-actions-end\">';\n                buttonsHTML += that._createButton({ name: \"update\", text: updateText, attr: attr, iconClass: updateIconClass }) + that._createButton({ name: \"canceledit\", text: cancelText, attr: attr, iconClass: cancelIconClass });\n                buttonsHTML += '</div>';\n\n                html += template ? buttonsHTML + '</div>' : '</div>';\n\n                container = that._editContainer = $(html)\n                .appendTo(that.wrapper).eq(0)\n                .kendoWindow(extend({\n                    modal: true,\n                    resizable: false,\n                    draggable: true,\n                    title: that.options.messages.commands.edit || \"Edit\",\n                    visible: false,\n                    close: function(e) {\n                        if (e.userTriggered) {\n                            //The bellow line is required due to: draggable window in IE, change event will be triggered while the window is closing\n                            e.sender.element.trigger(\"focus\");\n                            if (that.trigger(\"cancel\", { container: container, model: model })) {\n                                e.preventDefault();\n                                return;\n                            }\n\n                            var currentIndex = that.items().index($(that.current()).parent());\n\n                            that._editableIsClosing = true;\n                            that.cancelRow();\n                            if (that.options.navigatable) {\n                                that._setCurrent(that.items().eq(currentIndex).children().filter(NAVCELL).first());\n                                focusTable(that.table, true);\n                            }\n                        }\n                    }\n                }, options));\n            } else {\n                html += \"</ul></div>\";\n                that.editView = that.pane.append(\n                    '<div data-' + kendo.ns + 'role=\"view\" class=\"k-grid-edit-form\">' +\n                        '<div data-' + kendo.ns + 'role=\"header\" class=\"k-header\">' +\n                            '<a href=\"\\\\#\" class=\"k-header-cancel k-link k-grid-cancel\" title=\"#=messages.cancel#\" ' +\n                            'aria-label=\"#=messages.cancel#\"><span class=\"k-icon k-i-arrow-chevron-left\"></span></a>' +\n                            (that.options.messages.commands.edit || \"Edit\") +\n                            '<a href=\"\\\\#\" class=\"k-header-done k-link k-grid-update\" title=\"#=messages.done#\" ' +\n                            'aria-label=\"#=messages.done#\"><span class=\"k-icon k-i-check\"></span></a>' +\n                        '</div>' +\n                        '<div data-' + kendo.ns + 'role=\"content\" class=\"' + classNames.content + '\">' +\n                            html +\n                        '</div>' +\n                    '</div>');\n                container = that._editContainer = that.editView.element.find(\".k-popup-edit-form\");\n            }\n\n            if (!template && !that._isMobile) {\n                that.editable = new ui.Form(that._editContainer.find(\".k-edit-form-container\"), {\n                    items: that._editFields(columns, model),\n                    buttonsTemplate: \"\",\n                    formData: model\n                }).editable;\n                that._editContainer.append(buttonsHTML);\n            } else {\n                that.editable = that._editContainer\n                .kendoEditable({\n                    fields: that._isMobile ? that._editFields(columns, model) : null,\n                    model: model,\n                    clearContainer: false,\n                    target: that\n                }).data(\"kendoEditable\");\n            }\n\n            that._openPopUpEditor();\n\n            that.trigger(EDIT, { container: container, model: model });\n        },\n\n        _openPopUpEditor: function() {\n            var that = this;\n            var windowEditor = that._editContainer ? that._editContainer.data(\"kendoWindow\") : null;\n            var windowOptions = (that.options.editable || {}).window || {};\n\n            if (!this._isMobile) {\n                if (windowEditor) {\n                    if (!windowOptions.position) {\n                        windowEditor.center();\n                    }\n\n                    windowEditor.open();\n                }\n            } else {\n                this.pane.navigate(this.editView, this._editAnimation);\n            }\n        },\n\n        _createInlineEditor: function(row, model) {\n            var that = this;\n            var column;\n            var cell;\n            var command;\n            var fields = [];\n\n            if (that.trigger(BEFOREEDIT, { model: model })) {\n                return;\n            }\n\n            if (that.lockedContent) {\n                row = row.add(that._relatedRow(row));\n            }\n\n            row.children(\":not(.k-group-cell,.k-hierarchy-cell)\").each(function() {\n                cell = $(this);\n                column = leafColumns(that.columns)[that._calculateColumnIndex(cell)];\n\n                if (!column.command && isColumnEditable(column, model)) {\n                    fields.push(editField(column));\n                    cell.attr(kendo.attr(\"container-for\"), column.field);\n                    cell.empty();\n                } else if (column.command) {\n                    command = getCommand(column.command, \"edit\");\n                    if (command) {\n                        cell.empty();\n\n                        var updateText,\n                            cancelText,\n                            updateIconClass,\n                            cancelIconClass,\n                            attr;\n\n                        if (isPlainObject(command)) {\n                                if (isPlainObject(command.text)) {\n                                    updateText = command.text.update;\n                                    cancelText = command.text.cancel;\n                                }\n                                if (isPlainObject(command.iconClass)) {\n                                    updateIconClass = command.iconClass.update;\n                                    cancelIconClass = command.iconClass.cancel;\n                                }\n\n                            if (command.attr) {\n                                attr = command.attr;\n                            }\n                        }\n\n                        $(that._createButton({ name: \"update\", text: updateText, attr: attr, iconClass: updateIconClass }) +\n                            that._createButton({ name: \"canceledit\", text: cancelText, attr: attr, iconClass: cancelIconClass })).appendTo(cell);\n                    }\n                }\n            });\n\n            that._editContainer = row;\n            that._editContainer.addClass(\"k-grid-edit-row\");\n\n            if (that._shouldClearEditableState) {\n                that._clearEditableState();\n            }\n\n            that.editable = new kendo.ui.Editable(that._editContainer, {\n                target: that,\n                fields: fields,\n                model: model,\n                skipFocus: (that._isVirtualInlineEditable() && that._editableState && (that._editableState.field ? true : false)) || that._hasVirtualColumns(),\n                clearContainer: false\n            });\n\n            if (row.length > 1) {\n\n                adjustRowHeight(row[0], row[1]);\n                that._applyLockedContainersWidth();\n            }\n\n            that.trigger(EDIT, { container: row, model: model });\n        },\n\n        cancelRow: function(notify) {\n            var that = this,\n                container = that._editContainer,\n                model;\n\n            if (container) {\n                model = that._modelForContainer(container);\n\n                if (!model || (notify && that.trigger(\"cancel\", { container: container, model: model }))) {\n                    return;\n                }\n\n                that._destroyEditable();\n\n                that.dataSource.cancelChanges(model);\n\n                that._clearEditableState();\n\n                if (that._editMode() !== \"popup\") {\n                    that._displayRow(container);\n                } else {\n                    that._displayRow(that.tbody.find(\"[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\"));\n                }\n            }\n        },\n\n        saveRow: function() {\n            var that = this;\n            var container = this._editContainer;\n            var model = this._modelForContainer(container);\n            var deferred = $.Deferred();\n            var valid;\n\n            if (!container || !this.editable) {\n                return deferred.resolve().promise();\n            }\n\n            valid = that.editable && that.editable.end();\n\n            if (!valid || this.trigger(SAVE, { container: container, model: model })) {\n                if (!valid) {\n                    that._scrollVirtualWrapper();\n                }\n\n                return deferred.reject().promise();\n            }\n\n            that._clearEditableState();\n\n            return this.dataSource.sync();\n        },\n\n        _displayRow: function(row) {\n            var that = this,\n                model = that._modelForContainer(row),\n                related,\n                newRow,\n                nextRow,\n                isSelected = row.hasClass(\"k-selected\"),\n                isAlt = row.hasClass(\"k-alt\");\n\n            if (model) {\n\n                if (that.lockedContent) {\n                    related = $((isAlt ? that.lockedAltRowTemplate : that.lockedRowTemplate)(model));\n                    that._relatedRow(row.last()).replaceWith(related);\n                }\n\n                that.angular(\"cleanup\", function() { return { elements: row.get() }; });\n\n                newRow = $((isAlt ? that.altRowTemplate : that.rowTemplate)(model));\n                if (!row.is(\":visible\")) {\n                    newRow.hide();\n                }\n                row.replaceWith(newRow);\n\n                that.trigger(\"itemChange\", { item: newRow, data: model, ns: ui });\n\n                if (related && related.length) {\n                    that.trigger(\"itemChange\", { item: related, data: model, ns: ui });\n                }\n\n                var angularElements = newRow;\n                var angularData = [{ dataItem: model }];\n\n                if (related && related.length) {\n                    angularElements = newRow.add(related);\n                    angularData.push({ dataItem: model });\n                }\n\n                that.angular(\"compile\", function() {\n                    return {\n                        elements: angularElements.get(),\n                        data: angularData\n                    };\n                });\n\n\n                if (isSelected && (that.options.selectable || that._checkBoxSelection)) {\n                    that.select(newRow.add(related));\n                }\n\n                if (related) {\n                    adjustRowHeight(newRow[0], related[0]);\n                }\n\n                nextRow = newRow.next();\n                if (nextRow.hasClass(\"k-detail-row\") && nextRow.is(\":visible\")) {\n                    newRow.find(\".k-hierarchy-cell .k-icon\")\n                        .removeClass(\"k-i-expand\")\n                        .addClass(\"k-i-collapse\");\n                }\n            }\n        },\n\n        _showMessage: function(messages, row) {\n            var that = this;\n\n            if (!that._isMobile) {\n                // eslint-disable-next-line no-alert\n                return window.confirm(messages.title);\n            }\n\n            var confirmDialog = that._confirmDialog = new kendo.ui.Confirm($(\"<div />\").appendTo(document.body), {\n                modal: {\n                    preventScroll: true\n                },\n                closable: false,\n                title: false,\n                content: messages.title,\n                messages: {\n                    okText: messages.confirmDelete,\n                    cancel: messages.cancelDelete\n                },\n                open: function() {\n                    if (that.content) {\n                        that.content.data(OVERFLOW, that.content.css(OVERFLOW));\n                        that.content.css(OVERFLOW, HIDDEN);\n                    }\n                },\n                close: function() {\n                    if (that.content) {\n                        that.content.css(OVERFLOW, that.content.data(OVERFLOW));\n                    }\n                }\n            });\n\n            confirmDialog.result\n                .done(function() {\n                    that._removeRow(row);\n                })\n                .fail(function() {\n                    var confirmDialog = that._confirmDialog;\n\n                    if (confirmDialog) {\n                        confirmDialog.close();\n                        confirmDialog.destroy();\n                    }\n                });\n\n            return false;\n        },\n\n        _confirmation: function(row) {\n            var that = this,\n                editable = that.options.editable,\n                confirmation = (editable === true || typeof editable === STRING) ? that.options.messages.editable.confirmation : editable.confirmation;\n\n            if (isPlainObject(editable) && typeof editable.mode === STRING && typeof confirmation !== FUNCTION && typeof confirmation !== STRING && confirmation !== false) {\n                confirmation = that.options.messages.editable.confirmation;\n            }\n\n            if (confirmation !== false && confirmation != null) {\n\n                if (typeof confirmation === FUNCTION) {\n                    confirmation = confirmation(that._modelForContainer(row));\n                }\n\n                return that._showMessage({\n                        confirmDelete: editable.confirmDelete || that.options.messages.editable.confirmDelete,\n                        cancelDelete: editable.cancelDelete || that.options.messages.editable.cancelDelete,\n                        title: confirmation === true ? that.options.messages.editable.confirmation : confirmation\n                    }, row);\n            }\n\n            return true;\n        },\n\n        cancelChanges: function() {\n            var that = this;\n\n            that.dataSource.cancelChanges();\n\n            if (that._isVirtualEditable()) {\n                that._virtualPageToTop(function() {\n                    that.virtualScrollable.scrollToTop();\n                });\n            }\n        },\n\n        saveChanges: function() {\n            var that = this;\n            var valid = that.editable && that.editable.end();\n\n            if ((valid || !that.editable) && !that.trigger(SAVECHANGES)) {\n                that.dataSource.sync();\n            } else if (!valid) {\n                that._scrollVirtualWrapper();\n            }\n        },\n\n        addRow: function() {\n            var that = this,\n                index,\n                dataSource = that.dataSource,\n                mode = that._editMode(),\n                createAt = that.options.editable.createAt || \"\",\n                pageSize = dataSource.pageSize(),\n                view = dataSource.view() || [];\n            var createAtBottom = createAt.toLowerCase() === BOTTOM;\n            var model;\n            var virtualEditable = that._isVirtualEditable();\n\n            if ((that.editable && that.editable.end()) || !that.editable) {\n                if (mode != \"incell\") {\n                    that.cancelRow();\n                }\n\n                index = dataSource.indexOf(view[0]);\n\n                if (createAtBottom) {\n                    index += view.length;\n\n                    if (pageSize && !dataSource.options.serverPaging && pageSize <= view.length) {\n                        index -= 1;\n                    }\n                }\n\n                if (index < 0) {\n                    if (dataSource.page() > dataSource.totalPages()) {\n                        index = (dataSource.page() - 1) * pageSize;\n                    } else {\n                        index = 0;\n                    }\n                }\n\n                if (that.options.navigatable && mode == \"incell\") {\n                    that._removeCurrent();\n                }\n\n                if (virtualEditable) {\n                    that._virtualAddRow();\n                } else {\n                    model = dataSource.insert(index, {});\n                    that._editModel(model);\n                }\n            } else {\n                that._scrollVirtualWrapper();\n            }\n        },\n\n        _editModel: function(model) {\n            var that = this;\n            var createAt = that.options.editable.createAt || \"\";\n            var mode = that._editMode();\n\n            if (model) {\n                var id = model.uid,\n                    table = that.lockedContent ? that.lockedTable : that.table,\n                    row = table.find(\"tr[\" + kendo.attr(\"uid\") + \"=\" + id + \"]\"),\n                    cell = row.children(\"td:not(.k-group-cell,.k-hierarchy-cell)\").eq(that._firstEditableColumnIndex(row));\n\n                if (mode === \"inline\" && row.length) {\n                    that.editRow(row);\n                } else if (mode === \"popup\") {\n                    that.editRow(model);\n                } else if (cell.length) {\n                    that.editCell(cell);\n                }\n\n                if (createAt.toLowerCase() == \"bottom\" && that.lockedContent) {\n                    //scroll the containers to the bottom\n                    that.lockedContent[0].scrollTop = that.content[0].scrollTop = that.table[0].offsetHeight;\n                }\n            }\n        },\n\n        _virtualAddRow: function() {\n            var that = this;\n            var createAtBottom = (that.options.editable.createAt || \"\").toLowerCase() === BOTTOM;\n\n            that._clearEditableState();\n\n            if (createAtBottom) {\n                that._virtualAddRowAtBottom();\n            } else {\n                that._virtualAddRowAtTop();\n            }\n        },\n\n        _virtualAddRowAtTop: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n            var virtualScrollable = that.virtualScrollable;\n            var model;\n\n            if (dataSource.page() === 1) {\n                model = dataSource.insert(0, {});\n                that._editModel(model);\n                virtualScrollable.scrollToTop();\n            } else {\n                that._virtualPageToTop(function() {\n                    model = dataSource.insert(0, {});\n                    that._editModel(model);\n                    virtualScrollable.scrollToTop();\n                });\n            }\n        },\n\n        _virtualAddRowAtBottom: function() {\n            var that = this;\n            var dataSource = that.dataSource;\n            var virtualScrollable = that.virtualScrollable;\n            var index = dataSource.total();\n            var model;\n\n            if (dataSource.at(index - 1) instanceof ObservableObject) {\n                model = dataSource.insert(index, {});\n\n                that._virtualPageToBottom(function() {\n                    that._editModel(model);\n                    virtualScrollable.scrollToBottom();\n                });\n            } else {\n                that._virtualPageToBottom(function() {\n                    model = dataSource.insert(index, {});\n                    that._editModel(model);\n                    virtualScrollable.scrollToBottom();\n                });\n            }\n        },\n\n        _virtualPageToTop: function(callback) {\n            var that = this;\n\n            that._virtualPage(0, that.dataSource.take(), function() {\n                callback();\n            });\n        },\n\n        _virtualPageToBottom: function(callback) {\n            var that = this;\n            var dataSource = that.dataSource;\n            var take = dataSource.take();\n            var total = dataSource.total();\n            var skip = total > take ? (total - take) : 0;\n\n            that._virtualPage(skip, take, function() {\n                callback();\n            });\n        },\n\n        _virtualPage: function(skip, take, callback) {\n            var that = this;\n\n            if (that._isVirtualEditable()) {\n                that.virtualScrollable._preventScroll = true;\n                that.virtualScrollable._page(skip, take, callback);\n            }\n        },\n\n        _firstEditableColumnIndex: function(container) {\n            var that = this,\n                column,\n                columns = leafColumns(that.columns),\n                idx,\n                length,\n                model = that._modelForContainer(container);\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (model && (!model.editable || model.editable(column.field)) && !column.command && column.field && column.hidden !== true) {\n                    return idx;\n                }\n            }\n            return -1;\n        },\n\n        _toolbar: function() {\n            var that = this,\n                wrapper = that.wrapper,\n                toolbar = that.options.toolbar,\n                editable = that.options.editable,\n                container;\n\n            if (toolbar) {\n                container = that.wrapper.find(\".k-grid-toolbar\");\n\n                if (!container.length) {\n                    if (!isFunction(toolbar)) {\n                        toolbar = (typeof toolbar === STRING ? toolbar : that._toolbarTmpl(toolbar).replace(templateHashRegExp, \"\\\\#\"));\n                        toolbar = kendo.template(toolbar).bind(that);\n                    }\n\n                    container = $('<div class=\"k-toolbar k-grid-toolbar\" />')\n                        .html(toolbar({}))\n                        .prependTo(wrapper);\n\n                    that.angular(\"compile\", function() {\n                        return { elements: container.get() };\n                    });\n                }\n\n                if (editable && editable.create !== false) {\n                    container.on(CLICK + NS, \".k-grid-add\", function(e) { e.preventDefault(); that.addRow(); })\n                        .on(CLICK + NS, \".k-grid-cancel-changes\", function(e) { e.preventDefault(); that.cancelChanges(); })\n                        .on(CLICK + NS, \".k-grid-save-changes\", function(e) { e.preventDefault(); that.saveChanges(); });\n                }\n\n                container.on(CLICK + NS, \".k-grid-excel\", function(e) {\n                    e.preventDefault();\n\n                    that.saveAsExcel();\n                });\n\n                container.on(CLICK + NS, \".k-grid-pdf\", function(e) {\n                    e.preventDefault();\n\n                    var promise = that.saveAsPDF();\n                    if (promise) {\n                        promise.done(function() {\n                            that._pdfInitialized = false;\n                        });\n                    }\n                });\n\n                container.on(INPUT + NS, \".k-grid-search input\", function(e) {\n                    var input = e.currentTarget;\n                    clearTimeout(that._searchTimeOut);\n                    that._searchTimeOut = setTimeout(function() {\n                        that._searchTimeOut = null;\n                        var options = that.options;\n                        var searchFields = options.search ? options.search.fields : null;\n                        var expression = { filters: [], logic: \"or\" };\n                        var value = input.value;\n\n                        if (!searchFields) {\n                            searchFields = getColumnsFields(options.columns);\n                        }\n\n                        if (that.dataSource.options.endless) {\n                            that.dataSource.options.endless = null;\n                            that._endlessPageSize = that.dataSource.options.pageSize;\n                        }\n\n                        if (value) {\n                            for (var i = 0; i < searchFields.length; i++) {\n                                that._pushExpression(expression.filters, searchFields[i], value);\n                            }\n                        } else {\n                            expression = {};\n                        }\n\n                        that.dataSource.filter(expression);\n\n                    }, 300);\n                });\n            }\n        },\n\n        _pushExpression: function(filters, field, value) {\n            var that = this,\n                isServerFiltering = that.dataSource.options.serverFiltering,\n                defaultOperators = {\n                    string: \"contains\",\n                    number: \"gte\",\n                    date: \"gte\",\n                    enums: \"eq\",\n                    boolean: \"eq\"\n                },\n                name = field.name || field,\n                operator = field.operator,\n                modelInfo = that.dataSource.reader.model && that.dataSource.reader.model.fields,\n                fieldInfo = modelInfo && modelInfo[name],\n                parseFn = fieldInfo && fieldInfo.parse,\n                expression = {\n                    field: name,\n                    operator: operator || defaultOperators.string,\n                    value: value\n                };\n\n            if ((operator || isServerFiltering) && fieldInfo && kendo.isFunction(parseFn) && parseFn(value) !== null) {\n                extend(expression, {\n                    operator: operator || defaultOperators[fieldInfo.type],\n                    value: parseFn(value)\n                });\n            }\n\n            if (isServerFiltering && fieldInfo && kendo.isFunction(parseFn) && parseFn(value) === null) {\n                return;\n            }\n\n            filters.push(expression);\n        },\n\n        _toolbarTmpl: function(commands) {\n            var that = this,\n                idx,\n                length,\n                html = \"\",\n                command,\n                searchText = \"\",\n                messages = that.options.messages.commands;\n\n            if (isArray(commands)) {\n                for (idx = 0, length = commands.length; idx < length; idx++) {\n                    command = typeof commands[idx] === 'string' ? commands[idx].toLowerCase() : (commands[idx].name || \"\").toLowerCase();\n                    if (command === \"search\") {\n                        if (typeof commands[idx] !== 'string') {\n                            searchText = commands[idx].text;\n                        }\n                        searchText = searchText || messages.search;\n                        html += \"<span class='k-spacer'></span>\";\n                        html += \"<span class='k-searchbox k-input k-input-md k-rounded-md k-input-solid k-grid-search'>\";\n                        html += \"<span class='k-input-icon k-icon k-i-search'></span>\";\n                        html += \"<input autocomplete='off' placeholder='\" + searchText + \"' title='\" + searchText + \"' aria-label='\" + searchText + \"' class='k-input-inner' />\";\n                        html += \"</span>\";\n                    } else {\n                        html += that._createButton(commands[idx]);\n                    }\n                }\n            }\n\n            return html;\n        },\n\n        _createButton: function(command) {\n            var button,\n                template = command.template || COMMANDBUTTONTMPL,\n                commandName = typeof command === STRING ? command : command.name || command.text,\n                className = defaultCommands[commandName] ? defaultCommands[commandName].className : \"k-grid-\" + (commandName || \"\").replace(/\\s/g, \"\"),\n                options = { className: className, text: commandName, attr: \"\", iconClass: \"\" },\n                messages = this.options.messages.commands,\n                attributeClassMatch;\n\n            if (!commandName && !(isPlainObject(command) && command.template)) {\n                throw new Error(\"Custom commands should have name specified\");\n            }\n\n            if (isPlainObject(command)) {\n                command = extend(true, {}, command);\n\n                if (command.className && inArray(options.className, command.className.split(\" \")) < 0) {\n                    command.className += \" \" + options.className;\n                } else if (command.className === undefined) {\n                    command.className = options.className;\n                }\n\n                if (command.className.indexOf(\"k-primary\") > -1) {\n                    command.className = command.className.replace(\"k-primary\", \"\");\n                    command.themeColor = \"primary\";\n                }\n\n                if (commandName === \"edit\") {\n                    command = extend(true, {}, command);\n                    command.text = isPlainObject(command.text) ? command.text.edit : command.text;\n                    command.iconClass = isPlainObject(command.iconClass) ? command.iconClass.edit : command.iconClass;\n                }\n\n                if (command.attr) {\n                    if (isPlainObject(command.attr)) {\n                        command.attr = stringifyAttributes(command.attr);\n                    }\n\n                    if (typeof command.attr === STRING) {\n                        attributeClassMatch = command.attr.match(/class=\"(.+?)\"/);\n\n                        if (attributeClassMatch && inArray(attributeClassMatch[1], command.className.split(\" \")) < 0) {\n                            command.className += \" \" + attributeClassMatch[1];\n                        }\n                    }\n                }\n\n                options = extend(true, options, defaultCommands[commandName], { text: messages[commandName] }, command);\n            } else {\n                options = extend(true, options, defaultCommands[commandName], { text: messages[commandName] });\n            }\n\n            button = kendo.template(template)(options);\n\n            if (!command.template) {\n                return kendo.html.renderButton($(button), options);\n            } else {\n                return button;\n            }\n        },\n\n        _hasFooters: function() {\n            return !!this.footerTemplate ||\n                !!this.groupFooterTemplate ||\n                (this.footer && this.footer.length > 0) ||\n                this.wrapper.find(\".k-grid-footer\").length > 0;\n        },\n\n        _groupable: function() {\n            var that = this;\n\n            if (that._groupableClickHandler) {\n                that.table.add(that.lockedTable).off(CLICK + NS, that._groupableClickHandler);\n            } else {\n                that._groupableClickHandler = function(e) {\n                    var element = $(this),\n                    groupRow = element.closest(\"tr\");\n\n                    var group = that._groupRows ? that._groupRows[that.wrapper.find(\".k-grouping-row\").index(groupRow)] : { };\n\n                    if (element.hasClass('k-i-collapse')) {\n                        if (!that.trigger(\"groupCollapse\", { group: group, element: groupRow })) {\n                            that.collapseGroup(groupRow);\n                        }\n                    } else {\n                        if (!that.trigger(\"groupExpand\", { group: group, element: groupRow })) {\n                            that.expandGroup(groupRow);\n                        }\n                    }\n                    e.preventDefault();\n                    e.stopPropagation();\n                };\n            }\n\n            if (that._isLocked()) {\n                that.lockedTable.on(CLICK + NS, \".k-grouping-row .k-i-expand, .k-grouping-row .k-i-collapse\", that._groupableClickHandler);\n            } else {\n                that.table.on(CLICK + NS, \".k-grouping-row .k-i-expand, .k-grouping-row .k-i-collapse\", that._groupableClickHandler);\n            }\n\n            that._attachGroupable();\n        },\n\n        _attachGroupable: function() {\n            var that = this,\n                wrapper = that.wrapper,\n                groupable = that.options.groupable,\n                draggables = HEADERCELLS + \"[\" + kendo.attr(\"field\") + \"]\",\n                filter = that.content ? \".k-grid-header:first \" + draggables : \"table:first>.k-grid-header \" + draggables;\n\n            if (groupable && groupable.enabled !== false) {\n                if (!wrapper.has(\"div.k-grouping-header\")[0]) {\n                    $(\"<div>&nbsp;</div>\").addClass(\"k-grouping-header\").prependTo(wrapper);\n                }\n\n                if (that.groupable) {\n                    that._destroyGroupable();\n                }\n\n                if (browser.chrome) {\n                    wrapper.find(\"div.k-grouping-header\").css(\"touch-action\", \"none\");\n                    wrapper.find(filter).css(\"touch-action\", \"none\");\n                }\n\n                that.groupable = new ui.Groupable(wrapper, extend({}, groupable, {\n                    draggable: that._draggableInstance,\n                    groupContainer: \">div.k-grouping-header\",\n                    dataSource: that.dataSource,\n                    draggableElements: filter,\n                    filter: filter,\n                    allowDrag: that.options.reorderable,\n                    removeGroup: function(e) {\n                        that._showUngroupedColumn(e);\n                    },\n                    change: function(e) {\n                        if (that.trigger(\"group\", { groups: e.groups })) {\n                            e.preventDefault();\n                        } else {\n                            that._clearEditableState();\n                            that._hideGroupedColumns(e.groups);\n                            if (that.dataSource.options.endless) {\n                                that._resetEndless();\n                            }\n                        }\n                    }\n                }));\n\n                that._addGroupableOptionsToHeader();\n            }\n        },\n\n        _showUngroupedColumn: function(group) {\n            var columns = leafColumns(this.columns);\n            var i;\n\n            for (i = 0; i < columns.length; i++) {\n                if (columns[i].uid == group.colID && columns[i].hideOnGroup) {\n                    this.showColumn(columns[i]);\n                }\n            }\n        },\n\n        _hideGroupedColumns: function(groups) {\n            if (!groups) {\n                return;\n            }\n            var columns = leafColumns(this.columns);\n            var fields = [];\n            var i;\n\n            for (i = 0; i < groups.length; i++) {\n                if (groups[i].colID) {\n                    fields.push(groups[i].colID);\n                }\n            }\n\n            for (i = 0; i < columns.length; i++) {\n                if (fields.indexOf(columns[i].uid) >= 0 && columns[i].hideOnGroup) {\n                    this.hideColumn(columns[i]);\n                }\n            }\n        },\n\n        _resetEndless: function() {\n            var that = this;\n            that.dataSource.options.endless = null;\n            that._endlessPageSize = that.dataSource.options.pageSize;\n            that.dataSource._skip = 0;\n            that.dataSource._pageSize = that.dataSource._take = that._endlessPageSize;\n            that.dataSource._page = 1;\n        },\n\n        _addGroupableOptionsToHeader: function() {\n            var that = this;\n            var columns = flatColumns(that.columns);\n            var columnFieldMap = {};\n            var field = \"\";\n            var headerCells = that._headerCells();\n            var cellFieldAttr = \"\";\n            var headerCell;\n            var columnOptions;\n            var i;\n\n            for (i = 0; i < columns.length; i++) {\n                field = columns[i].field;\n                columnFieldMap[columns[i].field] = columns[i];\n            }\n\n            for (i = 0; i < headerCells.length; i++) {\n                headerCell = headerCells.eq(i);\n                cellFieldAttr = headerCell.attr(kendo.attr(FIELD));\n                columnOptions = columnFieldMap[cellFieldAttr];\n\n                if (columnOptions && columnOptions.groupable && columnOptions.groupable.sort) {\n                    headerCell.data(GROUP_SORT, columnOptions.groupable.sort);\n                }\n            }\n        },\n\n        _destroyGroupable: function() {\n            var that = this;\n\n            if (that.groupable && that.groupable.element) {\n                that.groupable.element.kendoGroupable(\"destroy\");\n            }\n\n            that.groupable = null;\n\n            that._removeGroupableOptionsFromHeader();\n        },\n\n        _removeGroupableOptionsFromHeader: function() {\n            var that = this;\n            var headerCells = that._headerCells();\n\n            for (var i = 0; i < headerCells.length; i++) {\n                headerCells.eq(i).removeData(GROUP_SORT);\n            }\n        },\n\n        _continuousItems: function(filter, cell) {\n            if (!this.lockedContent) {\n                return;\n            }\n\n            var that = this;\n\n            var elements = that.table.add(that.lockedTable);\n\n            var lockedItems = $(filter, elements[0]);\n            var nonLockedItems = $(filter, elements[1]);\n            var columns = cell ? lockedColumns(that.columns).length : 1;\n            var nonLockedColumns = cell ? that.columns.length - columns : 1;\n            var result = [];\n\n            for (var idx = 0; idx < lockedItems.length; idx += columns) {\n                push.apply(result, lockedItems.slice(idx, idx + columns));\n                push.apply(result, nonLockedItems.splice(0, nonLockedColumns));\n            }\n\n            return result;\n        },\n\n        _selectable: function() {\n            var that = this,\n                multi,\n                cell,\n                notString = [],\n                isLocked = that._isLocked(),\n                selectable = that.options.selectable;\n\n            if (selectable) {\n\n                if (that.selectable) {\n                    that.selectable.destroy();\n                }\n\n                that._selectedIds = {};\n\n                selectable = kendo.ui.Selectable.parseOptions(selectable);\n\n                multi = selectable.multiple;\n                cell = selectable.cell;\n\n                if (that._hasDetails()) {\n                    notString[notString.length] = \".k-detail-row\";\n                }\n                if (that.options.groupable || that._hasFooters() || that._groups()) {\n                    notString[notString.length] = \".k-grouping-row,.k-group-footer\";\n                }\n\n                notString = notString.join(\",\");\n\n                if (notString !== \"\") {\n                    notString = \":not(\" + notString + \")\";\n                }\n\n                var elements = that.table;\n                if (isLocked) {\n                    elements = elements.add(that.lockedTable);\n                }\n\n                var filter = \">\" + (cell ? SELECTION_CELL_SELECTOR : \"tbody>tr\" + notString);\n                that.selectable = new kendo.ui.Selectable(elements, {\n                    filter: filter,\n                    aria: true,\n                    multiple: multi,\n                    dragToSelect: that.options.selectable && that.options.selectable.dragToSelect,\n                    change: function(e) {\n                        var selectedValues;\n                        if (!cell) {\n                            that._persistSelectedRows();\n                        }\n\n                        if (that._checkBoxSelection) {\n                            selectedValues = that.selectable.value();\n                            that._uncheckCheckBoxes();\n                            that._checkRows(selectedValues);\n                            if (selectedValues.length && selectedValues.length === that.items().length) {\n                                that._toggleHeaderCheckState(true);\n                            } else {\n                                that._toggleHeaderCheckState(false);\n                            }\n                        }\n\n                        if (e.event) {\n                            that.trigger(CHANGE);\n                        }\n                    },\n                    useAllItems: isLocked && multi && cell,\n                    relatedTarget: function(items) {\n                        if (cell || !isLocked) {\n                            return;\n                        }\n\n                        var related;\n                        var result = $();\n                        for (var idx = 0, length = items.length; idx < length; idx ++) {\n                            related = that._relatedRow(items[idx]);\n\n                            if (inArray(related[0], items) < 0) {\n                                result = result.add(related);\n                            }\n                        }\n\n                        return result;\n                    },\n                    continuousItems: function() {\n                        return that._continuousItems(filter, cell);\n                    },\n                    ignoreOverlapped: that.options.selectable && that.options.selectable.ignoreOverlapped,\n                    addIdToRanges: true\n                });\n\n                if (that.options.navigatable) {\n                    elements.on(\"keydown\" + NS, function(e) {\n                        var current = that.current();\n                        var target = e.target;\n                        var eventObject = { event: e };\n                        var triggerChange;\n                        var lastSelection;\n                        if (!current) {\n                            return;\n                        }\n                        if (e.keyCode === keys.SPACEBAR && !e.shiftKey && $.inArray(target, elements) > -1 &&\n                            !current.is(\".k-edit-cell,.k-header\") &&\n                            current.parent().is(\":not(.k-grouping-row,.k-detail-row,.k-group-footer)\")) {\n                                e.preventDefault();\n                                e.stopPropagation();\n                                current = cell ? current : current.parent();\n                                triggerChange = !current.hasClass(SELECTED) || that.selectable.value().length > 1;\n\n                                if (isLocked && !cell) {\n                                    current = current.add(that._relatedRow(current));\n                                }\n\n                                if (multi) {\n                                    if (!e.ctrlKey) {\n                                        that.selectable.clear();\n                                    } else {\n                                        if (current.hasClass(SELECTED)) {\n                                            that._deselectCheckRows(current);\n                                            return;\n                                        }\n                                    }\n                                } else {\n                                    that.selectable.clear();\n                                }\n                                if (!cell) {\n                                    that.selectable._lastActive = current;\n                                }\n                                that.selectable.value(current);\n                                if (triggerChange) {\n                                    that.trigger(CHANGE);\n                                }\n                        } else if (!cell &&\n                            ($(target).is(\"td\") || ($(target).is(\"table\") && inArray(target, this._navigatableTables))) &&\n                          ((e.shiftKey && e.keyCode == keys.LEFT) ||\n                           (e.shiftKey && e.keyCode == keys.RIGHT) ||\n                           (e.shiftKey && e.keyCode == keys.UP) ||\n                           (e.shiftKey && e.keyCode == keys.DOWN) ||\n                           (e.keyCode === keys.SPACEBAR && e.shiftKey))) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            current = current.parent();\n\n                            lastSelection = that.selectable.value();\n\n                            if (isLocked) {\n                                current = current.add(that._relatedRow(current));\n                            }\n\n                            if (multi) {\n                                if (!that.selectable._lastActive) {\n                                    that.selectable._lastActive = current;\n                                }\n                                that.selectable.selectRange(that.selectable._firstSelectee(), current);\n\n                                if (!compareElements(lastSelection, that.selectable.value())) {\n                                    that.trigger(CHANGE, eventObject);\n                                }\n                            } else if (!current.hasClass(\"k-selected\")) {\n                                that.selectable.clear();\n                                that.selectable.value(current);\n                                that.trigger(CHANGE);\n                            }\n                        }\n                    });\n                }\n            }\n        },\n\n        _clipboard: function() {\n            var options = this.options;\n            var selectable = options.selectable;\n            if (selectable && options.allowCopy) {\n                var grid = this;\n                if (!options.navigatable) {\n                    grid.table.attr(\"tabindex\", 0);\n\n                    grid.table.add(grid.lockedTable)\n                        .on(\"mousedown\" + NS + \" keydown\" + NS, \".k-detail-cell\", function(e) {\n                            if (e.target !== e.currentTarget) {\n                                e.stopImmediatePropagation();\n                            }\n                        })\n                        .on(\"mousedown\" + NS, NAVROW + \">\" + NAVCELL, tableClick.bind(grid));\n                }\n                grid.copyHandler = grid.copySelection.bind(grid);\n                grid.updateClipBoardState = function() {\n                    if (grid.areaClipBoard) {\n                        grid.areaClipBoard.val(grid.getTSV()).trigger(\"focus\").select();\n                    }\n                };\n                grid.bind(\"change\",grid.updateClipBoardState);\n                grid.wrapper.on(\"keydown\", grid.copyHandler);\n                grid.clearAreaHandler = grid.clearArea.bind(grid);\n                grid.wrapper.on(\"keyup\", grid.clearAreaHandler);\n            }\n        },\n\n        copySelectionToClipboard: function(includeHeaders) {\n            this._createAreaClipBoard();\n            this.areaClipBoard.val(this.getTSV(includeHeaders)).trigger(\"focus\").select();\n            document.execCommand('copy');\n        },\n\n        copySelection: function(e) {\n            if ((e instanceof jQuery.Event && !(e.ctrlKey || e.metaKey)) ||\n                $(e.target).is(\"input:visible,textarea:visible\") ||\n                (window.getSelection && window.getSelection().toString()) ||\n                (document.selection && document.selection.createRange().text) ) {\n                return;\n            }\n\n            this._createAreaClipBoard();\n            this.areaClipBoard.val(this.getTSV()).trigger(\"focus\").select();\n\n        },\n\n        _createAreaClipBoard: function() {\n            if (!this.areaClipBoard) {\n                this.areaClipBoard =\n                    $(\"<textarea />\")\n                    .css({\n                        position: \"fixed\",\n                        top: \"50%\",\n                        left: \"50%\",\n                        opacity: 0,\n                        width: 0,\n                        height: 0\n                    })\n                    .appendTo(this.wrapper);\n            }\n        },\n\n        getTSV: function(includeHeaders) {\n            var grid = this;\n            var selected = grid.select();\n            var delimeter = \"\\t\";\n            var allowCopy = grid.options.allowCopy;\n            var onlyVisible = true;\n            var hasLockedCols = grid._isLocked() && lockedColumns(grid.columns).length;\n\n            if ($.isPlainObject(allowCopy) && allowCopy.delimeter) {\n                delimeter = allowCopy.delimeter;\n            }\n            var text = \"\";\n            if (selected.length) {\n                if (selected.eq(0).is(\"tr\")) {\n                    selected = selected.find(\"td:not(.k-group-cell)\");\n                }\n                if (onlyVisible) {\n                    selected.filter(\":visible\");\n                }\n\n                var result = [];\n                var cellsOffset = this.columns.length;\n                var lockedCols = grid._isLocked() && lockedColumns(grid.columns).length;\n                var inLockedArea = true;\n                var fields = [];\n                var field;\n                var columns = visibleLeafColumns(this.columns);\n\n                $.each(selected, function(idx, cell) {\n                    cell = $(cell);\n                    field = grid._getCellField(cell, hasLockedCols);\n\n                    var tr = cell.closest(\"tr\");\n                    var rowIndex = tr.index();\n                    var cellIndex = cell.index();\n                    if (onlyVisible) {\n                        cellIndex -= cell.prevAll(\":hidden\").length;\n                    }\n                    if (lockedCols && inLockedArea) {\n                        inLockedArea = $.contains(grid.lockedTable[0], cell[0]);\n                    }\n                    if (grid._groups() && inLockedArea) {\n                        cellIndex -= grid._groups();\n                    }\n                    cellIndex = inLockedArea ? cellIndex : (cellIndex + lockedCols );\n                    if (field) {\n                        fields[cellIndex] = field;\n                    }\n                    if (cellsOffset > cellIndex) {\n                        cellsOffset = cellIndex;\n                    }\n                    var cellText = cell.text();\n                    if (!result[rowIndex]) {\n                        result[rowIndex] = [];\n                    }\n                    result[rowIndex][cellIndex] = cellText;\n                });\n\n                var rowsOffset = result.length;\n                result = $.each(result, function(idx, val) {\n                    if (val) {\n                        result[idx] = val.slice(cellsOffset);\n                        if (rowsOffset > idx) {\n                            rowsOffset = idx;\n                        }\n                    }\n                });\n\n                if (includeHeaders && fields.length) {\n                    result.splice(rowsOffset, 0, fields.map(function(field) {\n                        return getTitle(field, columns);\n                    }));\n\n                    var headerIndex = result.findIndex(function(el) {\n                        return el !== undefined;\n                    });\n\n                    result[headerIndex] = result[headerIndex].slice(cellsOffset);\n                }\n\n                $.each(result.slice(rowsOffset), function(idx, val) {\n                    if (val) {\n                        text += val.join(delimeter) + \"\\r\\n\";\n                    } else {\n                        text += \"\\r\\n\";\n                    }\n                });\n            }\n            return text;\n        },\n\n        clearArea: function(e) {\n            if (this.areaClipBoard && e && e.target === this.areaClipBoard[0]) {\n                focusTable(this.table, true);\n            }\n\n            if (this.areaClipBoard) {\n                this.areaClipBoard.remove();\n                this.areaClipBoard = null;\n            }\n        },\n\n        _adaptiveColumns: function() {\n            var that = this;\n\n            if (that._anyColumnHasMediaQuery()) {\n                that._setColumnsMediaVisibility(that.columns);\n                that._attachColumnMediaResizeHandler();\n            }\n        },\n\n        _anyColumnHasMediaQuery: function() {\n            return this._columnsWithMediaQuery().length;\n        },\n\n        _columnsWithMediaQuery: function() {\n            return columnsWithMedia(this.columns);\n        },\n\n        _attachColumnMediaResizeHandler: function() {\n            var that = this;\n\n            that._detachColumnMediaResizeHandler();\n            that._columnMediaResizeHandler = that._onColumnMediaResize.bind(that);\n            $(window).on(RESIZE + NS, that._columnMediaResizeHandler);\n        },\n\n        _detachColumnMediaResizeHandler: function() {\n            var that = this;\n\n            if (that._columnMediaResizeHandler) {\n                $(window).off(RESIZE + NS, that._columnMediaResizeHandler);\n            }\n        },\n\n        _onColumnMediaResize: function() {\n            var that = this;\n            that._setColumnsMediaVisibility(that.columns);\n            that._setContentMediaWidth();\n        },\n\n        _setColumnsMediaVisibility: function(columns) {\n            var cols = columns || [];\n\n            for (var i = 0; i < cols.length; i++) {\n                this._setColumnMediaVisibility(cols[i]);\n            }\n        },\n\n        _setColumnMediaVisibility: function(column) {\n            var that = this;\n\n            if (isUndefined(column.media)) {\n                that._setColumnsMediaVisibility(column.columns);\n            } else {\n                if (columnMatchesMedia(column)) {\n                    that._showColumnByMedia(column);\n\n                    if (!column.hidden) {\n                        that._setColumnsMediaVisibility(column.columns);\n                    }\n                } else {\n                    that._hideColumnByMedia(column);\n                }\n            }\n        },\n\n        _showColumnByMedia: function(column) {\n            if (!column.hidden) {\n                // \"hidden\" has a priority over \"matchesMedia\"\n                this.showColumn(column);\n            }\n\n            setColumnMatchesMedia(column);\n        },\n\n        _hideColumnByMedia: function(column) {\n            var initiallyHidden = column.hidden;\n\n            if (!initiallyHidden) {\n                column._hideByMedia = true;\n                this.hideColumn(column);\n                column._hideByMedia = false;\n\n                // hiding is tracked in \"matchesMedia\" instead of \"hidden\" flag\n                column.hidden = initiallyHidden;\n            }\n\n            setColumnMatchesMedia(column);\n        },\n\n        _setContentMediaWidth: function() {\n            var that = this;\n            var options = that.options;\n            var isLocked = that._isLocked();\n            var footer;\n\n            if (options.scrollable && options.resizable) {\n                if (isLocked && that.lockedFooter) {\n                    footer = that.lockedFooter.children(\"table\");\n                } else if (that.footer) {\n                    footer = that.footer.find(\">.k-grid-footer-wrap>table\");\n                }\n\n                if (!footer || !footer[0]) {\n                    footer = $();\n                }\n\n                var header = isLocked ? that.wrapper.find(\".k-grid-header-locked\").find(\"table\") : that.wrapper.find(\".k-grid-header\").find(\"table\");\n                var contentTable = isLocked ? that.lockedTable : that.table;\n\n                var headerColumns = header.find(\"th\");\n                var headerColgroup = header.find(\"colgroup\");\n\n                var headerColumnsCount = headerColumns.length;\n                var visibleHeaderColumnsCount = headerColumns.filter(isCellVisible).length;\n                var hiddenHeaderColumnsCount = headerColumns.length - visibleHeaderColumnsCount;\n\n                var totalHeaderWidth = 0;\n\n                if (header[0].style.width !== \"\" && parseFloat(header[0].style.width) !== totalHeaderWidth) {\n                    var currentHeaderWidth = header.css(\"width\");\n\n                    for (var i = 0; i < headerColumnsCount; i++) {\n                        if (isElementVisible(headerColumns[i])) {\n                            var columnWidth;\n                            var cellIndex = Math.max(i, (i - hiddenHeaderColumnsCount));\n                            var colgroupChild = headerColgroup.children()[cellIndex];\n                            var columnStyleWidth = colgroupChild ? colgroupChild.style.width : \"\";\n\n                            if (columnStyleWidth !== \"\") {\n                                columnWidth = parseFloat(columnStyleWidth);\n                            } else {\n                                // remove the header width to calculate the height of a column without fixed width\n                                header.css(\"width\", \"auto\");\n                                columnWidth = outerWidth(headerColumns.eq(i));\n                                header.css(\"width\", currentHeaderWidth);\n                            }\n\n                            totalHeaderWidth += columnWidth;\n                        }\n                    }\n\n                    contentTable.css('width', totalHeaderWidth - 1); // subtract 1 to remove the horizontal scroll\n                    header.css('width', totalHeaderWidth);\n                    footer.css('width', totalHeaderWidth);\n                    that._updateStickyColumns();\n                }\n            }\n        },\n\n        _minScreenSupport: function() {\n            var any = this.hideMinScreenCols();\n\n            if (any) {\n                this.minScreenResizeHandler = this.hideMinScreenCols.bind(this);\n                $(window).on(\"resize\", this.minScreenResizeHandler);\n            }\n        },\n\n        hideMinScreenCols: function() {\n            var cols = this.columns,\n                screenWidth = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n\n            return this._iterateMinScreenCols(cols, screenWidth);\n        },\n\n        _iterateMinScreenCols: function(cols, screenWidth) {\n            var any = false;\n\n            for (var i = 0; i < cols.length; i++) {\n                var col = cols[i];\n                var minWidth = col.minScreenWidth;\n                if (minWidth !== undefined && minWidth !== null) {\n                    any = true;\n                    if (minWidth > screenWidth) {\n                        this.hideColumn(col);\n                    } else {\n                        this.showColumn(col);\n                    }\n                }\n                if (!col.hidden && col.columns) {\n                    any = this._iterateMinScreenCols(col.columns, screenWidth) || any;\n                }\n            }\n            return any;\n        },\n\n        _stickyColumns: function() {\n            var that = this;\n\n            if (that._anyStickyColumns()) {\n                that._setStickyColumns(false);\n            }\n        },\n\n        _updateStickyColumns: function() {\n            var that = this;\n            var groupHeaderColumnTemplateColumns = grep(leafColumns(that.columns), function(column) { return column.groupHeaderColumnTemplate; });\n\n            if (that._anyStickyColumns()) {\n                that._setStickyColumns(true);\n                that._templates();\n\n                if (groupHeaderColumnTemplateColumns.length > 0) {\n                    that._renderGroupRows();\n                }\n\n                if (that._hasFilterRow()) {\n                    that._updateStickyFilterCells();\n                }\n            }\n        },\n\n        _updateStickyFilterCells: function() {\n            var that = this;\n            var filterCells = that.thead.find(\".k-filter-row\").find(\"td:not(.k-group-cell,.k-hierarchy-cell)\");\n            if (filterCells.length) {\n                filterCells.each(function() {\n                    var th = $(this);\n                    var column = th.data(\"column\");\n                    var style = th.attr(\"style\") || \"\";\n                    if (column.sticky) {\n                        th.attr(\"style\", style + column.stickyStyle);\n                        th.addClass(STICKY_HEADER_CLASS);\n                    } else {\n                        style = style.replace(leftRegExp, \"\");\n                        style = style.replace(rightRegExp, \"\");\n                        th.attr(\"style\", style);\n                        th.removeClass(STICKY_HEADER_CLASS);\n                    }\n                });\n            }\n        },\n\n        _anyStickyColumns: function() {\n            var that = this;\n\n            return stickyColumns(that.columns).length;\n        },\n\n        _setStickyColumns: function(updateStyles) {\n            var that = this;\n            var columns = stickyColumns(that.columns);\n            var visibleColumns = visibleStickyColumns(that.columns);\n            var stickyWidths = that._calculateStickyWidths(visibleColumns);\n\n            that._removeStickyAttributes(columns);\n            that._setStickyClassAttributes(columns);\n            that._setStickyStyleAttributes(visibleColumns, stickyWidths, updateStyles);\n\n            if (updateStyles) {\n                that._setStickyStyles(visibleColumns, stickyWidths);\n            }\n        },\n\n        _calculateStickyWidths: function(columns, initialLeftWidth, initialRightWidth) {\n            var that = this;\n            var i;\n            var column;\n            var columnWidth;\n            var nextColumnLeft;\n            var nextColumnRight;\n            var left = isRtl ? \"right\" : \"left\";\n            var right = isRtl ? \"left\" : \"right\";\n            var stickyWidths = {\n                left: new Array(columns.length).fill(initialLeftWidth ? initialLeftWidth : 0),\n                right: new Array(columns.length).fill(initialRightWidth ? initialRightWidth : 0)\n            };\n\n            for (i = 0; i < columns.length - 1; i++) {\n                column = columns[i];\n                columnWidth = that._sumColumnWidth(column);\n                nextColumnLeft = columnWidth + stickyWidths[left][i];\n\n                stickyWidths[left][i + 1] = nextColumnLeft;\n            }\n\n            for (i = columns.length - 1; i > 0; i--) {\n                column = columns[i];\n                columnWidth = that._sumColumnWidth(column);\n                nextColumnRight = columnWidth + stickyWidths[right][i];\n\n                stickyWidths[right][i - 1] = nextColumnRight;\n            }\n\n            return stickyWidths;\n        },\n\n        _setStickyClassAttributes: function(columns, masterIndex) {\n            var that = this;\n            var i;\n            var column;\n\n            for (i = 0; i < columns.length; i++) {\n                column = columns[i];\n\n                if (column.columns) {\n                    if (!masterIndex && i) {\n                        masterIndex = i;\n                    }\n\n                    that._setStickyClassAttributes(childColumns([column]), masterIndex);\n                }\n\n                if (masterIndex) {\n                    addColumnAttribute(column, \"headerAttributes\", \"class\", STICKY_HEADER_NO_BORDER_CLASS);\n                }\n                addColumnAttribute(column, \"attributes\", \"class\", STICKY_CELL_CLASS);\n                addColumnAttribute(column, \"headerAttributes\", \"class\", STICKY_HEADER_CLASS);\n                addColumnAttribute(column, \"footerAttributes\", \"class\", STICKY_FOOTER_CLASS);\n            }\n        },\n\n        _setStickyStyleAttributes: function(columns, stickyWidths, updateStyles) {\n            var that = this;\n            var i;\n            var column;\n            var stickyLeft;\n            var stickyRight;\n            var stickyStyle;\n            var childCols;\n            var childStickyWidths;\n\n            for (i = 0; i < columns.length; i++) {\n                column = columns[i];\n                stickyLeft = stickyWidths.left[i];\n                stickyRight = stickyWidths.right[i];\n                stickyStyle = \"left: \" + stickyLeft + \"px; right: \" + stickyRight + \"px;\";\n\n                if (column.columns) {\n                    childCols = visibleChildColumns([column]);\n                    childStickyWidths = that._calculateStickyWidths(childCols, stickyLeft, stickyRight);\n\n                    that._setStickyStyleAttributes(childCols, childStickyWidths, updateStyles);\n\n                    if (updateStyles) {\n                        that._setStickyStyles(childCols, childStickyWidths);\n                    }\n                }\n\n                addColumnAttribute(column, \"attributes\", \"style\", stickyStyle);\n                addColumnAttribute(column, \"headerAttributes\", \"style\", stickyStyle);\n                addColumnAttribute(column, \"footerAttributes\", \"style\", stickyStyle);\n\n                column.stickyStyle = stickyStyle;\n            }\n        },\n\n        _removeStickyAttributes: function(columns) {\n            var that = this;\n            var i;\n            var cellClassRegExp = new RegExp(\"(\\\\s*\" + STICKY_CELL_CLASS + \")*\", \"ig\");\n            var headerClassRegExp = new RegExp(\"(\\\\s*\" + STICKY_HEADER_CLASS + \")*\", \"ig\");\n            var footerClassRegExp = new RegExp(\"(\\\\s*\" + STICKY_FOOTER_CLASS + \")*\", \"ig\");\n            var headerClassNoBorderRegExp = new RegExp(\"(\\\\s*\" + STICKY_HEADER_NO_BORDER_CLASS + \")*\", \"ig\");\n            var column;\n\n            for (i = 0; i < columns.length; i++) {\n                column = columns[i];\n\n                if (column.columns) {\n                    that._removeStickyAttributes(childColumns([column]));\n                }\n\n                removeColumnAttribute(column, \"attributes\", \"class\", cellClassRegExp);\n                removeColumnAttribute(column, \"attributes\", \"style\", leftRegExp);\n                removeColumnAttribute(column, \"attributes\", \"style\", rightRegExp);\n\n                removeColumnAttribute(column, \"headerAttributes\", \"class\", headerClassRegExp);\n                removeColumnAttribute(column, \"headerAttributes\", \"class\", headerClassNoBorderRegExp);\n                removeColumnAttribute(column, \"headerAttributes\", \"style\", leftRegExp);\n                removeColumnAttribute(column, \"headerAttributes\", \"style\", rightRegExp);\n\n                removeColumnAttribute(column, \"footerAttributes\", \"class\", footerClassRegExp);\n                removeColumnAttribute(column, \"footerAttributes\", \"style\", leftRegExp);\n                removeColumnAttribute(column, \"footerAttributes\", \"style\", rightRegExp);\n            }\n        },\n\n        _setStickyStyles: function(columns, stickyWidths) {\n            var that = this;\n            var i;\n            var j;\n            var leafsCols = leafColumns(nonLockedColumns(that.columns));\n            var rows = that.tbody.children(\":not(.k-detail-row)\");\n            var row;\n            var column;\n            var columnIndex;\n            var left;\n            var right;\n            var header;\n            var footer;\n            var groupHeader;\n            var cell;\n\n            for (i = 0; i < columns.length; i++) {\n                column = columns[i];\n                left = stickyWidths.left[i];\n                right = stickyWidths.right[i];\n                columnIndex = leafsCols.indexOf(column);\n                header = that._getColumnHeader(column);\n\n                header.addClass(STICKY_HEADER_CLASS);\n                if (column.headerAttributes[\"class\"] && column.headerAttributes[\"class\"].indexOf(STICKY_HEADER_NO_BORDER_CLASS) !== -1) {\n                    header.addClass(STICKY_HEADER_NO_BORDER_CLASS);\n                }\n                setLeftAndRightStyles(header, left, right);\n\n                if (column.columns) {\n                    continue;\n                }\n\n                if (that.footer) {\n                    footer = that.footer.find(\".k-grid-footer-wrap tr.k-footer-template\").children().filter(\":not(.k-group-cell,.k-hierarchy-cell)\").eq(columnIndex);\n\n                    footer.addClass(STICKY_FOOTER_CLASS);\n                    setLeftAndRightStyles(footer, left, right);\n                }\n\n                for (j = 0; j < rows.length; j++) {\n                    row = $(rows[j]);\n\n                    if (row.hasClass(\"k-grouping-row\")) {\n                        groupHeader = row.find(\".\" + column.groupHeaderColumnTemplateClass);\n\n                        groupHeader.addClass(STICKY_CELL_CLASS);\n                        setLeftAndRightStyles(groupHeader, left, right);\n                    } else {\n                        cell = row.children().filter(\":not(.k-group-cell,.k-hierarchy-cell)\").eq(columnIndex);\n\n                        cell.addClass(STICKY_CELL_CLASS);\n                        setLeftAndRightStyles(cell, left, right);\n                    }\n                }\n            }\n        },\n\n        _removeStickyStyles: function(columns) {\n            var that = this;\n            var i;\n            var j;\n            var leafsCols = leafColumns(nonLockedColumns(that.columns));\n            var rows = that.tbody.children(\":not(.k-detail-row)\");\n            var row;\n            var column;\n            var columnIndex;\n            var header;\n            var footer;\n            var groupHeader;\n            var cell;\n\n            for (i = 0; i < columns.length; i++) {\n                column = columns[i];\n                columnIndex = leafsCols.indexOf(column);\n                header = that._getColumnHeader(column);\n\n                header.removeClass(STICKY_HEADER_CLASS);\n                header.removeClass(STICKY_HEADER_NO_BORDER_CLASS);\n                setLeftAndRightStyles(header, \"\", \"\");\n\n                if (column.columns) {\n                    that._removeStickyStyles(column.columns);\n                    continue;\n                }\n\n                if (column.footerTemplate && that.footer) {\n                    footer = that.footer.find(\".k-grid-footer-wrap tr.k-footer-template\").children().filter(\":not(.k-group-cell,.k-hierarchy-cell)\").eq(columnIndex);\n\n                    footer.removeClass(STICKY_FOOTER_CLASS);\n                    setLeftAndRightStyles(footer, \"\", \"\");\n                }\n\n                for (j = 0; j < rows.length; j++) {\n                    row = $(rows[j]);\n\n                    if (row.hasClass(\"k-grouping-row\")) {\n                        groupHeader = row.find(\".\" + column.groupHeaderColumnTemplateClass);\n\n                        groupHeader.removeClass(STICKY_CELL_CLASS);\n                        setLeftAndRightStyles(groupHeader, \"\", \"\");\n                    } else {\n                        cell = row.children().filter(\":not(.k-group-cell,.k-hierarchy-cell)\").eq(columnIndex);\n\n                        cell.removeClass(STICKY_CELL_CLASS);\n                        setLeftAndRightStyles(cell, \"\", \"\");\n                    }\n                }\n            }\n        },\n\n        _getColumnHeader: function(column) {\n            var that = this;\n            var header = $(\"#\" + column.headerAttributes.id).length ? $(\"#\" + column.headerAttributes.id) : $(\"#\" + that._cellId);\n\n            return header;\n        },\n\n        _sumColumnWidth: function(column) {\n            var that = this;\n            var width = 0;\n\n            if (column.columns) {\n                width = that._sumCurrentWidths(leafColumns([column]));\n            } else {\n                width = that._sumCurrentWidths([column]);\n            }\n\n            return width;\n        },\n\n        _sumCurrentWidths: function(cols) {\n            var that = this;\n            var width = 0;\n            var colWidth = 0;\n            var col;\n            var header;\n            var i;\n            var length = cols.length;\n\n            for (i = 0; i < length; i++) {\n                col = cols[i];\n                header = that._getColumnHeader(col);\n\n                if (!col.hidden && columnMatchesMedia(col)) {\n                    colWidth = header.is(\":visible\") ? header.outerWidth() : col.width;\n\n                    width += colWidth ? parseInt(colWidth, 10) : 0;\n                }\n            }\n\n            return width;\n        },\n\n        _belongsToGrid: function(element) {\n            return this.wrapper[0] === element.closest(WRAPPER)[0];\n        },\n\n        getSelectedData: function() {\n            var that = this;\n            var selectedRanges = that.selectable.selectedRanges();\n            var selectedRangeNames = Object.keys(selectedRanges);\n            var selectedSingleItems = that.selectable.selectedSingleItems();\n            var result = [];\n            var visibleColumns = visibleLeafColumns(that.columns);\n\n            for (var idx = 0; idx < selectedRangeNames.length; idx++) {\n                result = result.concat(that._mapSelectionToData(selectedRanges[selectedRangeNames[idx]], visibleColumns));\n            }\n\n            if (selectedSingleItems.length) {\n                result = result.concat(that._mapSelectionToData(selectedSingleItems, visibleColumns));\n            }\n\n            return result;\n        },\n\n        exportSelectedToExcel: function(includeHeaders) {\n            if (!kendo.excel || !kendo.ooxml) {\n                throw new Error(\"The excel export functionality depends on both kendo.excel.js and kendo.ooxml.js scripts, please make sure they are included.\");\n            }\n\n            var that = this;\n            var excel = this.options.excel || {};\n            var visibleColumns = visibleLeafColumns(that.columns);\n            var exporter = new kendo.excel.ExcelExporter({});\n            var columnHandler = function() {return { autoWidth: true };};\n            var book = {\n                sheets: [{\n                    columns: Array.apply(0, Array(visibleColumns.length)).map(columnHandler),\n                    rows: [],\n                    freezePane: {},\n                    filter: false\n                }]\n            };\n            var selectedRanges = that.selectable.selectedRanges();\n            var selectedRangeNames = Object.keys(selectedRanges);\n            var selectedSingleItems = that.selectable.selectedSingleItems();\n            var idx;\n            var exportData = [];\n            var hasLockedCols = that._isLocked() && lockedColumns(that.columns).length;\n            var sortHandler = exportDataSort.bind(that);\n\n            for (idx = 0; idx < selectedRangeNames.length; idx++) {\n                exportData = exportData.concat(that._mapSelectionToData(selectedRanges[selectedRangeNames[idx]], visibleColumns, isExcelExportableColumn));\n            }\n\n            if (exportData.length) {\n                that._addRangeSelectionRows(book, exporter, exportData, includeHeaders);\n\n            }\n            exportData = selectedSingleItems.length ? that._mapSelectionToData(selectedSingleItems, visibleColumns, isExcelExportableColumn) : [];\n\n            if (exportData.length) {\n                if (hasLockedCols) {\n                    exportData = exportData.sort(sortHandler);\n                }\n                that._addSingleSelectionRows(book, exporter, exportData, includeHeaders);\n            }\n\n            if (book.sheets[0].rows.length) {\n                var workbook = new kendo.ooxml.Workbook(book);\n\n                if (!workbook.options) {\n                    workbook.options = {};\n                }\n                workbook.options.skipCustomHeight = true;\n\n                workbook.toDataURLAsync().then(function(dataURI) {\n                    kendo.saveAs({\n                        dataURI: dataURI,\n                        fileName: book.fileName || excel.fileName,\n                        proxyURL: excel.proxyURL,\n                        forceProxy: excel.forceProxy\n                    });\n                });\n            }\n        },\n\n        _addSingleSelectionRows: function(book, exporter, data, includeHeaders) {\n            var idx = 0;\n            var visibleColumns = visibleLeafExportColumns(this.columns);\n            var item;\n\n            for (idx = 0; idx < data.length; idx++) {\n                item = data[idx];\n                exporter.data = [item];\n                this._setExporterColumns(exporter, visibleColumns, item);\n                this._createExportRows(book, exporter, includeHeaders);\n            }\n        },\n\n        _addRangeSelectionRows: function(book, exporter, data, includeHeaders) {\n            var visibleColumns = visibleLeafExportColumns(this.columns);\n\n            exporter.data = data;\n            this._setExporterColumns(exporter, visibleColumns, data[0]);\n            this._createExportRows(book, exporter, includeHeaders);\n        },\n\n        _createExportRows: function(book, exporter, includeHeaders) {\n            book.sheets[0].rows = book.sheets[0].rows.concat(includeHeaders ? exporter._rows() : exporter._dataRows(exporter.data, 0));\n        },\n\n        _setExporterColumns: function(exporter, columns, item) {\n            exporter.columns = exporter.options.columns = $.map(columns.filter(function(col) {\n                return Object.keys(item).indexOf(col.field) >= 0;\n            }), exporter._prepareColumn);\n        },\n\n        _mapSelectionToData: function(elements, visibleColumns, columnsFilter) {\n            var that = this;\n            var elementType = elements[0][0].nodeName;\n            var isRowSelection = elementType === 'TR';\n            var dataItem;\n            var result = {};\n            var element;\n            var curr;\n            var field;\n            var columnMapHandler = function(col) {\n                var result = {};\n\n                if (!col.field || (columnsFilter && !columnsFilter(col))) {\n                    return;\n                }\n\n                result[col.field] = dataItem[col.field];\n                return result;\n            };\n            var hasLockedCols = that._isLocked() && lockedColumns(that.columns).length;\n            var column;\n\n            for (var i = 0; i < elements.length; i++) {\n                element = elements[i];\n                dataItem = that.dataItem(isRowSelection ? element : element.parent());\n\n                if (isRowSelection) {\n                    result[dataItem.uid] = $.extend.apply(null, visibleColumns.map(columnMapHandler));\n                } else {\n                    field = that._getCellField(element, hasLockedCols);\n\n                    if (!field) {\n                        continue;\n                    }\n\n                    curr = result[dataItem.uid];\n\n                    if (!curr) {\n                        curr = result[dataItem.uid] = {};\n                    }\n\n                    column = findColumnByField(visibleColumns, field);\n\n                    if (!column || (columnsFilter && !columnsFilter(column))) {\n                        continue;\n                    }\n\n                    curr[field] = dataItem[field];\n                }\n            }\n\n            return Object.keys(result).map(function(id) {\n                result[id].uid = id;\n                return result[id];\n            });\n        },\n\n        _getCellField: function(cell, hasLockedCols) {\n            var grid = this;\n            var inLockedArea = hasLockedCols && $.contains(grid.lockedTable[0], cell[0]);\n            var fieldAttr = kendo.attr('field');\n            var index = kendo.attr('index');\n\n            if (hasLockedCols) {\n                return grid.element.find(\".k-grid-header-\" + (inLockedArea ? \"locked\" : \"wrap\") + \" th[\" + index + \"='\" + cell.index() + \"']\").attr(fieldAttr);\n            } else {\n                return grid.thead.find(\"th[\" + index + \"='\" + cell.index() + \"']\").attr(fieldAttr);\n            }\n        },\n\n        _relatedRow: function(row) {\n            var lockedTable = this.lockedTable;\n            row = $(row);\n\n            if (!lockedTable) {\n                return row;\n            }\n\n            var table = row.closest(this.table.add(this.lockedTable));\n            var index = table.find(\">tbody>tr\").index(row);\n\n            table = table[0] === this.table[0] ? lockedTable : this.table;\n\n            return table.find(\">tbody>tr\").eq(index);\n        },\n\n        _relatedCell: function(cell) {\n            var lockedTable = this.lockedTable;\n\n            cell = $(cell);\n\n            if (!lockedTable) {\n                return cell;\n            }\n\n            var table = cell.closest(this.table.add(this.lockedTable));\n            var index = table.find(\">tbody>tr>td\").index(cell);\n\n            table = table[0] === this.table[0] ? lockedTable : this.table;\n\n            return table.find(\">tbody>tr>td\").index(index);\n        },\n\n        clearSelection: function() {\n            var that = this;\n\n            if (that.selectable && !that._checkBoxSelection) {\n                that.selectable.clear();\n            }\n\n            if (that._checkBoxSelection) {\n                that._deselectCheckRows(that.select());\n                return;\n            }\n\n            if (that.options.persistSelection) {\n                that._persistSelectedRows();\n            } else {\n                that._selectedIds = {};\n            }\n        },\n\n        select: function(items) {\n            var that = this,\n                selectable = that.selectable,\n                selectableoptions = kendo.ui.Selectable.parseOptions(this.options.selectable),\n                cell = selectableoptions.cell;\n\n            items = that.table.add(that.lockedTable).find(items);\n            if (items.length) {\n                if (selectable && !selectable.options.multiple) {\n                    selectable.clear();\n                    items = items.first();\n                }\n\n                if (that._isLocked()) {\n                    items = items.add(items.map(function() {\n                        if (cell) {\n                            return that._relatedCell(this);\n                        }\n                        else {\n                            return that._relatedRow(this);\n                        }\n                    }));\n                }\n\n                if (selectable && !that._checkBoxSelection) {\n                    selectable.value(items);\n                } else {\n                    that._checkRows(items);\n                    if (that.select().length === that.items().length) {\n                        that._toggleHeaderCheckState(true);\n                    }\n                }\n\n                if (!cell) {\n                    that._persistSelectedRows();\n                }\n\n                return;\n            }\n\n            return selectable ? selectable.value() : that.items().filter(\".\" + SELECTED);\n        },\n\n        _toggleHeaderCheckState: function(checked) {\n            var that = this;\n            if (checked) {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", true).attr(\"aria-checked\", true)\n                    .attr(\"aria-label\", \"Deselect all rows\");\n            } else {\n                that.thead.add(that.lockedHeader).find(\"tr \" + CHECKBOXINPUT)\n                    .prop(\"checked\", false).attr(\"aria-checked\", false)\n                    .attr(\"aria-label\", \"Select all rows\");\n            }\n        },\n\n        _uncheckCheckBoxes: function() {\n            var that = this;\n            var tables = that.table.add(that.lockedTable);\n\n            tables.find(\"tbody \" + CHECKBOXINPUT).attr(\"aria-checked\", false)\n                .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n\n        },\n\n        _deselectCheckRows: function(items) {\n            var that = this,\n            rangeSelectedAttr = kendo.attr(\"range-selected\");\n            items = that.table.add(that.lockedTable).find(items);\n\n            if (that._isLocked()) {\n                items = items.add(items.map(function() {\n                    return that._relatedRow(this);\n                }));\n            }\n\n            items.each(function() {\n                $(this).removeClass(SELECTED).removeAttr(rangeSelectedAttr).find(CHECKBOXINPUT).attr(\"aria-checked\", false)\n                    .prop(\"checked\", false).attr(\"aria-label\", \"Select row\");\n            });\n            that._toggleHeaderCheckState(false);\n\n            that._persistSelectedRows();\n\n            that.trigger(CHANGE);\n        },\n\n        _checkRows: function(items) {\n            items.each(function() {\n                $(this).addClass(SELECTED).find(CHECKBOXINPUT).prop(\"checked\", true)\n                    .attr(\"aria-label\", \"Deselect row\").attr(\"aria-checked\", true);\n            });\n        },\n\n        _persistSelectedRows: function() {\n            var that = this,\n                key,\n                dataItem,\n                allRows = that.items(),\n                dataSourceOptions = that.dataSource.options,\n                schema = dataSourceOptions.schema,\n                modelId,\n                selectedViewIds = {};\n\n            if (!schema || !schema.model || !that._data) {\n                return;\n            }\n\n            modelId = isFunction(schema.model) ? schema.model.fn.idField : schema.model.id;\n\n            if (!modelId) {\n                return;\n            }\n\n            if (!kendo.ui.Selectable.parseOptions(that.options.selectable).multiple && !that._checkBoxSelection) {\n                that._selectedIds = {};\n            }\n\n            that.select().each(function() {\n                dataItem = that.dataItem(this);\n                selectedViewIds[dataItem[modelId]] = true;\n            });\n\n            for (var i = 0; i < allRows.length; i ++) {\n                dataItem = that.dataItem(allRows[i]);\n                key = dataItem[modelId];\n                if (selectedViewIds[key]) {\n                    that._selectedIds[key] = true;\n                } else {\n                    delete that._selectedIds[key];\n                }\n            }\n        },\n\n        selectedKeyNames: function() {\n            var that = this,\n                ids = [];\n            for (var property in that._selectedIds) {\n                ids.push(property);\n            }\n            ids.sort();\n            return ids;\n        },\n\n        _updateCurrentAttr: function(current, next) {\n            var headerId = $(current).data(\"headerId\");\n            var nextId;\n            var descId;\n\n            $(current).removeClass(FOCUSED);\n            this.table.removeAttr(\"aria-activedescendant\");\n\n            if (headerId) {\n                headerId = headerId.replace(this._cellId, \"\");\n                $(current).attr(\"id\", headerId);\n            } else {\n                $(current).removeAttr(\"id\");\n            }\n\n            nextId = next.attr(\"id\");\n\n            if (nextId != this._cellId) {\n                next.data(\"headerId\", nextId);\n            }\n\n            if (!!nextId) {\n                descId = nextId;\n            } else {\n                next.attr(\"id\", this._cellId);\n            }\n\n            next.addClass(FOCUSED);\n            this.table.attr(\"aria-activedescendant\", descId || this._cellId);\n\n            this._current = next;\n        },\n\n        _scrollCurrent: function() {\n            var current = this._current;\n            var scrollable = this.options.scrollable;\n\n            if (!current || !scrollable) {\n                return;\n            }\n\n            var row = current.parent();\n            var tableContainer = row.closest(\"table\").parent();\n\n            var isInLockedContainer = tableContainer.is(\".k-grid-content-locked,.k-grid-header-locked\");\n            var isInContent = tableContainer.is(\".k-grid-content-locked,.k-grid-content,.k-virtual-scrollable-wrap\");\n\n            var scrollableContainer = $(this.content).find(\">.k-virtual-scrollable-wrap\").addBack().last()[0];\n\n            //adjust scroll vertically\n            if (isInContent) {\n                if (this.virtualScroll) {\n                    var rowIndex = Math.max(inArray(row[0], this._items(row.parent())), 0);\n                    if (this.virtualScroll.rows) {\n                        this._rowVirtualIndex = this.virtualScrollable.itemIndex(rowIndex);\n                        this.virtualScrollable.scrollIntoView(row);\n                    } else {\n                        this._rowVirtualIndex = rowIndex;\n                        this._scrollTo(this._relatedRow(row)[0], scrollableContainer);\n                    }\n                } else {\n                    this._scrollTo(this._relatedRow(row)[0], scrollableContainer);\n                }\n            }\n\n            if (this.lockedContent) {\n                //sync locked and non-locked content scrollTop\n                this.lockedContent[0].scrollTop = scrollableContainer.scrollTop;\n            }\n\n            //adjust scroll horizontally, if not inside locked tables\n            if (!isInLockedContainer) {\n                this._scrollTo(current[0], scrollableContainer);\n            }\n        },\n\n        current: function(next) {\n            return this._setCurrent(next, true);\n        },\n\n        _setCurrent: function(next, preventTrigger, preventScroll) {\n            var current = this._current;\n\n            next = $(next);\n\n            if (current && next && current.length && next.length && current.closest(\".k-filter-row\").length > 0 && next.closest(\".k-filter-row\").length === 0) {\n                this._filterFocusable().attr(\"tabindex\", -1);\n            }\n\n            if (next.length) {\n                if (!current || current[0] !== next[0]) {\n                    var parent = next.parent();\n                    var siblings = parent.children(DATA_CELL);\n                    var colspan = parseInt(parent.children().first().attr(\"colspan\"), 10);\n\n                    if (this._hasVirtualColumns()) {\n                        this._virtualCellIndex = (colspan > 1 ? colspan : 0) + siblings.index(next);\n                    }\n                    this._updateCurrentAttr(current, next);\n\n                    if (!preventScroll) {\n                        this._scrollCurrent();\n                    }\n\n                    if (!preventTrigger) {\n                        this.trigger(NAVIGATE, {\n                            element: next\n                        });\n                    }\n                }\n            }\n\n            if (next && next.length) {\n                this._lastCellIndex = next.parent().children(DATA_CELL).index(next);\n            }\n\n            this._updateSelctCheckbox(current, next);\n\n            return this._current;\n        },\n\n        _removeCurrent: function() {\n            if (this._current) {\n                this._current.removeClass(FOCUSED);\n                this._current = null;\n            }\n        },\n\n        _updateSelctCheckbox: function(current, next) {\n            var nextCheckbox;\n\n            if (next && next.length) {\n                nextCheckbox = next.find(\".k-select-checkbox\");\n\n                if (nextCheckbox.length > 0) {\n                    nextCheckbox.focus();\n                } else if (current && current.find(\".k-select-checkbox\").length > 0) {\n                    focusTable(this.table, true);\n                }\n            }\n        },\n\n        _scrollTo: function(element, container) {\n            var elementToLowercase = element.tagName.toLowerCase();\n            var isHorizontal = elementToLowercase === \"td\" || elementToLowercase === \"th\";\n            var table = $(element).closest(\"table\")[0];\n            var elementOffsetDir = element[isHorizontal ? \"offsetWidth\" : \"offsetHeight\"];\n            var containerScroll = container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"];\n            var containerOffsetDir = container[isHorizontal ? \"clientWidth\" : \"clientHeight\"];\n            var elementOffset = $(element).css(\"position\") === \"relative\" && isRtl && isHorizontal ? Math.abs(table.offsetLeft - element.offsetLeft) : element[isHorizontal ? \"offsetLeft\" : \"offsetTop\"];\n            var bottomDistance = elementOffset + elementOffsetDir;\n            var result = 0;\n            var ieCorrection = 0;\n            var firefoxCorrection = 0;\n\n            if (isRtl && isHorizontal) {\n                if (browser.msie || browser.edge) {\n                    ieCorrection = table.offsetLeft;\n                } else if (browser.mozilla || (browser.webkit && (browser.version > 85))) {\n                    firefoxCorrection = table.offsetLeft - kendo.support.scrollbar();\n                }\n            }\n\n            containerScroll = Math.abs(containerScroll + ieCorrection - firefoxCorrection);\n\n            if (containerScroll > elementOffset) {\n                result = elementOffset;\n            } else if (bottomDistance > (containerScroll + containerOffsetDir)) {\n                if (elementOffsetDir <= containerOffsetDir) {\n                    result = (bottomDistance - containerOffsetDir);\n                } else {\n                    result = elementOffset;\n                }\n            } else {\n                result = containerScroll;\n            }\n\n            result = Math.abs(result + ieCorrection) + firefoxCorrection;\n\n            container[isHorizontal ? \"scrollLeft\" : \"scrollTop\"] = result;\n        },\n\n        _navigatable: function() {\n            var that = this;\n\n            if (!that.options.navigatable) {\n                return;\n            }\n\n            //data tables - locked and non-locked\n            var dataTables = that.table.add(that.lockedTable);\n            //header tables - locked and non-locked\n            var headerTables = that.thead.parent().add($(\">table\", that.lockedHeader));\n\n            //the over wich keys will be handled\n            var tables = dataTables;\n\n            if (that.options.scrollable) {\n                //add the header table when the widget is scrollable\n                tables = tables.add(headerTables);\n            }\n\n            this._navigatableTables = tables;\n            this._headertables = headerTables;\n\n            //dettach all previous events\n            tables.off(\"mousedown\" + NS + \" focus\" + NS + \" focusout\" + NS + \" keydown\" + NS);\n\n            headerTables\n                .find(\"a.k-link\").attr(\"tabIndex\", -1);\n\n            //prevent propagation when clicked inside detail grid\n            dataTables\n                .on(\"keydown\" + NS, \".k-detail-cell\", function(e) {\n                    if (e.target !== e.currentTarget) {\n                        e.stopImmediatePropagation();\n                    }\n                });\n\n            tables\n                //handle click on tables, will attempt to focus the table\n                .on((kendo.support.touch ? \"touchstart\" + NS : \"mousedown\" + NS), NAVROW + \">\" + NAVCELL, tableClick.bind(that))\n                .on(\"focus\" + NS, that._tableFocus.bind(that))\n                .on(\"focusout\" + NS, that._tableBlur.bind(that))\n                .on(\"keydown\" + NS, that, that._tableKeyDown.bind(that));\n\n            that._filterFocusable().on(\"focus\", that._filterFocus.bind(that));\n        },\n\n        _filterFocus: function(e) {\n            var header = e.target.closest(\"th\");\n\n            this._filterFocusable().attr(\"tabindex\", 0);\n            this._setCurrent(header);\n            $(header).removeClass(FOCUSED);\n        },\n\n        _tableFocus: function() {\n            var current = this.current();\n            var table = this.lockedTable ? this.lockedTable : this.table;\n\n            //if there is already current, highlighted it\n            //otherwise highlight the first possible cell\n            if (current && current.is(\":visible\")) {\n                current.addClass(FOCUSED);\n            } else {\n                if (this._virtualColScroll) {\n                    this._setCurrent(table.find(NAVROW).first().children(NAVCELL).first(), true, true);\n                } else {\n                    this._setCurrent(table.find(NAVROW).first().children(NAVCELL).first());\n                }\n            }\n\n            this.table.attr(TABINDEX, 0);\n        },\n\n        _tableBlur: function() {\n            var current = this.current();\n\n            if (current) {\n                current.removeClass(FOCUSED);\n            }\n        },\n\n        _findCellIndex: function(columns, startIndex, reversed) {\n            var cellIndex;\n            var i;\n\n            if (reversed) {\n                for (i = startIndex; i >= 0; i--) {\n                    cellIndex = i;\n                    if (!columns[i].hidden) {\n                        break;\n                    }\n                }\n            } else {\n                for (i = startIndex; i < columns.length; i++) {\n                    cellIndex = i;\n                    if (!columns[i].hidden) {\n                        break;\n                    }\n                }\n            }\n\n            return cellIndex;\n        },\n\n        _scrollToColumn: function(key, e) {\n            if (this._virtualCellIndex === undefined) {\n                return false;\n            }\n\n            var that = this;\n            var cellIndex = that._virtualCellIndex;\n            var leafsCols = leafColumns(nonLockedColumns(that.columns));\n            var scrollWidth = 0;\n\n            if (key == (isRtl ? keys.LEFT : keys.RIGHT) && (cellIndex !== leafsCols.length - 1)) {\n                cellIndex = that._findCellIndex(leafsCols, cellIndex + 1);\n            } else if (key == (isRtl ? keys.RIGHT : keys.LEFT) && cellIndex) {\n                cellIndex = that._findCellIndex(leafsCols,cellIndex - 1, true);\n            } else if (key == keys.HOME) {\n                cellIndex = that._findCellIndex(leafsCols, 0);\n            } else if (key == keys.END) {\n                cellIndex = that._findCellIndex(leafsCols, leafsCols.length - 1, true);\n            }\n\n            for (var i = 0; i < cellIndex; i++) {\n                scrollWidth += leafsCols[i].width;\n            }\n\n            that._virtualCellIndex = cellIndex;\n            if (e) {\n                e.preventDefault();\n                e.stopPropagation();\n            }\n            kendo.scrollLeft(that.content, scrollWidth);\n            return true;\n        },\n\n        _tableKeyDown: function(e) {\n            var current = this.current();\n            var virtualScroll = this.virtualScroll || {};\n            var requestInProgress = this.virtualScrollable && this.virtualScrollable.fetching();\n            var target = $(e.target);\n            var canHandle = !e.isDefaultPrevented() && !target.is(\":button,a,:input:not(.k-select-checkbox),a>.k-icon\");\n\n            if (e.altKey && e.keyCode == keys.DOWN) {\n                this.current().find(\".k-grid-filter, .k-header-column-menu\").click();\n                e.stopImmediatePropagation();\n                return;\n            }\n\n            // do not handle key down if request in progress\n            // or there isn't current set\n            if (requestInProgress) {\n                // swallow key events while in progress\n                e.preventDefault();\n                return;\n            }\n\n            if (virtualScroll.columns && (!current || !document.body.contains(current[0])) && (this._scrollToColumn(e.keyCode, e))) {\n                return;\n            }\n\n            if (!current) {\n                current = $(this.lockedTable).add(this.options.scrollable ? this.table : this.tbody).find(NAVROW).first().children(NAVCELL).first();\n            }\n\n            if (!current.length) {\n                return;\n            }\n\n            var handled = false;\n\n            if (canHandle && e.keyCode == keys.UP) {\n                handled = this._moveUp(current, e.shiftKey, e.ctrlKey);\n            }\n\n            if (canHandle && e.keyCode == keys.DOWN) {\n                handled = this._moveDown(current, e.shiftKey, e.ctrlKey);\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.LEFT : keys.RIGHT)) {\n                handled = this._moveRight(current, e.altKey, e.shiftKey, e.ctrlKey, e.currentTarget);\n            }\n\n            if (canHandle && e.keyCode == (isRtl ? keys.RIGHT : keys.LEFT)) {\n                handled = this._moveLeft(current, e.altKey, e.shiftKey, e.ctrlKey, e.currentTarget);\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEDOWN) {\n                handled = this._handlePageDown();\n            }\n\n            if (canHandle && e.keyCode == keys.PAGEUP) {\n                handled = this._handlePageUp();\n            }\n\n            if (canHandle && e.keyCode == keys.HOME) {\n                handled = this._handleHome(current, e.ctrlKey);\n            }\n\n            if (canHandle && e.keyCode == keys.END) {\n                handled = this._handleEnd(current, e.ctrlKey);\n            }\n\n            if (canHandle && e.keyCode == keys.SPACEBAR) {\n                handled = this._handleSpaceKey(current, e.ctrlKey);\n            }\n\n            if (e.keyCode == keys.ENTER || e.keyCode == keys.F2) {\n                handled = this._handleEnterKey(current, e.currentTarget, target);\n            }\n\n            if (e.keyCode == keys.ESC) {\n                handled = this._handleEscKey(current, e.currentTarget);\n            }\n\n            if (e.keyCode == keys.TAB) {\n                handled = this._handleTabKey(current, e.currentTarget, e.shiftKey, target);\n            }\n\n            if (handled) {\n                //prevent scrolling while pressing the keys\n                e.preventDefault();\n                //required in hierarchy\n                e.stopPropagation();\n            }\n        },\n\n        _moveLeft: function(current, altKey, shiftKey, ctrlKey, currentTable) {\n            var next, index;\n            var row = current.parent();\n            //thead or tbody\n            var container = row.parent();\n\n            if (altKey) {\n                if (row.hasClass(\"k-grouping-row\")) {\n                    this.collapseGroup(row);\n                } else {\n                    this.collapseRow(row);\n                }\n            } else if (ctrlKey && current.is(\".k-header\") && this.options.reorderable) {\n               this._moveColumn(current, true);\n            } else {\n                index = container.find(NAVROW).index(row);\n                next = this._prevHorizontalCell(container, current, index);\n\n                if (!next[0]) {\n                    if (shiftKey) {\n                        if (this.lockedTable) {\n                            next = this._relatedRow(row);\n                            if ($.contains(this.lockedTable[0], row[0])) {\n                                next = next.prevAll(ITEMROW).first();\n                            }\n                            next = next.children(DATA_CELL).last();\n                        } else {\n                            next = this._tabNext(current, currentTable, true);\n                        }\n                    } else {\n                        container = this._horizontalContainer(container);\n\n                        next = this._prevHorizontalCell(container, current, index);\n\n                        if (next[0] !== current[0]) {\n                            focusTable(this.table, true);\n                        }\n                    }\n                }\n\n                this._setCurrent(next);\n            }\n\n            return true;\n        },\n\n        _moveRight: function(current, altKey, shiftKey, ctrlKey, currentTable) {\n            var next, index;\n            var row = current.parent();\n            //thead or tbody\n            var container = row.parent();\n\n            if (altKey) {\n                if (row.hasClass(\"k-grouping-row\")) {\n                    this.expandGroup(row);\n                } else {\n                    this.expandRow(row);\n                }\n             } else if (ctrlKey && current.is(\".k-header\") && this.options.reorderable) {\n                this._moveColumn(current, false);\n            } else {\n                index = container.find(NAVROW).index(row);\n                next = this._nextHorizontalCell(container, current, index);\n\n                if (!next[0]) {\n                    if (shiftKey) {\n                       if (this.lockedTable) {\n                            next = this._relatedRow(row);\n                            if ($.contains(this.table[0], row[0])) {\n                                next = next.nextAll(ITEMROW).first();\n                            }\n                            next = next.children(DATA_CELL).first();\n                        } else {\n                            next = this._tabNext(current, currentTable, false);\n                        }\n                    } else {\n                        container = this._horizontalContainer(container, true);\n\n                        next = this._nextHorizontalCell(container, current, index);\n\n                        if (next[0] !== current[0]) {\n                            focusTable(this.table, true);\n                        }\n                    }\n                }\n\n                this._setCurrent(next);\n            }\n\n            return true;\n        },\n\n        _moveUp: function(current, shiftKey, ctrlKey) {\n            //thead or tbody\n            var container = current.parent().parent();\n            var next, cellIndex, index, oldIndex;\n\n            if (shiftKey) {\n               next = current.parent();\n               next = next.prevAll(ITEMROW).first();\n               next = current.parent().is(ITEMROW) ? next.children().eq(current.index()) : next.children(DATA_CELL).last();\n            } else if (ctrlKey && current.parent().is(ITEMROW) && this._hasReorderableRows()) {\n                cellIndex = current.index();\n                next = current.parent();\n                next = next.prevAll(ITEMROW).first();\n                index = this.tbody.children(ITEMROW).index(next);\n                oldIndex = this.tbody.children(ITEMROW).index(current.parent());\n\n                if (index >= 0 && !this.trigger(ROWREORDER, { oldIndex: oldIndex, newIndex: index, row: current.parent() })) {\n                    this.reorderRows(current.parent(), index);\n                    next = this.tbody.children(ITEMROW).eq(index).children().eq(cellIndex);\n                }\n            } else {\n               next = this._prevVerticalCell(container, current);\n               if (!next[0]) {\n                  this._lastCellIndex = 0;\n                  container = this._verticalContainer(container, true);\n\n                  next = this._prevVerticalCell(container, current);\n\n                  if (next[0]) {\n                      focusTable(this.table, true);\n                  }\n               }\n            }\n\n            var tmp = this._lastCellIndex || 0;\n            this._setCurrent(next);\n            this._lastCellIndex = tmp;\n\n            return true;\n        },\n\n        _moveDown: function(current, shiftKey, ctrlKey) {\n            //thead or tbody\n            var container = current.parent().parent();\n            var next, cellIndex, index, oldIndex;\n\n            if (shiftKey) {\n                next = current.parent();\n                next = next.nextAll(ITEMROW).first();\n                next = current.parent().is(ITEMROW) ? next.children().eq(current.index()) : next.children(DATA_CELL).first();\n            } else if (ctrlKey && current.parent().is(ITEMROW) && this._hasReorderableRows()) {\n                cellIndex = current.index();\n                next = current.parent();\n                next = next.nextAll(ITEMROW).first();\n                index = this.tbody.children(ITEMROW).index(next);\n                oldIndex = this.tbody.children(ITEMROW).index(current.parent());\n\n                if (index >= 0 && !this.trigger(ROWREORDER, { oldIndex: oldIndex, newIndex: index, row: current.parent() })) {\n                    this.reorderRows(current.parent(), index + 1);\n                    next = this.tbody.children(ITEMROW).eq(index).children().eq(cellIndex);\n                }\n            } else {\n                next = this._nextVerticalCell(container, current);\n                if (!next[0]) {\n                    this._lastCellIndex = 0;\n                    container = this._verticalContainer(container);\n\n                    next = this._nextVerticalCell(container, current);\n                    if (next[0]) {\n                        focusTable(this.table, true);\n                    }\n                }\n            }\n            var tmp = this._lastCellIndex || 0;\n            this._setCurrent(next);\n            this._lastCellIndex = tmp;\n            return true;\n        },\n\n        _moveColumn: function(current, isLeft) {\n            var elements = this.wrapper.data().kendoReorderable.element.find(this._draggableInstance.options.filter + \":visible\");\n\n            var columns = visibleColumns(flatColumnsInDomOrder(this.columns));\n            var oldIndex = elements.index($(current));\n            var offset = isLeft ? - 1 : 1;\n            var column = columns[oldIndex];\n            var newIndex = targetParentContainerIndex(columns, this.columns, oldIndex, oldIndex + offset);\n            if (newIndex >= 0) {\n                this.reorderColumn(newIndex, column, isLeft);\n                this.trigger(COLUMNREORDER, {\n                    newIndex: newIndex,\n                    oldIndex: oldIndex,\n                    column: column\n                });\n            }\n        },\n\n        _handleHome: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var prev;\n\n            if (this._hasVirtualColumns()) {\n                this._scrollToColumn(kendo.keys.HOME);\n                return true;\n            }\n\n            if (ctrl) {\n                if (this.lockedTable) {\n                    prev = this.lockedTable.find(ITEMROW).first().children(NAVCELL).first();\n                } else {\n                    prev = this.table.find(ITEMROW).first().children(NAVCELL).first();\n                }\n            } else if (isInBody || isInLockedTable) {\n                if (isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                prev = row.children(DATA_CELL).first();\n            }\n\n            if (prev && prev.length) {\n                this._setCurrent(prev);\n                return true;\n            }\n        },\n\n        _handleEnd: function(current, ctrl) {\n            var row = current.parent();\n            var rowContainer = row.parent();\n            var isInLockedTable = this.lockedTable && this.lockedTable.children(\"tbody\")[0] === rowContainer[0];\n            var isInBody = rowContainer[0] === this.tbody[0];\n            var next;\n\n            if (this._hasVirtualColumns()) {\n                this._scrollToColumn(kendo.keys.END);\n                return true;\n            }\n\n            if (ctrl) {\n                next = this.table.find(ITEMROW).last().children(NAVCELL).last();\n            } else if (isInBody || isInLockedTable) {\n                if (!isInBody && this.lockedTable) {\n                    row = this._relatedRow(row);\n                }\n                next = row.children(DATA_CELL).last();\n            }\n\n            if (next && next.length) {\n                this._setCurrent(next);\n                return true;\n            }\n        },\n\n        _handlePageDown: function() {\n            if (!this.options.pageable) {\n                return false;\n            }\n\n            this.dataSource.page(this.dataSource.page() + 1);\n\n            return true;\n        },\n\n        _handlePageUp: function() {\n            if (!this.options.pageable) {\n                return false;\n            }\n\n            this.dataSource.page(this.dataSource.page() - 1);\n\n            return true;\n        },\n\n        _handleTabKey: function(current, currentTable, shiftKey, target) {\n            var isInCell = this.options.editable && this._editMode() == \"incell\";\n            var cell, filterFocusable;\n\n            if (!isInCell ||\n                current.is(\"th\") ||\n                (this.options.scrollable ? this._headertables.filter(currentTable).length : this.thead.filter(target).length)) {\n                    if (current.parent().hasClass(\"k-filter-row\")) {\n                        filterFocusable = this._filterFocusable();\n\n                        if (!shiftKey && filterFocusable[filterFocusable.length - 1] === document.activeElement) {\n                            filterFocusable.first().trigger(\"focus\");\n\n                            return true;\n                        } else if (shiftKey && filterFocusable[0] === document.activeElement) {\n                            filterFocusable.last().trigger(\"focus\");\n\n                            return true;\n                        }\n                    }\n\n                    return false;\n            }\n\n            cell = $(activeElement()).closest(\".k-edit-cell\");\n\n            if (cell[0] && cell[0] !== current[0]) {\n                current = cell;\n            }\n\n            cell = this._tabNext(current, currentTable, shiftKey);\n\n            if (cell[0] === current[0]) {\n                return false;\n            }\n\n            if (cell.length) {\n                this._handleEditing(current, cell, cell.closest(\"table\"));\n\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleEscKey: function(current) {\n            var active = activeElement();\n            var isInCell = this._editMode() == \"incell\";\n\n            if (!isInEdit(current)) {\n                if (current.has(active).length) {\n                    // return focus back to the table\n                    focusTable(this.table, true);\n\n                    return true;\n                }\n\n                if (current.parent().hasClass(\"k-filter-row\")) {\n                    this._filterFocusable().attr(\"tabindex\", -1);\n                    focusTable(this.table, true);\n\n                    return true;\n                }\n\n                return false;\n            }\n\n            if (isInCell) {\n                this.closeCell(true);\n            } else {\n                var currentIndex = $(current).parent().index();\n                if (active) {\n                    active.blur();\n                }\n                this.cancelRow(true);\n                if (currentIndex >= 0) {\n                    this._setCurrent(this.items().eq(currentIndex).children(NAVCELL).first());\n                }\n            }\n\n            focusTable(this.table, true);\n\n            return true;\n        },\n\n        _toggleCurrent: function(current, editable, hasDetails) {\n            var row = current.parent();\n\n            if (current.is(\".k-command-cell\")) {\n                return false;\n            }\n\n            if (row.is(\".k-grouping-row\")) {\n                row.find(\".k-icon\").first().click();\n\n                return true;\n            }\n\n            if (!editable && hasDetails) {\n                row.find(\".k-icon\").first().click();\n\n                return true;\n            }\n\n            return false;\n        },\n\n        _handleSpaceKey: function(current, ctrlKey) {\n            var that = this;\n\n            if (!ctrlKey || !that.groupable || !current.hasClass(\"k-header\")) {\n                return;\n            }\n\n            var descriptors = that.groupable.descriptors();\n            var field = current.attr(kendo.attr(\"field\"));\n            var aggregates = that.groupable.aggregates();\n            var label;\n\n            if (that.groupable._canDrag(current)) {\n                descriptors.push({\n                    field: field,\n                    dir: \"asc\",\n                    aggregates: aggregates || []\n                });\n                label = that.options.messages.ungroupHeader;\n            } else {\n                descriptors = $.grep(descriptors, function(item)\n                {\n                    return item.field !== field;\n                });\n                label = that.options.messages.groupHeader;\n            }\n\n            current.attr(\"title\", label);\n\n            that.dataSource.group(descriptors);\n\n            return true;\n        },\n\n        _handleEnterKey: function(current, currentTable, target) {\n            var editable = this.options.editable && this.options.editable.update !== false;\n            var container = target.closest(\"td\");\n            var hasDetails = this._hasDetails();\n            var link, filterFocusable;\n\n            if (!target.is(\"table\") && !$.contains(current[0], target[0])) {\n                current = container;\n            }\n\n            if (current.is(\"th\")) {\n                // sort the column, if possible\n                link = current.find(\".k-link\");\n\n                if (current.has($(activeElement())).length > 0) {\n                    return false;\n                } else if (link.length) {\n                    link.click();\n                } else if (current.parent().hasClass(\"k-filter-row\")) {\n                    filterFocusable = this._filterFocusable();\n                    filterFocusable.attr(\"tabindex\", 0);\n                    current.find(\":kendoFocusable\").first().focus();\n                } else {\n                    current.find(CHECKBOXINPUT).trigger(\"focus\");\n                }\n\n                return true;\n            }\n            if (this._toggleCurrent(current, editable, hasDetails)) {\n                return true;\n            }\n\n            var focusable = current.find(\":kendoFocusable\").first();\n            if (focusable[0] && !current.hasClass(\"k-edit-cell\") && current.hasClass(\"k-focus\")) {\n                focusable.trigger(\"focus\");\n\n                return true;\n            }\n\n            if (editable && !target.is(\":button,.k-button,textarea\")) {\n                if (!container[0]) {\n                    container = current;\n                }\n\n                this._handleEditing(container, false, currentTable);\n\n                return true;\n            }\n\n            return false;\n        },\n\n        _nextHorizontalCell: function(table, current, originalIndex) {\n            var cells = current.nextAll(DATA_CELL);\n\n            if (!cells.length) {\n                var rows = table.find(NAVROW);\n                var rowIndex = rows.index(current.parent());\n\n                //no sibling cells are found and we've changed the table\n                if (rowIndex == -1) {\n                    if (current.hasClass(\"k-header\")) {\n                        var headerRows = [];\n                        mapColumnToCellRows([lockedColumns(this.columns)[0]], childColumnsCells(rows.eq(0).children(\":visible\").first()), headerRows, 0, 0);\n\n                        if (headerRows[originalIndex]) {\n                            return headerRows[originalIndex][0];\n                        }\n\n                        return current;\n                    }\n\n                    //current is in filter row\n                    if (current.parent().hasClass(\"k-filter-row\")) {\n                        return rows.last().children(DATA_CELL).first();\n                    }\n\n                    //get the same row index in the new table\n                    return rows.eq(originalIndex).children(DATA_CELL).first();\n                }\n            }\n\n            return cells.first();\n        },\n\n        _prevHorizontalCell: function(table, current, originalIndex) {\n            var cells = current.prevAll(DATA_CELL);\n\n            if (!cells.length) {\n                var rows = table.find(NAVROW);\n                var rowIndex = rows.index(current.parent());\n\n                //no sibling cells are found and we've changed the table\n                if (rowIndex == -1) {\n                    if (current.hasClass(\"k-header\")) {\n                        var headerRows = [];\n                        var columns = lockedColumns(this.columns);\n                        mapColumnToCellRows([columns[columns.length - 1]], childColumnsCells(rows.eq(0).children().last()), headerRows, 0, 0);\n\n                        if (headerRows[originalIndex]) {\n                            return headerRows[originalIndex][0];\n                        }\n\n                        return current;\n                    }\n\n                    //current is in filter row\n                    if (current.parent().hasClass(\"k-filter-row\")) {\n                        return rows.last().children(DATA_CELL).last();\n                    }\n\n                    //get the same row index in the new table\n                    return rows.eq(originalIndex).children(DATA_CELL).last();\n                }\n            }\n\n            return cells.first();\n        },\n\n        _currentDataIndex: function(table, current) {\n            var index = current.attr(\"data-index\");\n\n            if (!index) {\n                return undefined;\n            }\n\n            var lockedColumnsCount = lockedColumns(this.columns).length;\n            if (lockedColumnsCount && !table.closest(\"div\").hasClass(\"k-grid-content-locked\")[0]) {\n                return index - lockedColumnsCount;\n            }\n\n            return index;\n        },\n\n        _prevVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n\n            //current is in the header, but not at the last level of multi-level columns\n            if (index || current.hasClass(\"k-header\")) {\n                cells = parentColumnsCells(current);\n                return cells.eq(cells.length - 2);\n            }\n\n            //check this out\n            index = Math.max(row.children(DATA_CELL).index(current), this._lastCellIndex || 0);\n\n            //if current is inside filter row\n            if (row.hasClass(\"k-filter-row\")) {\n                return leafDataCells(container).filter(isCellVisible).eq(index);\n            }\n\n            //move up to header container\n            if (rowIndex == -1) {\n                if (this._hasVirtualColumns()) {\n                    index = this._virtualCellIndex;\n                }\n                //is there filter row in the header container\n                row = container.find(\"tr.k-filter-row:visible\");\n                if (!row[0]) {\n                    // in hierarchical grid we need to correct the index\n                    // since the k-hierarchy cell is navigatable\n                    if ((this._hasDetails() || current.parent().find('.k-hierarchy-cell').length) && index) {\n                        index--;\n                    }\n                    return leafDataCells(container).filter(isCellVisible).eq(index);\n                }\n            } else {\n                row = rowIndex === 0 ? $() : rows.eq(rowIndex - 1);\n            }\n\n            cells = row.children(DATA_CELL);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _nextVerticalCell: function(container, current) {\n            var cells;\n            var row = current.parent();\n            var rows = container.children(NAVROW);\n            var rowIndex = rows.index(row);\n            //get data-index in case of last level of multi-level columns\n            var index = this._currentDataIndex(container, current);\n            var virtualScroll = this.virtualScroll || {};\n            var colspan;\n\n            //current is in the header, but not at the last level of multi-level columns\n            //and we are not changing the table\n            if (rowIndex != -1 && index === undefined && current.hasClass(\"k-header\")) {\n                return childColumnsCells(current).eq(1);\n            }\n\n            index = index ? parseInt(index, 10) : row.children(DATA_CELL).index(current);\n            index = Math.max(index, this._lastCellIndex || 0);\n\n            //move down to data container\n            if (rowIndex == -1) {\n                row = rows.eq(0);\n                if (virtualScroll.columns) {\n                    colspan = parseInt(row.children().first().attr(\"colspan\"), 10);\n                    index = this._virtualCellIndex - (colspan > 1 ? colspan : 0);\n                }\n                // in hierarchical grid we need to correct the index\n                // since the k-hierarchy cell is navigatable\n                if (this._hasDetails() || row.find('.k-hierarchy-cell').length) {\n                    index++;\n                }\n            } else {\n                row = rows.eq(rowIndex + current[0].rowSpan);\n            }\n\n            var tmpIndex = index;\n            //in case of last level of multi-level columns the index should be updated depending on the hidden columns\n            if (this._currentDataIndex(container, current) !== undefined) {\n                var currentRowCells = row.children(\":not(.k-group-cell):not(.k-hierarchy-cell)\");\n                var hiddenColumns = currentRowCells.filter(\":hidden\");\n                for (var idx = 0, length = hiddenColumns.length; idx < length; idx++) {\n                    if (currentRowCells.index(hiddenColumns[idx]) < index) {\n                        tmpIndex--;\n                    }\n                }\n            }\n            index = tmpIndex;\n\n            cells = row.children(DATA_CELL);\n            if (cells.length > index) {\n                return cells.eq(index);\n            }\n\n            return cells.eq(0);\n        },\n\n        _verticalContainer: function(container, up) {\n            var table = container.parent();\n            var length = this._navigatableTables.length;\n            var step = Math.floor(length / 2);\n            var index = inArray(table[0], this._navigatableTables);\n\n            if (up) {\n                step *= -1;\n            }\n            index += step;\n\n            if (index >= 0 || index < length) {\n                table = this._navigatableTables.eq(index);\n            }\n\n            return table.find(up ? \">thead\" : \">tbody\");\n        },\n\n        _filterFocusable: function() {\n            return this.wrapper.find(\".k-filter-row\").find(\".k-dropdownlist, .k-input .k-input-inner:visible, input[type='radio']:visible, input[type='checkbox']:visible\");\n        },\n\n        _horizontalContainer: function(container, right) {\n            var length = this._navigatableTables.length;\n            if (length <= 2) {\n                return container;\n            }\n\n            var table = container.parent();\n            var index = inArray(table[0], this._navigatableTables);\n\n            index += right ? 1 : -1;\n\n            if (right && (index == 2 || index == length)) {\n                return container;\n            }\n\n            if (!right && (index == 1 || index < 0)) {\n                return container;\n            }\n\n            return this._navigatableTables.eq(index).find(\"thead, tbody\");\n        },\n\n        _tabNext: function(current, currentTable, back) {\n            var switchRow = true;\n            var next = back ? current.prevAll(DATA_CELL).first() : current.nextAll(\":visible\").first();\n\n            if (!next.length) {\n                next = current.parent();\n                if (this.lockedTable) {\n                    switchRow = (back && currentTable == this.lockedTable[0]) || (!back && currentTable == this.table[0]);\n                    next = this._relatedRow(next);\n                }\n\n                if (switchRow) {\n                    if (this._hasVirtualColumns()) {\n                        return current;\n                    }\n                    next = next[back ? \"prevAll\" : \"nextAll\"](\"tr:not(.k-grouping-row):not(.k-detail-row):visible\").first();\n                }\n                if (back) {\n                    next = next.children(DATA_CELL).last();\n                } else {\n                    next = next.children(DATA_CELL).first();\n                }\n            }\n\n            return next;\n        },\n\n        _handleEditing: function(current, next, table) {\n            var that = this,\n                active = $(activeElement()),\n                mode = that._editMode(),\n                isIE = browser.msie,\n                editContainer = that._editContainer,\n                focusable,\n                editable = that.options.editable && that.options.editable.update !== false,\n                isEdited;\n\n            table = $(table);\n            if (mode == \"incell\") {\n                isEdited = current.hasClass(\"k-edit-cell\");\n            } else {\n                isEdited = current.parent().hasClass(\"k-grid-edit-row\");\n            }\n\n            if (that.editable) {\n                if ($.contains(editContainer[0], active[0])) {\n                    active.trigger(\"blur\");\n                    if (isIE) {\n                        //IE10 with jQuery 1.9.x does not trigger blur handler\n                        //numeric textbox does trigger change\n                        active.trigger(\"blur\");\n                    }\n                }\n\n                if (!that.editable) {\n                    focusTable(that.table);\n                    return;\n                }\n\n                if (that.editable.end()) {\n                    if (mode == \"incell\") {\n                        that.closeCell();\n                    } else {\n                        that.saveRow();\n                        isEdited = true;\n                    }\n                } else {\n                    if (mode == \"incell\") {\n                        that._setCurrent(editContainer);\n                    } else {\n                        that._setCurrent(editContainer.children().filter(DATA_CELL).first());\n                    }\n                    focusable = editContainer.find(\":kendoFocusable\").first()[0];\n                    if (focusable) {\n                        focusable.focus();\n                    }\n                    return;\n                }\n            }\n\n            if (next) {\n                that._setCurrent(next);\n            }\n\n            focusTable(that.table, true);\n\n            if (!editable) {\n                return;\n            }\n\n            if ((!isEdited && !next) || next) {\n                if (mode === INCELL) {\n                    if (!$(that.current()).hasClass(HIERARCHY_CELL_CLASS)) {\n                        that.editCell(that.current());\n                    }\n                } else {\n                    that.editRow(that.current().parent());\n                }\n            }\n        },\n\n        _wrapper: function() {\n            var that = this,\n                table = that.table,\n                height = that.options.height,\n                width = that.options.width,\n                wrapper = that.element;\n\n            if (!wrapper.is(\"div\")) {\n               wrapper = wrapper.wrap(\"<div/>\").parent();\n            }\n\n            that.wrapper = wrapper.addClass(\"k-grid k-widget k-grid-display-block\");\n\n            if (height) {\n                that.wrapper.css(HEIGHT, height);\n                table.css(HEIGHT, \"auto\");\n            }\n\n            if (width) {\n                that.wrapper.css(\"width\", width);\n            }\n\n            that._initMobile();\n        },\n\n        _initMobile: function() {\n            var options = this.options;\n            var that = this;\n\n            this._isMobile = (options.mobile === true && kendo.support.mobileOS) ||\n                                options.mobile === \"phone\" ||\n                                options.mobile === \"tablet\";\n\n            if (this._isMobile) {\n                var html = this.wrapper.addClass(\"k-grid-mobile\").wrap(\n                    '<div data-' + kendo.ns + 'stretch=\"true\" data-' + kendo.ns + 'role=\"view\" ' +\n                    'data-' + kendo.ns + 'init-widgets=\"false\"></div>'\n                )\n                .parent();\n\n                this.pane = this._createPane(html);\n                this.view = this.pane.view();\n\n                if (options.height) {\n                    this.pane.element.parent().css(HEIGHT, options.height);\n                } else {\n                    this.pane.element.parent().css(HEIGHT, this.wrapper[0].style.height);\n                }\n\n                this._editAnimation = \"slide\";\n\n                // Grid transitions should not propagate to the view\n                that.wrapper.on(\"transitionend\" + NS, function(e) {\n                    e.stopPropagation();\n                });\n\n                that.wrapper.on(\"contextmenu\" + NS, \"th a\", function(e) {\n                    e.preventDefault();\n                    return false;\n                });\n\n                this.view.bind(\"showStart\", function() {\n                    if (that._isLocked()) {\n                        that._updateTablesWidth();\n                        that._applyLockedContainersWidth();\n                        that._syncLockedContentHeight();\n                        that._syncLockedHeaderHeight();\n                        that._syncLockedFooterHeight();\n                    }\n                });\n            }\n        },\n\n        _createPane: function(html) {\n            var pane = kendo.Pane.wrap(html, {\n                viewEngine: {\n                    viewOptions: {\n                        renderOnInit: true,\n                        wrap: false,\n                        wrapInSections: true,\n                        detachOnHide: false,\n                        detachOnDestroy: false\n                    }\n                }\n            });\n\n            return pane;\n        },\n\n        _tbody: function() {\n            var that = this,\n                table = that.table,\n                tbody;\n\n            tbody = table.find(\">tbody\");\n\n            if (!tbody.length) {\n                tbody = $(\"<tbody/>\").appendTo(table);\n            }\n\n            that.tbody = tbody;\n        },\n\n        _scrollable: function() {\n            var that = this,\n                header,\n                table,\n                options = that.options,\n                scrollable = options.scrollable,\n                hasVirtualScroll = scrollable !== true && scrollable.virtual,\n                virtualScroll = hasVirtualScroll ? parseVirtualSettings(scrollable.virtual) : null,\n                scrollbar = !kendo.support.kineticScrollNeeded || (virtualScroll && virtualScroll.rows) ? kendo.support.scrollbar() : 0,\n                headerWrap;\n\n            if (scrollable) {\n                header = that.wrapper.children(\".k-grid-header\");\n\n                if (!header[0]) {\n                    header = $('<div class=\"k-grid-header\" />').insertBefore(that.table);\n                }\n\n                // workaround for IE issue where scroll is not raised if container is same width as the scrollbar\n                header.css((isRtl ? \"padding-left\" : \"padding-right\"), scrollable.virtual ? scrollbar + 1 : scrollbar);\n                table = $('<table role=\"none\"/>');\n\n                table.width(that.table[0].style.width);\n\n                table.append(that.thead);\n                header.empty().append($('<div class=\"k-grid-header-wrap k-auto-scrollable\" />').append(table));\n\n\n                that.content = that.table.parent();\n                that.virtualScroll = virtualScroll;\n\n                if (that.content.is(\".k-virtual-scrollable-wrap, \" + DOT + classNames.scrollContainer)) {\n                    that.content = that.content.parent();\n                }\n\n                if (!that.content.is(\".k-grid-content, .k-virtual-scrollable-wrap\")) {\n                    that.content = that.table.wrap('<div class=\"k-grid-content k-auto-scrollable\" />').parent();\n                }\n\n                if (virtualScroll && virtualScroll.rows && !that.virtualScrollable) {\n                    that._createVirtualScrollable();\n                }\n\n                if (virtualScroll && virtualScroll.columns) {\n\n                    that.table.css({\n                        width: sumWidths(visibleLeafColumns(visibleNonLockedColumns(that.columns)))\n                    });\n                }\n\n                headerWrap = header.children(\".k-grid-header-wrap\");\n\n                that.scrollables = headerWrap.add(that.content);\n\n                // the footer may exists if rendered from the server\n                var footer = that.wrapper.find(\".k-grid-footer\");\n\n                if (footer.length) {\n                    that.scrollables = that.scrollables.add(footer.children(\".k-grid-footer-wrap\"));\n                }\n\n                headerWrap.off(\"scroll\" + NS).on(\"scroll\" + NS, function(e) {\n                    if (that._scrollLeft !== this.scrollLeft) {\n                        kendo.scrollLeft(that.scrollables.not(e.currentTarget), this.scrollLeft);\n                    }\n                });\n\n                if (virtualScroll && virtualScroll.rows) {\n                    that.content.find(\">.k-virtual-scrollable-wrap\").off(\"scroll\" + NS).on(\"scroll\" + NS, function() {\n                        var isScrollingLeft = this.scrollLeft != that._scrollLeft;\n                        that._scrollLeft = this.scrollLeft;\n                        kendo.scrollLeft(that.scrollables, this.scrollLeft);\n                        if (that.lockedContent) {\n                            that.lockedContent[0].scrollTop = this.scrollTop;\n                        }\n                        if (virtualScroll.columns && isScrollingLeft) {\n                            that.refresh();\n                        }\n                    });\n                } else {\n                    var endless = scrollable.endless;\n                    var originalPageSize = that.dataSource.options.pageSize;\n                    if (endless) {\n                        that._endlessPageSize = originalPageSize;\n                    }\n                    that.content.off(\"scroll\" + NS).on(\"scroll\" + NS, function(e) {\n                        var isScrollingLeft = this.scrollLeft != that._scrollLeft;\n                        that._scrollLeft = this.scrollLeft;\n                        kendo.scrollLeft(that.scrollables.not(e.currentTarget), that._scrollLeft);\n                        if (that.lockedContent && e.currentTarget == that.content[0]) {\n                            that.lockedContent[0].scrollTop = this.scrollTop;\n                        }\n                        if (endless) {\n                            if ((this.scrollTop + this.clientHeight - this.scrollHeight >= -10) &&\n                                !that._endlessFetchInProgress &&\n                                that._endlessPageSize < that.dataSource.total()) {\n                                that._skipRerenderItemsCount = that._endlessPageSize;\n                                that._endlessPageSize = that._endlessPageSize + originalPageSize;\n                                that.dataSource.options.endless = true;\n                                that._endlessFetchInProgress = true;\n                                that.dataSource.pageSize(that._endlessPageSize);\n                            }\n                        }\n\n                        if (virtualScroll && virtualScroll.columns && isScrollingLeft) {\n                              that._virtualColScroll = true;\n                              that._cacheEditableState();\n                              that.refresh();\n                              that._restoreEditableState();\n                              that._virtualColScroll = false;\n                        }\n                    });\n\n                    var touchScroller = that.content.data(\"kendoTouchScroller\");\n                    if (touchScroller) {\n                        touchScroller.destroy();\n                    }\n\n                    touchScroller = kendo.touchScroller(that.content);\n                    if (touchScroller && touchScroller.movable) {\n                        that.touchScroller = touchScroller;\n                        touchScroller.movable.bind(\"change\", function(e) {\n                            kendo.scrollLeft(that.scrollables, -e.sender.x);\n                            if (that.lockedContent) {\n                                that.lockedContent.scrollTop(-e.sender.y);\n                            }\n                        });\n\n                        that.one(DATABOUND, function(e) {\n                            e.sender.wrapper.addClass(\"k-grid-backface\");\n                        });\n                    }\n                }\n            }\n        },\n\n        _createVirtualScrollable: function() {\n            var that = this;\n\n            if (that.virtualScrollable) {\n                that.virtualScrollable.destroy();\n            }\n\n            that.virtualScrollable = new VirtualScrollable(that.content, {\n                dataSource: that.dataSource,\n                itemHeight: function() { return that._averageRowHeight(); },\n                page: function() {\n                    that._restoreEditableState();\n                },\n                scroll: function() {\n                    that._focusEditable();\n                },\n                loadStart: function() {\n                    that._progress(true);\n                },\n                loadEnd: function() {\n                    that._progress(false);\n                }\n            });\n\n            that.virtualScrollable.bind(PAGING, that._onVirtualPaging.bind(that));\n        },\n\n        _onVirtualPaging: function() {\n            var that = this;\n\n            that._cacheEditableState();\n\n            if (that._isVirtualIncellEditable()) {\n                that._shouldClearEditableState = false;\n                that.closeCell();\n                that._shouldClearEditableState = true;\n            }\n        },\n\n        _isVirtualEditable: function() {\n            return this._isVirtualIncellEditable() || this._isVirtualInlineEditable() || this._isVirtualPopupEditable();\n        },\n\n        _isVirtualInlineEditable: function() {\n            return (this.virtualScrollable) && this._editMode() === INLINE;\n        },\n\n        _isVirtualIncellEditable: function() {\n            return (this.virtualScrollable) && this._editMode() === INCELL;\n        },\n\n        _isVirtualPopupEditable: function() {\n            return this.virtualScrollable && this._editMode() === \"popup\";\n        },\n\n        _hasVirtualColumns: function() {\n            return (this.virtualScroll || {}).columns ? true : false;\n        },\n\n        _scrollVirtualWrapper: function() {\n            var that = this;\n            var scrollable = that.virtualScrollable;\n\n            if (that._isVirtualInlineEditable() || that._isVirtualIncellEditable()) {\n                if (scrollable._isScrolledToBottom()) {\n                    scrollable._scrollWrapperToBottom();\n                } else if (scrollable._isScrolledToTop()) {\n                    scrollable._scrollWrapperToTop();\n                }\n            }\n        },\n\n        _scrollVirtualWrapperOnColumnResize: function() {\n            var virtualScrollable = this.virtualScrollable;\n\n            if (virtualScrollable) {\n                virtualScrollable._scrollWrapperOnColumnResize();\n            }\n        },\n\n        _restoreEditableState: function() {\n            var that = this;\n            var editableState = that._editableState || {};\n            var editedModel = editableState.model;\n            var dataSource = that.dataSource;\n            var inlineMode = that._isVirtualInlineEditable();\n            var incellMode = that._isVirtualIncellEditable();\n            var virtualColumns = that._hasVirtualColumns();\n            var row;\n            var cell;\n\n            if ((inlineMode || incellMode || virtualColumns) && editedModel && dataSource._getByUid(editedModel.uid, dataSource.view())) {\n                if (that._editMode() === INLINE) {\n                    that._shouldClearEditableState = false;\n                    that.editRow(editedModel);\n                    if (!virtualColumns) {\n                        that._focusEditable();\n                    }\n                } else if (that._editMode() === INCELL) {\n                    row = that.tbody.children(attrEquals(UNIQUE_ID, editedModel.uid));\n                    cell = $(row).children(attrEquals(FIELD, editableState.field));\n\n                    if (cell[0]) {\n                        that._shouldClearEditableState = false;\n                        that.editCell(cell);\n                        if (!virtualColumns) {\n                            that._focusEditable();\n                        }\n                    }\n                }\n            }\n\n            that._shouldClearEditableState = true;\n        },\n\n        _focusEditable: function() {\n            var that = this;\n            var editedField = (that._editableState || {}).field;\n            var editContainer = that._editContainer;\n\n            if (editContainer && editContainer.length && !contains(editContainer[0], activeElement()) && that._canFocusEditable()) {\n                if (that._isVirtualInlineEditable() || that._hasVirtualColumns()) {\n                    editContainer.find(attrEquals(CONTAINER_FOR, editedField)).find(FOCUSABLE).eq(0).trigger(\"focus\");\n                } else if (that._isVirtualIncellEditable() || that._hasVirtualColumns()) {\n                    editContainer.find(FOCUSABLE).eq(0).trigger(\"focus\");\n                }\n            }\n        },\n\n        _canFocusEditable: function() {\n            var that = this;\n            var result = ((that._isVirtualIncellEditable() || that._isVirtualInlineEditable() || that._hasVirtualColumns()) &&\n            (isElementVisibleInWrapper((that.virtualScrollable || {}).wrapper, that._editContainer) || isElementVisibleInWrapper(that.content, that._editContainer)));\n\n            return result;\n        },\n\n        _cacheEditableState: function() {\n            var that = this;\n            var editContainer = that._editContainer;\n            var editedModel = editContainer ? that._modelForContainer(editContainer) : null;\n            var inlineMode = that._isVirtualInlineEditable();\n            var incellMode = that._isVirtualIncellEditable();\n            var virtualColumns = that._hasVirtualColumns();\n            var active;\n            var widget;\n\n            if ((inlineMode || incellMode || virtualColumns) && editedModel) {\n                that._clearEditableState();\n                active = $(activeElement());\n\n                if (editContainer && active[0] && contains(editContainer[0], active[0])) {\n                    //change event is not fired if the editable container is scrolled\n                    //out of the virtual view with the mousewheel right after editing\n                    active.change();\n\n                    widget = kendo.widgetInstance(active, kendo.ui);\n\n                    if (widget && isFunction(widget.value) && active.is(INPUT)) {\n                        widget.value(active.val());\n                        widget.trigger(CHANGE);\n                    }\n                }\n\n                if (that._editMode() === INLINE) {\n                    that._editableState = {\n                        model: editedModel,\n                        field: active.closest(\"[\" + kendo.attr(CONTAINER_FOR) + \"]\").attr(kendo.attr(CONTAINER_FOR))\n                    };\n                } else if (that._editMode() === INCELL) {\n                    that._editableState = {\n                        model: editedModel,\n                        field: editContainer.attr(kendo.attr(FIELD))\n                    };\n                }\n            }\n        },\n\n        _clearSortClasses: function() {\n            var that = this,\n                content = that.content || that.table,\n                lockedContent = that.lockedContent;\n\n            if (content) {\n                content.find(COLGROUP).removeClass(SORTED_CLASS);\n            }\n\n            if (lockedContent) {\n                lockedContent.find(COLGROUP).removeClass(SORTED_CLASS);\n            }\n        },\n\n        _clearEditableState: function() {\n            var that = this;\n\n            if (that.virtualScrollable || (that.virtualScroll && that._hasVirtualColumns())) {\n                that._editableState = null;\n            }\n        },\n\n        _destroyVirtualScrollable: function() {\n            var that = this;\n\n            that._clearEditableState();\n\n            if (that.virtualScrollable && that.virtualScrollable.element) {\n                that.virtualScrollable.destroy();\n            }\n\n            that.virtualScrollable = null;\n        },\n\n        _renderNoRecordsContent: function() {\n            var that = this;\n\n            if (that.options.noRecords) {\n                var noRecordsElement = that.table.parent().children('.' + NORECORDSCLASS);\n\n                if (noRecordsElement.length) {\n                    that.angular(\"cleanup\", function() {\n                        return { elements: noRecordsElement.get() };\n                    });\n\n                    noRecordsElement.remove();\n                }\n\n                if (!that.dataSource || !that.dataSource.view().length) {\n                    noRecordsElement = $(that.noRecordsTemplate({})).insertAfter(that.table);\n\n                    that.angular(\"compile\", function() {\n                        return {\n                            elements: noRecordsElement.get(),\n                            data: [{}]\n                        };\n                    });\n                }\n            }\n        },\n\n        _setContentWidth: function(scrollLeft) {\n            var that = this,\n                hiddenDivClass = 'k-grid-content-expander',\n                hiddenDiv = '<div class=\"' + hiddenDivClass + '\"></div>',\n                resizable = that.resizable,\n                expander;\n\n            if (that.options.scrollable && that.wrapper.is(\":visible\")) {\n                expander = that.table.parent().children('.' + hiddenDivClass);\n                that._setContentWidthHandler = that._setContentWidth.bind(that);\n                if (!that.dataSource || !that.dataSource.view().length) {\n                    if (!expander[0]) {\n                        expander = $(hiddenDiv).appendTo(that.table.parent());\n                        if (resizable) {\n                            resizable.bind(\"resize\", that._setContentWidthHandler);\n                        }\n                    }\n                    if (that.thead) {\n                        expander.width(that.thead.width());\n                        if (!isNaN(parseFloat(scrollLeft, 10))) {\n                            kendo.scrollLeft(that.content, scrollLeft);\n                        }\n                    }\n                } else if (expander[0]) {\n                    expander.remove();\n                    if (resizable) {\n                        resizable.unbind(\"resize\", that._setContentWidthHandler);\n                    }\n                }\n\n                that._applyLockedContainersWidth();\n                that._syncLockedContentHeight();\n\n                // workaround IE does not show vertical scrollbar for elements without width\n                if (that.lockedHeader && that.table[0].clientWidth === 0) {\n                    that.table[0].style.width = \"1px\";\n                }\n            }\n        },\n\n        _applyLockedContainersWidth: function() {\n            if (this.options.scrollable && this.lockedHeader) {\n                var headerTable = this.thead.parent(),\n                    headerWrap = headerTable.parent(),\n                    contentWidth = this.wrapper[0].clientWidth,\n                    groups = this._groups(),\n                    scrollbar = kendo.support.scrollbar(),\n                    cols = this.lockedHeader.find(\">table>colgroup>col:not(.k-group-col, .k-hierarchy-col)\"),\n                    nonLockedCols = headerTable.find(\">colgroup>col:not(.k-group-col, .k-hierarchy-col)\"),\n                    width = columnsWidth(cols),\n                    nonLockedColsWidth = columnsWidth(nonLockedCols),\n                    footerWrap;\n\n                if (groups > 0) {\n                    width += outerWidth(this.lockedHeader.find(\".k-group-cell\").first()) * groups;\n                }\n\n                if (width >= contentWidth) {\n                    width = contentWidth - 3 * scrollbar;\n                }\n\n                this.lockedHeader\n                    .add(this.lockedContent)\n                    .width(width);\n\n                headerWrap[0].style.width = headerWrap.parent().width() - width - 2 + \"px\";\n\n                headerTable.add(this.table).width(nonLockedColsWidth);\n\n                //https://github.com/telerik/kendo-ui-core/issues/377\n                if (this.virtualScrollable && !isIE11) {\n                    contentWidth -= scrollbar;\n                }\n\n                this.content[0].style.width = contentWidth - width - 1 + \"px\";\n\n                if (this.lockedFooter && this.lockedFooter.length) {\n                    this.lockedFooter.width(width);\n                    footerWrap = this.footer.find(\".k-grid-footer-wrap\");\n                    footerWrap[0].style.width = headerWrap[0].clientWidth + \"px\";\n                    footerWrap.children().first().width(nonLockedColsWidth);\n                }\n            }\n        },\n\n        _setContentHeight: function() {\n            var that = this,\n                options = that.options,\n                height,\n                header = that.wrapper.children(\".k-grid-header\"),\n                scrollbar = kendo.support.scrollbar();\n            var scrollableHeight = (options.scrollable || {}).height;\n\n            if (options.scrollable && that.wrapper.is(\":visible\")) {\n                if (scrollableHeight && that.content[0].style.height === \"\") {\n                    // fallback to client-side setting as ASP.NET MVC Core wrapper does not provide server rendering of the content\n                    that.content[0].style.height = scrollableHeight;\n                }\n\n                height = that.wrapper.innerHeight();\n\n                height -= outerHeight(header);\n\n                if (that.pager && that.pager.element.is(\":visible\")) {\n                    height -= outerHeight(that.pager.element);\n                }\n\n                if (options.groupable) {\n                    height -= outerHeight(that.wrapper.children(\".k-grouping-header\"));\n                }\n\n                if (options.toolbar) {\n                    height -= outerHeight(that.wrapper.children(\".k-grid-toolbar\"));\n                }\n\n                if (that.footerTemplate) {\n                    height -= outerHeight(that.wrapper.children(\".k-grid-footer\"));\n                }\n\n                var isGridHeightSet = function(el) {\n                    var initialHeight, newHeight;\n                    if (el[0].style.height) {\n                        return true;\n                    } else {\n                        initialHeight = el.height();\n                    }\n\n                    el.height(\"auto\");\n                    newHeight = el.height();\n\n                    if (initialHeight != newHeight) {\n                        el.height(\"\");\n                        return true;\n                    }\n                    el.height(\"\");\n                    return false;\n                };\n\n                if (isGridHeightSet(that.wrapper)) { // set content height only if needed\n                    if (height > scrollbar * 2) { // do not set height if proper scrollbar cannot be displayed\n                        if (that.lockedContent) {\n                            scrollbar = that.table[0].offsetWidth > that.table.parent()[0].clientWidth ? scrollbar : 0;\n                            that.lockedContent.height(height - scrollbar);\n                        }\n\n                        that.content.height(height);\n                    } else {\n                        that.content.height(scrollbar * 2 + 1);\n                    }\n                }\n            }\n        },\n\n        _averageRowHeight: function() {\n            var that = this,\n                itemsCount = that._items(that.tbody, true).length,\n                rowHeight = that._rowHeight;\n\n            if (itemsCount === 0) {\n                return rowHeight;\n            }\n\n            if (!that._rowHeight) {\n                that._rowHeight = rowHeight = outerHeight(that.table) / itemsCount;\n                that._sum = rowHeight;\n                that._measures = 1;\n            }\n\n            var currentRowHeight = outerHeight(that.table) / itemsCount;\n\n            if (rowHeight !== currentRowHeight) {\n                that._measures ++;\n                that._sum += currentRowHeight;\n                that._rowHeight = that._sum / that._measures;\n            }\n            return rowHeight;\n        },\n\n        _dataSource: function() {\n            var that = this,\n                options = that.options,\n                pageable,\n                dataSource = options.dataSource;\n\n            dataSource = isArray(dataSource) ? { data: dataSource } : dataSource;\n\n            if (isPlainObject(dataSource)) {\n                extend(dataSource, { table: that.table, fields: that.columns });\n\n                pageable = options.pageable;\n\n                if (isPlainObject(pageable) && pageable.pageSize !== undefined) {\n                    dataSource.pageSize = pageable.pageSize;\n                }\n            }\n\n            if (that.dataSource && that._refreshHandler) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler)\n                                .unbind(PROGRESS, that._progressHandler)\n                                .unbind(ERROR, that._errorHandler)\n                                .unbind(SORT, that._sortHandler);\n            } else {\n                that._refreshHandler = that.refresh.bind(that);\n                that._progressHandler = that._requestStart.bind(that);\n                that._errorHandler = that._error.bind(that);\n                that._sortHandler = that._clearSortClasses.bind(that);\n            }\n\n            that.dataSource = DataSource.create(dataSource)\n                                .bind(CHANGE, that._refreshHandler)\n                                .bind(PROGRESS, that._progressHandler)\n                                .bind(ERROR, that._errorHandler)\n                                .bind(SORT, that._sortHandler);\n        },\n\n        _error: function() {\n            this._progress(false);\n        },\n\n        _requestStart: function() {\n            this._progress(true);\n        },\n\n        _modelChange: function(e) {\n            var that = this,\n                tbody = that.tbody,\n                model = e.model,\n                row = that.tbody.find(\"tr[\" + kendo.attr(\"uid\") + \"=\" + model.uid + \"]\"),\n                relatedRow,\n                cell,\n                column,\n                isAlt = row.hasClass(\"k-alt\"),\n                tmp,\n                idx = that._items(tbody).index(row),\n                isLocked = that.lockedContent,\n                selectable,\n                selectableRow,\n                childCells,\n                originalCells,\n                length;\n\n            if (isLocked) {\n                relatedRow = that._relatedRow(row);\n            }\n\n            if (row.add(relatedRow).children(\".k-edit-cell\").length && !that.options.rowTemplate) {\n                row.add(relatedRow).children(\":not(.k-group-cell,.k-hierarchy-cell)\").each(function() {\n                    cell = $(this);\n                    column = leafColumns(that.columns)[that._calculateColumnIndex(cell)];\n\n                    if (column.field === e.field) {\n                        if (!cell.hasClass(\"k-edit-cell\")) {\n                            that._displayCell(cell, column, model);\n                        } else {\n                            cell.addClass(\"k-dirty-cell\");\n                        }\n                    }\n                });\n\n            } else if (!row.hasClass(\"k-grid-edit-row\")) {\n\n                selectableRow = $().add(row);\n\n                if (isLocked) {\n                    tmp = (isAlt ? that.lockedAltRowTemplate : that.lockedRowTemplate)(model);\n\n                    selectableRow = selectableRow.add(relatedRow);\n\n                    relatedRow.replaceWith(tmp);\n                }\n\n                that.angular(\"cleanup\", function() { return { elements: selectableRow.get() }; });\n\n                tmp = (isAlt ? that.altRowTemplate : that.rowTemplate)(model);\n\n                row.replaceWith(tmp);\n\n                tmp = that._items(tbody).eq(idx);\n\n                var angularData = [ { dataItem: model } ];\n\n                if (isLocked) {\n                    row = row.add(relatedRow);\n\n                    relatedRow = that._relatedRow(tmp)[0];\n                    adjustRowHeight(tmp[0], relatedRow);\n\n                    tmp = tmp.add(relatedRow);\n                    angularData.push({ dataItem: model });\n                }\n\n                that.angular(\"compile\", function() {\n                    return {\n                        elements: tmp.get(),\n                        data: angularData\n                     };\n                });\n\n                selectable = that.options.selectable;\n                if ((selectable || that._checkBoxSelection) && row.hasClass(\"k-selected\")) {\n                   that.select(tmp);\n                }\n\n                originalCells = selectableRow.children(\":not(.k-group-cell,.k-hierarchy-cell)\");\n                childCells = tmp.children(\":not(.k-group-cell,.k-hierarchy-cell)\");\n\n                for (idx = 0, length = that.columns.length; idx < length; idx++) {\n                    column = that.columns[idx];\n\n                    cell = childCells.eq(idx);\n                    if (selectable && originalCells.eq(idx).hasClass(\"k-selected\")) {\n                        cell.addClass(\"k-selected\");\n                    }\n                }\n\n                that.trigger(\"itemChange\", { item: tmp, data: model, ns: ui });\n            }\n        },\n\n        _pageable: function() {\n            var that = this,\n                pagerWrap,\n                pageable = that.options.pageable,\n                navigatable = that.options.navigatable;\n\n            if (pageable) {\n                pagerWrap = that.wrapper.children(\"div.k-grid-pager\");\n\n                if (!pagerWrap.length) {\n                    pagerWrap = $('<div class=\"k-pager-wrap k-grid-pager\"/>');\n                }\n\n                if (pageable.position === \"top\") {\n                    pagerWrap.prependTo(that.wrapper).addClass(\"k-grid-pager-top\");\n                } else {\n                    pagerWrap.appendTo(that.wrapper);\n                }\n\n                if (that.pager) {\n                    that.pager.destroy();\n                }\n\n                if (typeof pageable === \"object\" && pageable instanceof kendo.ui.Pager) {\n                    that.pager = pageable;\n                } else {\n                    if (that.dataSource._groupPaging) {\n                        that.pager = new GroupsPager(pagerWrap, extend({}, pageable, { dataSource: that.dataSource, navigatable: navigatable }));\n                    } else {\n                        that.pager = new kendo.ui.Pager(pagerWrap, extend({}, pageable, { dataSource: that.dataSource, navigatable: navigatable }));\n                    }\n                }\n\n                that.pager.bind(\"pageChange\", function(e) {\n                    if (that.trigger(\"page\", { page: e.index })) {\n                        e.preventDefault();\n                    }\n                });\n\n                that._togglePagerVisibility();\n            }\n        },\n\n        _footer: function() {\n            var that = this,\n                aggregates = that.dataSource.aggregates(),\n                html = \"\",\n                footerTemplate = that.footerTemplate,\n                options = that.options,\n                footerWrap,\n                footer = that.footer || that.wrapper.find(\".k-grid-footer\");\n\n            if (footerTemplate) {\n                html = $(that._wrapFooter(footerTemplate(aggregates)));\n\n                if (footer.length) {\n                    var tmp = html;\n\n                    that.angular(\"cleanup\", function() {\n                        return { elements: footer.get() };\n                    });\n\n                    footer.replaceWith(tmp);\n                    footer = that.footer = tmp;\n                } else {\n                    if (options.scrollable) {\n                        footer = that.footer = options.pageable && options.pageable.position !== \"top\" ? html.insertBefore(that.wrapper.children(\"div.k-grid-pager\")) : html.appendTo(that.wrapper);\n                    } else {\n                        footer = that.footer = html.insertAfter(that.tbody);\n                    }\n                }\n\n                that.angular(\"compile\", function() {\n                    return {\n                        elements: footer.find(\"td:not(.k-group-cell, .k-hierarchy-cell)\").get(),\n                        data: map(that.columns, function(col) {\n                            return {\n                                column: col,\n                                aggregate: aggregates[col.field]\n                            };\n                        })\n                    };\n                });\n\n            } else if (footer && !that.footer) {\n                that.footer = footer;\n            }\n\n            if (footer.length) {\n                if (options.scrollable) {\n                    footerWrap = footer.attr(\"tabindex\", -1).children(\".k-grid-footer-wrap\");\n\n                    that.scrollables = $(\n                        that.scrollables\n                            .filter(function() { return !$(this).is(\".k-grid-footer-wrap\"); })\n                            .toArray()\n                    ).add(footerWrap);\n                }\n\n                if (that._footerWidth) {\n                    footer.find(\"table\").css('width', that._footerWidth);\n                }\n\n                if (footerWrap) {\n                    var offset = kendo.scrollLeft(that.content);\n\n                    if (options.scrollable !== true && that.virtualScroll && that.virtualScroll.rows) {\n                        offset = kendo.scrollLeft(that.wrapper.find('.k-virtual-scrollable-wrap'));\n                    }\n                    kendo.scrollLeft(footerWrap, offset);\n                }\n            }\n\n            if (that.lockedContent) {\n                that._appendLockedColumnFooter();\n                that._applyLockedContainersWidth();\n                that._syncLockedFooterHeight();\n            }\n        },\n\n        _wrapFooter: function(footerRow) {\n            var that = this,\n                html = \"\",\n                scrollbar = !kendo.support.mobileOS ? kendo.support.scrollbar() : 0;\n\n            if (that.options.scrollable) {\n                html = $('<div class=\"k-grid-footer\"><div class=\"k-grid-footer-wrap\"><table><tfoot>' + footerRow + '</tfoot></table></div></div>');\n                that._appendCols(html.find(\"table\"));\n                html.css((isRtl ? \"padding-left\" : \"padding-right\"), scrollbar); // Update inner fix.\n\n                return html;\n            }\n\n            return '<tfoot class=\"k-grid-footer\">' + footerRow + '</tfoot>';\n        },\n\n        _columnMenu: function() {\n            var that = this,\n                menu,\n                columns = leafColumns(that.columns),\n                column,\n                options = that.options,\n                columnMenu = options.columnMenu,\n                menuOptions,\n                sortable,\n                filterable,\n                cells,\n                hasMultiColumnHeaders = grep(that.columns, function(item) {\n                    return item.columns !== undefined;\n                }).length > 0,\n                hasLockableColumns = grep(that.columns, function(item) {\n                    return item.lockable !== false;\n                }).length > 0,\n                hasStickableColumns = grep(that.columns, function(item) {\n                    return item.stickable === true;\n                }).length > 0,\n                isMobile = this._isMobile,\n                initCallback = function(e) {\n                    that.trigger(COLUMNMENUINIT, { field: e.field, container: e.container });\n                },\n                openCallback = function(e) {\n                    that.trigger(COLUMNMENUOPEN, { field: e.field, container: e.container });\n                },\n                closeCallback = function() {\n                    focusTable(that.table, true);\n                },\n                stickCallback = function(e) {\n                    that.trigger(COLUMNSTICK, { column: e.column });\n                },\n                unstickCallback = function(e) {\n                    that.trigger(COLUMNUNSTICK, { column: e.column });\n                },\n                sortHandler = function(e) {\n                    if (that.trigger(\"sort\", { sort: e.sort })) {\n                        e.preventDefault();\n                    } else {\n                        that._clearEditableState();\n                        if (that.dataSource.options.endless) {\n                            that._resetEndless();\n                        }\n                    }\n                },\n                filterHandler = function(e) {\n                    if (that.trigger(\"filter\", { filter: e.filter, field: e.field })) {\n                        e.preventDefault();\n                    } else {\n                        that._clearEditableState();\n                        if (that.dataSource.options.endless) {\n                            that._resetEndless();\n                        }\n                    }\n                },\n                $angular = options.$angular;\n\n            if (columnMenu) {\n                if (typeof columnMenu == \"boolean\") {\n                    columnMenu = {};\n                }\n\n                that._setColumnsMediaVisibility(columns);\n\n                cells = leafDataCells(that.thead);\n\n                for (var idx = 0, length = cells.length; idx < length; idx++) {\n                    column = columns[idx];\n                    var cell = cells.eq(idx);\n\n                    if (column.columnMenu !== false && !column.command && (column.field || cell.attr(\"data-\" + kendo.ns + \"field\"))) {\n                        menu = cell.data(\"kendoColumnMenu\");\n                        if (menu) {\n                            menu.destroy();\n                        }\n\n                        sortable = column.sortable !== false && columnMenu.sortable !== false && options.sortable !== false ? extend({}, options.sortable, {\n                            compare: (column.sortable || {}).compare\n                        }) : false;\n\n                        filterable = options.filterable && column.filterable !== false && columnMenu.filterable !== false ? extend({ pane: that.pane }, options.filterable, column.filterable) : false;\n\n                        if (column.filterable && column.filterable.dataSource) {\n                            filterable.forceUnique = false;\n                            filterable.checkSource = column.filterable.dataSource;\n                        }\n\n                        if (filterable) {\n                            filterable.format = column.format;\n                        }\n\n                        menuOptions = {\n                            dataSource: that.dataSource,\n                            values: column.values,\n                            columns: columnMenu.columns,\n                            sortable: sortable,\n                            filterable: filterable,\n                            messages: columnMenu.messages,\n                            owner: that,\n                            closeCallback: closeCallback,\n                            init: initCallback,\n                            open: openCallback,\n                            stick: stickCallback,\n                            unstick: unstickCallback,\n                            pane: that.pane,\n                            sort: sortHandler,\n                            filtering: filterHandler,\n                            filter: isMobile ? \":not(.k-column-active)\" : \"\",\n                            hasLockableColumns: lockedColumns(columns).length > 0 && hasLockableColumns && !hasMultiColumnHeaders,\n                            hasStickableColumns: hasStickableColumns && !hasMultiColumnHeaders,\n                            encodeTitles: that.options.encodeTitles,\n                            componentType: columnMenu.componentType,\n                            appendTo: DOT + classNames.headerCellInner\n                        };\n\n                        if ($angular) {\n                            menuOptions.$angular = $angular;\n                        }\n\n                        cell.kendoColumnMenu(menuOptions);\n                    }\n                }\n            }\n        },\n\n        _headerCells: function() {\n            return $(this.thead).find(\"th\").filter(function() {\n                var th = $(this);\n                return !th.hasClass(\"k-group-cell\") && !th.hasClass(\"k-hierarchy-cell\");\n            });\n        },\n\n        _hasFilterMenu: function() {\n            var filterable = this.options.filterable;\n            if (filterable && typeof filterable.mode == STRING && filterable.mode.indexOf(\"menu\") == -1) {\n                return false;\n            }\n\n            return filterable;\n        },\n\n        _filterable: function() {\n            var that = this,\n                columns = leafColumns(that.columns),\n                filterMenu,\n                cells,\n                cell,\n                filterInit = function(e) {\n                    that.trigger(FILTERMENUINIT, { field: e.field, container: e.container });\n                },\n                closeCallback = function() {\n                    focusTable(that.table, true);\n                },\n                filterHandler = function(e) {\n                    if (that.trigger(\"filter\", { filter: e.filter, field: e.field })) {\n                        e.preventDefault();\n                    } else {\n                        that._clearEditableState();\n                        if (that.dataSource.options.endless) {\n                            that._resetEndless();\n                        }\n                    }\n                },\n                filterOpen = function(e) {\n                    that.trigger(FILTERMENUOPEN, { field: e.field, container: e.container });\n                },\n                filterable = that._hasFilterMenu();\n\n            if (filterable && !that.options.columnMenu) {\n                cells = leafDataCells(that.thead);//that._headerCells();\n\n                for (var idx = 0, length = cells.length; idx < length; idx++) {\n                    cell = cells.eq(idx);\n\n                    if (columns[idx].filterable !== false && !columns[idx].command && (columns[idx].field || cell.attr(\"data-\" + kendo.ns + \"field\"))) {\n                        filterMenu = cell.data(\"kendoFilterMenu\");\n\n                        if (filterMenu) {\n                            filterMenu.destroy();\n                        }\n\n                        filterMenu = cell.data(\"kendoFilterMultiCheck\");\n                        if (filterMenu) {\n                           filterMenu.destroy();\n                        }\n\n                        var columnFilterable = columns[idx].filterable;\n\n                        var options = extend({},\n                            filterable,\n                            columnFilterable,\n                            {\n                                dataSource: that.dataSource,\n                                values: columns[idx].values,\n                                format: columns[idx].format,\n                                closeCallback: closeCallback,\n                                title: columns[idx].title || columns[idx].field,\n                                init: filterInit,\n                                open: filterOpen,\n                                pane: that.pane,\n                                change: filterHandler,\n                                appendTo: DOT + classNames.headerCellInner\n                            }\n                        );\n\n                        if (columnFilterable && columnFilterable.messages) {\n                            options.messages = extend(true, {}, filterable.messages, columnFilterable.messages);\n                        }\n                        if (columnFilterable && columnFilterable.dataSource) {\n                            options.forceUnique = false;\n                            options.checkSource = columnFilterable.dataSource;\n                        }\n\n                        if (columnFilterable && columnFilterable.multi) {\n                            cell.kendoFilterMultiCheck(options);\n                        } else {\n                            cell.kendoFilterMenu(options);\n                        }\n                    }\n                }\n            }\n        },\n\n        _filterRow: function() {\n            var that = this;\n            if (!that._hasFilterRow()) {\n               return;\n            }\n\n            var settings;\n            var $angular = that.options.$angular;\n            var columns = leafColumns(that.columns),\n                filterable = that.options.filterable,\n                rowheader = that.thead.find(\".k-filter-row\"),\n                filterHandler = function(e) {\n                    if (that.trigger(\"filter\", { filter: e.filter, field: e.field })) {\n                        e.preventDefault();\n                    } else {\n                        that._clearEditableState();\n                        if (that.dataSource.options.endless) {\n                            that._resetEndless();\n                        }\n                    }\n                };\n\n\n            this._updateHeader(this.dataSource.group().length);\n\n            for (var i = 0; i < columns.length; i++) {\n                var suggestDataSource,\n                    col = columns[i],\n                    operators = that.options.filterable.operators,\n                    customDataSource = false,\n                    td = $(\"<td title='\" + that.options.messages.filterCellTitle + \"'/>\"),\n                    field = col.field;\n\n                if (col.hidden) {\n                    td.hide();\n                }\n                rowheader.append(td);\n                if (field && col.filterable !== false) {\n                    var cellOptions = col.filterable && col.filterable.cell || {};\n\n                    suggestDataSource = that.options.dataSource;\n                    if (suggestDataSource instanceof DataSource) {\n                        suggestDataSource = that.options.dataSource.options;\n                    }\n\n                    var messages = extend(true, {}, filterable.messages);\n                    if (col.filterable) {\n                        extend(true, messages, col.filterable.messages);\n                    }\n\n                    if (cellOptions.enabled === false) {\n                        td.html(\"&nbsp;\");\n                        continue;\n                    }\n                    if (cellOptions.dataSource) {\n                        suggestDataSource = cellOptions.dataSource;\n                        customDataSource = true;\n                    }\n                    if (col.filterable && col.filterable.operators) {\n                        operators = col.filterable.operators;\n                    }\n\n                    settings = {\n                        column: col,\n                        dataSource: that.dataSource,\n                        suggestDataSource: suggestDataSource,\n                        customDataSource: customDataSource,\n                        field: field,\n                        messages: messages,\n                        values: col.values,\n                        template: cellOptions.template,\n                        delay: cellOptions.delay,\n                        inputWidth: cellOptions.inputWidth,\n                        suggestionOperator: cellOptions.suggestionOperator,\n                        minLength: cellOptions.minLength,\n                        dataTextField: cellOptions.dataTextField,\n                        operator: cellOptions.operator,\n                        operators: operators,\n                        showOperators: cellOptions.showOperators,\n                        change: filterHandler\n                    };\n\n                    if ($angular) {\n                        settings.$angular = $angular;\n                    }\n\n                    $(\"<span/>\").attr(kendo.attr(\"field\"), field)\n                        .appendTo(td)\n                        .kendoFilterCell(settings);\n                } else {\n                    td.html(\"&nbsp;\");\n                }\n                td.data(\"column\", col);\n            }\n\n            this._filterFocusable().attr(\"tabindex\", -1);\n        },\n\n        _sortable: function() {\n            var that = this,\n                columns = leafColumns(that.columns),\n                column,\n                sorterInstance,\n                cell,\n                sortable = that.options.sortable,\n                sortHandler = function(e) {\n                    if (that.trigger(\"sort\", { sort: e.sort })) {\n                        e.preventDefault();\n                    } else {\n                        that._clearEditableState();\n                    }\n                };\n\n\n            if (sortable) {\n                var cells = leafDataCells(that.thead);\n\n                for (var idx = 0, length = cells.length; idx < length; idx++) {\n                    column = columns[idx];\n\n                    if (column.sortable !== false && !column.command && column.field) {\n                        cell = cells.eq(idx);\n\n                        sorterInstance = cell.data(\"kendoColumnSorter\");\n\n                        if (sorterInstance) {\n                            sorterInstance.destroy();\n                        }\n\n                        cell.attr(\"data-\" + kendo.ns + \"field\", column.field)\n                            .kendoColumnSorter(\n                                extend({}, sortable, column.sortable, {\n                                    dataSource: that.dataSource,\n                                    aria: true,\n                                    filter: \":not(.k-column-active)\",\n                                    change: sortHandler\n                                })\n                            );\n                    }\n                }\n                cells = null;\n            }\n        },\n\n        _columns: function(columns) {\n            var that = this,\n                table = that.table,\n                encoded,\n                cols = table.find(\"col\"),\n                lockedCols,\n                headerRows = that.element.find('thead tr'),\n                dataSource = that.options.dataSource,\n                draggableColumns;\n\n            // using HTML5 data attributes as a configuration option e.g. <th data-field=\"foo\">Foo</foo>\n            columns = columns.length ? columns : map(table.find(\"th:not(.k-group-cell):not(.k-hierarchy-cell)\"), function(th, idx) {\n                th = $(th);\n                var sortable = th.attr(kendo.attr(\"sortable\")),\n                    filterable = th.attr(kendo.attr(\"filterable\")),\n                    type = th.attr(kendo.attr(\"type\")),\n                    groupable = th.attr(kendo.attr(\"groupable\")),\n                    field = th.attr(kendo.attr(\"field\")),\n                    title = th.attr(kendo.attr(\"title\")),\n                    columnMenu = th.attr(kendo.attr(\"column-menu\")),\n                    menu = th.attr(kendo.attr(\"menu\"));\n\n                if (!field) {\n                   field = th.text().replace(/\\s|[^A-z0-9]/g, \"\");\n                }\n\n                return {\n                    field: field,\n                    type: type,\n                    title: title,\n                    sortable: sortable !== \"false\",\n                    filterable: filterable !== \"false\",\n                    groupable: groupable !== \"false\",\n                    menu: menu !== \"false\",\n                    columnMenu: columnMenu !== \"false\",\n                    template: th.attr(kendo.attr(\"template\")),\n                    width: cols.eq(idx).css(\"width\")\n                };\n            });\n\n            encoded = !(that.table.find(\"tbody tr\").length > 0 && (!dataSource || !dataSource.transport));\n\n            if (that.options.scrollable) {\n                var initialColumns = columns;\n                lockedCols = lockedColumns(columns);\n                columns = nonLockedColumns(columns);\n\n                if (lockedCols.length > 0 && columns.length === 0) {\n                    throw new Error(\"There should be at least one non locked column\");\n                }\n\n                normalizeHeaderCells(that.element.find(\"tr:has(th)\").first(), initialColumns);\n                columns = lockedCols.concat(columns);\n            }\n\n            if (headerRows.length && columns.length) {\n                that._updateColumnIDs(columns, headerRows.first());\n            }\n\n            that.columns = normalizeColumns(columns, encoded);\n\n            if ($.grep(leafColumns(that.columns), function(col) { return col.selectable;}).length) {\n                that._selectedIds = {};\n                that._checkBoxSelection = true;\n                that.wrapper.on(CLICK + NS, \"tbody > tr \" + CHECKBOXINPUT, that._checkboxClick.bind(that));\n                that.wrapper.on(CLICK + NS, \"thead > tr \" + CHECKBOXINPUT, that._headerCheckboxClick.bind(that));\n            }\n\n            draggableColumns = $.grep(leafColumns(that.columns), function(col) { return col.draggable;});\n\n            if (draggableColumns.length) {\n                that._hasDragHandleColumn = true;\n\n                for (var i = 0; i < draggableColumns.length; i++) {\n                    draggableColumns[i].headerAttributes = $.extend({\n                        \"aria-label\": that.options.messages.dragHandleLabel\n                    }, draggableColumns[i].headerAttributes);\n                }\n            }\n\n            that._foreignKeyBindings(that.columns);\n        },\n\n        _foreignKeyBindings: function(columns) {\n            var that = this;\n            var length = columns.length;\n            var column;\n\n            for (var i = 0; i < length; i++) {\n                column = columns[i];\n\n                if (column.dataSource) {\n                    that._fetchForeignKeyValues(column);\n                }\n            }\n        },\n\n        _fetchForeignKeyValues: function(column) {\n            var that = this;\n            var promise = $.Deferred();\n\n            that._hasBoundForeignKey = true;\n            column.dataSource = DataSource.create(column.dataSource);\n\n            if (!that._foreignKeyPromises) {\n                that._foreignKeyPromises = [];\n            }\n\n            that._foreignKeyPromises.push(promise);\n            column.dataSource.fetch().then(function() {\n                var data = column.dataSource.data();\n                column.values = data.map(function(item) {\n                    return {\n                        value: item[column.dataValueField],\n                        text: item[column.dataTextField]\n                    };\n                });\n                promise.resolve();\n            });\n\n        },\n\n        _updateColumnIDs: function(columns, tr) {\n\n            if (!columns.length) {\n                return;\n            }\n\n            var ths = tr.find(\"th:not(.k-group-cell):not(.k-hierarchy-cell)\");\n            var id;\n            for (var i = 0; i < columns.length; i++) {\n                id = ths.eq(i).attr(\"id\");\n                if (id) {\n                    columns[i].headerAttributes = extend(columns[i].headerAttributes, { id: id });\n                }\n            }\n\n            this._updateColumnIDs(childColumns(columns), tr.next());\n        },\n\n        _headerCheckboxClick: function(e) {\n            var that = this,\n                checkBox = $(e.target),\n                checked = checkBox.prop(\"checked\");\n\n            if (!that._belongsToGrid(checkBox)) {\n                return;\n            }\n\n            if (checked) {\n                that.select(that.items());\n            } else {\n                that.clearSelection();\n            }\n        },\n\n        _checkboxClick: function(e) {\n            var that = this,\n                row = $(e.target).closest(\"tr\"),\n                isSelecting = !row.hasClass(SELECTED);\n\n            if (!that._belongsToGrid(row)) {\n                return;\n            }\n\n            if (isSelecting) {\n                that.select(row);\n                that.trigger(CHANGE);\n            } else {\n                that._deselectCheckRows(row);\n            }\n        },\n\n        _groups: function() {\n            var group = this.dataSource.group();\n\n            return group ? group.length : 0;\n        },\n\n        _tmpl: function(rowTemplate, columns, alt, skipGroupCells) {\n            var that = this,\n                settings = extend({}, kendo.Template, that.options.templateSettings),\n                paramName = settings.paramName,\n                idx,\n                length = columns.length,\n                template,\n                state = { storage: {}, count: 0 },\n                column,\n                type,\n                hasDetails = that._hasDetails(),\n                className = [],\n                groups = that._groups();\n\n            var fieldAttr = kendo.attr(\"field\");\n            var field;\n            var dirtyCellTemplate = \"\";\n            var classAttribute;\n\n            if (!rowTemplate) {\n                rowTemplate = \"<tr\";\n\n                if (alt) {\n                    className.push(\"k-alt\");\n                }\n\n                className.push(\"k-master-row\");\n\n                if (className.length) {\n                    rowTemplate += ' class=\"' + className.join(\" \") + '\"';\n                }\n\n                if (length) { // data item is an object\n                    rowTemplate += ' ' + kendo.attr(\"uid\") + '=\"#=' + kendo.expr(\"uid\", settings.paramName) + '#\"';\n                }\n\n                rowTemplate += \">\";\n\n                if (groups > 0 && !skipGroupCells) {\n                    rowTemplate += groupCells(groups);\n                }\n\n                if (hasDetails) {\n                    rowTemplate += '<td class=\"k-hierarchy-cell\" aria-expanded=\"false\"><a class=\"k-icon k-i-expand\" href=\"\\\\#\" ' + ARIALABEL + '=\"' + EXPAND + '\" tabindex=\"-1\"></a></td>';\n                }\n\n                for (idx = 0; idx < length; idx++) {\n                    column = columns[idx];\n                    template = column.template;\n                    type = typeof template;\n                    field = column.field;\n\n                    if (that._editMode() === INCELL && field) {\n                        column.attributes = column.attributes || {};\n\n                        if (that.virtualScroll) {\n                            column.attributes[fieldAttr] = field;\n                        }\n\n                        dirtyCellTemplate = that._dirtyCellTemplate(field, paramName);\n                        column.attributes[\"class\"] = (column.attributes[\"class\"] || \"\");\n\n                        if (column.attributes[\"class\"].indexOf(dirtyCellTemplate) < 0) {\n                            column.attributes[\"class\"] += dirtyCellTemplate;\n                        }\n                    }\n\n                    if (column.colSpan && column.colSpan > 0 && hasHiddenStyle(column.attributes)) { //virtual cell should be visible at all times\n                        column.attributes = removeHiddenStyle(column.attributes);\n                    } else if (!column.colSpan && column.hidden) {\n                        column.attributes = addHiddenStyle(column.attributes);\n                    }\n\n                    if (column.command) {\n                        column.attributes = column.attributes || {};\n                        classAttribute = column.attributes[\"class\"];\n\n                        if (typeof classAttribute !== \"undefined\") {\n                            if (classAttribute.indexOf(\"k-command-cell\") < 0) {\n                                column.attributes[\"class\"] += \" k-command-cell\";\n                            }\n                        } else {\n                            column.attributes[\"class\"] = \"k-command-cell\";\n                        }\n                    }\n\n                    if (column.draggable) {\n                        column.attributes = column.attributes || {};\n\n                        if (typeof column.attributes[\"class\"] !== \"undefined\") {\n                            column.attributes[\"class\"] += \" k-drag-cell k-touch-action-none\";\n                        } else {\n                            column.attributes[\"class\"] = \"k-drag-cell k-touch-action-none\";\n                        }\n\n                        if (typeof column.attributes[\"aria-label\"] === \"undefined\") {\n                            column.attributes[\"aria-label\"] = that.options.messages.dragHandleLabel;\n                        }\n\n                        if (typeof column.attributes.style !== \"undefined\") {\n                            column.attributes.style += \" cursor: move;\";\n                        } else {\n                            column.attributes.style = \"cursor: move;\";\n                        }\n                    }\n\n                    rowTemplate += \"<td\" + stringifyAttributes(column.attributes);\n\n                    if (column.colSpan) {\n                        if (column.colSpan > 1) {\n                            rowTemplate += \" \" + kendo.attr(\"virtual\");\n                        }\n                        rowTemplate += \" colSpan='\" + column.colSpan + \"'\";\n                    }\n\n                    rowTemplate += \">\";\n                    rowTemplate += that._cellTmpl(column, state);\n\n                    rowTemplate += \"</td>\";\n                }\n\n                rowTemplate += \"</tr>\";\n            }\n\n            rowTemplate = kendo.template(rowTemplate, settings);\n\n            if (state.count > 0) {\n                return rowTemplate.bind(state.storage);\n            }\n\n            return rowTemplate;\n        },\n\n        _dirtyCellTemplate: function(field, paramName) {\n            var dirtyField;\n\n            if (field && paramName) {\n                dirtyField = field.charAt(0) === \"[\" ? kendo.expr(field, paramName + \".dirtyFields\") : paramName + \".dirtyFields['\" + field + \"']\";\n\n                return \"#= \" + paramName + \" && \" + paramName + \".dirty && \" + paramName + \".dirtyFields && \" + dirtyField + \" ? ' k-dirty-cell' : '' #\";\n            }\n\n            return \"\";\n        },\n\n        _headerCellText: function(column) {\n            var that = this,\n                settings = extend({}, kendo.Template, that.options.templateSettings),\n                template = column.headerTemplate,\n                type = typeof(template),\n                text = column.title && (that.options.encodeTitles ? htmlEncode(column.title) : column.title) || column.field || \"\";\n\n            if (type === FUNCTION) {\n                text = kendo.template(template, settings)({});\n            } else if (type === STRING) {\n                text = template;\n            }\n            return text;\n        },\n\n        _cellTmpl: function(column, state) {\n            var that = this,\n                settings = extend({}, kendo.Template, that.options.templateSettings),\n                template = column.template,\n                paramName = settings.paramName,\n                field = column.field,\n                html = \"\",\n                idx,\n                length,\n                format = column.format,\n                type = typeof template,\n                columnValues = column.values;\n\n            if (column.command) {\n                if (isArray(column.command)) {\n                    for (idx = 0, length = column.command.length; idx < length; idx++) {\n                        if (column.command[idx].visible) {\n                            html += kendo.format(\"#= {0}(data)? '{1}':'' #\",column.command[idx].visible, that._createButton(column.command[idx]).replace(templateHashRegExp, \"\\\\#\").replace(/'/ig,\"\\\\'\"));\n                        } else {\n                            html += that._createButton(column.command[idx]).replace(templateHashRegExp, \"\\\\#\");\n                        }\n                    }\n                    return html;\n                }\n                return that._createButton(column.command).replace(templateHashRegExp, \"\\\\#\");\n            }\n\n            if (column.selectable) {\n                return SELECTCOLUMNTMPL;\n            }\n\n            if (column.draggable) {\n                return DRAGHANDLECOLUMNTMPL;\n            }\n\n            html += that._dirtyIndicatorTemplate(field, paramName);\n\n            if (type === FUNCTION) {\n                state.storage[\"tmpl\" + state.count] = template;\n                html += \"#=this.tmpl\" + state.count + \"(\" + paramName + \")#\";\n                state.count ++;\n            } else if (type === STRING) {\n                html += template;\n            } else if (columnValues && columnValues.length && isPlainObject(columnValues[0]) && \"value\" in columnValues[0] && field) {\n                html += \"#var v =\" + kendo.stringify(convertToObject(columnValues)).replace(templateHashRegExp, \"\\\\#\") + \"#\";\n                html += \"#var f = v[\";\n\n                if (!settings.useWithBlock) {\n                    html += paramName + \".\";\n                }\n\n                html += field + \"]#\";\n                html += \"${f != null ? f : ''}\";\n            } else {\n                html += column.encoded ? \"#:\" : \"#=\";\n\n                if (format) {\n                    html += 'kendo.format(\\\"' + format.replace(formatRegExp,\"\\\\$1\") + '\\\",';\n                }\n\n                if (field) {\n                    field = kendo.expr(field, paramName);\n                    html += field + \"==null?'':\" + field;\n                } else {\n                    html += \"''\";\n                }\n\n                if (format) {\n                    html += \")\";\n                }\n\n                html += \"#\";\n            }\n            return html;\n        },\n\n        _dirtyIndicatorTemplate: function(field, paramName) {\n            var dirtyField;\n\n            if (field && paramName) {\n                dirtyField = field.charAt(0) === \"[\" ? kendo.expr(field, paramName + \".dirtyFields\") : paramName + \".dirtyFields['\" + field + \"']\";\n\n                return \"#= \" + paramName + \" && \" + paramName + \".dirty && \" + paramName + \".dirtyFields && \" + dirtyField +\n                    \" ? '<span class=\\\"k-dirty\\\"></span>' : '' #\";\n            }\n\n            return \"\";\n        },\n\n        _virtualCols: function(columns) {\n            var that = this;\n            var widths = $.map(columns, function(c) { return c.hidden ? 0 : parseInt(c.width, 10); });\n            var scrollLeft = that.virtualScrollable ? kendo.scrollLeft(that.content.find(\">.k-virtual-scrollable-wrap\")) : kendo.scrollLeft(that.content);\n            var tableWidth = outerWidth(that.content);\n            var sumOfWidths = sumWidths(columns);\n            var colsToRender = [];\n            var firstColspan = 0;\n            var lastColspan = 0;\n            var hiddenColumns = 0;\n            var idx = 0;\n            var widthOfHiddenColumns = 0;\n            var considerNext;\n\n            for (idx = 0; idx < columns.length; idx++) {\n                considerNext = (idx < widths.length - 1) ? widths[idx + 1] : 0;\n                if (widthOfHiddenColumns + widths[idx] + 2 * considerNext < scrollLeft) {\n                    if (widths[idx]) {\n                        hiddenColumns++;\n                    }\n                    widthOfHiddenColumns += widths[idx];\n                } else {\n                    firstColspan = 1 + hiddenColumns;\n                    break;\n                }\n            }\n\n            hiddenColumns = 0;\n            widthOfHiddenColumns = 0;\n\n            for (var i = columns.length - 1; i >= 0; i--) {\n                if (widthOfHiddenColumns + 3 * widths[i] < sumOfWidths - tableWidth - scrollLeft) {\n                    if (widths[i]) {\n                        hiddenColumns++;\n                    }\n                    widthOfHiddenColumns += widths[i];\n                } else {\n                    lastColspan = 1 + hiddenColumns;\n                    for (var j = idx; j <= i; j++) {\n                        if (columns[j].locked) {\n                            continue;\n                        }\n                        colsToRender.push(columns[j]);\n                        if (columns[j].colSpan) {\n                            delete columns[j].colSpan;\n                        }\n                    }\n                    colsToRender[0].colSpan = firstColspan;\n                    colsToRender[colsToRender.length - 1].colSpan = lastColspan;\n                    break;\n                }\n            }\n\n            if (colsToRender[0].hidden) {\n                colsToRender[0].colSpan--;\n            }\n\n            that.virtualCols = colsToRender;\n\n            return colsToRender;\n        },\n\n        _templates: function() {\n            var that = this,\n                options = that.options,\n                dataSource = that.dataSource,\n                groups = dataSource.group(),\n                footer = that.footer || that.wrapper.find(\".k-grid-footer\"),\n                aggregates = dataSource.aggregate(),\n                columnLeafs = leafColumns(that.columns),\n                columnsLocked = leafColumns(lockedColumns(that.columns)),\n                leafsCols = options.scrollable ? leafColumns(nonLockedColumns(that.columns)) : columnLeafs,\n                columns = (that.virtualScroll || {}).columns ? that._virtualCols(leafsCols) : leafsCols,\n                groupHeaderColumnTemplateLockedColumns = grep(visibleColumns(columnsLocked), function(column, index) { return column.groupHeaderColumnTemplate && index !== 0; }),\n                groupHeaderColumnTemplateNonLockedColumns = grep(visibleColumns(columns), function(column) { return column.groupHeaderColumnTemplate; });\n\n            if (options.scrollable && columnsLocked.length) {\n                if (options.rowTemplate || options.altRowTemplate) {\n                    throw new Error(\"Having both row template and locked columns is not supported\");\n                }\n\n                that.rowTemplate = that._tmpl(options.rowTemplate, columns, false, true);\n                that.altRowTemplate = that._tmpl(options.altRowTemplate || options.rowTemplate, columns, true, true);\n\n                that.lockedRowTemplate = that._tmpl(options.rowTemplate, columnsLocked);\n                that.lockedAltRowTemplate = that._tmpl(options.altRowTemplate || options.rowTemplate, columnsLocked, true);\n            } else {\n                that.rowTemplate = that._tmpl(options.rowTemplate, columns);\n                that.altRowTemplate = that._tmpl(options.altRowTemplate || options.rowTemplate, columns, true);\n            }\n\n            if (that._hasDetails()) {\n                that.detailTemplate = that._detailTmpl(options.detailTemplate || \"\");\n            }\n\n            if ((that._group && !isEmptyObject(aggregates)) || (!isEmptyObject(aggregates) && !footer.length) ||\n                grep(columnLeafs, function(column) { return column.footerTemplate; }).length) {\n\n                that.footerTemplate = that._footerTmpl(columnLeafs, aggregates, \"footerTemplate\", \"k-footer-template\");\n            }\n\n            if (groups && grep(columnLeafs, function(column) { return column.groupFooterTemplate; }).length) {\n                aggregates = $.map(groups, function(g) { return g.aggregates; });\n\n                that.groupFooterTemplate = that._footerTmpl(columns, aggregates, \"groupFooterTemplate\", \"k-group-footer\", columnsLocked.length);\n\n                if (options.scrollable && columnsLocked.length) {\n                    that.lockedGroupFooterTemplate = that._footerTmpl(columnsLocked, aggregates, \"groupFooterTemplate\", \"k-group-footer\");\n                }\n            }\n\n            if (groups && (groupHeaderColumnTemplateLockedColumns.length || groupHeaderColumnTemplateNonLockedColumns.length)) {\n                aggregates = $.map(groups, function(g) { return g.aggregates; });\n\n                that.groupHeaderColumnTemplate = that._groupHeaderTmpl(visibleColumns(columns), aggregates, \"groupHeaderColumnTemplate\", \"k-grouping-row\", columnsLocked.length, groupHeaderColumnTemplateNonLockedColumns);\n\n                if (options.scrollable && columnsLocked.length) {\n                    that.lockedGroupHeaderColumnTemplate = that._groupHeaderTmpl(visibleColumns(columnsLocked), aggregates, \"groupHeaderColumnTemplate\", \"k-grouping-row\", 0, groupHeaderColumnTemplateLockedColumns);\n                }\n            } else {\n                that.groupHeaderColumnTemplate = null;\n                that.lockedGroupHeaderColumnTemplate = null;\n            }\n\n                if (that.options.noRecords) {\n                that.noRecordsTemplate = that._noRecordsTmpl();\n            }\n        },\n\n        _noRecordsTmpl: function() {\n            var wrapper = '<div class=\"{0}\">{1}</div>';\n            var defaultTemplate = '<div class=\"k-grid-norecords-template\"{1}>{0}</div>';\n            var scrollableNoGridHeightStyles = (this.options.scrollable && !this.wrapper[0].style.height) ? ' style=\"margin:0 auto;position:static;\"' : '';\n            var state = { storage: {}, count: 0 };\n            var settings = $.extend({}, kendo.Template, this.options.templateSettings);\n            var paramName = settings.paramName;\n            var template;\n            var html = \"\";\n            var type;\n            var tmpl;\n\n            if (this.options.noRecords.template) {\n                template = this.options.noRecords.template;\n            } else {\n                template = kendo.format(defaultTemplate, this.options.messages.noRecords, scrollableNoGridHeightStyles);\n            }\n\n            type = typeof template;\n            if (type === \"function\") {\n                state.storage[\"tmpl\" + state.count] = template;\n                html += \"#=this.tmpl\" + state.count + \"(\" + paramName + \")#\";\n                state.count ++;\n            } else if (type === \"string\") {\n                html += template;\n            }\n\n            tmpl = kendo.template(kendo.format(wrapper, NORECORDSCLASS, html), settings);\n\n            if (state.count > 0) {\n                tmpl = tmpl.bind(state.storage);\n            }\n\n            return tmpl;\n        },\n\n        _footerTmpl: function(columns, aggregates, templateName, rowClass, skipGroupCells) {\n            var that = this,\n                settings = extend({}, kendo.Template, that.options.templateSettings),\n                paramName = settings.paramName,\n                html = \"\",\n                idx,\n                length,\n                template,\n                type,\n                storage = {},\n                count = 0,\n                scope = {},\n                groups = that._groups(),\n                fieldsMap = that.dataSource._emptyAggregates(aggregates),\n                column;\n\n            html += '<tr class=\"' + rowClass + '\">';\n\n            if (groups > 0 && !skipGroupCells) {\n                html += groupCells(groups);\n            }\n\n            if (that._hasDetails()) {\n                html += '<td class=\"k-hierarchy-cell\">&nbsp;</td>';\n            }\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n                template = column[templateName];\n                type = typeof template;\n\n                html += \"<td\" + stringifyAttributes(column.footerAttributes) + \">\";\n\n                if (template) {\n                    if (type !== FUNCTION) {\n                        scope = fieldsMap[column.field] ? extend({}, settings, { paramName: paramName + \"['\" + column.field + \"']\" }) : {};\n                        template = kendo.template(template, scope);\n                    }\n\n                    storage[\"tmpl\" + count] = template;\n                    html += \"#=this.tmpl\" + count + \"(\" + paramName + \")#\";\n                    count ++;\n                } else {\n                    html += \"&nbsp;\";\n                }\n\n                html += \"</td>\";\n            }\n\n            html += '</tr>';\n\n            html = kendo.template(html, settings);\n\n            if (count > 0) {\n                return html.bind(storage);\n            }\n\n            return html;\n        },\n\n        _groupHeaderTmpl: function(columns, aggregates, templateName, rowClass, skipGroupCells, groupHeaderColumnTemplateColumns) {\n            var that = this,\n                settings = extend({}, kendo.Template, that.options.templateSettings),\n                paramName = settings.paramName,\n                html = \"\",\n                idx,\n                length,\n                template,\n                type,\n                storage = {},\n                count = 0,\n                scope = {},\n                fieldsMap = that.dataSource._emptyAggregates(aggregates),\n                column,\n                headerTemplateIndex = groupHeaderColumnTemplateColumns.length ? inArray(groupHeaderColumnTemplateColumns[0], columns) : -1,\n                groupHeaderColumnTemplateClass;\n\n            html += '<tr class=\"' + rowClass + '\">';\n\n            if (!skipGroupCells) {\n                html += '# for (var i = 0; i < data.groupCells; i++) { #' +\n                '<td class=\"k-group-cell\">' +\n                  '&nbsp;' +\n                '</td>' +\n                '# } #';\n            }\n\n            if (that._hasDetails()) {\n                html += '<td class=\"k-hierarchy-cell\">&nbsp;</td>';\n            }\n\n            if (headerTemplateIndex < 0) {\n                html += !skipGroupCells ? groupCellBuilder(columns.length) : '';\n                return;\n            }\n\n            if (headerTemplateIndex < MINCOLSPANVALUE && groupHeaderColumnTemplateColumns.length <= 1 && !skipGroupCells) {\n                html += !skipGroupCells ? groupCellBuilder(columns.length) : '';\n                return kendo.template(html, settings);\n            }\n\n            if (headerTemplateIndex < MINCOLSPANVALUE) {\n                headerTemplateIndex = !skipGroupCells ? 1 : 0;\n                html += !skipGroupCells ? groupCellBuilder(headerTemplateIndex) : '';\n            }\n            else {\n                html += !skipGroupCells ? groupCellBuilder(headerTemplateIndex) : groupCellLockedContentBuilder(headerTemplateIndex);\n            }\n\n            for (idx = headerTemplateIndex, length = columns.length; idx < length; idx++) {\n                column = columns[idx];\n                template = column[templateName];\n                type = typeof template;\n\n                if (column.sticky) {\n                    groupHeaderColumnTemplateClass = (column.groupHeaderColumnTemplateClass || '');\n\n                    if (!groupHeaderColumnTemplateClass) {\n                        groupHeaderColumnTemplateClass = column.groupHeaderColumnTemplateClass = \"group-header-column-template-\" + kendo.guid();\n                    }\n\n                    html += \"<td class='\" + STICKY_CELL_CLASS + \" \" + groupHeaderColumnTemplateClass + \"' style='\" + (column.stickyStyle || '') + \"'>\";\n                } else {\n                    html += \"<td>\";\n                }\n\n                if (template) {\n                    if (type !== FUNCTION) {\n                        scope = fieldsMap[column.field] ? extend({}, settings, { paramName: paramName + \"['\" + column.field + \"']\" }) : {};\n                        template = kendo.template(template, scope);\n                    }\n\n                    storage[\"tmpl\" + count] = template;\n                    html += \"#=this.tmpl\" + count + \"(\" + paramName + \")#\";\n                    count ++;\n                } else {\n                    html += \"&nbsp;\";\n                }\n\n                html += \"</td>\";\n            }\n\n            html += '</tr>';\n\n            html = kendo.template(html, settings);\n\n            if (count > 0) {\n                return html.bind(storage);\n            }\n\n            return html;\n        },\n\n        _detailTmpl: function(template) {\n            var that = this,\n                html = \"\",\n                settings = extend({}, kendo.Template, that.options.templateSettings),\n                paramName = settings.paramName,\n                templateFunctionStorage = {},\n                templateFunctionCount = 0,\n                groups = that._groups(),\n                colspan = visibleColumns(leafColumns(that.columns)).length,\n                type = typeof template;\n\n            html += '<tr role=\"row\" class=\"k-detail-row\">';\n            if (groups > 0) {\n                html += groupCells(groups);\n            }\n            html += '<td role=\"gridcell\" class=\"k-hierarchy-cell\"></td><td role=\"gridcell\" class=\"k-detail-cell\"' + (colspan ? ' colspan=\"' + colspan + '\"' : '') + \">\";\n\n            if (type === FUNCTION) {\n                templateFunctionStorage[\"tmpl\" + templateFunctionCount] = template;\n                html += \"#=this.tmpl\" + templateFunctionCount + \"(\" + paramName + \")#\";\n                templateFunctionCount ++;\n            } else {\n                html += template;\n            }\n\n            html += \"</td></tr>\";\n\n            html = kendo.template(html, settings);\n\n            if (templateFunctionCount > 0) {\n                return html.bind(templateFunctionStorage);\n            }\n\n            return html;\n        },\n\n        _hasDetails: function() {\n            var that = this;\n\n            return that.options.detailTemplate !== null || (that._events[DETAILINIT] || []).length;\n        },\n        _hasFilterRow: function() {\n            var filterable = this.options.filterable;\n            var hasFiltering = filterable &&\n                    typeof filterable.mode == STRING &&\n                    filterable.mode.indexOf(\"row\") != -1;\n            var columns = this.columns;\n            var columnsWithoutFiltering = $.grep(columns, function(col) {\n                return col.filterable === false;\n            });\n\n            if (columns.length && columnsWithoutFiltering.length == columns.length) {\n                hasFiltering = false;\n            }\n\n            return hasFiltering;\n        },\n\n        _details: function() {\n            var that = this;\n\n            if (that.options.scrollable && that._hasDetails() && lockedColumns(that.columns).length) {\n                throw new Error(\"Having both detail template and locked columns is not supported\");\n            }\n\n            that.table.on(CLICK + NS, \".k-hierarchy-cell .k-i-expand, .k-hierarchy-cell .k-i-collapse\", function(e) {\n                var button = $(this);\n\n                that._toggleDetails(button);\n                e.preventDefault();\n                return false;\n            });\n        },\n\n        _toggleDetails: function(button, omitAnimation) {\n            var that = this,\n            cell = button.closest(\"td.k-hierarchy-cell\"),\n            expanding = button.hasClass(\"k-i-expand\"),\n            masterRow = button.closest(\"tr.k-master-row\"),\n            masterRowIndex = masterRow.attr(\"aria-rowindex\"),\n            detailRow,\n            detailTemplate = that.detailTemplate,\n            data,\n            hasDetails = that._hasDetails(),\n            ariaLabelText = expanding ? COLLAPSE : EXPAND,\n            ariaExpandText = expanding ? true : false;\n\n            button.toggleClass(\"k-i-expand\", !expanding)\n                .toggleClass(\"k-i-collapse\", expanding)\n                .attr(ARIALABEL, ariaLabelText);\n\n            cell.attr(\"aria-expanded\", ariaExpandText);\n\n            detailRow = masterRow.next();\n\n            if (hasDetails && !detailRow.hasClass(\"k-detail-row\")) {\n                data = that.dataItem(masterRow);\n\n                detailRow = $(detailTemplate(data))\n                    .addClass(masterRow.hasClass(\"k-alt\") ? \"k-alt\" : \"\")\n                    .insertAfter(masterRow);\n\n                if (masterRowIndex || masterRowIndex === 0) {\n                    detailRow.attr(\"aria-rowindex\", Number(masterRowIndex) + 1);\n                }\n\n                that.angular(\"compile\", function() {\n                    return {\n                        elements: detailRow.get(),\n                        data: [ { dataItem: data } ]\n                    };\n                });\n\n                that.trigger(DETAILINIT, { masterRow: masterRow, detailRow: detailRow, data: data, detailCell: detailRow.find(\".k-detail-cell\") });\n            }\n\n            that.trigger(expanding ? DETAILEXPAND : DETAILCOLLAPSE, { masterRow: masterRow, detailRow: detailRow });\n\n            if (omitAnimation) {\n                toggleRow(detailRow, expanding);\n            } else {\n                detailRow.toggle(expanding);\n            }\n        },\n\n        dataItem: function(tr) {\n            tr = $(tr)[0];\n            if (!tr) {\n                return null;\n            }\n\n            var rows = this.tbody.children(),\n                classesRegEx = /k-grouping-row|k-detail-row|k-group-footer/,\n                idx = tr.sectionRowIndex,\n                j, correctIdx;\n\n            correctIdx = idx;\n\n            for (j = 0; j < idx; j++) {\n                if (classesRegEx.test(rows[j].className)) {\n                    correctIdx--;\n                }\n            }\n\n            return this._data[correctIdx];\n        },\n\n        expandRow: function(tr, omitAnimation) {\n            var button = $(tr).find('> td .k-i-expand');\n\n            if (button.length) {\n                this._toggleDetails(button, omitAnimation);\n            }\n        },\n\n        collapseRow: function(tr, omitAnimation) {\n            var button = $(tr).find('> td .k-i-collapse');\n\n            if (button.length) {\n                this._toggleDetails(button, omitAnimation);\n            }\n        },\n\n        _createHeaderCells: function(columns, rowSpan) {\n            var that = this,\n                idx,\n                th,\n                text,\n                html = \"\",\n                length,\n                title,\n                columnMenu = that.options.columnMenu,\n                sortable = that.options.sortable,\n                filterable = that._hasFilterMenu(),\n                messages = that.options.messages,\n                leafs = leafColumns(that.columns),\n                groups = that.dataSource.group(),\n                field;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                th = columns[idx].column || columns[idx];\n                text = that._headerCellText(th);\n                title = th.title;\n                field = \"\";\n\n                var index = inArray(th, leafs);\n\n                if (th.selectable) {\n                    html += \"<th scope='col'\" + stringifyAttributes(th.headerAttributes);\n\n                    if (rowSpan && !columns[idx].colSpan) {\n                        html += \" rowspan='\" + rowSpan + \"'\";\n                    }\n\n                    if (index > -1) {\n                        html += kendo.attr(\"index\") + \"='\" + index + \"'\";\n                    }\n                    text = th.headerTemplate ? text : kendo.template(SELECTCOLUMNHEADERTMPL)({});\n                    html += \">\" + text + \"</th>\";\n                } else if (th.draggable) {\n                    html += \"<th class='k-header k-drag-cell' scope='col'\" + stringifyAttributes(th.headerAttributes);\n\n                    if (rowSpan && !columns[idx].colSpan) {\n                        html += \" rowspan='\" + rowSpan + \"'\";\n                    }\n\n                    if (index > -1) {\n                        html += kendo.attr(\"index\") + \"='\" + index + \"'\";\n                    }\n                    text = th.headerTemplate ? text : \"\";\n                    html += \">\" + text + \"</th>\";\n                } else if (th.command) {\n                    html += \"<th scope='col'\" + stringifyAttributes(th.headerAttributes);\n\n                    if (rowSpan && !columns[idx].colSpan) {\n                        html += \" rowspan='\" + rowSpan + \"'\";\n                    }\n\n                    if (index > -1) {\n                        html += kendo.attr(\"index\") + \"='\" + index + \"'\";\n                    }\n\n                    html += \">\" + text + \"</th>\";\n                } else {\n                    if (th.field) {\n                        field = kendo.attr(\"field\") + \"='\" + th.field + \"' \";\n                    }\n\n                    html += \"<th scope='col' \" + field;\n                    if ((columnMenu && th.field && th.menu !== false)) {\n                        html += \" aria-haspopup='menu'\";\n                    } else if (filterable && th.filterable !== false && !th.command) {\n                        html += \" aria-haspopup='dialog'\";\n                    }\n\n                    if (rowSpan && !columns[idx].colSpan) {\n                        html += \" rowspan='\" + rowSpan + \"'\";\n                    }\n\n                    if (columns[idx].colSpan > 1) {\n                        html += 'colspan=\"' + (columns[idx].colSpan - hiddenLeafColumnsCount(th.columns)) + '\" ';\n                        html += kendo.attr(\"colspan\") + \"='\" + columns[idx].colSpan + \"'\";\n                    } else if (columns[idx].colSpan === 1) {\n                        html += kendo.attr(\"colspan\") + \"='\" + columns[idx].colSpan + \"'\";\n                    }\n\n                    if (title) {\n                        title = title && (that.options.encodeTitles ? htmlEncode(title, true) : title);\n                        html += kendo.attr(\"title\") + '=\"' + title + '\" ';\n                    }\n\n                    if (th.groupable !== undefined) {\n                        html += kendo.attr(\"groupable\") + \"='\" + th.groupable + \"' \";\n                    }\n\n                    if (isColumnGroupable(that, th)) {\n                        html += \"title='\";\n                        html += isGroupedBy(groups, th.field) ? messages.ungroupHeader : messages.groupHeader;\n                        html += \"' \";\n                    }\n\n                    if (th.aggregates && th.aggregates.length) {\n                        html += kendo.attr(\"aggregates\") + \"='\" + th.aggregates + \"'\";\n                    }\n\n                    if (index > -1) {\n                        html += kendo.attr(\"index\") + \"='\" + index + \"'\";\n                    }\n\n                    html += stringifyAttributes(th.headerAttributes);\n\n                    if (sortable) {\n                        text = kendo.template(SORTHEADERTMPL)({ text: text });\n                    }\n\n                    html += \">\" + text + \"</th>\";\n                }\n            }\n            return html;\n        },\n\n        _appendLockedColumnContent: function() {\n            var columns = this.columns,\n                idx,\n                colgroup = this.table.find(\"colgroup\"),\n                cols = colgroup.find(COLGROUP),\n                length,\n                lockedCols = $(),\n                skipHiddenCount = 0,\n                container,\n                colSpan,\n                spanIdx,\n                colOffset = 0;\n\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                if (columns[idx].locked) {\n\n                    if (isVisible(columns[idx])) {\n                        colSpan = 1;\n\n                        if (columns[idx].columns) {\n                            colSpan = leafColumns(columns[idx].columns).length - hiddenLeafColumnsCount(columns[idx].columns);\n                        }\n\n                        colSpan = colSpan || 1;\n                        for (spanIdx = 0; spanIdx < colSpan; spanIdx++) {\n                            lockedCols = lockedCols.add(cols.eq(idx + colOffset + spanIdx - skipHiddenCount));\n                        }\n                        colOffset += colSpan - 1;\n                    } else {\n                        skipHiddenCount ++;\n                    }\n                }\n            }\n\n            container = $('<div class=\"k-grid-content-locked\"><table><colgroup></colgroup><tbody></tbody></table></div>');\n            // detach is required for IE8, otherwise it switches to compatibility mode\n            colgroup.detach();\n            container.find(\"colgroup\").append(lockedCols);\n            colgroup.insertBefore(this.table.find(\"tbody\"));\n\n            this.lockedContent = container.insertBefore(this.content);\n            this.lockedTable = container.children(\"table\");\n        },\n\n        _appendLockedColumnFooter: function() {\n            var that = this;\n            var footer = that.footer;\n            var cells = footer.find(\".k-footer-template>td\");\n            var cols = footer.find(\".k-grid-footer-wrap>table>colgroup>col\");\n            var html = $('<div class=\"k-grid-footer-locked\"><table><colgroup></colgroup><tfoot><tr class=\"k-footer-template\"></tr></tfoot></table></div>');\n            var idx, length;\n            var groups = that._groups();\n            var lockedCells = $(), lockedCols = $();\n\n            lockedCells = lockedCells.add(cells.filter(\".k-group-cell\"));\n            for (idx = 0, length = leafColumns(lockedColumns(that.columns)).length; idx < length; idx++) {\n                lockedCells = lockedCells.add(cells.eq(idx + groups));\n            }\n\n            lockedCols = lockedCols.add(cols.filter(\".k-group-col\"));\n            for (idx = 0, length = visibleColumns(leafColumns(visibleLockedColumns(that.columns))).length; idx < length; idx++) {\n                lockedCols = lockedCols.add(cols.eq(idx + groups));\n            }\n\n            lockedCells.appendTo(html.find(\"tr\"));\n            lockedCols.appendTo(html.find(\"colgroup\"));\n            that.lockedFooter = html.prependTo(footer);\n        },\n\n        _appendLockedColumnHeader: function(container) {\n            var that = this,\n                columns = this.columns,\n                idx,\n                html,\n                length,\n                colgroup,\n                tr,\n                trFilter,\n                table,\n                header,\n                filtercellCells,\n                rows = [],\n                skipHiddenCount = 0,\n                cols = $(),\n                hasFilterRow = that._hasFilterRow(),\n                filterCellOffset = 0,\n                filterCells = $(),\n                cell,\n                leafColumnsCount = 0,\n                cells = $();\n\n            colgroup = that.thead.prev().find(COLGROUP);\n            header = that.thead.find(\"tr\").first().find(\".k-header:not(.k-group-cell,.k-hierarchy-cell)\");\n            filtercellCells = that.thead.find(\".k-filter-row\").find(\"td:not(.k-group-cell,.k-hierarchy-cell)\");\n\n            var colOffset = 0;\n            for (idx = 0, length = columns.length; idx < length; idx++) {\n                if (columns[idx].locked) {\n                    cell = header.eq(idx);\n                    leafColumnsCount = leafColumns(columns[idx].columns || []).length;\n\n                    if (isVisible(columns[idx])) {\n                        var colSpan = null;\n\n                        if (columns[idx].columns) {\n                            colSpan = leafColumnsCount - hiddenLeafColumnsCount(columns[idx].columns);\n                        }\n\n                        colSpan = colSpan || 1;\n                        for (var spanIdx = 0; spanIdx < colSpan; spanIdx++) {\n                            cols = cols.add(colgroup.eq(idx + colOffset + spanIdx - skipHiddenCount));\n                        }\n                        colOffset += colSpan - 1;\n                    }\n\n                    mapColumnToCellRows([columns[idx]], childColumnsCells(cell), rows, 0, 0);\n\n                    leafColumnsCount = leafColumnsCount || 1;\n                    for (var j = 0; j < leafColumnsCount; j++) {\n                        filterCells = filterCells.add(filtercellCells.eq(filterCellOffset + j));\n                    }\n                    filterCellOffset += leafColumnsCount;\n                }\n\n                if (columns[idx].columns) {\n                    skipHiddenCount += hiddenLeafColumnsCount(columns[idx].columns);\n                }\n\n                if (!isVisible(columns[idx])) {\n                    skipHiddenCount++;\n                }\n            }\n\n            if (rows.length) {\n                html = '<div class=\"k-grid-header-locked\" style=\"width:1px\"><table><colgroup></colgroup><thead>';\n                html += new Array(rows.length + 1).join(\"<tr></tr>\");\n                html += (hasFilterRow ? '<tr class=\"k-filter-row\"></tr>' : '') + '</thead></table></div>';\n\n                table = $(html);\n\n                colgroup = table.find(\"colgroup\");\n                colgroup.append(that.thead.prev().find(\"col.k-group-col\").add(cols));\n\n                tr = table.find(\"thead tr:not(.k-filter-row)\");\n                for (idx = 0, length = rows.length; idx < length; idx++) {\n                    cells = toJQuery(rows[idx]);\n                    tr.eq(idx).append(that.thead.find(\"tr\").eq(idx).find(\".k-group-cell\").add(cells));\n                }\n\n                var count = removeEmptyRows(this.thead);\n                if (rows.length < count) {\n                    removeRowSpanValue(table, count - rows.length);\n                }\n\n                trFilter = table.find(\".k-filter-row\");\n                trFilter.append(that.thead.find(\".k-filter-row .k-group-cell\").add(filterCells));\n\n                this.lockedHeader = table.prependTo(container);\n                this.thead.find(\".k-group-cell\").remove();\n\n                return true;\n            }\n            return false;\n        },\n\n        _removeLockedContainers: function() {\n            var elements = this.lockedHeader\n                .add(this.lockedContent)\n                .add(this.lockedFooter);\n\n            kendo.destroy(elements);\n            elements.off(NS).remove();\n\n            this.lockedHeader = this.lockedContent = this.lockedFooter = null;\n            this.selectable = null;\n        },\n\n        _thead: function() {\n            var that = this,\n                columns = that.columns,\n                hasDetails = that._hasDetails() && columns.length,\n                hasFilterRow = that._hasFilterRow(),\n                idx,\n                html = \"\",\n                thead = that.table.find(\">thead\"),\n                hasTHead = that.element.find(\"thead\").first().length > 0,\n                headerContent = that.options.messages.expandCollapseColumnHeader,\n                tr;\n\n            if (!thead.length) {\n                thead = $(\"<thead role='rowgroup'/>\").insertBefore(that.tbody);\n            }\n\n            if (that.lockedHeader && that.thead) {\n                tr = that.thead.find(\"tr:has(th):not(.k-filter-row)\").html(\"\");\n                tr.remove();\n                tr = $();\n\n                that._removeLockedContainers();\n            } else if (hasTHead) {\n                tr = that.element.find(\"thead\").first().find(\"tr:has(th):not(.k-filter-row)\");\n            } else {\n                tr = that.element.find(\"tr:has(th)\").first();\n            }\n\n            if (!tr.length) {\n                tr = thead.children().first();\n                if (!tr.length) {\n                   var rows = [{ rowSpan: 1, cells: [], index: 0 }];\n                   that._prepareColumns(rows, columns);\n\n                   for (idx = 0; idx < rows.length; idx++) {\n                       html += \"<tr>\";\n                       if (hasDetails) {\n                           html += '<th class=\"k-hierarchy-cell\" scope=\"col\">' + headerContent + '</th>';\n                       }\n                       html += that._createHeaderCells(rows[idx].cells, rows[idx].rowSpan);\n                       html += \"</tr>\";\n                   }\n\n                   tr = $(html);\n                }\n            } else {\n                for (idx = 0; idx < columns.length; idx++) {\n\t\t\t\t\tvar columnIndex = inArray(columns[idx], leafColumns(columns));\n\t\t\t\t\tvar cell = leafDataCells(tr.parent()).filter(\"th:not(.k-group-cell):not(.k-hierarchy-cell)\").eq(columnIndex);\n\t\t\t\t\tif (columns[idx].hidden && columnIndex >= 0) {\n\t\t\t\t\t\tcell[0].style.display = \"none\";\n\t\t\t\t\t}\n               }\n\n               that._updateHeadersAttr(childColumns(columns));\n\t\t\t}\n\n            if (hasFilterRow) {\n                var filterRow = $(\"<tr/>\");\n                filterRow.addClass(\"k-filter-row\");\n                if (hasDetails || tr.find(\".k-hierarchy-cell\").length) { // handles server side detail template\n                    filterRow.prepend('<td class=\"k-hierarchy-cell\">&nbsp;</td>');\n                }\n\n                var existingFilterRow = (that.thead || thead).find(\".k-filter-row\");\n                if (existingFilterRow.length) {\n                    kendo.destroy(existingFilterRow);\n                    existingFilterRow.remove();\n                }\n\n                thead.append(filterRow);\n            }\n\n            if (!tr.children().length) {\n                html = \"\";\n                if (hasDetails) {\n                    html += '<th class=\"k-hierarchy-cell\" scope=\"col\">&nbsp;</th>';\n                }\n\n                html += that._createHeaderCells(columns);\n\n                tr.html(html);\n            } else if (hasDetails && !tr.find(\".k-hierarchy-cell\")[0]) {\n                tr.prepend('<th class=\"k-hierarchy-cell\" scope=\"col\">' + (headerContent ? headerContent : '&nbsp;') + '</th>');\n            }\n\n            tr.find(\"th\").addClass(\"k-header\");\n\n            if (!that.options.scrollable) {\n                thead.addClass(\"k-grid-header\");\n            }\n\n            tr.find(\"script\").remove().end().prependTo(thead);\n\n            if (that.thead) {\n                that._destroyColumnAttachments();\n            }\n\n            this.angular(\"cleanup\", function() {\n                return {\n                    elements: thead.find(\"th\" + NAVCELL).get()\n                };\n            });\n\n            this.angular(\"compile\", function() {\n                return {\n                    elements: thead.find(HEADERCELLS).get(),\n                    data: map(columns, function(col) { return { column: col }; })\n                };\n            });\n\n            that.thead = thead;\n\n            that._sortable();\n\n            that._filterable();\n\n            that._filterRow();\n\n            that._scrollable();\n\n            that._columnMenu();\n\n            var syncHeight;\n            var hasLockedColumns = this.options.scrollable && lockedColumns(this.columns).length;\n\n            if (hasLockedColumns) {\n\n                syncHeight = that._appendLockedColumnHeader(that.thead.closest(\".k-grid-header\"));\n\n                that._appendLockedColumnContent();\n\n                that.lockedContent.on(\"DOMMouseScroll\" + NS + \" mousewheel\" + NS, that._wheelScroll.bind(that));\n\n                if (kendo.support.touch) {\n                    that._lockedContentUserEvents = new kendo.UserEvents(that.lockedContent, {\n                        move: function(e) {\n                            that.content.scrollTop(that.content.scrollTop() + (-e.y.delta));\n                            e.preventDefault();\n                        }\n                    });\n                }\n\n                that._updateLockedCols();\n            }\n\n            that._updateCols();\n\n            that._updateColumnCellIndex();\n\n            that._updateFirstColumnClass();\n\n            that._resizable();\n\n            that._draggable();\n\n            that._reorderable();\n\n            that._updateHeader(that._groups());\n\n            that._updateStickyColumns();\n\n            if (hasLockedColumns) {\n                if (syncHeight) {\n                    that._syncLockedHeaderHeight();\n                }\n\n                that._applyLockedContainersWidth();\n            }\n\n            if (that.groupable) {\n                that._attachGroupable();\n            }\n        },\n\n        _retrieveFirstColumn: function(columns, rows) {\n            var result = $();\n\n            if (rows.length && columns[0]) {\n                var column = columns[0];\n\n                while (column.columns && column.columns.length) {\n                    column = column.columns[0];\n                    rows = rows.filter(\":not(:first)\");\n                }\n\n                result = result.add(rows);\n            }\n\n            return result;\n        },\n\n        _updateFirstColumnClass: function() {\n            var that = this,\n                columns = that.columns || [],\n                hasDetails = that._hasDetails() && columns.length;\n\n            if (!hasDetails && !that._groups()) {\n                var tr = that.thead.find(\">tr:not(.k-filter-row):not(:first)\");\n                columns = nonLockedColumns(columns);\n\n                var rows = that._retrieveFirstColumn(columns, tr);\n\n                if (that._isLocked()) {\n                    tr = that.lockedHeader.find(\"thead>tr:not(.k-filter-row):not(:first)\");\n                    columns = lockedColumns(that.columns);\n\n                    rows = rows.add(that._retrieveFirstColumn(columns, tr));\n                }\n\n                rows.each(function() {\n                    var ths = $(this).find(\"th\");\n                    ths.removeClass(\"k-first\");\n                    ths.eq(0).addClass(\"k-first\");\n                });\n            }\n        },\n\n        _prepareColumns: function(rows, columns, parentCell, parentRow) {\n            var row = parentRow || rows[rows.length - 1];\n\n            var childRow = rows[row.index + 1];\n            var totalColSpan = 0;\n\n            for (var idx = 0; idx < columns.length; idx++) {\n                var cell = { column: columns[idx], colSpan: 0 };\n                row.cells.push(cell);\n\n                if (columns[idx].columns && columns[idx].columns.length) {\n                    if (!childRow) {\n                        childRow = { rowSpan: 0, cells: [], index: rows.length };\n                        rows.push(childRow);\n                    }\n                    cell.colSpan = columns[idx].columns.length;\n                    this._prepareColumns(rows, columns[idx].columns, cell, childRow);\n                    totalColSpan += cell.colSpan - 1;\n                    row.rowSpan = rows.length - row.index;\n                }\n            }\n            if (parentCell) {\n                parentCell.colSpan += totalColSpan;\n            }\n        },\n\n        _wheelScroll: function(e) {\n            if (e.ctrlKey) {\n                return;\n            }\n\n            var content = this.content;\n\n            if (this.virtualScroll && this.virtualScroll.rows) {\n                content = this.virtualScrollable.verticalScrollbar;\n            }\n\n            var scrollTop = content.scrollTop(),\n                delta = kendo.wheelDeltaY(e);\n\n            if (delta) {\n                if (content[0].scrollHeight > content[0].clientHeight &&\n                    (content[0].scrollTop < content[0].scrollHeight - content[0].clientHeight && delta < 0 ||\n                    content[0].scrollTop > 0 && delta > 0)) {\n                    e.preventDefault();\n                }\n\n                content.scrollTop(scrollTop + (-delta));\n            }\n        },\n\n        _isLocked: function() {\n            return this.lockedHeader != null;\n        },\n\n        _updateHeaderCols: function() {\n            var table = this.thead.parent().add(this.table);\n\n            if (this._isLocked()) {\n                normalizeCols(table, visibleLeafColumns(visibleNonLockedColumns(this.columns)), this._hasDetails(), 0);\n            } else {\n                normalizeCols(table, visibleLeafColumns(visibleColumns(this.columns)), this._hasDetails(), 0);\n            }\n        },\n\n        _updateColumnSorters: function() {\n            var that = this;\n            var cells = leafDataCells(that.thead);\n            var columns = leafColumns(that.columns);\n            var column;\n            var cell;\n            var sorterInstance;\n\n            if (!that.options.sortable) {\n                return;\n            }\n\n            for (var idx = 0, length = cells.length; idx < length; idx++) {\n                column = columns[idx];\n\n                if (column.sortable !== false && !column.command && column.field) {\n                    cell = cells.eq(idx);\n\n                    sorterInstance = cell.data(\"kendoColumnSorter\");\n\n                    if (sorterInstance) {\n                        sorterInstance.refresh();\n                    }\n                }\n            }\n        },\n\n        _updateHeadersAttr: function(columns) {\n            if (!columns.length) {\n                return;\n            }\n\n            var that = this;\n\n            for (var i = 0; i < columns.length; i++) {\n                if (columns[i].headerAttributes) {\n                    var th = that.element.find(\"[id='\" + columns[i].headerAttributes.id + \"']\");\n                    th.attr(\"headers\", columns[i].headerAttributes.headers);\n                }\n            }\n\n            that._updateHeadersAttr(childColumns(columns));\n        },\n\n        _updateCols: function(table) {\n            table = table || this.thead.parent().add(this.table);\n\n            this._appendCols(table, this._isLocked());\n        },\n\n        _updateLockedCols: function(table) {\n            if (this._isLocked()) {\n                table = table || this.lockedHeader.find(\"table\").add(this.lockedTable);\n\n                normalizeCols(table, visibleLeafColumns(visibleLockedColumns(this.columns)), this._hasDetails(), this._groups());\n            }\n        },\n\n        _appendCols: function(table, locked) {\n            if (locked) {\n                normalizeCols(table, visibleLeafColumns(visibleNonLockedColumns(this.columns)), this._hasDetails(), 0);\n            } else {\n                normalizeCols(table, visibleLeafColumns(visibleColumns(this.columns)), this._hasDetails(), this._groups());\n            }\n        },\n\n        _autoColumns: function(schema) {\n            if (schema && schema.toJSON) {\n                var that = this,\n                    field,\n                    encoded;\n\n                schema = schema.toJSON();\n\n                encoded = !(that.table.find(\"tbody tr\").length > 0 && (!that.dataSource || !that.dataSource.transport));\n\n                for (field in schema) {\n                    that.columns.push({ field: field, encoded: encoded, headerAttributes: { id: kendo.guid() } });\n                }\n\n                that._thead();\n\n                that._templates();\n            }\n        },\n\n        _rowsHtml: function(data, templates) {\n            var that = this,\n                html = \"\",\n                idx,\n                rowTemplate = templates.rowTemplate,\n                altRowTemplate = templates.altRowTemplate,\n                length;\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if (that._skipRerenderItemsCount > 0) {\n                    that._skipRerenderItemsCount--;\n                } else {\n                    if (idx % 2) {\n                        html += altRowTemplate(data[idx]);\n                    } else {\n                        html += rowTemplate(data[idx]);\n                    }\n                }\n                that._data.push(data[idx]);\n            }\n\n            return html;\n        },\n\n        _groupData: function(group, skipFooter, firstColumn) {\n            var that = this,\n                footerDefaults = that._groupAggregatesDefaultObject || {},\n                groupItems = group.items,\n                aggregates = extend({}, footerDefaults, group.aggregates),\n                headerData = extend({}, {\n                    field: group.field,\n                    value: group.value,\n                    items: groupItems,\n                    aggregates: aggregates\n                }, group.aggregates[firstColumn ? firstColumn.field : group.field]),\n                footerData = {};\n\n            if (!skipFooter) {\n                for (var aggregate in aggregates) {\n                    footerData[aggregate] = extend({}, aggregates[aggregate],\n                        { group: { field: group.field, value: group.value, items: groupItems } }\n                    );\n                }\n            }\n            return extend({}, footerData, headerData);\n        },\n\n        _removeGroupIfEmpty: function(row) {\n            var that = this,\n                itemsCount,\n                subgroupsCount,\n                length = that.dataSource._group.length;\n\n            for (var i = 0; i < length; i++) {\n                row = row.prev();\n                itemsCount = +row.attr('data-group-item-count');\n                subgroupsCount = +row.attr('data-sub-group-count');\n\n                if (itemsCount == 1 || subgroupsCount == 1) {\n                    row.hide();\n                }\n\n            }\n        },\n\n        _groupRowHtml: function(group, colspan, level, groupHeaderBuilder, templates, skipColspan, skipLastGroup, isLockedTable) {\n            var that = this,\n                html = \"\",\n                idx,\n                length,\n                isLocked = that.lockedContent != null,\n                field = group.field,\n                column = grep(leafColumns(that.columns), function(column) { return column.field == field; })[0] || { },\n                firstColumn = visibleColumns(that.columns)[0],\n                firstVisibleColumnGroupHeaderTemplate = firstColumn ? firstColumn.groupHeaderColumnTemplate : null,\n                template = column.groupHeaderTemplate ? column.groupHeaderTemplate : firstVisibleColumnGroupHeaderTemplate,\n                text = (column.title && (that.options.encodeTitles ? htmlEncode(column.title, true) : column.title) || field) + ': ' + formatGroupValue(group.value, column.format, column.values, column.encoded),\n                groupItems = group.currentItems || group.items,\n                groups = that._groups(),\n                groupFooterTemplate = templates.groupFooterTemplate,\n                groupHeaderColumnTemplate = templates.groupHeaderColumnTemplate,\n                groupData,\n                isGroupPaged = that.dataSource._isGroupPaged(),\n                expanded = isGroupPaged ? that.dataSource._groupsState[group.uid] : true;\n\n            if (that.options.editable && group.items && group.items[0] && group.items[0].isNew && group.items[0].isNew()) {\n                expanded = true;\n            }\n\n            if (templates.groupFooterTemplate || templates.groupHeaderColumnTemplate || column.groupHeaderTemplate) {\n                groupData = that._groupData(group, false, !column.groupHeaderTemplate && visibleColumns(that.columns)[0].groupHeaderColumnTemplate ? visibleColumns(that.columns)[0] : false);\n            }\n            if (template && !skipColspan) {\n                text = typeof template === FUNCTION ? template(groupData) : kendo.template(template)(groupData);\n            }\n\n            if (!that._skipRerenderItemsCount) {\n                if (!group.excludeHeader) {\n                    html += groupHtmlBuilder(groupHeaderColumnTemplate, groupHeaderBuilder, colspan, groups - level, groupData, level, text, expanded, group, isGroupPaged);\n                } else if (isLocked) {\n                    group.excludeHeader = isLockedTable ? false : true;\n                } else {\n                    group.excludeHeader = false;\n                }\n            } else {\n                groupHeaderBuilder(colspan, level, text, expanded, group.uid, isGroupPaged);\n            }\n\n            if (expanded) {\n                if (group.hasSubgroups) {\n                    for (idx = 0, length = groupItems.length; idx < length; idx++) {\n                        html += that._groupRowHtml(groupItems[idx], skipColspan ? colspan : colspan - 1, level + 1, groupHeaderBuilder, templates, skipColspan, skipLastGroup && idx === groupItems.length - 1, isLockedTable);\n                    }\n                } else {\n                    html += that._rowsHtml(groupItems, templates);\n                }\n            }\n\n            if (groupFooterTemplate) {\n\n                if (skipLastGroup) {\n                    if (!inArray(group.value, that._skippedGroups)) {\n                        that._skippedGroups.push(group.value);\n                    }\n                } else {\n                    if (that._skippedGroups.length && that._skippedGroups[0] === group.value) {\n                        that._skippedGroups.shift();\n                    }\n                    if (!that._skipRerenderItemsCount) {\n                        html += groupFooterTemplate(groupData);\n                    }\n                }\n            }\n            return html;\n        },\n\n        collapseGroup: function(group) {\n\n            var level,\n                that = this,\n                groupToCollapse = group,\n                groupable = this.options.groupable,\n                showFooter = groupable.showFooter,\n                footerCount = showFooter ? 0 : 1,\n                offset,\n                relatedGroup = $(),\n                idx,\n                length,\n                tr;\n\n            group = $(group);\n            level = group.find(\".k-group-cell\").length;\n\n            if (this.dataSource._isGroupPaged()) {\n                var groupUid = group.attr(\"data-group-uid\");\n                var groupObject = that.dataSource._getGroupByUid(groupUid);\n                var currentGroupCount = that.dataSource._calculateGroupsTotal([groupObject], true);\n                var groupCountAfterCollapse;\n\n                that.dataSource._groupsState[groupUid] = false;\n                groupCountAfterCollapse = that.dataSource._calculateGroupsTotal([groupObject], true);\n                that.dataSource._serverGroupsTotal -= currentGroupCount - groupCountAfterCollapse;\n                that._progress(true);\n                that.dataSource.range(that.dataSource._currentRangeStart, that.dataSource.take(), function() {\n                    that._progress(false);\n                }, \"collapseGroup\");\n                return;\n            }\n\n            if (this._isLocked()) {\n                if (!group.closest(\"div\").hasClass(\"k-grid-content-locked\")) {\n                    relatedGroup = group.nextAll(\"tr\");\n                    group = this.lockedTable.find(\">tbody>tr\").eq(group.index());\n                } else {\n                    relatedGroup = this.tbody.children(\"tr\").eq(group.index()).nextAll(\"tr\");\n                }\n            }\n\n            group.find(\".k-i-collapse\").addClass(\"k-i-expand\").removeClass(\"k-i-collapse\");\n            group.find(\"td[aria-expanded='true']\").first().attr(\"aria-expanded\", false)\n                .find(\"a\").attr(ARIALABEL, EXPAND);\n\n            group = group.nextAll(\"tr\");\n\n            var toHide = [];\n\n            for (idx = 0, length = group.length; idx < length; idx ++ ) {\n                tr = group.eq(idx);\n                offset = tr.find(\".k-group-cell\").length;\n\n                if (tr.hasClass(\"k-grouping-row\")) {\n                    footerCount++;\n                } else if (tr.hasClass(\"k-group-footer\")) {\n                    footerCount--;\n                }\n\n                if (offset <= level || (tr.hasClass(\"k-group-footer\") && footerCount < 0)) {\n                    break;\n                }\n\n                if (relatedGroup.length) {\n                    toHide.push(relatedGroup[idx]);\n                }\n                toHide.push(tr[0]);\n            }\n\n            $(toHide).hide();\n\n            if (this.options.scrollable.endless && this.content) {\n                clearTimeout(that._collapseGroupsTimeOut);\n                that._collapseGroupsTimeOut = setTimeout(function() {\n                    that.content.scroll();\n                    that._groupToCollapse = groupToCollapse;\n                });\n            }\n        },\n\n        expandGroup: function(group) {\n                group = $(group);\n\n            var that = this,\n                showFooter = that.options.groupable.showFooter,\n                level,\n                tr,\n                offset,\n                relatedGroup = $(),\n                idx,\n                length,\n                footersVisibility = [],\n                groupsCount = 1;\n\n                level = group.find(\".k-group-cell\").length;\n\n            if (this.dataSource._isGroupPaged()) {\n                var groupUid = group.attr(\"data-group-uid\");\n                var groupObject = that.dataSource._getGroupByUid(groupUid);\n                var groupCount = that.dataSource._calculateGroupsTotal([groupObject], true);\n                var groupCountAfterExpand;\n\n                that.dataSource._groupsState[groupUid] = true;\n                if (groupObject.items && groupObject.items.length) {\n                    groupCountAfterExpand = that.dataSource._calculateGroupsTotal([groupObject], true);\n                    that.dataSource._serverGroupsTotal += groupCountAfterExpand - groupCount;\n                }\n\n                that._progress(true);\n                that.dataSource.range(that.dataSource._currentRangeStart, that.dataSource.take(), function() {\n                    that._progress(false);\n                }, \"expandGroup\");\n                return;\n            }\n\n            if (this._isLocked()) {\n                if (!group.closest(\"div\").hasClass(\"k-grid-content-locked\")) {\n                    relatedGroup = group.nextAll(\"tr\");\n                    group = this.lockedTable.find(\">tbody>tr\").eq(group.index());\n                } else {\n                    relatedGroup = this.tbody.children(\"tr\").eq(group.index()).nextAll(\"tr\");\n                }\n            }\n\n            group.find(\".k-i-expand\").addClass(\"k-i-collapse\").removeClass(\"k-i-expand\");\n            group.find(\"td[aria-expanded='false']\").first().attr(\"aria-expanded\", true)\n                .find(\"a\").attr(ARIALABEL, COLLAPSE);\n            group = group.nextAll(\"tr\");\n\n            for (idx = 0, length = group.length; idx < length; idx ++ ) {\n                tr = group.eq(idx);\n                offset = tr.find(\".k-group-cell\").length;\n                if (offset <= level) {\n                    break;\n                }\n\n                if (offset == level + 1 && !tr.hasClass(\"k-detail-row\")) {\n                    tr.show();\n                    relatedGroup.eq(idx).show();\n\n                    if (tr.hasClass(\"k-grouping-row\") && tr.find(\".k-icon\").hasClass(\"k-i-collapse\")) {\n                        that.expandGroup(tr);\n                    }\n\n                    if (tr.hasClass(\"k-master-row\") && tr.find(\".k-icon\").hasClass(\"k-i-collapse\")) {\n                        tr.next().show();\n                        relatedGroup.eq(idx + 1).show();\n                    }\n                }\n\n                if (tr.hasClass(\"k-grouping-row\")) {\n                    if (showFooter) {\n                        footersVisibility.push(tr.is(\":visible\"));\n                    }\n                    groupsCount ++;\n                }\n\n                if (tr.hasClass(\"k-group-footer\")) {\n                    if (showFooter) {\n                        var toggleVisibility = footersVisibility.pop();\n                        tr.toggle(toggleVisibility);\n                        relatedGroup.eq(idx).toggle(toggleVisibility);\n                    }\n                    if (groupsCount == 1) {\n                        tr.show();\n                        relatedGroup.eq(idx).show();\n                    } else {\n                        groupsCount --;\n                    }\n                }\n            }\n\n            if ((level === 0 && that.options.scrollable.endless && this._isLocked()) ||\n            (!that.options.scrollable.endless && this._isLocked())) {\n                that._syncLockedContentHeight();\n            }\n        },\n\n        _updateHeader: function(groups) {\n            var that = this,\n                container = that._isLocked() ? that.lockedHeader.find(\"thead\") : that.thead,\n                filterCells = container.find(\"tr.k-filter-row\").find(\"td.k-group-cell\").length,\n                length = container.find(\"tr\").first().find(\"th.k-group-cell\").length,\n                rows = container.children(\"tr:not(:first)\").filter(function() {\n                    return !$(this).children(\":visible\").length;\n                });\n\n            if (groups > length) {\n                $(new Array(groups - length + 1).join('<th class=\"k-group-cell k-header\" scope=\"col\">' + that.options.messages.expandCollapseColumnHeader + '</th>')).prependTo(container.children(\"tr:not(.k-filter-row)\"));\n                if (that.element.is(\":visible\")) {\n                    rows.find(\"th.k-group-cell\").hide();\n                }\n            } else if (groups < length) {\n                container.find(\"tr\").each(function() {\n                    $(this).find(\"th.k-group-cell\").eq(groups).remove();\n                    $(this).find(\"th.k-group-cell\").slice(groups).remove();\n                });\n            }\n            if (groups > filterCells) {\n                $(new Array(groups - filterCells + 1).join('<td class=\"k-group-cell k-header\">&nbsp;</td>')).prependTo(container.find(\".k-filter-row\"));\n            }\n        },\n\n        _firstDataItem: function(data, grouped) {\n            if (data && grouped) {\n                if (data.hasSubgroups) {\n                    data = this._firstDataItem(data.items[0], grouped);\n                } else {\n                    data = data.items[0];\n                }\n            }\n            return data;\n        },\n\n        _updateTablesWidth: function() {\n            var that = this,\n                tables;\n\n            if (!that._isLocked()) {\n                return;\n            }\n\n            tables =\n                $(\">.k-grid-footer>.k-grid-footer-wrap>table\", that.wrapper)\n                .add(that.thead.parent())\n                .add(that.table);\n\n            that._footerWidth = tableWidth(tables.eq(0));\n            tables.width(that._footerWidth);\n\n            tables =\n                $(\">.k-grid-footer>.k-grid-footer-locked>table\", that.wrapper)\n                .add(that.lockedHeader.find(\">table\"))\n                .add(that.lockedTable);\n\n            tables.width(tableWidth(tables.eq(0)));\n        },\n\n        hideColumn: function(column) {\n            var that = this,\n                cell,\n                tables,\n                idx,\n                cols,\n                colWidth,\n                position,\n                width = 0,\n                headerCellIndex,\n                length,\n                footer = that.footer || that.wrapper.find(\".k-grid-footer\"),\n                virtualScroll = that.virtualScroll || {},\n                columns = that.columns,\n                visibleLocked = that.lockedHeader ? leafDataCells(that.lockedHeader.find(\">table>thead\")).filter(isCellVisible).length : 0,\n                columnIndex,\n                groupHeaderColumnTemplateColumns = grep(leafColumns(that.columns), function(column) { return column.groupHeaderColumnTemplate; });\n\n            if (typeof column == \"number\") {\n                column = columns[column];\n            } else if (isPlainObject(column)) {\n                column = grep(flatColumns(columns), function(item) {\n                    return item === column;\n                })[0];\n            } else {\n                column = grep(flatColumns(columns), function(item) {\n                    return item.field === column;\n                })[0];\n            }\n\n            if (!column || !isVisible(column)) {\n                return;\n            }\n\n            var setColumnVisibility = that._columnVisibilitySetter(column);\n\n            if (column.columns && column.columns.length) {\n                position = columnVisiblePosition(column, columns);\n\n                setColumnVisibility(column, false);\n\n                setCellVisibility(elements($(\">table>thead\", that.lockedHeader), that.thead, \">tr:eq(\" + position.row + \")>th\"), position.cell, false);\n\n                for (idx = 0; idx < column.columns.length; idx++) {\n                   this.hideColumn(column.columns[idx]);\n                }\n\n                that._ariaAddHiddenColIndex();\n                that.trigger(COLUMNHIDE, { column: column });\n\n                return;\n            }\n\n            columnIndex = inArray(column, visibleColumns(leafColumns(columns)));\n\n            setColumnVisibility(column, false);\n\n            that._setParentsVisibility(column, false);\n\n            that._templates();\n\n            that._updateCols();\n            that._updateLockedCols();\n\n            var container = that.thead;\n\n            headerCellIndex = columnIndex;\n            if (that.lockedHeader && visibleLocked > columnIndex) {\n                container = that.lockedHeader.find(\">table>thead\");\n            } else {\n                headerCellIndex -= visibleLocked;\n            }\n\n            cell = leafDataCells(container).filter(isCellVisible).eq(headerCellIndex);\n            cell[0].style.display = \"none\";\n\n            setCellVisibility(elements($(\">table>thead\", that.lockedHeader), that.thead, \">tr.k-filter-row>td\"), columnIndex, false);\n            if (footer[0]) {\n                that._updateCols(footer.find(\">.k-grid-footer-wrap>table\"));\n                that._updateLockedCols(footer.find(\">.k-grid-footer-locked>table\"));\n                setCellVisibility(footer.find(\".k-footer-template>td\"), columnIndex, false);\n            }\n\n            if (virtualScroll.columns && !column.locked) {\n                that._updateContentWidth();\n                that.trigger(COLUMNHIDE, { column: column });\n                return;\n            }\n\n            if (that.lockedTable && visibleLocked > columnIndex) {\n                hideColumnCells(that.lockedTable.find(\">tbody>tr\"), columnIndex);\n            } else {\n                hideColumnCells(that.tbody.children(), columnIndex - visibleLocked);\n            }\n\n            if (that.lockedTable) {\n                that._updateTablesWidth();\n                that._applyLockedContainersWidth();\n                that._syncLockedContentHeight();\n                that._syncLockedHeaderHeight();\n                that._syncLockedFooterHeight();\n            } else {\n                cols = that.thead.prev().find(\"col\");\n                for (idx = 0, length = cols.length; idx < length; idx += 1) {\n                    colWidth = cols[idx].style.width;\n\n                    if (cols[idx].className.indexOf(\"k-hierarchy-col\") > -1) {\n                        width += outerWidth(cols[idx]);\n                        continue;\n                    }\n\n                    if (cols[idx].className.indexOf(\"k-group-col\") > -1) {\n                        width += outerWidth(cols[idx]);\n                        continue;\n                    }\n\n                    if (colWidth && colWidth.indexOf(\"%\") == -1) {\n                        width += parseInt(colWidth, 10);\n                    } else {\n                        width = 0;\n                        break;\n                    }\n                }\n\n                tables = that.wrapper.find(\">.k-grid-header table\").first().add(that.wrapper.find(\">.k-grid-footer table\").first()).add(that.table);\n                that._footerWidth = null;\n\n                if (width) {\n                    tables.each(function() {\n                        this.style.width = width + \"px\";\n                    });\n\n                    that._footerWidth = width;\n                    that._setContentWidth();\n                }\n            }\n\n            that._updateFirstColumnClass();\n            that._updateStickyColumns();\n            if (groupHeaderColumnTemplateColumns.length > 0) {\n                that._renderGroupRows();\n            }\n            that._ariaAddHiddenColIndex();\n            that.trigger(COLUMNHIDE, { column: column });\n        },\n\n        _setParentsVisibility: function(column, visible) {\n            var that = this;\n            var columns = that.columns;\n            var idx;\n            var parents = [];\n            var parent;\n            var position;\n            var cell;\n            var colSpan;\n            var setColumnVisibility = that._columnVisibilitySetter(column);\n\n            var predicate = visible ?\n                function(p) { return visibleColumns(p.columns).length && p.hidden; } :\n                function(p) { return !visibleColumns(p.columns).length && !p.hidden; };\n\n\n            if (columnParents(column, columns, parents) && parents.length) {\n                for (idx = parents.length - 1; idx >= 0; idx--) {\n                    parent = parents[idx];\n                    position = columnPosition(parent, columns);\n                    cell = elements($(\">table>thead\", this.lockedHeader), this.thead, \">tr:eq(\" + position.row + \")>th:not(.k-group-cell):not(.k-hierarchy-cell)\").eq(position.cell);\n\n                    if (predicate(parent)) {\n                        setColumnVisibility(parent, visible);\n                        cell[0].style.display = visible ? \"\" : \"none\";\n                    }\n\n                    if (cell.filter(\"[\" + kendo.attr(\"colspan\") + \"]\").length) {\n                        colSpan = parseInt(cell.attr(kendo.attr(\"colspan\")), 10);\n                        cell[0].colSpan = (colSpan - hiddenLeafColumnsCount(parent.columns)) || 1;\n                    }\n                }\n            }\n        },\n\n        _updateContentWidth: function() {\n            var that = this;\n            var tables = that.table.add(that.thead.parent());\n\n            tables.css({\n                width: sumWidths(visibleLeafColumns(visibleNonLockedColumns(that.columns)))\n            });\n            that.refresh();\n        },\n\n        showColumn: function(column) {\n            var that = this,\n                idx,\n                length,\n                cell,\n                tables,\n                width,\n                headerCellIndex,\n                position,\n                colWidth,\n                cols,\n                columns = that.columns,\n                virtualScroll = that.virtualScroll || {},\n                footer = that.footer || that.wrapper.find(\".k-grid-footer\"),\n                lockedColumnsCount = that.lockedHeader ? leafDataCells(that.lockedHeader.find(\">table>thead\")).length : 0,\n                columnIndex,\n                originalColumn,\n                columnLeafIndex,\n                groupHeaderColumnTemplateColumns = grep(leafColumns(that.columns), function(column) { return column.groupHeaderColumnTemplate; });\n\n            if (typeof column == \"number\") {\n                columnIndex = column;\n                column = columns[column];\n            } else if (isPlainObject(column)) {\n                $.each(flatColumns(columns), function(index, item) {\n                    if (item === column) {\n                        column = item;\n                        columnIndex = index;\n                        return false;\n                    }\n                });\n            } else {\n                $.each(flatColumns(columns), function(index, item) {\n                    if (item.field === column) {\n                        column = item;\n                        columnIndex = index;\n                        return false;\n                    }\n                });\n            }\n\n            if (!column || isVisible(column)) {\n                return;\n            }\n\n            var setColumnVisibility = that._columnVisibilitySetter(column);\n\n            if (column.columns && column.columns.length) {\n                position = columnPosition(column, columns);\n                originalColumn = flatColumns(that.options.columns)[columnIndex];\n\n                setColumnVisibility(column, true);\n\n                setCellVisibility(elements($(\">table>thead\", that.lockedHeader), that.thead, \">tr:eq(\" + position.row + \")>th\"), position.cell, true);\n\n                for (idx = 0; idx < column.columns.length; idx++) {\n                    if (!originalColumn.columns[idx].hidden) {\n                        this.showColumn(column.columns[idx]);\n                    }\n                }\n\n                that._ariaRemoveHiddenColIndex();\n                that.trigger(COLUMNSHOW, { column: column });\n\n                return;\n            }\n\n            columnLeafIndex = inArray(column, leafColumns(columns));\n\n            setColumnVisibility(column, true);\n\n            that._setParentsVisibility(column, true);\n\n            that._templates();\n            that._updateCols();\n            that._updateLockedCols();\n\n            var container = that.thead;\n\n            headerCellIndex = columnLeafIndex;\n            if (that.lockedHeader && lockedColumnsCount > columnLeafIndex) {\n                container = that.lockedHeader.find(\">table>thead\");\n            } else {\n                headerCellIndex -= lockedColumnsCount;\n            }\n\n            cell = leafDataCells(container).eq(headerCellIndex);\n            cell[0].style.display = \"\";\n\n            setCellVisibility(elements($(\">table>thead\", that.lockedHeader), that.thead, \">tr.k-filter-row>td\"), columnLeafIndex, true);\n            if (footer[0]) {\n                that._updateCols(footer.find(\">.k-grid-footer-wrap>table\"));\n                that._updateLockedCols(footer.find(\">.k-grid-footer-locked>table\"));\n                setCellVisibility(footer.find(\".k-footer-template>td\"), columnLeafIndex, true);\n            }\n\n            if (virtualScroll.columns && !column.locked) {\n                that._updateContentWidth();\n                that.trigger(COLUMNSHOW, { column: column });\n                return;\n            }\n\n            if (that.lockedTable && lockedColumnsCount > columnLeafIndex) {\n                showColumnCells(that.lockedTable.find(\">tbody>tr\"), columnLeafIndex);\n            } else {\n                showColumnCells(that.tbody.children(), columnLeafIndex - lockedColumnsCount);\n            }\n\n            if (that.lockedTable) {\n                that._updateTablesWidth();\n                that._applyLockedContainersWidth();\n                that._syncLockedContentHeight();\n                that._syncLockedHeaderHeight();\n            } else {\n                tables = that.wrapper.find(\">.k-grid-header table\").first().add(that.wrapper.find(\">.k-grid-footer table\").first()).add(that.table);\n                if (!column.width) {\n                    tables.width(\"\");\n                } else {\n                    width = 0;\n                    cols = that.thead.prev().find(\"col\");\n                    for (idx = 0, length = cols.length; idx < length; idx += 1) {\n                        colWidth = cols[idx].style.width;\n\n                        if (cols[idx].className.indexOf(\"k-hierarchy-col\") > -1) {\n                            width += outerWidth(cols[idx]);\n                            continue;\n                        }\n\n                        if (cols[idx].className.indexOf(\"k-group-col\") > -1) {\n                            width += outerWidth(cols[idx]);\n                            continue;\n                        }\n\n                        if (colWidth.indexOf(\"%\") > -1) {\n                            width = 0;\n                            break;\n                        }\n                        width += parseInt(colWidth, 10);\n                    }\n\n                    that._footerWidth = null;\n                    if (width) {\n                        tables.each(function() {\n                            this.style.width = width + \"px\";\n                        });\n                        that._footerWidth = width;\n                        that._setContentWidth();\n                    }\n                }\n            }\n\n            that._updateFirstColumnClass();\n            that._updateStickyColumns();\n            if (groupHeaderColumnTemplateColumns.length > 0) {\n                that._renderGroupRows();\n            }\n            that._ariaRemoveHiddenColIndex();\n            that.trigger(COLUMNSHOW, { column: column });\n        },\n\n        _columnVisibilitySetter: function(column) {\n            var col = column || {};\n\n            if (isUndefined(col.media)) {\n                return setColumnVisibility;\n            } else {\n                return setColumnMediaVisibility;\n            }\n        },\n\n\n        _buildSkeleton: function() {\n            var visibleColumns = this.virtualCols ? this.virtualCols : visibleLeafColumns(this.columns);\n            var pageSize = this.dataSource.pageSize() || this.dataSource.total();\n            var loaderHTML = \"\";\n            var colspan;\n            var groups = (this.dataSource.group() || []).length;\n            var columnsCount = visibleColumns.length + groups;\n\n            if (this._hasDetails()) {\n                columnsCount++;\n            }\n\n            if (this._hasVirtualColumns()) {\n                colspan = parseInt(this.content.find(\"tr\").first().find(\"td\").first().attr(\"colspan\"), 10);\n            }\n\n            for (var i = 0; i < pageSize; i++) {\n                loaderHTML += \"<tr>\";\n                for (var j = 0; j < columnsCount; j++) {\n                    if (colspan && !j) {\n                        loaderHTML += \"<td colspan='\" + colspan + \"'><span class='k-skeleton k-skeleton-text k-skeleton-pulse'></span></td>\";\n                    } else {\n                        loaderHTML += \"<td><span class='k-skeleton k-skeleton-text k-skeleton-pulse'></span></td>\";\n                    }\n                }\n                loaderHTML += \"</tr>\";\n            }\n            return loaderHTML;\n        },\n\n        _progress: function(toggle) {\n            var element = this.element;\n            var endless = this.options.scrollable && this.options.scrollable.endless;\n            var loaderType = this.options.loaderType;\n            var isVirtualization = this.options.scrollable && this.options.scrollable.virtual;\n            var skeleton;\n\n            if (isVirtualization) {\n                element = this.content;\n            } else if (this._editContainer && this._editMode() === \"popup\") {\n                element = this._editContainer;\n            } else if (this.lockedContent || endless) {\n                element = this.wrapper;\n            } else if (this.element.is(\"table\")) {\n                element = this.element.parent();\n            } else if (this.content && this.content.length) {\n                element = this.content;\n            }\n\n            if (loaderType == \"skeleton\") {\n                if (toggle) {\n                    skeleton = this._buildSkeleton();\n                        element.find(\"tbody\")\n                         .empty()\n                         .append(skeleton);\n                } else {\n                    element.find(\".k-skeleton\").closest(\"tbody\").empty();\n                }\n            } else {\n                if (endless && toggle) {\n                    kendo.ui.progress(element, toggle, { height: this.content.height(), top: this.content[0].offsetTop, opacity: true });\n                } else {\n                    kendo.ui.progress(element, toggle);\n                }\n            }\n        },\n\n        _resize: function(size, force) {\n\n            this._syncLockedContentHeight();\n            this._syncLockedHeaderHeight();\n\n            if (this.content) {\n                this._setContentWidth();\n                this._setContentHeight();\n            }\n\n            if (this.lockedTable) {\n                this._syncLockedScroll();\n            }\n\n            if (this.virtualScrollable && (force || this._rowHeight)) {\n                if (force) {\n                    this._rowHeight = null;\n                }\n                this.virtualScrollable.repaintScrollbar();\n            }\n\n            if (this.pager && this.pager.element) {\n                this.pager.resize(force);\n            }\n\n            if (this._anyStickyColumns()) {\n                this._updateStickyColumns(false);\n            }\n        },\n\n        _isActiveInTable: function() {\n            var active = activeElement();\n\n            if (!active) { return false; }\n\n            return this.table[0] === active ||\n                $.contains(this.table[0], active) ||\n                (this._isLocked() &&\n                    (this.lockedTable[0] === active || $.contains(this.lockedTable[0], active))\n                );\n        },\n\n        refresh: function(e) {\n            var that = this,\n                data = that.dataSource.view(),\n                navigatable = that.options.navigatable,\n                virtualScroll = that.virtualScroll || {},\n                currentIndex,\n                current = $(that.current()),\n                isCurrentInHeader = false,\n                groups = (that.dataSource.group() || []).length,\n                colspan = groups + visibleLeafColumns(visibleColumns(that.columns)).length,\n                contentScrollLeft,\n                cachedItemsToSkip;\n\n            if (e && e.action === \"itemchange\" && (that.editable || that.options.scrollable.endless)) { // skip rebinding if editing is in progress\n                if (this._editMode() != \"popup\" || this._editMode() === \"popup\" && !that._editableIsClosing) { // popup editing animation has not finished yet and the editable is not destoyed\n                    return;\n                }\n            }\n\n\n            if (virtualScroll.columns) {\n                that._templates();\n            }\n\n            //someone remove the edited item\n            if (e && e.action === \"remove\" && that.editable &&\n                that.editable.options.model && inArray(that.editable.options.model, e.items) > -1) {\n                that.editable.options.model.unbind(CHANGE, that._modelChangeHandler);\n            }\n\n            e = e || {};\n\n            if (that.trigger(\"dataBinding\", { action: e.action || \"rebind\", index: e.index, items: e.items })) {\n                return;\n            }\n\n            if (e.action === SYNC && that._isVirtualEditable()) {\n                that._destroyEditable();\n                that._clearEditableState();\n            }\n\n            that._angularItems(\"cleanup\");\n\n            if (!that._endlessFetchInProgress) {\n                if (navigatable && (that._isActiveInTable() || (that._editContainer && that._editContainer.data(\"kendoWindow\")))) {\n                    isCurrentInHeader = current.is(\"th\");\n                    currentIndex = isCurrentInHeader ? current.parent().children(\":not(.k-group-cell)\").index(current[0]) : Math.max(that.cellIndex(current), 0);\n                }\n                that._destroyEditable();\n            }\n\n            if (that.options.scrollable && that.options.scrollable.endless && !that._pdfInitialized) {\n                clearTimeout(that._progressTimeOut);\n                that._progressTimeOut = setTimeout(function() {\n                    if (!that._endlessFetchInProgress) {\n                        that._progress(false);\n                    }\n                }, 250);\n            } else {\n                 that._progress(false);\n            }\n\n            that._hideResizeHandle();\n\n            that._data = [];\n\n            if (!that.columns.length) {\n                that._autoColumns(that._firstDataItem(data[0], groups));\n                colspan = groups + that.columns.length;\n            }\n\n            that._group = groups > 0 || that._group;\n\n            if (that._group) {\n                that._templates();\n                that._updateCols();\n                that._updateLockedCols();\n                if (!that._virtualColScroll) {\n                    that._updateHeader(groups);\n                }\n                that._group = groups > 0;\n                that._groupRows = groupRows(data);\n            }\n\n            if (that.content) {\n                contentScrollLeft = kendo.scrollLeft(that.content);\n            }\n            cachedItemsToSkip = that._skipRerenderItemsCount;\n            that._renderContent(data, colspan, groups);\n            if (that.options.scrollable && that.options.scrollable.endless && this.lockedContent) {\n                that._skipRerenderItemsCount = cachedItemsToSkip;\n            }\n            that._renderLockedContent(data, colspan, groups);\n\n            if (!that._virtualColScroll) {\n                that._footer();\n\n                that._renderNoRecordsContent();\n\n                that._togglePagerVisibility();\n\n                that._setContentHeight();\n\n                that._setContentWidth(that.content && contentScrollLeft);\n            }\n\n            if (that.lockedTable) {\n                //requires manual trigger of scroll to sync both tables\n                if (virtualScroll.rows) {\n                    that.content.find(\">.k-virtual-scrollable-wrap\").trigger(\"scroll\");\n                } else if (that.touchScroller) {\n                    that.touchScroller.movable.trigger(\"change\");\n                } else {\n                    that.wrapper.one(\"scroll\", function(e) { e.stopPropagation(); });\n                    that.content.trigger(\"scroll\");\n                }\n            }\n\n            if (!that._endlessFetchInProgress && !that._rowDropping) {\n                that._restoreCurrent(currentIndex, isCurrentInHeader);\n            }\n\n            if (that.touchScroller) {\n                that.touchScroller.contentResized();\n            }\n\n            if (that.selectable) {\n                that.selectable.resetTouchEvents();\n            }\n\n            that._muteAngularRebind(function() {\n                that._angularItems(\"compile\");\n            });\n\n            if (that._checkBoxSelection) {\n                that._toggleHeaderCheckState(false);\n            }\n\n            if (that.options.persistSelection &&\n                ((that.selectable && !kendo.ui.Selectable.parseOptions(that.options.selectable).cell) || that._checkBoxSelection) &&\n                (that.items().length || that.dataSource._isGroupPaged())) {\n                that._restoreSelection();\n            }\n\n            if (!that.options.persistSelection) {\n                that._selectedIds = {};\n            }\n\n            if (that._hasReorderableRows()) {\n                that._draggableRows();\n                that._reorderableRows();\n            }\n\n            that._aria();\n\n            that.trigger(DATABOUND);\n       },\n\n        _restoreCurrent: function(currentIndex, isCurrentInHeader) {\n            if (currentIndex === undefined || currentIndex < 0) {\n                return;\n            }\n\n            this._removeCurrent();\n\n            if (isCurrentInHeader) {\n                this._setCurrent(this.thead.find(\"th:not(.k-group-cell)\").eq(currentIndex));\n            } else {\n                var rowIndex = 0;\n                var virtualScroll = this.virtualScroll || {};\n\n                if (this._rowVirtualIndex) {\n                    if (virtualScroll.rows) {\n                        rowIndex = this.virtualScrollable.position(this._rowVirtualIndex);\n                    } else {\n                        rowIndex = this._rowVirtualIndex;\n                    }\n                } else {\n                    currentIndex = 0;\n                }\n\n                var row = $();\n                var colspan;\n\n                if (this.lockedTable) {\n                    row = this.lockedTable.find(\">tbody>tr\").eq(rowIndex);\n                }\n                row = row.add(this.tbody.children().eq(rowIndex));\n\n                if (this._hasVirtualColumns()) {\n                    colspan = parseInt(row.find(\"td\").first().attr(\"colspan\"), 10);\n                    currentIndex = this._virtualCellIndex - (colspan > 1 ? colspan - 1 : 0);\n                }\n\n\n                var td = row.find(\">td:not(.k-group-cell):not(.k-hierarchy-cell)\")\n                    .eq(currentIndex);\n\n                if (!td.length || currentIndex < 0) {\n                    return;\n                }\n\n                if (this._hasVirtualColumns()) {\n                    this._setCurrent(td, true, true);\n\n                } else {\n                    this._setCurrent(td);\n                }\n\n            }\n\n            if (this._current) {\n                focusTable(this.table, true);\n            }\n        },\n\n        _restoreSelection: function() {\n            var that = this,\n                allRows = that.items(),\n                selectedRows,\n                id = isFunction(that.dataSource.options.schema.model) ? that.dataSource.options.schema.model.fn.idField : that.dataSource.options.schema.model.id;\n\n            selectedRows = grep(allRows, function(row) {\n                 var dataItemKey = that.dataItem(row)[id];\n                 if (that._selectedIds[dataItemKey]) {\n                    return row;\n                 }\n            });\n\n            that.select(selectedRows);\n        },\n\n       _angularItems: function(cmd) {\n\n           kendo.ui.DataBoundWidget.fn._angularItems.call(this, cmd);\n\n           if (cmd === \"cleanup\" && (!this.dataSource || !this.dataSource.options.endless)) {\n               this._cleanupDetailItems();\n           }\n\n           this._angularGroupItems(cmd);\n\n           this._angularGroupFooterItems(cmd);\n       },\n\n       _cleanupDetailItems: function() {\n           var that = this;\n\n           if (that._hasDetails()) {\n              that.angular(\"cleanup\", function() {\n                   return { elements: that.tbody.children(\".k-detail-row\") };\n               });\n\n               that.tbody.find(\".k-detail-cell\").empty();\n           }\n       },\n\n       _angularGroupItems: function(cmd) {\n           var that = this,\n               container = that.tbody;\n\n           if (that.lockedContent) {\n               container = that.lockedTable.find(\"tbody\");\n           }\n\n           if (that._group) {\n              that.angular(cmd, function() {\n                   return {\n                       elements: container.children(\".k-grouping-row\"),\n                       data: $.map(groupRows(that.dataSource.view()), function(dataItem) {\n                           return { dataItem: dataItem };\n                       })\n                   };\n               });\n           }\n       },\n\n       _angularGroupFooterItems: function(cmd) {\n           var that = this,\n               container = that.tbody;\n\n           if (that.lockedContent) {\n                container = that.element;\n           }\n\n           if (that._group && that.groupFooterTemplate) {\n\n               that.angular(cmd, function() {\n                   return {\n                       elements: container.find(\".k-group-footer\"),\n                       data: $.map(groupFooters(that.dataSource.view()), function(dataItem) {\n                           return { dataItem: dataItem };\n                       })\n                   };\n               });\n           }\n       },\n\n       _renderContent: function(data, colspan, groups) {\n            var that = this,\n                idx,\n                length,\n                html = \"\",\n                isLocked = that.lockedContent != null,\n                endlessAppend = null,\n                skipLastGroup,\n                flatViewLength,\n                scrollable = that.options.scrollable,\n                templates = {\n                        rowTemplate: that.rowTemplate,\n                        altRowTemplate: that.altRowTemplate,\n                        groupFooterTemplate: that.groupFooterTemplate,\n                        groupHeaderColumnTemplate: that.groupHeaderColumnTemplate\n                    };\n            if (scrollable && scrollable.endless && !that.dataSource.options.endless) {\n                that._skipRerenderItemsCount = 0;\n                if (that.content) {\n                    that.content[0].scrollTop = 0;\n                }\n            }\n            endlessAppend = that._skipRerenderItemsCount > 0;\n            colspan = isLocked ? colspan - visibleLeafColumns(visibleLockedColumns(that.columns)).length : colspan;\n            if (groups > 0) {\n\n                colspan = isLocked ? colspan - groups : colspan;\n\n                if (that.detailTemplate) {\n                    colspan++;\n                }\n\n                if (that.groupFooterTemplate) {\n                    that._groupAggregatesDefaultObject = that.dataSource.aggregates();\n                }\n                if (that.options.scrollable.endless) {\n                    flatViewLength = that.dataSource.flatView().length;\n                }\n                for (idx = 0, length = data.length; idx < length; idx++) {\n                    if (!that._skippedGroups) {\n                        that._skippedGroups = [];\n                    }\n                    skipLastGroup = flatViewLength && idx === data.length - 1 && flatViewLength !== that.dataSource.total();\n                    html += that._groupRowHtml(data[idx], colspan, 0, isLocked ? groupRowLockedContentBuilder : groupRowBuilder, templates, isLocked, skipLastGroup, false);\n                }\n            } else {\n                html += that._rowsHtml(data, templates);\n            }\n\n            if (endlessAppend) {\n                that.tbody.append(html);\n                clearTimeout(that._endlessFetchTimeOut);\n                that._endlessFetchTimeOut = setTimeout(function() {\n                    if (that._groupToCollapse) {\n                        that.collapseGroup(that._groupToCollapse);\n                        that._groupToCollapse = null;\n                    }\n                });\n                that._endlessFetchInProgress = null;\n            } else {\n                that.tbody = appendContent(that.tbody, that.table, html, this.options.$angular);\n            }\n       },\n\n       _renderGroupRows: function() {\n        var that = this,\n        data = that._groupRows,\n        groupRows = that.wrapper.find(\".k-grouping-row\"),\n        groups = that._groups(),\n        groupRowBuilderFunc,\n        isLocked = that.lockedContent != null,\n        columns,\n        colspan,\n        group,\n        field,\n        column,\n        template,\n        text,\n        groupHeaderData,\n        tableContainer,\n        isInLockedContainer,\n        prevElement,\n        newGroupRowElement,\n        currentRow,\n        level,\n        groupHeaderColumnTemplate,\n        firstColumnGroupData;\n\n        groupRows.each(function(index, row) {\n            currentRow = $(row);\n            tableContainer = currentRow.closest(\"table\").parent();\n            isInLockedContainer = tableContainer.is(\".\" + CONTENTRLOCKEDCONTAINER);\n            columns = isInLockedContainer ? visibleLeafColumns(visibleColumns(lockedColumns(that.columns))) : visibleLeafColumns(visibleColumns(nonLockedColumns(that.columns)));\n            level = currentRow.find(\".\" + GROUPCELLCLASS).length;\n            if (isLocked) {\n                groupRowBuilderFunc = isInLockedContainer ? groupRowBuilder : groupRowLockedContentBuilder;\n                colspan = isInLockedContainer ? columns.length + groups - level : columns.length;\n            }\n            else {\n                groupRowBuilderFunc = groupRowBuilder;\n                colspan = columns.length + groups - level;\n            }\n\n            group = index >= data.length ? data[index - data.length] : data[index];\n            field = group.field;\n            column = grep(leafColumns(that.columns), function(column) { return column.field == field; })[0] || { };\n            firstColumnGroupData = !column.groupHeaderTemplate && visibleColumns(that.columns)[0].groupHeaderColumnTemplate ? visibleColumns(that.columns)[0] : false;\n            template = column.groupHeaderTemplate ? column.groupHeaderTemplate : visibleColumns(that.columns)[0].groupHeaderColumnTemplate;\n            text = (column.title && (that.options.encodeTitles ? htmlEncode(column.title, true) : column.title) || field) + ': ' + formatGroupValue(group.value, column.format, column.values, column.encoded);\n            groups = groups;\n            groupHeaderData = that._groupData(group, false, firstColumnGroupData);\n            groupHeaderColumnTemplate = isInLockedContainer ? that.lockedGroupHeaderColumnTemplate : that.groupHeaderColumnTemplate;\n\n            if (template) {\n                text = typeof template === FUNCTION ? template(groupHeaderData) : kendo.template(template)(groupHeaderData);\n            }\n\n            prevElement = currentRow.prev().length ? currentRow.prev() : currentRow.parent();\n\n            newGroupRowElement = $(groupHeaderColumnTemplate ?\n                groupHeaderColumnTemplate(extend({}, groupHeaderData, { groupCells: level, colspan: groups - level, text: text })) :\n                groupRowBuilderFunc(colspan, level, text)\n            );\n\n            if (prevElement.is(\"tbody\")) {\n                prevElement.prepend(newGroupRowElement);\n            }\n            else {\n                prevElement.after(newGroupRowElement);\n            }\n                currentRow.remove();\n           });\n       },\n\n       _renderLockedContent: function(data, colspan, groups) {\n           var html = \"\",\n               idx,\n               length,\n               skipLastGroup,\n               endlessAppend = null,\n               flatViewLength,\n               templates = {\n                   rowTemplate: this.lockedRowTemplate,\n                   altRowTemplate: this.lockedAltRowTemplate,\n                   groupFooterTemplate: this.lockedGroupFooterTemplate,\n                   groupHeaderColumnTemplate: this.lockedGroupHeaderColumnTemplate\n               };\n\n           if (this.lockedContent) {\n\n               var table = this.lockedTable;\n               endlessAppend = this._skipRerenderItemsCount > 0;\n\n               if (groups > 0) {\n                   colspan = colspan - visibleColumns(leafColumns(nonLockedColumns(this.columns))).length;\n                   if (this.options.scrollable.endless) {\n                     flatViewLength = this.dataSource.flatView().length;\n                   }\n                   for (idx = 0, length = data.length; idx < length; idx++) {\n                    skipLastGroup = flatViewLength && idx === data.length - 1 && flatViewLength !== this.dataSource.total();\n                    html += this._groupRowHtml(data[idx], colspan, 0, groupRowBuilder, templates, false, skipLastGroup, true);\n                   }\n               } else {\n                   html = this._rowsHtml(data, templates);\n               }\n\n               if (endlessAppend) {\n                   table.children(\"tbody\").append(html);\n               } else {\n                   appendContent(table.children(\"tbody\"), table, html, this.options.$angular);\n               }\n\n               this._syncLockedContentHeight();\n           }\n       },\n\n       _togglePagerVisibility: function() {\n           if (this.options.pageable.alwaysVisible === false) {\n                this.wrapper.find(\".k-grid-pager\").toggle(this.dataSource.total() >= this.dataSource.pageSize());\n            }\n       },\n\n       _adjustRowsHeight: function(table1, table2) {\n           var rows = table1[0].rows,\n               length = rows.length,\n               idx,\n               rows2 = table2[0].rows,\n               containers = table1.add(table2),\n               containersLength = containers.length,\n               heights = [];\n\n           for (idx = 0; idx < length; idx++) {\n               if (!rows2[idx]) {\n                   break;\n               }\n\n               if (rows[idx].style.height) {\n                   rows[idx].style.height = rows2[idx].style.height = \"\";\n               }\n           }\n\n           for (idx = 0; idx < length; idx++) {\n               if (!rows2[idx]) {\n                   break;\n               }\n\n               var offsetHeight1 = rows[idx].offsetHeight;\n               var offsetHeight2 = rows2[idx].offsetHeight;\n               var height = 0;\n\n               if (offsetHeight1 > offsetHeight2) {\n                   height = offsetHeight1;\n               } else if (offsetHeight1 < offsetHeight2) {\n                   height = offsetHeight2;\n               }\n\n               heights.push(height);\n           }\n\n           for (idx = 0; idx < containersLength; idx++) {\n               containers[idx].style.display = \"none\";\n           }\n\n           for (idx = 0; idx < length; idx++) {\n               if (heights[idx]) {\n                   //add one to resolve row misalignment in IE\n                   rows[idx].style.height = rows2[idx].style.height = (heights[idx] + 1) + \"px\";\n               }\n           }\n\n           for (idx = 0; idx < containersLength; idx++) {\n               containers[idx].style.display = \"\";\n           }\n       }\n   });\n\n   if (kendo.ExcelMixin) {\n       kendo.ExcelMixin.extend(Grid.prototype);\n   }\n\n   if (kendo.PDFMixin) {\n       kendo.PDFMixin.extend(Grid.prototype);\n\n       Grid.prototype._drawPDF_autoPageBreak = function(progress) {\n           var grid = this;\n           var result = new $.Deferred();\n           var dataSource = grid.dataSource;\n           var allPages = grid.options.pdf.allPages;\n           var origBody = grid.wrapper.find('table[role$=\"grid\"] > tbody').first();\n           var cont = $(\"<div>\")\n               .css({ position: \"absolute\", left: -10000, top: -10000 });\n           var clone;\n\n           grid.toggleUnexportableColumns(grid.columns);\n           clone = grid.wrapper.clone().css({\n               height: \"auto\", width: \"auto\"\n           }).appendTo(cont);\n           clone.find(\".k-grid-content\").css({ height: \"auto\", width: \"auto\", overflow: \"visible\" });\n           clone.find('table[role$=\"grid\"], .k-grid-footer table').css({ height: \"auto\", width: \"100%\", overflow: \"visible\" });\n           clone.find(\".k-grid-pager, .k-grid-toolbar, .k-grouping-header\").remove();\n           clone.find(\".k-grid-header, .k-grid-footer, .k-auto-scrollable\").css({ paddingRight: 0 });\n\n           this._initPDFProgress(progress);\n\n           var body = clone.find('table[role$=\"grid\"] > tbody').first().empty();\n           var startingPage = dataSource.page();\n\n           function resolve() {\n               if (allPages && startingPage !== undefined) {\n                   dataSource.one(\"change\", draw);\n                   dataSource.page(startingPage);\n               } else {\n                   grid.refresh();\n                   draw();\n               }\n           }\n\n           function draw() {\n               cont.appendTo(document.body);\n               var options = $.extend({}, grid.options.pdf, {\n                   _destructive: true,\n                   progress: function(p) {\n                       progress.notify({\n                           page: p.page,\n                           pageNumber: p.pageNum,\n                           progress: 0.5 + p.pageNum / p.totalPages / 2,\n                           totalPages: p.totalPages\n                       });\n                   }\n               });\n               kendo.drawing.drawDOM(clone, options)\n                   .always(function() {\n                       cont.remove();\n                   })\n                   .then(function(group) {\n                       result.resolve(group);\n                       grid.toggleUnexportableColumns(grid.columns, true);\n                   })\n                   .fail(function(err) {\n                       result.reject(err);\n                   });\n           }\n\n           function renderPage() {\n               var pageNum = dataSource.page();\n               var totalPages = allPages ? dataSource.totalPages() : 1;\n               body.append(origBody.children(\"tr:not(.k-detail-row)\"));\n               if (pageNum < totalPages) {\n                   dataSource.page(pageNum + 1);\n               } else {\n                   dataSource.unbind(\"change\", renderPage);\n                   resolve();\n               }\n           }\n\n           if (allPages) {\n               dataSource.bind(\"change\", renderPage);\n               dataSource.page(1);\n           } else {\n               renderPage();\n           }\n\n           return result.promise();\n       };\n\n       Grid.prototype.toggleUnexportableColumns = function(columns, restore) {\n           var length = columns.length;\n           var column;\n           var exportable;\n           var visibleInExport;\n           var visibleInExportOnly;\n\n           for (var i = 0; i < length; i++) {\n               column = columns[i];\n               exportable = column.exportable;\n               if (!restore) {\n                   if (typeof column.exportable === \"object\") {\n                       exportable = column.exportable.pdf;\n                   }\n\n                   visibleInExport = !column.hidden && exportable !== false;\n                   visibleInExportOnly = column.hidden && exportable === true;\n                   exportable = visibleInExport || visibleInExportOnly;\n\n                   if (!exportable && !column.hidden) {\n                       column._toggledDuringExport = true;\n                       this.hideColumn(column);\n                   } else if (exportable && column.hidden) {\n                       column._toggledDuringExport = true;\n                       this.showColumn(column);\n                   } else if (exportable && column.columns) {\n                       this.toggleUnexportableColumns(column.columns);\n                   }\n               } else {\n                   if (column._toggledDuringExport) {\n                       column._toggledDuringExport = false;\n\n                       if (column.hidden) {\n                           this.showColumn(column);\n                       } else {\n                           this.hideColumn(column);\n                       }\n                   } else if (column.columns) {\n                       this.toggleUnexportableColumns(column.columns, restore);\n                   }\n               }\n           }\n       };\n\n       Grid.prototype._drawPDF = function(progress) {\n           var grid = this;\n\n           if (grid.options.pdf.paperSize && grid.options.pdf.paperSize != \"auto\") {\n               return grid._drawPDF_autoPageBreak(progress);\n           }\n\n           var result = new $.Deferred();\n           var dataSource = grid.dataSource;\n           var allPages = grid.options.pdf.allPages;\n\n           this._initPDFProgress(progress);\n\n           // This group will be our document containing all pages\n           var doc = new kendo.drawing.Group();\n           var startingPage = dataSource.page();\n\n           function resolve() {\n               if (allPages && startingPage !== undefined) {\n                   dataSource.unbind(\"change\", exportPage);\n                   dataSource.one(\"change\", function() {\n                       result.resolve(doc);\n                   });\n\n                   dataSource.page(startingPage);\n               } else {\n                   result.resolve(doc);\n               }\n           }\n\n           function exportPage() {\n                grid.toggleUnexportableColumns(grid.columns);\n                grid._drawPDFShadow({\n                    width: grid.wrapper.width()\n                }, {\n                    avoidLinks: grid.options.pdf.avoidLinks\n                })\n                .done(function(group) {\n                    var pageNum = dataSource.page();\n                    var totalPages = allPages ? dataSource.totalPages() : 1;\n\n                    var args = {\n                        page: group,\n                        pageNumber: pageNum,\n                        progress: pageNum / totalPages,\n                        totalPages: totalPages\n                    };\n\n                    grid.toggleUnexportableColumns(grid.columns, true);\n                    progress.notify(args);\n                    doc.append(args.page);\n\n                    if (pageNum < totalPages) {\n                        dataSource.page(pageNum + 1);\n                    } else {\n                        resolve();\n                    }\n                })\n                .fail(function(err) {\n                    result.reject(err);\n                });\n            }\n\n            if (allPages) {\n                dataSource.bind(\"change\", exportPage);\n                dataSource.page(1);\n            } else {\n                exportPage();\n            }\n\n            return result.promise();\n        };\n\n        Grid.prototype._initPDFProgress = function(deferred) {\n           var loading = $(\"<div class='k-loading-pdf-mask'><div class='k-loading-color'></div></div>\");\n           loading.prepend(this.wrapper.clone().css({\n               position: \"absolute\", top: 0, left: 0\n           }));\n\n           this._pdfInitialized = true;\n           this.wrapper.append(loading);\n\n           var pb = $(\"<div class='k-loading-pdf-progress'>\")\n           .appendTo(loading)\n           .kendoProgressBar({\n               type: \"chunk\",\n               chunkCount: 10,\n               min: 0,\n               max: 1,\n               value: 0\n           }).data(\"kendoProgressBar\");\n\n           deferred.progress(function(e) {\n               pb.value(e.progress);\n           })\n           .always(function() {\n               kendo.destroy(loading);\n               loading.remove();\n           });\n        };\n   }\n\n   function syncTableHeight(table1, table2) {\n       table1 = table1[0];\n       table2 = table2[0];\n\n       if (table1.rows.length !== table2.rows.length) {\n           var lockedHeigth = table1.offsetHeight;\n           var tableHeigth = table2.offsetHeight;\n\n           var row;\n           var diff;\n           if (lockedHeigth > tableHeigth) {\n               row = table2.rows[table2.rows.length - 1];\n\n               if (filterRowRegExp.test(row.className)) {\n                   row = table2.rows[table2.rows.length - 2];\n               }\n\n               diff = lockedHeigth - tableHeigth;\n           } else {\n               row = table1.rows[table1.rows.length - 1];\n\n               if (filterRowRegExp.test(row.className)) {\n                   row = table1.rows[table1.rows.length - 2];\n               }\n\n               diff = tableHeigth - lockedHeigth;\n           }\n           row.style.height = row.offsetHeight + diff + \"px\";\n       }\n   }\n\n   function adjustRowHeight(row1, row2) {\n       var height;\n       var offsetHeight1 = row1.offsetHeight;\n       var offsetHeight2 = row2.offsetHeight;\n\n       if (offsetHeight1 > offsetHeight2) {\n           height = offsetHeight1 + \"px\";\n       } else if (offsetHeight1 < offsetHeight2) {\n           height = offsetHeight2 + \"px\";\n       }\n\n       if (height) {\n           row1.style.height = row2.style.height = height;\n       }\n   }\n\n   function getCommand(commands, name) {\n       var idx, length, command;\n\n       if (typeof commands === STRING && commands === name) {\n          return commands;\n       }\n\n       if (isPlainObject(commands) && commands.name === name) {\n           return commands;\n       }\n\n       if (isArray(commands)) {\n           for (idx = 0, length = commands.length; idx < length; idx++) {\n               command = commands[idx];\n\n               if ((typeof command === STRING && command === name) || (command.name === name)) {\n                   return command;\n               }\n           }\n       }\n       return null;\n   }\n\n   function compareElements(element, toCompare) {\n       if (element.length !== toCompare.length) {\n           return false;\n       }\n\n       for (var i = 0; i < element.length; i++) {\n           if (element[i] !== toCompare[i]) {\n               return false;\n           }\n       }\n\n       return true;\n   }\n\n   function focusTable(table, direct) {\n       if (!table || table.length === 0) {\n           return;\n       }\n\n       if (direct === true) {\n           table = $(table);\n           var scrollLeft = kendo.scrollLeft(table.parent());\n\n            kendo.focusElement(table);\n            kendo.scrollLeft(table.parent(), scrollLeft);\n        } else {\n            $(table).one(\"focusin\", function(e) { e.preventDefault(); }).trigger(\"focus\");\n        }\n    }\n\n   function isColumnGroupable(grid, column) {\n       return grid.options.groupable && (column.groupable || column.groupable === undefined);\n   }\n\n   function isGroupedBy(groups, field) {\n       return !!$.grep(groups, function(item) {\n           return item.field === field;\n       }).length;\n   }\n\n   function isColumnEditable(column, model) {\n       if (!column.field || column.selectable) {\n           return false;\n       }\n       if (model.editable && !model.editable(column.field)) {\n           return false;\n       }\n       if (column.editable && !column.editable(model)) {\n           return false;\n       }\n       return true;\n   }\n\n   function isInputElement(element) {\n       return $(element).is(\":button,a,:input,a>.k-icon,textarea,span.k-select,span.k-icon,span.k-link,label.k-checkbox-label,.k-input,.k-multiselect-wrap,.k-picker-wrap,.k-picker-wrap>.k-selected-color,.k-tool-icon,.k-dropdownlist,.k-switch-thumb,.k-switch-track,.k-switch-label-off,.k-switch-label-on\");\n   }\n\n    function tableClick(e) {\n        var that = this,\n            currentTarget = $(e.currentTarget),\n            isHeader = currentTarget.is(\"th\"),\n            table = this.table.add(this.lockedTable),\n            headerTable = this.thead.parent().add($(\">table\", this.lockedHeader)),\n            isInput = isInputElement(e.target),\n            preventScroll = $(e.target).is('.k-checkbox'),\n            target = $(e.target),\n            currentTable = currentTarget.closest(\"table\")[0];\n\n        if (isInput && currentTarget.find(kendo.roleSelector(\"filtercell\")).length) {\n            this._setCurrent(currentTarget);\n            return;\n        }\n\n        if (currentTable !== table[0] && currentTable !== table[1] && currentTable !== headerTable[0] && currentTable !== headerTable[1]) {\n            return;\n        }\n\n        if (target.is(\"a.k-i-expand, a.k-i-collapse\")) {\n            return;\n        }\n\n        if (this.options.navigatable) {\n            this._setCurrent(currentTarget, false, preventScroll);\n        }\n\n        if (isHeader || !isInput) {\n            setTimeout(function() {\n                var activeEl = $(kendo._activeElement());\n                if ((activeEl.hasClass(\"k-widget\") || activeEl.hasClass(\"k-dropdownlist\")) && !activeEl.hasClass(\"k-grid-pager\")) {\n                    return;\n                }\n\n                //Only if input element is not selected yet and it is not descendant of the grid's table\n                if (that.table && (activeEl.is(CHECKBOXINPUT) || !isInputElement(kendo._activeElement()) || !$.contains(currentTable, kendo._activeElement()))) {\n                    //DOMElement.focus() only for header, because IE doesn't really focus the table\n                    focusTable(that.table[0], true);\n                }\n            });\n        }\n\n        if (isHeader && !kendo.support.touch) {\n            e.preventDefault(); //if any problem occurs, call preventDefault only for the clicked header links\n        }\n    }\n\n   function leftMostPosition(element, rtl) {\n       if (!rtl) {\n           return 0;\n       }\n\n       var result = 0;\n\n       if (kendo.support.browser.webkit) {\n           result = element.width();\n       }\n\n       return result;\n   }\n\n   function parseVirtualSettings(options) {\n        var asLowerString;\n\n        if (typeof options === \"string\") {\n            asLowerString = options.toLowerCase();\n            if (asLowerString === \"true\") {\n                return {\n                    rows: true\n                };\n            } else {\n                return {\n                    rows: asLowerString.indexOf(\"rows\") > -1,\n                    columns: asLowerString.indexOf(\"columns\") > -1\n                };\n            }\n\n        } else if (options === true) {\n            return {\n                rows: true\n            };\n        }\n   }\n\n   function isElementVisibleInWrapper(wrapper, element) {\n       var offsetTop;\n       var halfHeight;\n\n       if (!wrapper) {\n         return false;\n       }\n\n       element = $(element);\n\n       if (element[0] && contains(wrapper[0], element[0])) {\n           offsetTop = element.offset().top - wrapper.offset().top;\n           halfHeight = element.outerHeight() / 2;\n\n           if ((offsetTop >= 0 || math.abs(offsetTop) <= halfHeight) && (math.floor(offsetTop + halfHeight) <= wrapper.height())) {\n               return true;\n           }\n       }\n\n       return false;\n   }\n\n   function isInEdit(cell) {\n       return cell &&\n           (cell.hasClass(\"k-edit-cell\") ||\n            cell.parent().hasClass(\"k-grid-edit-row\"));\n   }\n\n    function groupHtmlBuilder(groupHeaderColumnTemplate, groupHeaderBuilder, colspan, templateColspan, groupData, level, text, expanded, group, isGroupPaged) {\n        var html;\n\n        if (groupHeaderColumnTemplate) {\n            html = groupHeaderColumnTemplate(extend({}, groupData, {\n                groupCells: level,\n                colspan: templateColspan,\n                text: text\n            }));\n        } else {\n            html = groupHeaderBuilder(colspan, level, text, expanded, group.uid, isGroupPaged);\n        }\n\n        return html;\n    }\n\n   function groupCellBuilder(headerTemplateIndex) {\n    return '<td colspan=\"#=data.colspan +' + headerTemplateIndex + '#\">' +\n    '<p class=\"k-reset\">' +\n    '<a class=\"k-icon k-i-collapse\" href=\"\\\\#\" tabindex=\"-1\" ' +\n    ARIALABEL + '=\"' + COLLAPSE +\n    '\"></a>#=data.text#' +\n    '</p></td>';\n   }\n\n   function groupCellLockedContentBuilder(headerTemplateIndex) {\n    return '<td colspan=\"' + headerTemplateIndex + '\">' +\n    '<p class=\"k-reset\">&nbsp;</p></td>';\n   }\n\n   function groupRowBuilder(colspan, level, text, expanded, uid, includeAdditionalData) {\n    return '<tr ' + (includeAdditionalData ? 'data-group-uid=\"' + uid + '\"' : '') + 'class=\"k-grouping-row\">' + groupCells(level) +\n        '<td colspan=\"' + colspan + '\" aria-expanded=\"' + !!expanded + '\">' +\n        '<p class=\"k-reset\">' +\n        '<a class=\"k-icon ' + (expanded ? 'k-i-collapse' : 'k-i-expand') + '\" href=\"#\" tabindex=\"-1\" ' + ARIALABEL + '=\"' + (expanded ? COLLAPSE : EXPAND) + '\"></a>' + text +\n    '</p></td></tr>';\n   }\n\n   function groupRowLockedContentBuilder(colspan) {\n    return '<tr class=\"k-grouping-row\">' +\n        '<td colspan=\"' + colspan + '\" aria-expanded=\"true\">' +\n        '<p class=\"k-reset\">&nbsp;</p></td></tr>';\n   }\n\n   function toggleRow(row, visible) {\n       row = $(row)[0];\n       if (visible) {\n           row.style.display = \"\";\n       } else {\n           row.style.display = \"none\";\n       }\n   }\n\n   function htmlEncode(value, backslashEscapeQuotes) {\n       var ampRegExp = /&/g,\n           ltRegExp = /</g,\n           quoteRegExp = /\"/g,\n           aposRegExp = /'/g,\n           gtRegExp = />/g;\n\n       return (\"\" + value)\n           .replace(ampRegExp, \"&amp;\")\n           .replace(ltRegExp, \"&lt;\")\n           .replace(gtRegExp, \"&gt;\")\n           .replace(quoteRegExp, function(match) {\n               if (backslashEscapeQuotes) {\n                   return \"\\\\\" + match;\n               }\n               return \"&quot;\";\n           })\n           .replace(aposRegExp, \"&#39;\");\n   }\n\n   function getTitle(field, columns) {\n        return columns.filter(function(col) {\n            return col.field === field;\n        })[0].title || field;\n    }\n\n    function exportDataSort(a, b) {\n        return this.dataSource.indexOf(this.dataSource.getByUid(a.uid)) - this.dataSource.indexOf(this.dataSource.getByUid(b.uid));\n    }\n\n    function isExcelExportableColumn(column) {\n        return !(column.exportable === false || (column.exportable && column.exportable.excel === false));\n    }\n\n   ui.plugin(Grid);\n   ui.plugin(VirtualScrollable);\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","depends","features","GroupsPager","$","window","kendo","jQuery","undefined","ui","DataSource","data","ObservableObject","tbodySupportsInnerHtml","support","tbodyInnerHtml","activeElement","_activeElement","Widget","outerWidth","_outerWidth","outerHeight","_outerHeight","keys","isPlainObject","extend","map","grep","isArray","Array","inArray","push","prototype","isFunction","isEmptyObject","contains","math","Math","DOT","PROGRESS","ERROR","HIERARCHY_CELL_CLASS","DATA_CELL","attr","SELECTION_CELL_SELECTOR","NAVROW","NAVCELL","ITEMROW","COLGROUP","HEADERCELLS","WRAPPER","NS","CONTENTRLOCKEDCONTAINER","GROUPCELLCLASS","EDIT","BEFOREEDIT","SAVE","REMOVE","DETAILINIT","FILTERMENUINIT","COLUMNMENUINIT","FILTERMENUOPEN","COLUMNMENUOPEN","CELLCLOSE","CHANGE","COLUMNHIDE","COLUMNSHOW","SAVECHANGES","DATABOUND","DETAILEXPAND","DETAILCOLLAPSE","ITEM_CHANGE","PAGE","PAGING","SCROLL","SYNC","LOAD_START","LOAD_END","FOCUSED","FOCUSABLE","SELECTED","CHECKBOX","CHECKBOXINPUT","NORECORDSCLASS","LINK_CLASS","ICON_CLASS","ORDER_CLASS","SORTED_CLASS","HEADER_COLUMN_MENU_CLASS","FILTER_MENU_CLASS","STICKY_CELL_CLASS","STICKY_HEADER_CLASS","STICKY_FOOTER_CLASS","STICKY_HEADER_NO_BORDER_CLASS","RESIZE","COLUMNRESIZE","COLUMNREORDER","COLUMNLOCK","COLUMNUNLOCK","COLUMNSTICK","COLUMNUNSTICK","ROWREORDER","NAVIGATE","CLICK","MOUSEDOWN","HEIGHT","TABINDEX","FUNCTION","STRING","BOTTOM","CONTAINER_FOR","FIELD","INPUT","INCELL","INLINE","UNIQUE_ID","MINCOLSPANVALUE","COLSPAN","OVERFLOW","HIDDEN","SORT","GROUP_SORT","DELETECONFIRM","NORECORDS","CONFIRMDELETE","CANCELDELETE","COLLAPSE","EXPAND","ARIALABEL","formatRegExp","templateHashRegExp","whitespaceRegExp","leftRegExp","RegExp","rightRegExp","nonDataCellsRegExp","filterRowRegExp","COMMANDBUTTONTMPL","SELECTCOLUMNTMPL","SELECTCOLUMNHEADERTMPL","DRAGHANDLECOLUMNTMPL","SORTHEADERTMPL","isRtl","browser","isIE11","msie","version","isMac","test","navigator","userAgent","classNames","content","widget","scrollContainer","headerCellInner","Pager","init","element","options","fn","call","this","dataSource","useRanges","_omitPrefetch","totalPages","that","ceil","_collapsedTotal","pageSize","groupsTotal","VirtualScrollable","_refreshHandler","refresh","bind","setDataSource","wrap","unbind","virtual","itemHeight","noop","prefetch","maxScrollHeight","events","destroy","wrapper","add","verticalScrollbar","off","clearTimeout","_timeout","_scrollingTimeout","drag","scrollbar","css","width","overflow","children","first","parent","on","_wheelScroll","_wrapper","kineticScrollNeeded","touch","UserEvents","global","allowSelection","start","e","sender","capture","move","scrollTop","y","delta","scrollLeft","x","preventDefault","appendTo","_scroll","overflow-y","ctrlKey","wheelDeltaY","clientHeight","scrollHeight","delayLoading","currentTarget","rowHeight","skip","_rangeStart","height","innerHeight","isScrollingUp","_scrollbarTop","firstItemIndex","max","floor","lastItemOffset","lastItemIndex","_preventScroll","_prevScrollTop","_scrollTop","_scrolling","_fetch","trigger","setTimeout","_page","take","scrollToTop","_scrollTo","scrollToBottom","_scrollWrapperToTop","_scrollWrapperToBottom","_scrollWrapperOnColumnResize","initialScrollTop","scrollWidth","clientWidth","_wrapperScrolled","_isScrolledToBottom","_isWrapperScrolledToBottom","_isScrolledToTop","parseInt","itemIndex","rowIndex","rangeStart","position","index","result","scrollIntoView","row","container","containerHeight","containerScroll","elementOffset","offsetTop","elementHeight","offsetHeight","scrollingUp","currentSkip","fetching","prefetchAt","webkitCorrection","webkit","total","_isGroupPaged","min","_fetching","callback","isGroupPaged","_groupRangeExists","inRange","range","repaintScrollbar","shouldScrollWrapper","html","maxHeight","wrapperElement","totalHeight","idx","wasScrolledToBottom","addScrollBarHeight","offsetWidth","action","cancel","page","attrEquals","attrName","attrValue","groupCells","count","join","stringifyAttributes","attributes","defaultCommands","create","text","className","iconClass","save","edit","update","themeColor","canceledit","excel","pdf","search","cursor","context","value","document","body","reorder","selector","source","dest","before","sourceIndex","eq","elements","lockedContent","filter","find","attachCustomCommandEvent","commands","length","command","commandName","click","replace","normalizeColumns","columns","encoded","hide","locked","parentIds","column","field","hidden","isVisible","addHiddenStyle","footerAttributes","headerAttributes","uid","guid","headers","columnParent","parents","columnParents","inserted","splice","setColumnVisibility","visible","setVisibility","show","method","removeHiddenStyle","setColumnMediaVisibility","setColumnMatchesMedia","hideByMedia","_hideByMedia","matchesMedia","columnMatchesMedia","isUndefined","media","isCellVisible","style","display","isElementVisible","visibleColumns","columnsWithMedia","i","minScreenWidth","Error","concat","toJQuery","toArray","updateCellRowSpan","cell","sourceLockedColumnsCount","lockedColumnDepth","depth","lockedColumns","nonLockedColumnDepth","nonLockedColumns","rowSpan","findColumnByField","moveCellsBetweenContainers","sources","target","leafs","destination","groups","sourcesDepth","targetDepth","rows","insertAfter","last","addRowSpanValue","moveCells","updateCellIndex","thead","offset","allColumns","leafColumns","cells","el","hasClass","columnPosition","temp","sourcePosition","columnVisiblePosition","ths","t","cellCounts","findParentColumnWithChildren","rtl","targetLocked","findReorderTarget","masterColumns","parentColumns","targetIndex","flatColumnsInDomOrder","flatColumns","targetParentContainerIndex","hiddenLeafColumnsCount","counter","sumWidths","cols","columnsWidth","colWidth","indexOf","removeRowSpanValue","removeEmptyRows","emptyRowsCount","remove","mapColumnToCellRows","setLeftAndRightStyles","left","right","createColumnAttribute","attribute","property","addColumnAttribute","removeColumnAttribute","stickyColumns","sticky","visibleStickyColumns","visibleNonLockedColumns","visibleLockedColumns","visibleLeafColumns","visibleLeafExportColumns","values","childColumns","visibleChildColumns","getColumnsFields","editField","title","format","editor","editorOptions","label","leafDataCells","indexAttr","sort","a","b","indexA","indexB","parentColumnsCells","closest","headerRows","level","parentCellsWithChildren","prevCells","prevAll","colSpan","parentCell","getAttribute","childColumnsCells","colSpanAttr","child","next","appendContent","tbody","table","empty","placeholder","tmp","innerHTML","createElement","firstChild","replaceChild","match","hasHiddenStyle","normalizeCols","hasDetails","colgroup","is","append","prepend","normalizeHeaderCells","lastIndex","len","th","insertBefore","convertToObject","array","item","formatGroupValue","columnValues","isForeignKey","groupValue","htmlEncode","setCellVisibility","pad","state","hideColumnCells","columnIndex","groupRows","hasSubgroups","items","groupFooters","aggregates","showColumnCells","updateColspan","toAdd","toRemove","num","tableWidth","Grid","DataBoundWidget","_events","_element","_ariaId","_columns","_foreignKeyPromises","when","apply","then","_continueInit","_dataSource","_stickyColumns","_tbody","_thead","_groupable","_toolbar","_pageable","_setContentHeight","_templates","_navigatable","_selectable","_clipboard","_details","_editable","_attachCustomCommandsEvent","_adaptiveColumns","_minScreenSupport","autoBind","fetch","_group","_groups","_footer","addClass","_resizeHandler","resize","notify","scrollable","scrollableContent","leftMostPosition","groupable","virtualScrollable","navigatable","selectable","toolbar","filterable","sortable","allowCopy","pageable","persistSelection","editable","encodeTitles","rowTemplate","altRowTemplate","noRecords","resizable","reorderable","columnMenu","detailTemplate","columnResizeHandleWidth","mobile","loaderType","messages","cancelDelete","confirmation","confirmDelete","expandCollapseColumnHeader","groupHeader","ungroupHeader","itemsSelected","dragHandleLabel","toolbarLabel","groupingHeaderLabel","filterCellTitle","_angularItems","_destroyColumnAttachments","_navigatableTables","_headertables","pager","timer","_progressTimeOut","_collapseGroupsTimeOut","_endlessFetchTimeOut","_destroyGroupable","_hasReorderableRows","clearArea","_selectedIds","copyHandler","updateClipBoardState","clearAreaHandler","_resizeUserEvents","_resizeHandleDocumentClickHandler","_destroyVirtualScrollable","editableUserEvents","_lockedContentUserEvents","_destroyEditable","_progressHandler","_errorHandler","_clearSortClasses","_sortHandler","lockedHeader","_removeLockedContainers","pane","_isMobile","minScreenResizeHandler","_detachColumnMediaResizeHandler","_draggableInstance","_draggableRowsInstance","lockedRowTemplate","lockedAltRowTemplate","footerTemplate","groupFooterTemplate","lockedGroupFooterTemplate","noRecordsTemplate","scrollables","footer","lockedTable","lockedFooter","_groupableClickHandler","_groupRows","_setContentWidthHandler","getOptions","deepExtend","initialData","_data","group","aggregate","transport","$angular","setOptions","currentOptions","mobileWrapper","roleSelector","after","removeClass","_setEvents","_items","includeGroupRows","tr","dataItems","n","resizeHandle","angular","get","each","filterMenu","_aria","gridRole","_hasDetails","groupingHeader","gridId","tableTabindex","tbodyId","headerGroupId","footerGroupId","tableOwned","numberOfFixedRows","trailingColumns","_trailingColumns","virtualScroll","rowsCount","role","tabindex","_ariaRowIndex","_ariaColumnIndex","aria-label","aria-controls","_ariaHeaderFooter","_ariaLockedContent","dataVirtual","not","lockedHeaderRows","firstIndex","Number","MAX_VALUE","lockedLastIndex","previousVirtual","nextVirtual","previousIndex","dataIndex","cellsIndex","eachHeaderCell","j","current","currentIndex","lockedParent","setAttribute","prev","type","groupId","rowGroup","_ariaLocked","_cellId","lockedRows","ownedCells","_cellsIds","tableRows","_ariaAddHiddenColIndex","leafColsCount","_ariaRemoveHiddenColIndex","removeAttr","numberOfHeaderRows","bodyRows","footerRows","totalNumberOfItems","previousItems","previousMaster","currentRow","prefix","_createResizeHandle","indicatorWidth","halfResizeHandle","rtlCorrection","headerWrap","ieCorrection","firefoxCorrection","leftMargin","invisibleSpace","leftBorderWidth","top","mozilla","parseFloat","_autoFitLeafColumn","_positionColumnResizeHandle","lockedHead","button","buttons","which","hasAttribute","_resizeHandleDocumentClick","_resetResizeHandleHeader","_hideResizeHandle","_positionColumnResizeHandleTouch","threshold","minHold","hold","resizeColumn","columnWidth","isLocked","isHidden","mobileOS","contentTable","header","columnMinWidth","minResizableWidth","gridWidth","col","constrain","totalWidth","_footerWidth","_scrollVirtualWrapperOnColumnResize","_applyLockedContainersWidth","_syncLockedContentHeight","_syncLockedHeaderHeight","_updateStickyColumns","_resizable","columnStart","isMobile","Resizable","handle","hint","location","rtlMultiplier","currentWidth","resizeend","newWidth","oldWidth","_draggable","kendoDraggable","autoScroll","dragstart","dragend","_reorderable","kendoReorderable","draggable","dropFilter","dragOverContainers","lockable","inSameContainer","change","oldIndex","newIndex","reorderColumn","_reorderHeader","destPosition","sourceLockedColumns","targetLockedColumns","_reorderContent","visibleSources","destIndex","colSourceIndex","colDest","lockedCount","headerCol","footerCol","beforeVisibleColumn","columnsArray","_findClosestVisibleColumnIndex","slice","_hasFilterRow","_hasVirtualColumns","reverse","closestVisibleColumn","leafIndex","autoFitColumn","_hasDragHandleColumn","_draggableRows","_checkBoxSelection","Selectable","parseOptions","select","clone","elm","innerText","_reorderableRows","smartPosition","allowIcon","orientation","reorderDropCue","positionDropCue","dropTarget","firstCellLeft","getOffset","transform","externalDraggable","_triggerRowRorder","args","reorderRows","rowsLength","targetItem","dataItem","_rowDropping","pushMove","autoFitColumns","headerTable","leafCols","visibleLocked","minWidth","contentDiv","notGroupOrHierarchyCol","notGroupOrHierarchyVisibleCell","menu","thWidth","footerTable","tables","safari","oldColumnWidth","newColumnWidth","destColumn","lockChanged","groupHeaderColumnTemplateColumns","groupHeaderColumnTemplate","sourceColumns","_updateLockedCols","_updateCols","_updateColumnCellIndex","_updateColumnSorters","_renderGroupRows","_updateTablesWidth","_updateFirstColumnClass","lockColumn","unstickColumn","unlockColumn","stickColumn","_removeStickyAttributes","_removeStickyStyles","_anyStickyColumns","_updateStickyFilterCells","cellIndex","td","lockedColumnOffset","_modelForContainer","_editMode","getByUid","_calculateColumnIndex","virtualOffset","handler","_editContainer","end","closeCell","_scrollVirtualWrapper","mode","editContainer","_mousedownOnEditCell","tap","isLockedCell","has","editCell","shouldCloseCell","_virtualColScroll","_belongsToGrid","editRow","_isVirtualInlineEditable","stopPropagation","removeRow","_confirmation","model","isColumnEditable","_attachModelChange","_shouldClearEditableState","_clearEditableState","kendoEditable","fields","skipFocus","_isVirtualIncellEditable","_editableState","adjustRowHeight","_relatedRow","_syncLockedScroll","_adjustLockedHorizontalScrollBar","touchScroller","_adjustRowsHeight","syncTableHeight","_syncLockedFooterHeight","editView","_editCancelClickHandler","_editUpdateClickHandler","_detachModelChange","_destroyEditView","_editableIsClosing","close","_confirmDialog","purge","navigate","_modelChangeHandler","_modelChange","isCancel","_displayCell","ns","storage","settings","Template","templateSettings","tmpl","template","_cellTmpl","_removeRow","modelId","key","schema","cancelRow","_removeGroupIfEmpty","idField","sync","_createPopupEditor","_createInlineEditor","_editCancelClick","_editUpdateClick","saveRow","_setCurrent","focusTable","_editFields","updateText","cancelText","updateIconClass","cancelIconClass","tempCommand","editMenuGuid","buttonsHTML","unescape","getCommand","_createButton","kendoWindow","modal","userTriggered","Form","buttonsTemplate","formData","clearContainer","_openPopUpEditor","windowEditor","windowOptions","center","open","_editAnimation","Editable","cancelChanges","_displayRow","deferred","Deferred","valid","resolve","promise","reject","related","newRow","nextRow","isSelected","isAlt","replaceWith","angularElements","angularData","_showMessage","confirm","confirmDialog","Confirm","preventScroll","closable","okText","done","fail","_isVirtualEditable","_virtualPageToTop","saveChanges","addRow","createAt","view","createAtBottom","toLowerCase","virtualEditable","serverPaging","_removeCurrent","_virtualAddRow","insert","_editModel","_firstEditableColumnIndex","_virtualAddRowAtBottom","_virtualAddRowAtTop","at","_virtualPageToBottom","_virtualPage","_toolbarTmpl","prependTo","saveAsExcel","saveAsPDF","_pdfInitialized","input","_searchTimeOut","searchFields","expression","filters","logic","endless","_endlessPageSize","_pushExpression","isServerFiltering","serverFiltering","defaultOperators","string","number","date","enums","boolean","operator","modelInfo","reader","fieldInfo","parseFn","parse","searchText","attributeClassMatch","split","renderButton","_hasFooters","groupRow","collapseGroup","expandGroup","_isLocked","_attachGroupable","draggables","enabled","chrome","Groupable","groupContainer","draggableElements","allowDrag","removeGroup","_showUngroupedColumn","_hideGroupedColumns","_resetEndless","_addGroupableOptionsToHeader","colID","hideOnGroup","showColumn","hideColumn","_skip","_pageSize","_take","columnFieldMap","headerCells","_headerCells","cellFieldAttr","headerCell","columnOptions","kendoGroupable","_removeGroupableOptionsFromHeader","removeData","_continuousItems","lockedItems","nonLockedItems","multi","notString","multiple","aria","dragToSelect","selectedValues","_persistSelectedRows","_uncheckCheckBoxes","_checkRows","_toggleHeaderCheckState","event","useAllItems","relatedTarget","continuousItems","ignoreOverlapped","addIdToRanges","eventObject","triggerChange","lastSelection","keyCode","SPACEBAR","shiftKey","clear","_deselectCheckRows","_lastActive","LEFT","RIGHT","UP","DOWN","selectRange","_firstSelectee","compareElements","grid","stopImmediatePropagation","tableClick","copySelection","areaClipBoard","val","getTSV","copySelectionToClipboard","includeHeaders","_createAreaClipBoard","execCommand","Event","metaKey","getSelection","toString","selection","createRange","opacity","selected","delimeter","onlyVisible","hasLockedCols","cellsOffset","lockedCols","inLockedArea","_getCellField","cellText","rowsOffset","getTitle","headerIndex","findIndex","_anyColumnHasMediaQuery","_setColumnsMediaVisibility","_attachColumnMediaResizeHandler","_columnsWithMediaQuery","_columnMediaResizeHandler","_onColumnMediaResize","_setContentMediaWidth","_setColumnMediaVisibility","_showColumnByMedia","_hideColumnByMedia","initiallyHidden","headerColumns","headerColgroup","headerColumnsCount","visibleHeaderColumnsCount","hiddenHeaderColumnsCount","totalHeaderWidth","currentHeaderWidth","colgroupChild","columnStyleWidth","any","hideMinScreenCols","screenWidth","innerWidth","screen","_iterateMinScreenCols","_setStickyColumns","filterCells","stickyStyle","updateStyles","stickyWidths","_calculateStickyWidths","_setStickyClassAttributes","_setStickyStyleAttributes","_setStickyStyles","initialLeftWidth","initialRightWidth","nextColumnLeft","nextColumnRight","fill","_sumColumnWidth","masterIndex","stickyLeft","stickyRight","childCols","childStickyWidths","cellClassRegExp","headerClassRegExp","footerClassRegExp","headerClassNoBorderRegExp","leafsCols","_getColumnHeader","groupHeaderColumnTemplateClass","_sumCurrentWidths","getSelectedData","selectedRanges","selectedRangeNames","Object","selectedSingleItems","_mapSelectionToData","exportSelectedToExcel","ooxml","exporter","ExcelExporter","columnHandler","autoWidth","book","sheets","freezePane","exportData","sortHandler","exportDataSort","isExcelExportableColumn","_addRangeSelectionRows","_addSingleSelectionRows","workbook","Workbook","skipCustomHeight","toDataURLAsync","dataURI","saveAs","fileName","proxyURL","forceProxy","_setExporterColumns","_createExportRows","_rows","_dataRows","_prepareColumn","columnsFilter","elementType","nodeName","isRowSelection","curr","columnMapHandler","fieldAttr","_relatedCell","clearSelection","selectableoptions","checked","prop","rangeSelectedAttr","allRows","dataSourceOptions","selectedViewIds","selectedKeyNames","ids","_updateCurrentAttr","headerId","nextId","descId","_current","_scrollCurrent","tableContainer","isInLockedContainer","isInContent","scrollableContainer","addBack","_rowVirtualIndex","preventTrigger","_filterFocusable","siblings","colspan","_virtualCellIndex","_lastCellIndex","_updateSelctCheckbox","nextCheckbox","focus","elementToLowercase","tagName","isHorizontal","elementOffsetDir","containerOffsetDir","abs","offsetLeft","bottomDistance","edge","dataTables","headerTables","_tableFocus","_tableBlur","_tableKeyDown","_filterFocus","_findCellIndex","startIndex","reversed","_scrollToColumn","HOME","END","requestInProgress","canHandle","isDefaultPrevented","altKey","handled","_moveUp","_moveDown","_moveRight","_moveLeft","PAGEDOWN","_handlePageDown","PAGEUP","_handlePageUp","_handleHome","_handleEnd","_handleSpaceKey","ENTER","F2","_handleEnterKey","ESC","_handleEscKey","TAB","_handleTabKey","currentTable","collapseRow","_moveColumn","_prevHorizontalCell","_tabNext","_horizontalContainer","expandRow","_nextHorizontalCell","nextAll","_prevVerticalCell","_verticalContainer","_nextVerticalCell","isLeft","ctrl","rowContainer","isInLockedTable","isInBody","isInCell","filterFocusable","_handleEditing","active","isInEdit","blur","_toggleCurrent","descriptors","_canDrag","dir","link","focusable","originalIndex","_currentDataIndex","lockedColumnsCount","tmpIndex","currentRowCells","hiddenColumns","up","step","back","switchRow","isIE","isEdited","_initMobile","_createPane","Pane","viewEngine","viewOptions","renderOnInit","wrapInSections","detachOnHide","detachOnDestroy","_scrollable","hasVirtualScroll","parseVirtualSettings","_createVirtualScrollable","_scrollLeft","isScrollingLeft","originalPageSize","_endlessFetchInProgress","_skipRerenderItemsCount","_cacheEditableState","_restoreEditableState","movable","one","_averageRowHeight","scroll","_focusEditable","loadStart","_progress","loadEnd","_onVirtualPaging","_isVirtualPopupEditable","editableState","editedModel","inlineMode","incellMode","virtualColumns","_getByUid","editedField","_canFocusEditable","isElementVisibleInWrapper","widgetInstance","_renderNoRecordsContent","noRecordsElement","_setContentWidth","hiddenDivClass","hiddenDiv","expander","isNaN","contentWidth","nonLockedCols","nonLockedColsWidth","footerWrap","scrollableHeight","isGridHeightSet","initialHeight","newHeight","itemsCount","_rowHeight","_sum","_measures","currentRowHeight","_requestStart","_error","relatedRow","selectableRow","childCells","originalCells","pagerWrap","_groupPaging","_togglePagerVisibility","_wrapFooter","_appendLockedColumnFooter","footerRow","_appendCols","_columnMenu","menuOptions","hasMultiColumnHeaders","hasLockableColumns","hasStickableColumns","stickable","initCallback","openCallback","closeCallback","stickCallback","unstickCallback","filterHandler","compare","forceUnique","checkSource","owner","stick","unstick","filtering","componentType","kendoColumnMenu","_hasFilterMenu","_filterable","filterInit","filterOpen","columnFilterable","kendoFilterMultiCheck","kendoFilterMenu","_filterRow","rowheader","_updateHeader","suggestDataSource","operators","customDataSource","cellOptions","delay","inputWidth","suggestionOperator","minLength","dataTextField","showOperators","kendoFilterCell","_sortable","sorterInstance","kendoColumnSorter","draggableColumns","initialColumns","_updateColumnIDs","_checkboxClick","_headerCheckboxClick","_foreignKeyBindings","_fetchForeignKeyValues","_hasBoundForeignKey","dataValueField","checkBox","isSelecting","_tmpl","alt","skipGroupCells","paramName","dirtyCellTemplate","classAttribute","expr","_dirtyCellTemplate","dirtyField","charAt","_headerCellText","headerTemplate","_dirtyIndicatorTemplate","stringify","useWithBlock","_virtualCols","widths","c","sumOfWidths","colsToRender","firstColspan","lastColspan","widthOfHiddenColumns","considerNext","virtualCols","columnLeafs","columnsLocked","groupHeaderColumnTemplateLockedColumns","groupHeaderColumnTemplateNonLockedColumns","_detailTmpl","_footerTmpl","g","_groupHeaderTmpl","lockedGroupHeaderColumnTemplate","_noRecordsTmpl","defaultTemplate","scrollableNoGridHeightStyles","templateName","rowClass","scope","fieldsMap","_emptyAggregates","headerTemplateIndex","groupCellBuilder","groupCellLockedContentBuilder","templateFunctionStorage","templateFunctionCount","hasFiltering","columnsWithoutFiltering","_toggleDetails","omitAnimation","expanding","masterRow","masterRowIndex","detailRow","ariaLabelText","ariaExpandText","toggleClass","detailCell","toggleRow","toggle","classesRegEx","sectionRowIndex","correctIdx","_createHeaderCells","isColumnGroupable","isGroupedBy","_appendLockedColumnContent","skipHiddenCount","spanIdx","colOffset","detach","lockedCells","_appendLockedColumnHeader","trFilter","filtercellCells","hasFilterRow","filterCellOffset","leafColumnsCount","hasTHead","headerContent","_prepareColumns","_updateHeadersAttr","filterRow","existingFilterRow","syncHeight","hasLockedColumns","_retrieveFirstColumn","parentRow","childRow","totalColSpan","_updateHeaderCols","_autoColumns","toJSON","_rowsHtml","templates","_groupData","skipFooter","firstColumn","footerDefaults","_groupAggregatesDefaultObject","groupItems","headerData","footerData","subgroupsCount","_groupRowHtml","groupHeaderBuilder","skipColspan","skipLastGroup","isLockedTable","firstVisibleColumnGroupHeaderTemplate","groupHeaderTemplate","currentItems","groupData","expanded","_groupsState","isNew","excludeHeader","groupHtmlBuilder","_skippedGroups","shift","groupToCollapse","showFooter","footerCount","relatedGroup","groupUid","groupObject","_getGroupByUid","currentGroupCount","_calculateGroupsTotal","groupCountAfterCollapse","_serverGroupsTotal","_currentRangeStart","toHide","_groupToCollapse","footersVisibility","groupsCount","groupCount","groupCountAfterExpand","toggleVisibility","pop","_firstDataItem","grouped","headerCellIndex","_columnVisibilitySetter","_setParentsVisibility","_updateContentWidth","predicate","p","originalColumn","columnLeafIndex","_buildSkeleton","loaderHTML","columnsCount","isVirtualization","skeleton","progress","_resize","size","force","_isActiveInTable","isCurrentInHeader","contentScrollLeft","cachedItemsToSkip","_renderContent","_renderLockedContent","_restoreCurrent","contentResized","resetTouchEvents","_muteAngularRebind","_restoreSelection","selectedRows","dataItemKey","cmd","_cleanupDetailItems","_angularGroupItems","_angularGroupFooterItems","endlessAppend","flatViewLength","flatView","groupRowLockedContentBuilder","groupRowBuilder","groupRowBuilderFunc","groupHeaderData","prevElement","newGroupRowElement","firstColumnGroupData","alwaysVisible","table1","table2","rows2","containers","containersLength","heights","offsetHeight1","offsetHeight2","ExcelMixin","PDFMixin","_drawPDF_autoPageBreak","allPages","origBody","cont","toggleUnexportableColumns","paddingRight","_initPDFProgress","startingPage","draw","_destructive","pageNumber","pageNum","drawing","drawDOM","always","err","renderPage","restore","exportable","visibleInExport","visibleInExportOnly","_toggledDuringExport","_drawPDF","paperSize","doc","Group","exportPage","_drawPDFShadow","avoidLinks","loading","pb","kendoProgressBar","chunkCount","lockedHeigth","tableHeigth","diff","row1","row2","toCompare","direct","focusElement","isInputElement","isHeader","isInput","activeEl","asLowerString","halfHeight","templateColspan","includeAdditionalData","backslashEscapeQuotes","ampRegExp","ltRegExp","quoteRegExp","aposRegExp","gtRegExp","plugin","amd","a1","a2","a3"],"mappings":"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"}