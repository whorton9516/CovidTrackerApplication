{"version":3,"file":"kendo.imageeditor.min.js","sources":["kendo.imageeditor.js"],"sourcesContent":["(function(f, define) {\n    define('imageeditor/toolbar',[\"kendo.toolbar\", \"kendo.dropdownlist\"], f);\n})(function() {\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        extend = $.extend,\n        ToolBar = kendo.ui.ToolBar,\n        TemplateItem = kendo.toolbar.TemplateItem,\n\n        CLICK = \"click\",\n        DROPDOWNCHANGE = \"dropDownChange\",\n        ACTION = \"action\";\n\n    var ImageEditorToolBar = ToolBar.extend({\n        init: function(element, options) {\n            var that = this;\n\n            that._extendOptions(options);\n\n            ToolBar.fn.init.call(that, element, options);\n\n            that._attachEvents();\n            that.toggleTools();\n        },\n\n        events: ToolBar.fn.events.concat([\n            DROPDOWNCHANGE,\n            ACTION\n        ]),\n\n        defaultTools: {\n            open: { type: \"button\", icon: \"upload\", name: \"open\", command: \"OpenImageEditorCommand\", showText: \"overflow\" },\n            save: { type: \"button\", icon: \"download\", name: \"save\", command: \"SaveImageEditorCommand\", showText: \"overflow\", toggleCondition: \"canExport\" },\n            separator: { type: \"separator\" },\n            undo: { type: \"button\", icon: \"undo\", name: \"undo\", command: \"UndoImageEditorCommand\", showText: \"overflow\", toggleCondition: \"undo\" },\n            redo: { type: \"button\", icon: \"redo\", name: \"redo\", command: \"RedoImageEditorCommand\", showText: \"overflow\", toggleCondition: \"redo\" },\n            separator1: { type: \"separator\" },\n            crop: { type: \"button\", icon: \"crop\", name: \"crop\", command: \"OpenPaneImageEditorCommand\", options: \"crop\", showText: \"overflow\", toggleCondition: \"canExport\" },\n            resize: { type: \"button\", icon: \"image-resize\", name: \"resize\", command: \"OpenPaneImageEditorCommand\", options: \"resize\", showText: \"overflow\", toggleCondition: \"canExport\" },\n            zoomIn: { type: \"button\", icon: \"zoom-in\", name: \"zoomIn\", command: \"ZoomImageEditorCommand\", showText: \"overflow\", options: \"zoomIn\", toggleCondition: \"enable\" },\n            zoomOut: { type: \"button\", icon: \"zoom-out\", name: \"zoomOut\", command: \"ZoomImageEditorCommand\", showText: \"overflow\", options: \"zoomOut\", toggleCondition: \"enable\" },\n            zoomDropdown: { type: \"imageEditorZoomDropDown\", name: \"zoomDropdown\", command: \"ZoomImageEditorCommand\", text: \"Zoom options\", toggleCondition: \"enable\" , items: [\n                { name: \"zoomActualSize\", icon: \"zoom-actual-size\", text: \"Show actual size\", options: \"actualSize\" },\n                { name: \"zoomFitToScreen\", icon: \"zoom-best-fit\", text: \"Fit to screen\", options: \"fitToScreen\" }\n            ] }\n        },\n\n        _attachEvents: function() {\n            var that = this;\n\n            that.bind(DROPDOWNCHANGE, that._dropDownChange.bind(that));\n            that.bind(CLICK, that._click.bind(that));\n        },\n\n        _extendOptions: function(options) {\n            var that = this,\n                tools = options.items ? options.items : Object.keys(that.defaultTools);\n\n            that.options = options;\n\n            that.options.items = that._extendToolsOptions(tools);\n        },\n\n        _extendToolsOptions: function(tools) {\n            var that = this,\n                messages = that.options.messages;\n\n            if (!tools.length) {\n                return;\n            }\n\n            return tools.map(function(tool) {\n                var isBuiltInTool = $.isPlainObject(tool) && Object.keys(tool).length === 1 && tool.name,\n                    toolOptions, text;\n\n                tool = isBuiltInTool ? tool.name : tool;\n                toolOptions = $.isPlainObject(tool) ? tool : extend({}, that.defaultTools[tool]);\n\n                text = messages[toolOptions.name] || toolOptions.text;\n\n                kendo.deepExtend(toolOptions, {\n                    id: toolOptions.name + \"-\" + kendo.guid(),\n                    name: toolOptions.name,\n                    text: text,\n                    attributes: {\n                        \"aria-label\": text,\n                        \"title\": text,\n                        \"data-command\": toolOptions.command,\n                        \"data-options\": toolOptions.options,\n                        \"data-toggle\": toolOptions.toggleCondition\n                    },\n                    overflow: toolOptions.overflow\n                });\n\n                if (toolOptions.type === \"imageEditorZoomDropDown\") {\n                    toolOptions.items = that._extendToolsOptions(toolOptions.items);\n                }\n\n                return toolOptions;\n            }, that);\n        },\n\n        _click: function(ev) {\n            var command = $(ev.target).data(\"command\"),\n                options = $(ev.target).data(\"options\");\n\n            if (!command) {\n                return;\n            }\n\n            this.action({\n                command: command,\n                options: options\n            });\n        },\n\n        _dropDownChange: function(ev) {\n            if (!ev.command) {\n                return;\n            }\n\n            this.action({\n                command: ev.command,\n                options: ev.options\n            });\n        },\n\n        action: function(args) {\n            this.trigger(ACTION, args);\n        },\n\n        toggleTools: function(conditions) {\n            var that = this,\n                tools = that.element.find(\"[data-toggle]\"),\n                focusable = that.element.find(\":kendoFocusable\").not(\"[tabindex=-1]\");\n\n            tools.each(function(index, elm) {\n                var tool = $(elm),\n                    widget = null,\n                    condition = tool.data(\"toggle\"),\n                    toToggle = conditions && conditions[condition];\n\n                if (tool.is(\"[data-role]\")) {\n                    widget = kendo.widgetInstance(tool);\n                }\n\n                if (widget && widget.enable) {\n                    widget.enable(toToggle || false);\n                } else {\n                    that.enable(tool, toToggle);\n                }\n            });\n\n            that.element.find(\":kendoFocusable\").not(\"[tabindex=-1]\").attr(\"tabindex\", -1);\n            focusable.attr(\"tabindex\", 0);\n        },\n\n        destroy: function() {\n            var that = this;\n\n            if (that.zoomDropdown) {\n                that.zoomDropdown.destroy();\n            }\n\n            ToolBar.fn.destroy.call(this);\n        }\n    });\n\n    var ImageEditorZoomDropDown = TemplateItem.extend({\n        init: function(options, toolbar) {\n            var that = this,\n                input = $(\"<input />\").attr(options.attributes),\n                template = \"<span class=\\\"k-icon k-i-#:icon#\\\"></span> #:text#\";\n\n                that.input = input;\n\n                delete options.attributes[\"aria-label\"];\n\n                that.dropDown = new ui.DropDownList(that.input, {\n                    optionLabel: { text: options.text, icon: \"\" },\n                    dataTextField: \"text\",\n                    dataSource: options.items,\n                    template: template,\n                    change: that._change.bind(that)\n                });\n\n                TemplateItem.fn.init.call(this, that.dropDown.wrapper, options, toolbar);\n\n                that.dropDown.list.find(\".k-list-optionlabel\").hide();\n\n                that.toolbar.zoomDropdown = that;\n        },\n        _change: function(ev) {\n            var that = this;\n            that.toolbar.trigger(DROPDOWNCHANGE, {\n                command: ev.sender.element.data(\"command\"),\n                options: ev.sender.dataItem().options\n            });\n        },\n        destroy: function() {\n            this.dropDown.destroy();\n        }\n    });\n\n    kendo.toolbar.registerComponent(\"imageEditorZoomDropDown\", ImageEditorZoomDropDown);\n\n    extend(kendo.ui, {\n        imageeditor: {\n            ToolBar: ImageEditorToolBar,\n            ZoomDropDown: ImageEditorZoomDropDown\n        }\n    });\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n(function(f, define) {\n    define('imageeditor/pane',[\"kendo.core\", \"kendo.form\", \"kendo.buttongroup\", \"kendo.draganddrop\"], f);\n})(function() {\n\n    (function($, undefined) {\n        var kendo = window.kendo,\n            extend = $.extend,\n            Class = kendo.Class,\n\n            NS = \".k-imageeditor-pane\",\n\n            CLICK = \"click\";\n\n        var paneStyles = {\n            form: \"k-imageeditor-pane-form\",\n            button: \"k-imageeditor-pane-button\",\n            confirmButton: \"k-imageeditor-pane-confirm-button\",\n            cropOverlay: \"k-imageeditor-crop-overlay\",\n            crop: \"k-imageeditor-crop\",\n            resizeHandle: \"k-resize-handle\",\n            resizeHandlePrefix: \"k-resize-\"\n        };\n\n        var round = function(f) {\n            return Math.round(f * 1000) / 1000;\n        };\n\n        var Pane = Class.extend({\n            init: function(imageeditor) {\n                var that = this;\n\n                that.imageeditor = imageeditor;\n\n                if (that.imageeditor.currentPaneTool) {\n                    that.imageeditor.currentPaneTool.destroy();\n                }\n\n                that.element = $(\"<div></div>\").addClass(paneStyles.form);\n            },\n            open: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    commonMessages = imageeditor.options.messages.common;\n\n                imageeditor.paneWrapper.append(that.element);\n                that.formWidget = new kendo.ui.Form(that.element, extend(that.formSettings(), {\n                    buttonsTemplate: kendo.format(\"<button class='{0} k-button k-button-md k-rounded-md k-button-solid k-button-solid-base' data-action='cancel'><span class='k-button-text'>{2}</span></button>\" +\n                                                    \"<button class='{0} {1} k-button k-button-md k-rounded-md k-button-solid k-button-solid-primary' data-action='confirm'><span class='k-button-text'>{3}</span></button>\",\n                                                    paneStyles.button,\n                                                    paneStyles.confirmButton,\n                                                    commonMessages.cancel,\n                                                    commonMessages.confirm)\n                }));\n\n                that.bindButtonEvents();\n                imageeditor.paneWrapper.show();\n                imageeditor.currentPaneTool = that;\n            },\n            bindButtonEvents: function() {\n                var that = this,\n                    formWidget = that.formWidget,\n                    buttons = formWidget.element.find(\".\" + paneStyles.button);\n\n                that._clickHandler = that._click.bind(that);\n\n                buttons.on(CLICK + NS, that._clickHandler);\n            },\n            _click: function(ev) {\n                var that = this,\n                    target = $(ev.target).closest(\".\" + paneStyles.button),\n                    action = target.data(\"action\");\n\n                if (that[action]) {\n                    that[action]();\n                }\n            },\n            cancel: function() {\n                this.destroy();\n            },\n            confirm: function() {\n                window.console.error(\"Pane's confirm method is not implemented!\");\n                this.destroy();\n            },\n            refresh: function() {\n            },\n            destroy: function() {\n                var that = this,\n                    imageeditor = that.imageeditor;\n\n                that.formWidget.element.find(\".\" + paneStyles.button).off(NS);\n                that.formWidget.destroy();\n                imageeditor.paneWrapper.html(\"\");\n                imageeditor.paneWrapper.hide();\n                delete imageeditor.currentPaneTool;\n            }\n        });\n\n        var CropPane = Pane.extend({\n            init: function(imageeditor) {\n                var that = this;\n                Pane.fn.init.call(that, imageeditor);\n                that.buildCropModel();\n                that.canvasUI();\n            },\n            confirm: function() {\n                var that = this,\n                    model = that.formWidget._model.toJSON();\n\n                that.destroy();\n\n                that.imageeditor.executeCommand({ command: \"CropImageEditorCommand\", options: model });\n            },\n            formSettings: function() {\n                var that = this,\n                    cropMessages = that.imageeditor.options.messages.panes.crop,\n                    commonMessages = that.imageeditor.options.messages.common,\n                    aspectRatioItems = cropMessages.aspectRatioItems,\n                    aspectRatioDS = [];\n\n                if (aspectRatioItems) {\n                    for (var key in aspectRatioItems) {\n                        aspectRatioDS.push({ value: key, text: aspectRatioItems[key] });\n                    }\n                } else {\n                    aspectRatioDS = [\n                        { value: \"originalRatio\", text: \"Original ratio\" },\n                        { value: \"1:1\", text: \"1:1 (Square)\" },\n                        { value: \"4:5\", text: \"4:5 (8:10)\" },\n                        { value: \"5:7\", text: \"5:7\" },\n                        { value: \"2:3\", text: \"2:3 (4:6)\" },\n                        { value: \"16:9\", text: \"16:9\" }\n                    ];\n                }\n\n                return {\n                    formData: that._model,\n                    change: that.onChange.bind(that),\n                    items: [{\n                        type: \"group\",\n                        label: cropMessages.title || \"Crop Image\",\n                        layout: \"grid\",\n                        grid: { cols: 2, gutter: \"0 8px\" },\n                        items: [{\n                                label: cropMessages.aspectRatio || \"Aspect ratio:\",\n                                field: \"aspectRatio\",\n                                editor: \"DropDownList\",\n                                editorOptions: {\n                                    dataValueField: \"value\",\n                                    dataTextField: \"text\",\n                                    dataSource: aspectRatioDS\n                                },\n                                colSpan: 2\n                            }, {\n                                label: cropMessages.orientation,\n                                field: \"orientation\",\n                                editor: that._orientationEditor.bind(that),\n                                colSpan: 2\n                            }, {\n                                label: commonMessages.width || \"Width:\",\n                                field: \"width\",\n                                attributes: { style: \"max-width: 100px;\" },\n                                editor: \"NumericTextBox\",\n                                editorOptions: {\n                                    format: \"n0\",\n                                    max: that._model.width,\n                                    min: 0\n                                },\n                                colSpan: 1\n                            }, {\n                                label: commonMessages.height || \"Height:\",\n                                field: \"height\",\n                                attributes: { style: \"max-width: 100px;\" },\n                                editor: \"NumericTextBox\",\n                                editorOptions: {\n                                    format: \"n0\",\n                                    max: that._model.height,\n                                    min: 0\n                                },\n                                colSpan: 1\n                            }, {\n                                label: commonMessages.lockAspectRatio || \"Lock aspect ratio\",\n                                field: \"lockAspectRatio\",\n                                colSpan: 2\n                            }\n                        ]\n                    }]\n                };\n            },\n            _orientationEditor: function(container, options) {\n                var that = this,\n                    cropMessages = that.imageeditor.options.messages.panes.crop,\n                    value = options.model[options.field];\n\n                that._orientationWidget = $(\"<div name='\" + options.field + \"'></div>\")\n                    .appendTo(container)\n                    .kendoButtonGroup({\n                        items: [\n                            { text: cropMessages.portrait || \"Portrait\", attributes: { \"data-value\": \"portrait\" }, selected: value === \"portrait\" },\n                            { text: cropMessages.landscape || \"Landscape\", attributes: { \"data-value\": \"landscape\" }, selected: value === \"landscape\" }\n                        ],\n                        select: function(ev) {\n                            var value = ev.sender.wrapper.find(\".k-selected\").data(\"value\");\n                            options.model.set(options.field, value);\n                        }\n                    }).data(\"kendoButtonGroup\");\n            },\n            buildCropModel: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    canvas = imageeditor.getCanvasElement(),\n                    width = canvas.width,\n                    height = canvas.height;\n\n                    that._model = {\n                        top: 0,\n                        left: 0,\n                        aspectRatio: \"originalRatio\",\n                        width: width,\n                        height: height,\n                        orientation: (width - height < 0) ? \"portrait\" : \"landscape\",\n                        lockAspectRatio: true\n                    };\n            },\n            canvasUI: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    canvasContainer = that.imageeditor.canvasContainer,\n                    cropOverlay = $(\"<div></div>\").addClass(paneStyles.cropOverlay),\n                    cropElement = $(\"<div></div>\").addClass(paneStyles.crop),\n                    handle = \"<span class='\" + paneStyles.resizeHandle + \"'></span>\",\n                    handles = [ \"nw\", \"n\", \"ne\", \"w\", \"e\", \"sw\", \"s\", \"se\" ],\n                    zoomLevel = imageeditor.getZoomLevel();\n\n                for (var i = 0; i < handles.length; i++) {\n                    var handleElm = $(handle)\n                        .addClass(paneStyles.resizeHandlePrefix + handles[i])\n                        .attr(\"data-orientation\", handles[i]);\n\n                    that._initResizeHandle(handleElm);\n\n                    cropElement.append(handleElm);\n                }\n\n                that.cropElement = cropElement;\n\n                that._canvasUI = cropOverlay\n                    .append(cropElement)\n                    .appendTo(canvasContainer);\n\n                var width = Math.round(that._model.width * zoomLevel);\n                var height = Math.round(that._model.height * zoomLevel);\n                var borderWidth = parseInt(that.cropElement.css(\"border-top-width\"), 10);\n\n                that.cropElement.css({\n                    width: width,\n                    height: height,\n                    backgroundImage: \"url('\" + imageeditor._image.src + \"')\",\n                    backgroundSize: kendo.format(\"{0}px {1}px\", width, height),\n                    backgroundClip: \"content-box\",\n                    backgroundPosition: kendo.format(\"-{0}px -{0}px\", borderWidth)\n                });\n\n                that.cropElement.kendoDraggable({\n                    ignore: \".\" + paneStyles.resizeHandle,\n                    drag: function(ev) {\n                        that._adjustTopLeft(ev.target.offsetTop + ev.y.delta, ev.target.offsetLeft + ev.x.delta);\n                    }\n                });\n            },\n            refresh: function() {\n                var that = this,\n                    newModel = that.formWidget._model,\n                    zoomLevel = that.imageeditor.getZoomLevel(),\n                    width = Math.round(newModel.width * zoomLevel),\n                    height = Math.round(newModel.height * zoomLevel),\n                    top = Math.round(newModel.top * zoomLevel),\n                    left = Math.round(newModel.left * zoomLevel),\n                    borderWidth = parseInt(that.cropElement.css(\"border-top-width\"), 10);\n\n                that.cropElement.css({\n                    top: top,\n                    left: left,\n                    width: width,\n                    height: height,\n                    backgroundSize: kendo.format(\"{0}px {1}px\", that._model.width * zoomLevel, that._model.height * zoomLevel),\n                    backgroundPosition: kendo.format(\"-{0}px -{1}px\", left + borderWidth, top + borderWidth)\n                });\n            },\n            _initResizeHandle: function(handle) {\n                var that = this;\n\n                handle.kendoDraggable({\n                    drag: function(ev) {\n                        var $target = $(ev.sender.element),\n                            newModel = that.formWidget._model,\n                            oldModel = that._model,\n                            orientation = $target.data(\"orientation\"),\n                            adjustments = {},\n                            zoomLevel = that.imageeditor.getZoomLevel(),\n                            correctedLeft = newModel.left * zoomLevel,\n                            correctedTop = newModel.top * zoomLevel;\n\n                        if (orientation.indexOf(\"w\") >= 0) {\n                            adjustments.left = that.cropElement[0].offsetLeft + ev.x.delta;\n                            adjustments.width = that.cropElement[0].offsetWidth - ev.x.delta;\n                        } else if (orientation.indexOf(\"e\") >= 0) {\n                            adjustments.width = that.cropElement[0].offsetWidth + ev.x.delta;\n                        }\n\n                        if (orientation.indexOf(\"n\") >= 0) {\n                            adjustments.top = that.cropElement[0].offsetTop + ev.y.delta;\n                            adjustments.height = that.cropElement[0].offsetHeight - ev.y.delta;\n                        } else if (orientation.indexOf(\"s\") >= 0) {\n                            adjustments.height = that.cropElement[0].offsetHeight + ev.y.delta;\n                        }\n\n                        if (adjustments.width && ((adjustments.left || correctedLeft) + adjustments.width <= oldModel.width * zoomLevel)) {\n                            newModel.set(\"width\", Math.round(adjustments.width / zoomLevel));\n                        }\n\n                        if (adjustments.height && ((adjustments.top || correctedTop) + adjustments.height <= oldModel.height * zoomLevel)) {\n                            newModel.set(\"height\", Math.round(adjustments.height / zoomLevel));\n                        }\n\n                        if (adjustments.top || adjustments.left) {\n                            that._adjustTopLeft(adjustments.top, adjustments.left);\n                        }\n                    }\n                });\n            },\n            _adjustTopLeft: function(top, left, compare) {\n                var that = this,\n                    compareModel = compare || that.formWidget._model,\n                    newModel = that.formWidget._model,\n                    oldModel = that._model,\n                    zoomLevel = that.imageeditor.getZoomLevel();\n\n                if (top >= 0 && (top / zoomLevel) + compareModel.height <= oldModel.height) {\n                    newModel.set(\"top\", Math.round(top / zoomLevel));\n                }\n\n                if (left >= 0 && (left / zoomLevel) + compareModel.width <= oldModel.width) {\n                    newModel.set(\"left\", Math.round(left / zoomLevel));\n                }\n            },\n            onChange: function(ev) {\n                var that = this,\n                    zoomLevel = that.imageeditor.getZoomLevel(),\n                    newModel = ev.sender._model,\n                    oldModel = that._model,\n                    maxWidth = oldModel.width,\n                    maxHeight = oldModel.height,\n                    originalRatio = oldModel.width + \":\" + oldModel.height,\n                    gcd = that._gcd(oldModel.width, oldModel.height);\n\n                originalRatio = oldModel.width / gcd + \":\" + oldModel.height / gcd;\n\n                if (ev.field === \"aspectRatio\" && ev.value === \"originalRatio\") {\n                    newModel.set(\"top\", 0);\n                    newModel.set(\"left\", 0);\n                    newModel.set(\"orientation\", oldModel.orientation);\n                    newModel.set(\"width\", oldModel.width);\n                    newModel.set(\"height\", oldModel.height);\n                } else if (ev.field === \"orientation\") {\n                    var tempModel = extend({}, newModel, {\n                        width: newModel.height,\n                        height: newModel.width\n                    });\n\n                    var newSize = that._calcSize(tempModel, originalRatio, maxWidth, maxHeight);\n\n                    newModel.set(\"width\", newSize.width);\n                    newModel.set(\"height\", newSize.height);\n                    that._orientationWidget.select(ev.value === \"portrait\" ? 0 : 1);\n                } else if (newModel.lockAspectRatio) {\n                    var force = ev.field;\n                    var size = that._calcSize(newModel, originalRatio, maxWidth, maxHeight, force);\n                    newModel.set(\"width\", size.width);\n                    newModel.set(\"height\", size.height);\n                }\n\n                var width = Math.round(newModel.width * zoomLevel);\n                var height = Math.round(newModel.height * zoomLevel);\n                var top = Math.round(newModel.top * zoomLevel);\n                var left = Math.round(newModel.left * zoomLevel);\n                var borderWidth = parseInt(that.cropElement.css(\"border-top-width\"), 10);\n\n                that.cropElement.css({\n                    top: top,\n                    left: left,\n                    width: width,\n                    height: height,\n                    backgroundPosition: kendo.format(\"-{0}px -{1}px\", left + borderWidth, top + borderWidth)\n                });\n            },\n            _calcSize: function(model, originalRatio, maxWidth, maxHeight, force) {\n                var width = Math.min(model.width, maxWidth),\n                    height = Math.min(model.height, maxHeight),\n                    isPortrait = model.orientation === \"portrait\",\n                    ratios = model.aspectRatio;\n\n                if (ratios.indexOf(\":\") < 0) {\n                    ratios = originalRatio;\n                }\n\n                ratios = ratios.split(\":\").map(function(value) {\n                    return parseInt(value, 10);\n                });\n\n                var wRatio = isPortrait ? Math.min(ratios[0], ratios[1]) : Math.max(ratios[0], ratios[1]);\n                var hRatio = !isPortrait ? Math.min(ratios[0], ratios[1]) : Math.max(ratios[0], ratios[1]);\n                var expectedRatio = round(wRatio / hRatio);\n                var realRatio = round(width / height);\n\n                var sizeByRatio = {\n                    width: Math.round(height * expectedRatio),\n                    height: Math.round(width / expectedRatio)\n                };\n\n                if (force === \"width\") {\n                    return {\n                        width: width,\n                        height: sizeByRatio.height\n                    };\n                }\n\n                if (force === \"height\") {\n                    return {\n                        width: sizeByRatio.width,\n                        height: height\n                    };\n                }\n\n                if (realRatio > expectedRatio) {\n                    width = sizeByRatio.width;\n                } else if (realRatio < expectedRatio) {\n                    height = sizeByRatio.height;\n                }\n\n                return {\n                    width: width,\n                    height: height\n                };\n            },\n            _gcd: function(a, b) {\n                return (b === 0) ? a : this._gcd (b, a % b);\n            },\n            destroy: function() {\n                kendo.destroy(this._canvasUI);\n                this._canvasUI.remove();\n                Pane.fn.destroy.call(this);\n            }\n        });\n\n        var ResizePane = Pane.extend({\n            init: function(imageeditor) {\n                Pane.fn.init.call(this, imageeditor);\n                this.buildResizeModel();\n            },\n            confirm: function() {\n                var that = this,\n                    originalWidth = that._model.width,\n                    originalHeight = that._model.height,\n                    model = that.formWidget._model.toJSON();\n\n                if (model.measure === \"percents\") {\n                    model.width = originalWidth * (model.width / 100);\n                    model.height = originalHeight * (model.height / 100);\n                }\n\n                that.imageeditor.executeCommand({ command: \"ResizeImageEditorCommand\", options: model });\n                that.destroy();\n            },\n            formSettings: function() {\n                var that = this,\n                    resizeMessages = that.imageeditor.options.messages.panes.resize,\n                    commonMessages = that.imageeditor.options.messages.common;\n\n                return {\n                    formData: that._model,\n                    change: that.onChange.bind(that),\n                    items: [{\n                        type: \"group\",\n                        label: resizeMessages.title || \"Resize image\",\n                        layout: \"grid\",\n                        grid: { cols: 2, gutter: \"0 8px\" },\n                        items: [{\n                            label: commonMessages.width || \"Width:\",\n                            field: \"width\",\n                            attributes: { style: \"max-width: 100px;\" },\n                            editor: \"NumericTextBox\",\n                            editorOptions: {\n                                format: \"n0\",\n                                min: 0\n                            },\n                            colSpan: 1\n                        }, {\n                            field: \"measureW\",\n                            editor: \"DropDownList\",\n                            attributes: { style: \"max-width: 100px;\" },\n                            label: { text: \"&nbsp;\", encoded: false },\n                            editorOptions: {\n                                dataTextField: \"text\",\n                                dataValueField: \"value\",\n                                dataSource: [\n                                    { text: resizeMessages.pixels || \"Pixels\", value: \"pixels\" },\n                                    { text: resizeMessages.percents || \"Percents\", value: \"percents\" }\n                                ]\n                            },\n                            colSpan: 1\n                        }, {\n                            label: commonMessages.height || \"Height:\",\n                            field: \"height\",\n                            attributes: { style: \"max-width: 100px;\" },\n                            editor: \"NumericTextBox\",\n                            editorOptions: {\n                                format: \"n0\",\n                                min: 0\n                            },\n                            colSpan: 1\n                        }, {\n                            field: \"measureH\",\n                            label: { text: \"&nbsp;\", encoded: false },\n                            attributes: { style: \"max-width: 100px;\" },\n                            editor: \"DropDownList\",\n                            editorOptions: {\n                                dataTextField: \"text\",\n                                dataValueField: \"value\",\n                                dataSource: [\n                                    { text: resizeMessages.pixels || \"Pixels\", value: \"pixels\" },\n                                    { text: resizeMessages.percents || \"Percents\", value: \"percents\" }\n                                ]\n                            },\n                            colSpan: 1\n                        }, {\n                            label: commonMessages.lockAspectRatio || \"Lock aspect ratio\",\n                            field: \"lockAspectRatio\",\n                            colSpan: 2\n                        }]\n                    }]\n                };\n            },\n            buildResizeModel: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    canvas = imageeditor.getCanvasElement(),\n                    width = canvas.width,\n                    height = canvas.height;\n\n                    that._model = {\n                        width: width,\n                        height: height,\n                        measure: \"pixels\",\n                        measureW: \"pixels\",\n                        measureH: \"pixels\",\n                        lockAspectRatio: true,\n                        ratio: round(width / height)\n                    };\n            },\n            onChange: function(ev) {\n                var that = this,\n                    newModel = ev.sender._model,\n                    aspectRatioLocked = newModel.lockAspectRatio;\n\n                if (ev.field === \"measureW\" || ev.field === \"measureH\") {\n                    newModel.set(\"measureW\", ev.value);\n                    newModel.set(\"measureH\", ev.value);\n                    newModel.set(\"measure\", ev.value);\n                } else if (ev.field === \"measure\") {\n                    that.resetNumericsTo(ev.value);\n                } else if (ev.field === \"width\" && aspectRatioLocked && !that._preventChange) {\n                    newModel.set(\"height\", newModel.width / newModel.ratio);\n                } else if (ev.field === \"height\" && aspectRatioLocked && !that._preventChange) {\n                    newModel.set(\"width\", newModel.height * newModel.ratio);\n                }\n\n                newModel.set(\"ratio\", round(newModel.width / newModel.height));\n            },\n            resetNumericsTo: function(type) {\n                var that = this,\n                    originalWidth = that._model.width,\n                    originalHeight = that._model.height,\n                    formWidget = that.formWidget,\n                    model = formWidget._model,\n                    widthNumeric = formWidget.element.find(\"[name=width]\").data(\"kendoNumericTextBox\"),\n                    heightNumeric = formWidget.element.find(\"[name=height]\").data(\"kendoNumericTextBox\"),\n                    isPercent = type === \"percents\",\n                    options = {\n                        percents: {\n                            format: \"#\\\\\\%\"\n                        },\n                        pixels: {\n                            format: \"n0\"\n                        }\n                    };\n\n\n                widthNumeric.setOptions(options[type]);\n                heightNumeric.setOptions(options[type]);\n\n                that._preventChange = true;\n                model.set(\"width\", isPercent ? (originalWidth / widthNumeric.value()) * 100 : originalWidth * (widthNumeric.value() / 100));\n                model.set(\"height\", isPercent ? (originalHeight / heightNumeric.value()) * 100 : originalHeight * (heightNumeric.value() / 100));\n                that._preventChange = false;\n            }\n        });\n\n        extend(kendo.ui.imageeditor, {\n            ImageEditorPane: Pane,\n            panes: {\n                crop: CropPane,\n                resize: ResizePane\n            }\n    });\n\n    })(window.kendo.jQuery);\n\n    return window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n(function(f, define) {\n    define('imageeditor/commands',[\"./pane\", \"kendo.upload\"], f);\n})(function() {\n\n    (function($, undefined) {\n        var kendo = window.kendo,\n            imageeditorNS = kendo.ui.imageeditor,\n            extend = $.extend,\n            Class = kendo.Class;\n\n        var Command = Class.extend({\n            init: function(options) {\n                this.options = extend({}, options, this.options);\n                this.imageeditor = options.imageeditor;\n            }\n        });\n\n        var OpenPaneImageEditorCommand = Command.extend({\n            init: function(options) {\n                Command.fn.init.call(this, options);\n            },\n            exec: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    pane = new imageeditorNS.panes[that.options.value](imageeditor);\n\n                    pane.open();\n            }\n        });\n\n        var ZoomImageEditorCommand = Command.extend({\n            options: {\n                zoomStep: 0.05,\n                spacing: 20\n            },\n            init: function(options) {\n                Command.fn.init.call(this, options);\n            },\n            exec: function() {\n                var that = this,\n                    options = that.options,\n                    value = options.value,\n                    imageeditor = that.imageeditor,\n                    imgHeight = imageeditor._image.height,\n                    currentZoom = imageeditor.getZoomLevel(),\n                    newHeight = imgHeight;\n\n                    if (!isNaN(value)) {\n                        value = parseFloat(value);\n                    } else if (typeof value === \"string\") {\n                        value = that._processStringValue(value, currentZoom);\n                    }\n\n                    newHeight = Math.round(imgHeight * value);\n\n                    if (newHeight > 0) {\n                        $(imageeditor._canvas).css(\"height\", newHeight);\n                        imageeditor._zoomLevel = value;\n                    }\n\n                    if (imageeditor.currentPaneTool) {\n                        imageeditor.currentPaneTool.refresh();\n                    }\n            },\n            _processStringValue: function(value, initialZoom) {\n                var that = this,\n                    options = that.options,\n                    imageeditor = that.imageeditor,\n                    imgHeight = imageeditor._image.height,\n                    expectedHeight = imageeditor.canvasWrapper.height() - options.spacing,\n                    zoomStep = options.zoomStep;\n\n                switch (value) {\n                    case \"zoomIn\":\n                        return initialZoom + zoomStep;\n                    case \"zoomOut\":\n                        return initialZoom - zoomStep;\n                    case \"fitToScreen\":\n                        return Math.round((expectedHeight / imgHeight) * 100) / 100;\n                    default:\n                        return 1;\n                }\n            }\n        });\n\n        var CropImageEditorCommand = Command.extend({\n            init: function(options) {\n                Command.fn.init.call(this, options);\n            },\n            exec: function() {\n                var that = this,\n                    options = that.options,\n                    imageeditor = that.imageeditor,\n                    canvas = imageeditor.getCanvasElement(),\n                    ctx = imageeditor.getCurrent2dContext(),\n                    croppedImage = ctx.getImageData(options.left, options.top, options.width, options.height);\n\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                canvas.width = options.width;\n                canvas.height = options.height;\n                ctx.putImageData(croppedImage, 0, 0);\n\n                imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                    imageeditor.drawCanvas(image);\n                }).fail(function(ev) {\n                    imageeditor.trigger(\"error\", ev);\n                });\n            }\n        });\n\n        var ResizeImageEditorCommand = Command.extend({\n            init: function(options) {\n                Command.fn.init.call(this, options);\n            },\n            exec: function() {\n                var that = this,\n                    options = that.options,\n                    imageeditor = that.imageeditor,\n                    canvas = imageeditor.getCanvasElement(),\n                    ctx = imageeditor.getCurrent2dContext(),\n                    image = imageeditor.getCurrentImage();\n\n                ctx.clearRect(0, 0, canvas.width, canvas.height);\n                canvas.width = options.width;\n                canvas.height = options.height;\n                ctx.drawImage(image, 0, 0, options.width, options.height);\n\n                imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                    imageeditor.drawCanvas(image);\n                }).fail(function(ev) {\n                    imageeditor.trigger(\"error\", ev);\n                });\n            }\n        });\n\n        var UndoImageEditorCommand = Command.extend({\n            exec: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    canvas = imageeditor.getCanvasElement(),\n                    ctx = imageeditor.getCurrent2dContext(),\n                    image = imageeditor.undoStack.pop();\n\n                if (image) {\n                    imageeditor.redoStack.push(imageeditor.getCurrentImage());\n                    delete imageeditor._image;\n\n                    ctx.clearRect(0, 0, canvas.width, canvas.height);\n                    canvas.width = image.width;\n                    canvas.height = image.height;\n                    ctx.drawImage(image, 0, 0, image.width, image.height);\n\n                    imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                        imageeditor.drawCanvas(image);\n                    }).fail(function(ev) {\n                        imageeditor.trigger(\"error\", ev);\n                    });\n                }\n            }\n        });\n\n        var RedoImageEditorCommand = Command.extend({\n            exec: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    canvas = imageeditor.getCanvasElement(),\n                    ctx = imageeditor.getCurrent2dContext(),\n                    image = imageeditor.redoStack.pop();\n\n                if (image) {\n                    imageeditor.undoStack.push(imageeditor.getCurrentImage());\n                    delete imageeditor._image;\n\n                    ctx.clearRect(0, 0, canvas.width, canvas.height);\n                    canvas.width = image.width;\n                    canvas.height = image.height;\n                    ctx.drawImage(image, 0, 0, image.width, image.height);\n\n                    imageeditor.drawImage(canvas.toDataURL()).done(function(image) {\n                        imageeditor.drawCanvas(image);\n                    }).fail(function(ev) {\n                        imageeditor.trigger(\"error\", ev);\n                    });\n                }\n            }\n        });\n\n        var SaveImageEditorCommand = Command.extend({\n            exec: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    canvas = imageeditor.getCanvasElement();\n\n                kendo.saveAs(extend({}, imageeditor.options.saveAs, {\n                    dataURI: canvas.toDataURL()\n                }));\n            }\n        });\n\n        var OpenImageEditorCommand = Command.extend({\n            exec: function() {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    upload = imageeditor._upload;\n\n                if (!upload) {\n                    var input = $(\"<input type='file' />\");\n                    input.kendoUpload({\n                        select: that.onSelect.bind(that),\n                        error: that.onError.bind(that),\n                        multiple: false,\n                        validation: {\n                            allowedExtensions: [\".jpg\", \".jpeg\", \".gif\", \".png\", \".bmp\", \".tiff\", \".webp\"]\n                        }\n                    });\n\n                    imageeditor._upload = upload = input.getKendoUpload();\n\n                }\n\n                upload.element.click();\n            },\n            onSelect: function(ev) {\n                var that = this,\n                    imageeditor = that.imageeditor,\n                    file = ev.files[0].rawFile,\n                    reader = new FileReader();\n\n                reader.addEventListener(\"load\", function() {\n                    imageeditor.drawImage(reader.result).done(function(image) {\n                        if (!imageeditor.trigger(\"imageLoaded\", { image: image })) {\n                            imageeditor.drawCanvas(image);\n                            imageeditor._initUndoRedoStack();\n                            imageeditor._toggleTools();\n                        }\n                    }).fail(function(ev) {\n                        imageeditor.trigger(\"error\", ev);\n                    });\n                }, false);\n\n\n                if (file) {\n                    reader.readAsDataURL(file);\n                }\n\n            },\n            onError: function(ev) {\n                var that = this,\n                    imageeditor = that.imageeditor;\n\n                imageeditor.trigger(\"error\", ev);\n            }\n        });\n\n        extend(kendo.ui.imageeditor, {\n            ImageEditorCommand: Command,\n            commands: {\n                OpenPaneImageEditorCommand: OpenPaneImageEditorCommand,\n                ZoomImageEditorCommand: ZoomImageEditorCommand,\n                CropImageEditorCommand: CropImageEditorCommand,\n                ResizeImageEditorCommand: ResizeImageEditorCommand,\n                UndoImageEditorCommand: UndoImageEditorCommand,\n                RedoImageEditorCommand: RedoImageEditorCommand,\n                SaveImageEditorCommand: SaveImageEditorCommand,\n                OpenImageEditorCommand: OpenImageEditorCommand\n            }\n    });\n\n    })(window.kendo.jQuery);\n\n    return window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n(function(f, define) {\n    define('kendo.imageeditor',[\n        \"./imageeditor/toolbar\",\n        \"./imageeditor/commands\"\n    ], f);\n})(function() {\n\nvar __meta__ = {\n    id: \"imageeditor\",\n    name: \"ImageEditor\",\n    category: \"web\",\n    depends: [\"core\"]\n};\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        extend = $.extend,\n        isPlainObject = $.isPlainObject,\n        Widget = kendo.ui.Widget,\n        ui = kendo.ui,\n\n        NS = \".kendoImageEditor\",\n\n        outerHeight = kendo._outerHeight,\n\n        ERROR = \"error\",\n        IMAGELOADED = \"imageLoaded\",\n        IMAGERENDERED = \"imageRendered\",\n        EXECUTE = \"execute\";\n\n    var imageEditorStyles = {\n        wrapper: \"k-widget k-imageeditor\",\n        header: \"k-imageeditor-header\",\n        toolbar: \"k-imageeditor-toolbar\",\n        paneWrapper: \"k-imageeditor-action-pane\",\n        contentWrapper: \"k-imageeditor-content\",\n        canvasWrapper: \"k-imageeditor-canvas-container\",\n        canvasContainer: \"k-imageeditor-canvas\"\n    };\n\n    var ImageEditor = Widget.extend({\n        init: function(element, options) {\n            var that = this;\n\n            Widget.fn.init.call(that, element, options);\n            options = $.extend(true, {}, options);\n\n            that._wrapper();\n            that._renderHeader();\n            that._contentWrapper();\n            that._keyHandler();\n\n            if (options.imageUrl) {\n                that._drawCanvas();\n            }\n\n            that._initUndoRedoStack();\n            that._toggleTools();\n\n            kendo.notify(that);\n        },\n\n        options: {\n            name: 'ImageEditor',\n            width: \"100%\",\n            height: 570,\n            imageUrl: \"\",\n            toolbar: {\n            },\n            saveAs: {\n                fileName: \"image.png\"\n            },\n            messages: {\n                toolbar: {\n                    open: \"Open Image\",\n                    save: \"Save Image\",\n                    undo: \"Undo\",\n                    redo: \"Redo\",\n                    crop: \"Crop\",\n                    resize: \"Resize\",\n                    zoomIn: \"Zoom In\",\n                    zoomOut: \"Zoom Out\",\n                    zoomDropdown: \"Zoom options\",\n                    zoomActualSize: \"Show actual size\",\n                    zoomFitToScreen: \"Fit to screen\"\n                },\n                panes: {\n                    crop: {\n                        title: \"Crop Image\",\n                        aspectRatio: \"Aspect Ratio:\",\n                        aspectRatioItems: {\n                            \"originalRatio\": \"Original ratio\",\n                            \"1:1\": \"1:1 (Square)\",\n                            \"4:5\": \"4:5 (8:10)\",\n                            \"5:7\": \"5:7\",\n                            \"2:3\": \"2:3 (4:6)\",\n                            \"16:9\": \"16:9\"\n                        },\n                        orientation: \"Orientation:\",\n                        portrait: \"Portrait\",\n                        landscape: \"Landscape\"\n                    },\n                    resize: {\n                        title: \"Resize image\",\n                        pixels: \"Pixels\",\n                        percents: \"Percents\"\n                    }\n                },\n                common: {\n                    width: \"Width:\",\n                    height: \"Height:\",\n                    cancel: \"Cancel\",\n                    confirm: \"Confirm\",\n                    lockAspectRatio: \"Lock aspect ratio\"\n                }\n            }\n        },\n\n        events: [\n            ERROR,\n            IMAGELOADED,\n            IMAGERENDERED,\n            EXECUTE\n        ],\n\n        _wrapper: function() {\n            var that = this,\n                options = that.options,\n                width = options.width,\n                height = options.height;\n\n            that.wrapper = that.element\n                .addClass(imageEditorStyles.wrapper);\n\n            if (width) {\n                that.wrapper.width(width);\n            }\n\n            if (height) {\n                that.wrapper.height(height);\n            }\n\n            that._resizeHandler = kendo.onResize(function() {\n                that.resize(true);\n            });\n        },\n\n        _renderHeader: function() {\n            var that = this,\n                options = that.options;\n\n            that.header = $(\"<div />\").addClass(imageEditorStyles.header);\n            that.wrapper.append(that.header);\n\n            if (options.toolbar) {\n                that._initToolbar();\n                that.toolbar._tabIndex();\n            }\n        },\n\n        _initToolbar: function() {\n            var that = this,\n                options = that.options,\n                toolbarElement = $(\"<div></div>\").addClass(imageEditorStyles.toolbar),\n                toolbarOptions = extend({}, options.toolbar, {\n                    messages: options.messages.toolbar,\n                    action: that.executeCommand.bind(that)\n                });\n\n            that.header.append(toolbarElement);\n\n            that.toolbar = new ui.imageeditor.ToolBar(toolbarElement, toolbarOptions);\n\n            return that.toolbar;\n        },\n\n        _contentWrapper: function() {\n            var that = this,\n                contentWrapper = $(\"<div></div>\").addClass(imageEditorStyles.contentWrapper),\n                canvasWrapper = $(\"<div></div>\").addClass(imageEditorStyles.canvasWrapper),\n                canvasContainer = $(\"<div></div>\").addClass(imageEditorStyles.canvasContainer),\n                paneWrapper = $(\"<div></div>\").addClass(imageEditorStyles.paneWrapper).hide(),\n                toolbarHeight = outerHeight(that.header);\n\n            that.canvasWrapper = canvasWrapper;\n            that.canvasContainer = canvasContainer;\n            that.paneWrapper = paneWrapper;\n\n            canvasWrapper.append(canvasContainer);\n\n            contentWrapper.height(outerHeight(that.wrapper) - toolbarHeight);\n\n            contentWrapper.append(canvasWrapper).append(paneWrapper);\n            that.wrapper.append(contentWrapper);\n        },\n\n        _keyHandler: function() {\n            var that = this,\n                prevent = false;\n\n            that.wrapper.on(\"keydown\" + NS, function(ev) {\n                if (ev.ctrlKey) {\n                    switch (ev.keyCode) {\n                        case 48: // ctrl+0\n                            that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"fitToScreen\" });\n                            prevent = true;\n                            break;\n                        case 189: // ctrl+-\n                            that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"zoomOut\" });\n                            prevent = true;\n                            break;\n                        case 187: // ctrl++\n                            that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"zoomIn\" });\n                            prevent = true;\n                            break;\n                        case 90: // ctrl+z\n                            that.executeCommand({ command: \"UndoImageEditorCommand\" });\n                            prevent = true;\n                            break;\n                        case 89: // ctrl+y\n                            that.executeCommand({ command: \"RedoImageEditorCommand\" });\n                            prevent = true;\n                            break;\n                    }\n\n                    if (prevent) {\n                        ev.preventDefault();\n                    }\n                }\n            });\n        },\n\n        _drawCanvas: function() {\n            var that = this;\n            var imageUrl = that.options.imageUrl;\n\n            that.drawImage(imageUrl).done(function(image) {\n                if (!that.trigger(IMAGELOADED, { image: image })) {\n                    that.drawCanvas(image);\n                }\n            }).fail(function(ev) {\n                that.trigger(ERROR, ev);\n            });\n        },\n\n        _initUndoRedoStack: function() {\n            var that = this;\n\n            that.undoStack = [];\n            that.redoStack = [];\n        },\n\n        _toggleTools: function() {\n            var that = this,\n                canRedo = that.redoStack.length > 0,\n                canUndo = that.undoStack.length > 0,\n                hasImage = !!that._image,\n                canExport = true;\n\n            try {\n                that._canvas.toDataURL();\n            } catch (error) {\n                canExport = false;\n            }\n\n            that.toolbar.toggleTools({\n                redo: canRedo,\n                undo: canUndo,\n                enable: hasImage,\n                canExport: canExport\n            });\n        },\n\n        drawImage: function(imageUrl) {\n            var that = this,\n                deferred = new $.Deferred(),\n                image = new Image();\n\n            image.onload = function() {\n                kendo.ui.progress(that.canvasContainer, false);\n                deferred.resolve(image);\n            };\n\n            image.onerror = function() {\n                kendo.ui.progress(that.canvasContainer, false);\n                deferred.reject(arguments);\n            };\n\n            kendo.ui.progress(that.canvasContainer, true);\n\n            image.src = imageUrl;\n\n            return deferred.promise();\n        },\n\n        drawCanvas: function(image) {\n            var that = this;\n            var canvas = $(\"<canvas>Canvas element</canvas>\")[0];\n            var ctx = canvas.getContext('2d');\n\n            if (that._canvas) {\n                $(that._canvas).remove();\n            }\n\n            if (that._image) {\n                that.undoStack.push(that._image);\n            }\n\n            that._canvas = canvas;\n            that._ctx = ctx;\n            that._image = image;\n\n            canvas.width = image.width;\n            canvas.height = image.height;\n\n            ctx.drawImage(image, 0, 0);\n\n            that.canvasContainer.append(canvas);\n\n            if (image.height > that.canvasWrapper.height()) {\n                that.executeCommand({ command: \"ZoomImageEditorCommand\", options: \"fitToScreen\" });\n            } else {\n                that.executeCommand({ command: \"ZoomImageEditorCommand\", options: that.getZoomLevel() });\n            }\n\n            that.trigger(IMAGERENDERED, {\n                canvas: canvas,\n                ctx: ctx,\n                image: image\n            });\n\n            that._toggleTools();\n        },\n\n        getCanvasElement: function() {\n            return this._canvas;\n        },\n\n        getCurrent2dContext: function() {\n            return this._ctx;\n        },\n\n        getCurrentImage: function() {\n            return this._image;\n        },\n\n        executeCommand: function(args) {\n            var commandName = args.command,\n                commandOptions = extend({ imageeditor: this }, isPlainObject(args.options) ? args.options : { value: args.options }),\n                command = new ui.imageeditor.commands[commandName](commandOptions);\n\n            if (!this.trigger(EXECUTE, args)) {\n                this._toggleTools();\n                return command.exec();\n            }\n        },\n\n        getZoomLevel: function() {\n            return this._zoomLevel || 1;\n        },\n\n        destroy: function() {\n            var that = this;\n\n            that.element.off(NS);\n\n            if (that.currentPaneTool) {\n                that.currentPaneTool.destroy();\n            }\n\n            if (that.toolbar) {\n                that.toolbar.destroy();\n            }\n\n            if (that._upload) {\n                that._upload.destroy();\n            }\n\n\n            Widget.fn.destroy.call(that);\n        }\n    });\n    ui.plugin(ImageEditor);\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","$","window","kendo","jQuery","undefined","ui","extend","ToolBar","TemplateItem","toolbar","CLICK","DROPDOWNCHANGE","ACTION","ImageEditorToolBar","init","element","options","that","this","_extendOptions","fn","call","_attachEvents","toggleTools","events","concat","defaultTools","open","type","icon","name","command","showText","save","toggleCondition","separator","undo","redo","separator1","crop","resize","zoomIn","zoomOut","zoomDropdown","text","items","bind","_dropDownChange","_click","tools","Object","keys","_extendToolsOptions","messages","length","map","tool","isBuiltInTool","isPlainObject","toolOptions","deepExtend","id","guid","attributes","aria-label","title","data-command","data-options","data-toggle","overflow","ev","target","data","action","args","trigger","conditions","find","focusable","not","each","index","elm","widget","condition","toToggle","is","widgetInstance","enable","attr","destroy","ImageEditorZoomDropDown","input","template","dropDown","DropDownList","optionLabel","dataTextField","dataSource","change","_change","wrapper","list","hide","sender","dataItem","registerComponent","imageeditor","ZoomDropDown","amd","a1","a2","a3","Class","NS","paneStyles","form","button","confirmButton","cropOverlay","resizeHandle","resizeHandlePrefix","round","f","Math","Pane","currentPaneTool","addClass","commonMessages","common","paneWrapper","append","formWidget","Form","formSettings","buttonsTemplate","format","cancel","confirm","bindButtonEvents","show","buttons","_clickHandler","on","closest","console","error","refresh","off","html","CropPane","buildCropModel","canvasUI","model","_model","toJSON","executeCommand","cropMessages","panes","aspectRatioItems","aspectRatioDS","key","push","value","formData","onChange","label","layout","grid","cols","gutter","aspectRatio","field","editor","editorOptions","dataValueField","colSpan","orientation","_orientationEditor","width","style","max","min","height","lockAspectRatio","container","_orientationWidget","appendTo","kendoButtonGroup","portrait","data-value","selected","landscape","select","set","canvas","getCanvasElement","top","left","canvasContainer","cropElement","handle","handles","zoomLevel","getZoomLevel","i","handleElm","_initResizeHandle","_canvasUI","borderWidth","parseInt","css","backgroundImage","_image","src","backgroundSize","backgroundClip","backgroundPosition","kendoDraggable","ignore","drag","_adjustTopLeft","offsetTop","y","delta","offsetLeft","x","newModel","$target","oldModel","adjustments","correctedLeft","correctedTop","indexOf","offsetWidth","offsetHeight","compare","compareModel","maxWidth","maxHeight","originalRatio","gcd","_gcd","tempModel","newSize","_calcSize","force","size","isPortrait","ratios","split","wRatio","hRatio","expectedRatio","realRatio","sizeByRatio","a","b","remove","ResizePane","buildResizeModel","originalWidth","originalHeight","measure","resizeMessages","encoded","pixels","percents","measureW","measureH","ratio","aspectRatioLocked","resetNumericsTo","_preventChange","widthNumeric","heightNumeric","isPercent","setOptions","ImageEditorPane","imageeditorNS","Command","OpenPaneImageEditorCommand","exec","pane","ZoomImageEditorCommand","zoomStep","spacing","imgHeight","currentZoom","newHeight","isNaN","parseFloat","_processStringValue","_canvas","_zoomLevel","initialZoom","expectedHeight","canvasWrapper","CropImageEditorCommand","ctx","getCurrent2dContext","croppedImage","getImageData","clearRect","putImageData","drawImage","toDataURL","done","image","drawCanvas","fail","ResizeImageEditorCommand","getCurrentImage","UndoImageEditorCommand","undoStack","pop","redoStack","RedoImageEditorCommand","SaveImageEditorCommand","saveAs","dataURI","OpenImageEditorCommand","upload","_upload","kendoUpload","onSelect","onError","multiple","validation","allowedExtensions","getKendoUpload","click","file","files","rawFile","reader","FileReader","addEventListener","result","_initUndoRedoStack","_toggleTools","readAsDataURL","ImageEditorCommand","commands","__meta__","category","depends","Widget","outerHeight","_outerHeight","ERROR","IMAGELOADED","IMAGERENDERED","EXECUTE","imageEditorStyles","header","contentWrapper","ImageEditor","_wrapper","_renderHeader","_contentWrapper","_keyHandler","imageUrl","_drawCanvas","notify","fileName","zoomActualSize","zoomFitToScreen","1:1","4:5","5:7","2:3","16:9","_resizeHandler","onResize","_initToolbar","_tabIndex","toolbarElement","toolbarOptions","toolbarHeight","prevent","ctrlKey","keyCode","preventDefault","canRedo","canUndo","hasImage","canExport","deferred","Deferred","Image","onload","progress","resolve","onerror","reject","arguments","promise","getContext","_ctx","commandName","commandOptions","plugin"],"mappings":"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"}